/*! For license information please see f31f4aa12bc797f51dc8.js.LICENSE.txt */
!function(){"use strict";function t(t){t.poolIndex=0,t.pool=[];for(var e=0;e<64;e++)t.pool.push(new t);t.alloc=function(){return this.poolIndex++,this.pool[this.poolIndex-1]},t.free=function(t){this.poolIndex-=t}}function e(t){return e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},e(t)}function n(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,o(r.key),r)}}function r(t,e,n){return(e=o(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function o(t){var n=function(t){if("object"!=e(t)||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var r=n.call(t,"string");if("object"!=e(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==e(n)?n:n+""}var i=new Float32Array(12),u=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t);var e=new Float32Array(12);return t.setInit(e),e}var e,r;return e=t,r=[{key:"setInit",value:function(t){t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t[9]=0,t[10]=0,t[11]=0}},{key:"setValue",value:function(t,e,n,r,o,i,a,u,s,c,f,l,h){this.setValues(t,e,n,r,o,i,a,u,s,c,f,l,h)}},{key:"setValues",value:function(t,e,n,r,o,i,a,u,s,c,f,l,h){t[0]=e,t[1]=n,t[2]=r,t[3]=o,t[4]=i,t[5]=a,t[6]=u,t[7]=s,t[8]=c,t[9]=f,t[10]=l,t[11]=h}},{key:"copy",value:function(t,e){t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11]}},{key:"copyMat44",value:function(t,e){t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[4],t[4]=e[5],t[5]=e[6],t[6]=e[8],t[7]=e[9],t[8]=e[10],t[9]=e[12],t[10]=e[13],t[11]=e[14]}},{key:"mul",value:function(t,e,n){t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t[3]=e[3]*n,t[4]=e[4]*n,t[5]=e[5]*n,t[6]=e[6]*n,t[7]=e[7]*n,t[8]=e[8]*n,t[9]=e[9]*n,t[10]=e[10]*n,t[11]=e[11]*n}},{key:"dotVec4",value:function(t,e,n){var r=n[0],o=n[1],i=n[2],a=n[3];t[0]=e[0]*r+e[3]*o+e[6]*i+e[9]*a,t[1]=e[1]*r+e[4]*o+e[7]*i+e[10]*a,t[2]=e[2]*r+e[5]*o+e[8]*i+e[11]*a,t[3]=a}},{key:"dot",value:function(t,e,n){i[0]=e[0]*n[0]+e[3]*n[1]+e[6]*n[2],i[1]=e[1]*n[0]+e[4]*n[1]+e[7]*n[2],i[2]=e[2]*n[0]+e[5]*n[1]+e[8]*n[2],i[3]=e[0]*n[3]+e[3]*n[4]+e[6]*n[5],i[4]=e[1]*n[3]+e[4]*n[4]+e[7]*n[5],i[5]=e[2]*n[3]+e[5]*n[4]+e[8]*n[5],i[6]=e[0]*n[6]+e[3]*n[7]+e[6]*n[8],i[7]=e[1]*n[6]+e[4]*n[7]+e[7]*n[8],i[8]=e[2]*n[6]+e[5]*n[7]+e[8]*n[8],i[9]=e[0]*n[9]+e[3]*n[10]+e[6]*n[11]+e[9],i[10]=e[1]*n[9]+e[4]*n[10]+e[7]*n[11]+e[10],i[11]=e[2]*n[9]+e[5]*n[10]+e[8]*n[11]+e[11],t.set(i)}},{key:"dotMat44Mat43",value:function(t,e,n){var r=e[0]*n[0]+e[4]*n[1]+e[8]*n[2],o=e[1]*n[0]+e[5]*n[1]+e[9]*n[2],i=e[2]*n[0]+e[6]*n[1]+e[10]*n[2],a=e[0]*n[3]+e[4]*n[4]+e[8]*n[5],u=e[1]*n[3]+e[5]*n[4]+e[9]*n[5],s=e[2]*n[3]+e[6]*n[4]+e[10]*n[5],c=e[0]*n[6]+e[4]*n[7]+e[8]*n[8],f=e[1]*n[6]+e[5]*n[7]+e[9]*n[8],l=e[2]*n[6]+e[6]*n[7]+e[10]*n[8],h=e[0]*n[9]+e[4]*n[10]+e[8]*n[11]+e[12],p=e[1]*n[9]+e[5]*n[10]+e[9]*n[11]+e[13],v=e[2]*n[9]+e[6]*n[10]+e[10]*n[11]+e[14];t[0]=r,t[1]=o,t[2]=i,t[3]=a,t[4]=u,t[5]=s,t[6]=c,t[7]=f,t[8]=l,t[9]=h,t[10]=p,t[11]=v}},{key:"fromRotVector",value:function(t,e,n,r,o){var i=Math.sin(e),a=Math.cos(e);t[0]=n*n*(1-a)+a,t[3]=n*r*(1-a)-o*i,t[6]=o*n*(1-a)+r*i,t[1]=n*r*(1-a)+o*i,t[4]=r*r*(1-a)+a,t[7]=r*o*(1-a)-n*i,t[2]=o*n*(1-a)-r*i,t[5]=r*o*(1-a)+n*i,t[8]=o*o*(1-a)+a,t[9]=t[10]=t[11]=0}},{key:"getRotVector",value:function(t,e){var n=this.alloc(),r=e[0],o=e[1],i=e[2],a=Math.atan2(o,i)+Math.PI,u=Math.atan2(r,i);this.fromRotVector(t,-0,0,0,1),this.fromRotVector(n,-a,1,0,0),this.dot(t,t,n),this.fromRotVector(n,-u,0,1,0),this.dot(t,t,n),this.free(1)}},{key:"determinant",value:function(t){return t[0]*t[4]*t[8]+t[3]*t[7]*t[2]+t[6]*t[1]*t[5]-t[0]*t[7]*t[5]-t[3]*t[1]*t[8]-t[6]*t[4]*t[2]}},{key:"getInv",value:function(t,e){var n=e[0]*e[4]*e[8]+e[3]*e[7]*e[2]+e[6]*e[1]*e[5]-e[0]*e[7]*e[5]-e[3]*e[1]*e[8]-e[6]*e[4]*e[2];if(0!==Math.abs(n)){n=1/n;var r=e[0],o=e[1],i=e[2],a=e[3],u=e[4],s=e[5],c=e[6],f=e[7],l=e[8],h=e[9],p=e[10],v=e[11];t[0]=(u*l-f*s)*n,t[1]=(i*f-o*l)*n,t[2]=(o*s-u*i)*n,t[3]=(c*s-a*l)*n,t[4]=(r*l-c*i)*n,t[5]=(a*i-r*s)*n,t[6]=(a*f-u*c)*n,t[7]=(c*o-r*f)*n,t[8]=(r*u-a*o)*n,t[9]=(a*p*l+c*u*v+h*f*s-a*f*v-c*p*s-h*u*l)*n,t[10]=(r*f*v+c*p*i+h*o*l-r*p*l-c*o*v-h*f*i)*n,t[11]=(r*p*s+a*o*v+h*u*i-r*u*v-a*p*i-h*o*s)*n}}},{key:"fromQuat",value:function(t,e){var n=e[1]*e[1]*2,r=e[2]*e[2]*2,o=e[3]*e[3]*2,i=e[1]*e[2]*2,a=e[2]*e[3]*2,u=e[3]*e[1]*2,s=e[1]*e[0]*2,c=e[2]*e[0]*2,f=e[3]*e[0]*2;t[0]=1-r-o,t[1]=i+f,t[2]=u-c,t[3]=i-f,t[4]=1-o-n,t[5]=a+s,t[6]=u+c,t[7]=a-s,t[8]=1-n-r,t[9]=t[10]=t[11]=0}},{key:"fromEuler",value:function(e,n){var r=t.alloc();this.fromRotVector(e,n[0],1,0,0),this.fromRotVector(r,n[2],0,0,1),this.dot(e,r,e),this.fromRotVector(r,n[1],0,1,0),this.dot(e,r,e),t.free(1)}},{key:"fromLSE",value:function(e,n,r,o){t.fromEuler(e,o),e[0]*=r[0],e[1]*=r[0],e[2]*=r[0],e[3]*=r[1],e[4]*=r[1],e[5]*=r[1],e[6]*=r[2],e[7]*=r[2],e[8]*=r[2],e[9]=n[0],e[10]=n[1],e[11]=n[2]}},{key:"fromLSR",value:function(e,n,r,o){t.fromQuat(e,o),e[0]*=r[0],e[1]*=r[0],e[2]*=r[0],e[3]*=r[1],e[4]*=r[1],e[5]*=r[1],e[6]*=r[2],e[7]*=r[2],e[8]*=r[2],e[9]=n[0],e[10]=n[1],e[11]=n[2]}},{key:"toLSR",value:function(t,e,n,r){X.setValue(t,r[9],r[10],r[11]),X.setValue(e,Math.sqrt(r[0]*r[0]+r[1]*r[1]+r[2]*r[2]),Math.sqrt(r[3]*r[3]+r[4]*r[4]+r[5]*r[5]),Math.sqrt(r[6]*r[6]+r[7]*r[7]+r[8]*r[8]));var o=1/e[0],i=1/e[1],a=1/e[2],u=new Y;u[0]=r[0]*o,u[1]=r[1]*o,u[2]=r[2]*o,u[3]=r[3]*i,u[4]=r[4]*i,u[5]=r[5]*i,u[6]=r[6]*a,u[7]=r[7]*a,u[8]=r[8]*a,Y.getRotQuat(n,u)}},{key:"toLSE",value:function(t,e,n,r){X.setValue(t,r[9],r[10],r[11]),X.setValue(e,Math.sqrt(r[0]*r[0]+r[1]*r[1]+r[2]*r[2]),Math.sqrt(r[3]*r[3]+r[4]*r[4]+r[5]*r[5]),Math.sqrt(r[6]*r[6]+r[7]*r[7]+r[8]*r[8]));var o=1/e[0],i=1/e[1],a=1/e[2],u=new Y;u[0]=r[0]*o,u[1]=r[1]*o,u[2]=r[2]*o,u[3]=r[3]*i,u[4]=r[4]*i,u[5]=r[5]*i,u[6]=r[6]*a,u[7]=r[7]*a,u[8]=r[8]*a,Y.getEuler(n,u)}}],null&&n(e.prototype,null),r&&n(e,r),Object.defineProperty(e,"prototype",{writable:!1}),t}();function s(t){return s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},s(t)}function c(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,f(r.key),r)}}function f(t){var e=function(t){if("object"!=s(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var n=e.call(t,"string");if("object"!=s(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==s(e)?e:e+""}r(u,"dotVec3",function(t,e,n){var r=n[0],o=n[1],i=n[2];t[0]=e[0]*r+e[3]*o+e[6]*i+e[9],t[1]=e[1]*r+e[4]*o+e[7]*i+e[10],t[2]=e[2]*r+e[5]*o+e[8]*i+e[11]}),r(u,"dotMat33Vec3",function(t,e,n){var r=n[0],o=n[1],i=n[2];t[0]=e[0]*r+e[3]*o+e[6]*i,t[1]=e[1]*r+e[4]*o+e[7]*i,t[2]=e[2]*r+e[5]*o+e[8]*i});var l,h,p,v=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t);var o=new Float32Array(3);return o[0]=e,o[1]=n,o[2]=r,o}var e,n;return e=t,n=[{key:"setValues",value:function(t,e,n,r){t[0]=e,t[1]=n,t[2]=r}},{key:"setValue",value:function(t,e,n,r){this.setValues(t,e,n,r)}},{key:"copy",value:function(t,e){t[0]=e[0],t[1]=e[1],t[2]=e[2]}},{key:"add",value:function(t,e,n){t[0]=e[0]+n[0],t[1]=e[1]+n[1],t[2]=e[2]+n[2]}},{key:"sub",value:function(t,e,n){t[0]=e[0]-n[0],t[1]=e[1]-n[1],t[2]=e[2]-n[2]}},{key:"mult",value:function(t,e,n){t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n}},{key:"mul",value:function(t,e,n){t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n}},{key:"madd",value:function(t,e,n,r){this.mad(t,e,n,r)}},{key:"mad",value:function(t,e,n,r){t[0]=e[0]+n[0]*r,t[1]=e[1]+n[1]*r,t[2]=e[2]+n[2]*r}},{key:"len",value:function(t,e){var n=t[0]-e[0],r=t[1]-e[1],o=t[2]-e[2];return Math.sqrt(n*n+r*r+o*o)}},{key:"len2",value:function(t,e){var n=t[0]-e[0],r=t[1]-e[1],o=t[2]-e[2];return n*n+r*r+o*o}},{key:"scalar",value:function(t){return Math.sqrt(t[0]*t[0]+t[1]*t[1]+t[2]*t[2])}},{key:"scalar2",value:function(t){return t[0]*t[0]+t[1]*t[1]+t[2]*t[2]}},{key:"normalize",value:function(t,e){if(0!==e[0]||0!==e[1]||0!==e[2]){var n=Math.sqrt(e[0]*e[0]+e[1]*e[1]+e[2]*e[2]);n=1/n,t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n}}},{key:"nrm",value:function(t){this.normalize(t,t)}},{key:"norm",value:function(t){this.normalize(t,t)}},{key:"dot",value:function(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}},{key:"vecmul",value:function(t,e,n){t[0]=e[0]*n[0],t[1]=e[1]*n[1],t[2]=e[2]*n[2]}},{key:"cross",value:function(t,e,n){var r=e[1]*n[2]-e[2]*n[1],o=e[2]*n[0]-e[0]*n[2],i=e[0]*n[1]-e[1]*n[0];t[0]=r,t[1]=o,t[2]=i}},{key:"cross3",value:function(e,n,r,o,i){t.sub(m,r,n),t.sub(d,i,o),t.cross(e,m,d)}},{key:"cross2",value:function(t,e,n,r){this.cross3(t,e,n,e,r)}},{key:"checkBetween",value:function(e,n,r){var o=new t;return t.cross(o,n,r),t.cross(o,o,e),!(t.dot(o,n)*t.dot(o,r)>0)}}],null&&c(e.prototype,null),n&&c(e,n),Object.defineProperty(e,"prototype",{writable:!1}),t}();l=v,p=function(t,e){t[1]=Math.atan2(e[0],e[2]),t[2]=0,t[0]=Math.atan2(e[1],Math.sqrt(e[0]*e[0]+e[2]*e[2]))},(h=f(h="eulerFromVec3"))in l?Object.defineProperty(l,h,{value:p,enumerable:!0,configurable:!0,writable:!0}):l[h]=p,v.ZERO=new v;var y,m=new v,d=new v;function g(t){return g="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},g(t)}function w(t,e,n){return(e=O(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function _(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function x(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,O(r.key),r)}}function j(t,e,n){return e&&x(t.prototype,e),n&&x(t,n),Object.defineProperty(t,"prototype",{writable:!1}),t}function O(t){var e=function(t){if("object"!=g(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var n=e.call(t,"string");if("object"!=g(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==g(e)?e:e+""}function S(t,e,n){return function(t,e,n){if("function"==typeof t?t===e:t.has(e))return arguments.length<3?e:n;throw new TypeError("Private element is not present on this object")}(e,t),function(t){if(void 0===t)throw new TypeError("attempted to get private static field before its declaration")}(n),function(t,e){return e.get?e.get.call(t):e.value}(t,n)}var E,P,T,k,M,R,I,A,C,F,N,B,U,L,V,D,G,z=u,X=v,H=((G=function(){var t=new Float32Array(2);return t[0]=0,t[1]=0,t}).copy=function(t,e){t[0]=e[0],t[1]=e[1]},G.scalar=function(t){return Math.sqrt(t[0]*t[0]+t[1]*t[1])},G.scalar2=function(t){return t[0]*t[0]+t[1]*t[1]},G.setValues=function(t,e,n){t[0]=e,t[1]=n},G.add=function(t,e,n){t[0]=e[0]+n[0],t[1]=e[1]+n[1]},G.sub=function(t,e,n){t[0]=e[0]-n[0],t[1]=e[1]-n[1]},G.mul=function(t,e,n){t[0]=e[0]*n,t[1]=e[1]*n},G.mad=function(t,e,n,r){t[0]=e[0]+n[0]*r,t[1]=e[1]+n[1]*r},G.len=function(t,e){return Math.sqrt((t[0]-e[0])*(t[0]-e[0])+(t[1]-e[1])*(t[1]-e[1]))},G.len2=function(t,e){return(t[0]-e[0])*(t[0]-e[0])+(t[1]-e[1])*(t[1]-e[1])},G.normalize=function(t,e){var n=Math.sqrt(e[0]*e[0]+e[1]*e[1]);n=1/n,isFinite(n)&&(t[0]*=n,t[1]*=n)},G.norm=function(t){var e=Math.sqrt(t[0]*t[0]+t[1]*t[1]);e=1/e,isFinite(e)&&(t[0]*=e,t[1]*=e)},G.dot=function(t,e){return t[0]*e[0]+t[1]*e[1]},G.cross=function(t,e){return t[0]*e[1]-t[1]*e[0]},G),q=function(){var t,e,n,r,o,i,a,u,s,c,f,l,h,p,v,y,m,b,d,g,w,_=function(){var t=new Float32Array(4);return t[0]=0,t[1]=0,t[2]=0,t[3]=0,t},x=_;return x.setValue=function(t,e,n,r,o){this.setValues(t,e,n,r,o)},x.setValues=function(t,e,n,r,o){t[0]=e,t[1]=n,t[2]=r,t[3]=o},x.copy=function(t,e){t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3]},x.add=function(t,e,n){t[0]=e[0]+n[0],t[1]=e[1]+n[1],t[2]=e[2]+n[2],t[3]=e[3]+n[3]},x.sub=function(t,e,n){t[0]=e[0]-n[0],t[1]=e[1]-n[1],t[2]=e[2]-n[2],t[3]=e[3]-n[3]},x.mul=function(t,e,n){t[0]*=n,t[1]*=n,t[2]*=n,t[3]*=n},x.qdot=function(o,i,a){t=i[0]*a[0]-i[1]*a[1]-i[2]*a[2]-i[3]*a[3],e=i[0]*a[1]+a[0]*i[1]+i[2]*a[3]-i[3]*a[2],n=i[0]*a[2]+a[0]*i[2]+i[3]*a[1]-i[1]*a[3],r=i[0]*a[3]+a[0]*i[3]+i[1]*a[2]-i[2]*a[1],o[0]=t,o[1]=e,o[2]=n,o[3]=r},x.qmul=function(t,e,n){if(1==e[0])return t[0]=e[0],t[1]=e[1],t[2]=e[2],void(t[3]=e[3]);var r=Math.acos(e[0]),o=Math.sin(r*n)/Math.sin(r);t[0]=Math.cos(r*n),t[1]=e[1]*o,t[2]=e[2]*o,t[3]=e[3]*o},x.qmdot=function(o,i,a){t=i[0]*a[0]+i[1]*a[1]+i[2]*a[2]+i[3]*a[3],e=-i[0]*a[1]+a[0]*i[1]-i[2]*a[3]+i[3]*a[2],n=-i[0]*a[2]+a[0]*i[2]-i[3]*a[1]+i[1]*a[3],r=-i[0]*a[3]+a[0]*i[3]-i[1]*a[2]+i[2]*a[1],o[0]=Math.min(1,Math.max(-1,t)),o[1]=e,o[2]=n,o[3]=r},x.fromRotVector=function(t,e,n,r,o){var i=Math.sin(.5*e);t[0]=Math.cos(.5*e),t[1]=i*n,t[2]=i*r,t[3]=i*o},x.toTorque=function(t,e){var n=2*Math.acos(e[0]);0!==n?n/=Math.sin(.5*n):n=0,t[0]=e[1]*n,t[1]=e[2]*n,t[2]=e[3]*n},x.rotVec3=function(o,i,a){t=-i[1]*a[0]-i[2]*a[1]-i[3]*a[2],e=i[0]*a[0]+i[2]*a[2]-i[3]*a[1],n=i[0]*a[1]+i[3]*a[0]-i[1]*a[2],r=i[0]*a[2]+i[1]*a[1]-i[2]*a[0],o[0]=t*-i[1]+i[0]*e+n*-i[3]-r*-i[2],o[1]=t*-i[2]+i[0]*n+r*-i[1]-e*-i[3],o[2]=t*-i[3]+i[0]*r+e*-i[2]-n*-i[1]},x.toMat33=function(t,e){o=e[1]*e[1]*2,i=e[2]*e[2]*2,a=e[3]*e[3]*2,u=e[1]*e[2]*2,s=e[2]*e[3]*2,c=e[3]*e[1]*2,f=e[1]*e[0]*2,l=e[2]*e[0]*2,h=e[3]*e[0]*2,t[0]=1-i-a,t[1]=u+h,t[2]=c-l,t[3]=u-h,t[4]=1-a-o,t[5]=s+f,t[6]=c+l,t[7]=s-f,t[8]=1-o-i},x.toMat43=x.qTOm=function(t,e){o=e[1]*e[1]*2,i=e[2]*e[2]*2,a=e[3]*e[3]*2,u=e[1]*e[2]*2,s=e[2]*e[3]*2,c=e[3]*e[1]*2,f=e[1]*e[0]*2,l=e[2]*e[0]*2,h=e[3]*e[0]*2,t[0]=1-i-a,t[1]=u+h,t[2]=c-l,t[3]=u-h,t[4]=1-a-o,t[5]=s+f,t[6]=c+l,t[7]=s-f,t[8]=1-o-i,t[9]=t[10]=t[11]=0},x.slerp=function(t,e,n,r){p=e[0]*n[0]+e[1]*n[1]+e[2]*n[2]+e[3]*n[3],v=1-p*p,y=0,p<0&&(y=1,p*=-1),v<=0?(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3]):(m=Math.sqrt(v),b=Math.acos(p),d=b*r,g=Math.sin(d)/m,w=Math.sin(b-d)/m,y&&(g*=-1),t[0]=e[0]*w+n[0]*g,t[1]=e[1]*w+n[1]*g,t[2]=e[2]*w+n[2]*g,t[3]=e[3]*w+n[3]*g)},x.fromMat44=function(t,e){var n=Y.alloc();n[0]=e[0],n[1]=e[1],n[2]=e[2],n[3]=e[4],n[4]=e[5],n[5]=e[6],n[6]=e[8],n[7]=e[9],n[8]=e[10],Y.rotToQuat(t,n),Y.free(1)},x.fromMat33=function(t,e){var n=1/Math.sqrt(e[0]*e[0]+e[1]*e[1]+e[2]*e[2]),r=1/Math.sqrt(e[3]*e[3]+e[4]*e[4]+e[5]*e[5]),o=1/Math.sqrt(e[6]*e[6]+e[7]*e[7]+e[8]*e[8]),i=Y.alloc();i[0]=e[0]*n,i[1]=e[1]*n,i[2]=e[2]*n,i[3]=e[3]*r,i[4]=e[4]*r,i[5]=e[5]*r,i[6]=e[6]*o,i[7]=e[7]*o,i[8]=e[8]*o,Y.getRotVec(t,i);var a=X.scalar(t);0!==a?(X.mul(t,t,1/a),_.fromRotVector(t,a,t[0],t[1],t[2])):_.setValue(t,0,0,0,1),Y.free(1)},x}(),Y=function(){function t(){_(this,t);var e=new Float32Array(9);return t.setInit(e),e}return j(t,null,[{key:"setInit",value:function(t){t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=0,t[7]=0,t[8]=1}},{key:"init",value:function(){S(t,t,W)[0]=0,S(t,t,W)[4]=0,S(t,t,W)[8]=0}},{key:"setValue",value:function(t,e,n,r,o,i,a,u,s,c){t[0]=e,t[1]=n,t[2]=r,t[3]=o,t[4]=i,t[5]=a,t[6]=u,t[7]=s,t[8]=c}},{key:"copy",value:function(t,e){t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8]}},{key:"add",value:function(t,e,n){t[0]=e[0]+n[0],t[1]=e[1]+n[1],t[2]=e[2]+n[2],t[3]=e[3]+n[3],t[4]=e[4]+n[4],t[5]=e[5]+n[5],t[6]=e[6]+n[6],t[7]=e[7]+n[7],t[8]=e[8]+n[8]}},{key:"madd",value:function(t,e,n,r){t[0]=e[0]+n[0]*r,t[1]=e[1]+n[1]*r,t[2]=e[2]+n[2]*r,t[3]=e[3]+n[3]*r,t[4]=e[4]+n[4]*r,t[5]=e[5]+n[5]*r,t[6]=e[6]+n[6]*r,t[7]=e[7]+n[7]*r,t[8]=e[8]+n[8]*r}},{key:"sub",value:function(t,e,n){t[0]=e[0]-n[0],t[1]=e[1]-n[1],t[2]=e[2]-n[2],t[3]=e[3]-n[3],t[4]=e[4]-n[4],t[5]=e[5]-n[5],t[6]=e[6]-n[6],t[7]=e[7]-n[7],t[8]=e[8]-n[8]}},{key:"mul",value:function(t,e,n){t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t[3]=e[3]*n,t[4]=e[4]*n,t[5]=e[5]*n,t[6]=e[6]*n,t[7]=e[7]*n,t[8]=e[8]*n}},{key:"dotVec3",value:function(t,e,n){var r=n[0],o=n[1],i=n[2];t[0]=e[0]*r+e[3]*o+e[6]*i,t[1]=e[1]*r+e[4]*o+e[7]*i,t[2]=e[2]*r+e[5]*o+e[8]*i}},{key:"dot",value:function(e,n,r){var o=S(t,t,Q);o[0]=n[0]*r[0]+n[3]*r[1]+n[6]*r[2],o[1]=n[1]*r[0]+n[4]*r[1]+n[7]*r[2],o[2]=n[2]*r[0]+n[5]*r[1]+n[8]*r[2],o[3]=n[0]*r[3]+n[3]*r[4]+n[6]*r[5],o[4]=n[1]*r[3]+n[4]*r[4]+n[7]*r[5],o[5]=n[2]*r[3]+n[5]*r[4]+n[8]*r[5],o[6]=n[0]*r[6]+n[3]*r[7]+n[6]*r[8],o[7]=n[1]*r[6]+n[4]*r[7]+n[7]*r[8],o[8]=n[2]*r[6]+n[5]*r[7]+n[8]*r[8],e.set(o)}},{key:"fromRotVector",value:function(t,e,n,r,o){var i=Math.sin(e),a=Math.cos(e);t[0]=n*n*(1-a)+a,t[3]=n*r*(1-a)-o*i,t[6]=o*n*(1-a)+r*i,t[1]=n*r*(1-a)+o*i,t[4]=r*r*(1-a)+a,t[7]=r*o*(1-a)-n*i,t[2]=o*n*(1-a)-r*i,t[5]=r*o*(1-a)+n*i,t[8]=o*o*(1-a)+a}},{key:"fromQuat",value:function(t,e){var n=e[1]*e[1]*2,r=e[2]*e[2]*2,o=e[3]*e[3]*2,i=e[1]*e[2]*2,a=e[2]*e[3]*2,u=e[3]*e[1]*2,s=e[1]*e[0]*2,c=e[2]*e[0]*2,f=e[3]*e[0]*2;t[0]=1-r-o,t[1]=i+f,t[2]=u-c,t[3]=i-f,t[4]=1-o-n,t[5]=a+s,t[6]=u+c,t[7]=a-s,t[8]=1-n-r}},{key:"getRotVec",value:function(t,e){var n=.5*(e[0]+e[4]+e[8]-1);if(n*n>=1)X.setValue(t,0,0,0);else{var r=Math.acos(n),o=Math.sin(r);t[0]=e[5]-e[7],t[1]=e[6]-e[2],t[2]=e[1]-e[3],X.mul(t,t,r/(2*o))}}},{key:"rotToQuat",value:function(t,e){t[1]=e[0]-e[4]-e[8]+1,t[2]=-e[0]+e[4]-e[8]+1,t[3]=-e[0]-e[4]+e[8]+1,t[0]=e[0]+e[4]+e[8]+1;for(var n=0,r=1;r<4;r++)t[r]>t[n]&&(n=r);if(!(t[n]<0)){var o=.5*Math.sqrt(t[n]);t[n]=o;var i=.25/o;switch(n){case 1:t[2]=(e[1]+e[3])*i,t[3]=(e[2]+e[6])*i,t[0]=(e[5]-e[7])*i;break;case 2:t[1]=(e[1]+e[3])*i,t[3]=(e[7]+e[5])*i,t[0]=(e[6]-e[2])*i;break;case 3:t[1]=(e[7]+e[5])*i,t[2]=(e[2]+e[6])*i,t[0]=(e[1]-e[3])*i;break;case 0:t[1]=(e[5]-e[7])*i,t[2]=(e[6]-e[2])*i,t[3]=(e[1]-e[3])*i}}}},{key:"getRotQuat",value:function(e,n){return t.rotToQuat(e,n)}},{key:"getEulerXYZ",value:function(t,e){t[1]=Math.asin(e[2]),1==e[2]||-1==e[2]?(t[0]=0,t[2]=Math.atan2(-e[3],[4])):(t[0]=Math.atan2(e[5],e[8]),t[2]=Math.atan2(e[1],e[0]))}},{key:"getEuler",value:function(t,e){t[2]=Math.asin(e[1]),1==e[1]||-1==e[1]?(t[0]=0,t[1]=Math.atan2(e[8],[6])):(t[0]=Math.atan2(-e[7],e[4]),t[1]=Math.atan2(-e[2],e[0]))}},{key:"getInv",value:function(t,e){var n=e[0]*e[4]*e[8]+e[3]*e[7]*e[2]+e[6]*e[1]*e[5]-e[6]*e[4]*e[2]-e[3]*e[1]*e[8]-e[0]*e[7]*e[5];if(n){n=1/n;var r=(e[4]*e[8]-e[7]*e[5])*n,o=(e[7]*e[2]-e[1]*e[8])*n,i=(e[1]*e[5]-e[4]*e[2])*n,a=(e[6]*e[5]-e[3]*e[8])*n,u=(e[0]*e[8]-e[6]*e[2])*n,s=(e[3]*e[2]-e[0]*e[5])*n,c=(e[3]*e[7]-e[6]*e[4])*n,f=(e[6]*e[1]-e[0]*e[7])*n,l=(e[0]*e[4]-e[3]*e[1])*n;t[0]=r,t[1]=o,t[2]=i,t[3]=a,t[4]=u,t[5]=s,t[6]=c,t[7]=f,t[8]=l}else this.mul(e,e,0)}},{key:"calcTranspose",value:function(t,e){var n;n=e[1],t[1]=e[3],t[3]=n,n=e[2],t[2]=e[6],t[6]=n,n=e[5],t[5]=e[7],t[7]=n}},{key:"scale",value:function(t,e,n,r){t[0]=e,t[1]=0,t[2]=0,t[3]=0,t[4]=n,t[5]=0,t[6]=0,t[7]=0,t[8]=r}},{key:"rotate",value:function(t,e,n,r,o){var i=Math.sin(e),a=Math.cos(e);t[0]=n*n*(1-a)+a,t[3]=n*r*(1-a)-o*i,t[6]=o*n*(1-a)+r*i,t[1]=n*r*(1-a)+o*i,t[4]=r*r*(1-a)+a,t[7]=r*o*(1-a)-n*i,t[2]=o*n*(1-a)-r*i,t[5]=r*o*(1-a)+n*i,t[8]=o*o*(1-a)+a}}]),t}(),W={writable:!0,value:new(y=Y)},Q={writable:!0,value:new y};new X,Y.init(),new Float32Array(16);var $=new z,J=function(){function t(){_(this,t);var e=new Float32Array(16);return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}return j(t,null,[{key:"setInit",value:function(t){t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1}},{key:"setValue",value:function(t,e,n,r,o,i,a,u,s,c,f,l,h,p,v,y,m){t[0]=e,t[1]=n,t[2]=r,t[3]=o,t[4]=i,t[5]=a,t[6]=u,t[7]=s,t[8]=c,t[9]=f,t[10]=l,t[11]=h,t[12]=p,t[13]=v,t[14]=y,t[15]=m}},{key:"copy",value:function(t,e){t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]}},{key:"copyMat43",value:function(t,e){t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=0,t[4]=e[3],t[5]=e[4],t[6]=e[5],t[7]=0,t[8]=e[6],t[9]=e[7],t[10]=e[8],t[11]=0,t[12]=e[9],t[13]=e[10],t[14]=e[11],t[15]=1}},{key:"mul",value:function(t,e,n){t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t[3]=e[3]*n,t[4]=e[4]*n,t[5]=e[5]*n,t[6]=e[6]*n,t[7]=e[7]*n,t[8]=e[8]*n,t[9]=e[9]*n,t[10]=e[10]*n,t[11]=e[11]*n,t[12]=e[12]*n,t[13]=e[13]*n,t[14]=e[14]*n,t[15]=e[15]*n}},{key:"dotVec3",value:function(t,e,n){E=n[0],P=n[1],T=n[2],t[0]=e[0]*E+e[4]*P+e[8]*T+e[12],t[1]=e[1]*E+e[5]*P+e[9]*T+e[13],t[2]=e[2]*E+e[6]*P+e[10]*T+e[14]}},{key:"dotMat33Vec3",value:function(t,e,n){E=n[0],P=n[1],T=n[2],t[0]=e[0]*E+e[4]*P+e[8]*T,t[1]=e[1]*E+e[5]*P+e[9]*T,t[2]=e[2]*E+e[6]*P+e[10]*T}},{key:"dotVec4",value:function(t,e,n){E=n[0],P=n[1],T=n[2],k=n[3],t[0]=e[0]*E+e[4]*P+e[8]*T+e[12]*k,t[1]=e[1]*E+e[5]*P+e[9]*T+e[13]*k,t[2]=e[2]*E+e[6]*P+e[10]*T+e[14]*k,t[3]=e[3]*E+e[7]*P+e[11]*T+e[15]*k}},{key:"dot",value:function(t,e,n){t==e?(E=e[0],P=e[1],T=e[2],k=e[3],M=e[4],R=e[5],I=e[6],A=e[7],C=e[8],F=e[9],N=e[10],B=e[11],U=e[12],L=e[13],V=e[14],D=e[15],t[0]=E*n[0]+M*n[1]+C*n[2]+U*n[3],t[1]=P*n[0]+R*n[1]+F*n[2]+L*n[3],t[2]=T*n[0]+I*n[1]+N*n[2]+V*n[3],t[3]=k*n[0]+A*n[1]+B*n[2]+D*n[3],t[4]=E*n[4]+M*n[5]+C*n[6]+U*n[7],t[5]=P*n[4]+R*n[5]+F*n[6]+L*n[7],t[6]=T*n[4]+I*n[5]+N*n[6]+V*n[7],t[7]=k*n[4]+A*n[5]+B*n[6]+D*n[7],t[8]=E*n[8]+M*n[9]+C*n[10]+U*n[11],t[9]=P*n[8]+R*n[9]+F*n[10]+L*n[11],t[10]=T*n[8]+I*n[9]+N*n[10]+V*n[11],t[11]=k*n[8]+A*n[9]+B*n[10]+D*n[11],t[12]=E*n[12]+M*n[13]+C*n[14]+U*n[15],t[13]=P*n[12]+R*n[13]+F*n[14]+L*n[15],t[14]=T*n[12]+I*n[13]+N*n[14]+V*n[15],t[15]=k*n[12]+A*n[13]+B*n[14]+D*n[15]):(E=n[0],P=n[1],T=n[2],k=n[3],M=n[4],R=n[5],I=n[6],A=n[7],C=n[8],F=n[9],N=n[10],B=n[11],U=n[12],L=n[13],V=n[14],D=n[15],t[0]=e[0]*E+e[4]*P+e[8]*T+e[12]*k,t[1]=e[1]*E+e[5]*P+e[9]*T+e[13]*k,t[2]=e[2]*E+e[6]*P+e[10]*T+e[14]*k,t[3]=e[3]*E+e[7]*P+e[11]*T+e[15]*k,t[4]=e[0]*M+e[4]*R+e[8]*I+e[12]*A,t[5]=e[1]*M+e[5]*R+e[9]*I+e[13]*A,t[6]=e[2]*M+e[6]*R+e[10]*I+e[14]*A,t[7]=e[3]*M+e[7]*R+e[11]*I+e[15]*A,t[8]=e[0]*C+e[4]*F+e[8]*N+e[12]*B,t[9]=e[1]*C+e[5]*F+e[9]*N+e[13]*B,t[10]=e[2]*C+e[6]*F+e[10]*N+e[14]*B,t[11]=e[3]*C+e[7]*F+e[11]*N+e[15]*B,t[12]=e[0]*U+e[4]*L+e[8]*V+e[12]*D,t[13]=e[1]*U+e[5]*L+e[9]*V+e[13]*D,t[14]=e[2]*U+e[6]*L+e[10]*V+e[14]*D,t[15]=e[3]*U+e[7]*L+e[11]*V+e[15]*D)}},{key:"dotMat43",value:function(t,e,n){E=e[0]*n[0]+e[4]*n[1]+e[8]*n[2],P=e[1]*n[0]+e[5]*n[1]+e[9]*n[2],T=e[2]*n[0]+e[6]*n[1]+e[10]*n[2],k=e[3]*n[0]+e[7]*n[1]+e[11]*n[2],M=e[0]*n[3]+e[4]*n[4]+e[8]*n[5],R=e[1]*n[3]+e[5]*n[4]+e[9]*n[5],I=e[2]*n[3]+e[6]*n[4]+e[10]*n[5],A=e[3]*n[3]+e[7]*n[4]+e[11]*n[5],C=e[0]*n[6]+e[4]*n[7]+e[8]*n[8],F=e[1]*n[6]+e[5]*n[7]+e[9]*n[8],N=e[2]*n[6]+e[6]*n[7]+e[10]*n[8],B=e[3]*n[6]+e[7]*n[7]+e[11]*n[8],U=e[0]*n[9]+e[4]*n[10]+e[8]*n[11]+e[12],L=e[1]*n[9]+e[5]*n[10]+e[9]*n[11]+e[13],V=e[2]*n[9]+e[6]*n[10]+e[10]*n[11]+e[14],D=e[3]*n[9]+e[7]*n[10]+e[11]*n[11]+e[15],t[0]=E,t[1]=P,t[2]=T,t[3]=k,t[4]=M,t[5]=R,t[6]=I,t[7]=A,t[8]=C,t[9]=F,t[10]=N,t[11]=B,t[12]=U,t[13]=L,t[14]=V,t[15]=D}},{key:"fromLSE",value:function(e,n,r,o){z.fromLSE($,n,r,o),t.setValue(e,$[0],$[1],$[2],0,$[3],$[4],$[5],0,$[6],$[7],$[8],0,$[9],$[10],$[11],1)}},{key:"fromLSR",value:function(e,n,r,o){z.fromLSR($,n,r,o),t.setValue(e,$[0],$[1],$[2],0,$[3],$[4],$[5],0,$[6],$[7],$[8],0,$[9],$[10],$[11],1)}},{key:"getRotVector",value:function(t,e){z.getRotVector.call(this,t,e)}},{key:"getInv",value:function(t,e){var n=e[0]*e[5]*e[10]*e[15]+e[0]*e[9]*e[14]*e[7]+e[0]*e[13]*e[6]*e[11]+e[4]*e[1]*e[14]*e[11]+e[4]*e[9]*e[2]*e[15]+e[4]*e[13]*e[10]*e[3]+e[8]*e[1]*e[6]*e[15]+e[8]*e[5]*e[14]*e[3]+e[8]*e[13]*e[2]*e[7]+e[12]*e[1]*e[10]*e[7]+e[12]*e[5]*e[2]*e[11]+e[12]*e[9]*e[6]*e[3]-e[0]*e[5]*e[14]*e[11]-e[0]*e[9]*e[6]*e[15]-e[0]*e[13]*e[10]*e[7]-e[4]*e[1]*e[10]*e[15]-e[4]*e[9]*e[14]*e[3]-e[4]*e[13]*e[2]*e[11]-e[8]*e[1]*e[14]*e[7]-e[8]*e[5]*e[2]*e[15]-e[8]*e[13]*e[6]*e[3]-e[12]*e[1]*e[6]*e[11]-e[12]*e[5]*e[10]*e[3]-e[12]*e[9]*e[2]*e[7];Math.abs(n)<1e-12||(n=1/n,E=e[0],P=e[1],T=e[2],k=e[3],M=e[4],R=e[5],I=e[6],A=e[7],C=e[8],F=e[9],N=e[10],B=e[11],U=e[12],L=e[13],V=e[14],D=e[15],t[0]=(R*N*D+F*V*A+L*I*B-R*V*B-F*I*D-L*N*A)*n,t[4]=(M*V*B+C*I*D+U*N*A-M*N*D-C*V*A-U*I*B)*n,t[8]=(M*F*D+C*L*A+U*R*B-M*L*B-C*R*D-U*F*A)*n,t[12]=(M*L*N+C*R*V+U*F*I-M*F*V-C*L*I-U*R*N)*n,t[1]=(P*V*B+F*T*D+L*N*k-P*N*D-F*V*k-L*T*B)*n,t[5]=(E*N*D+C*V*k+U*T*B-E*V*B-C*T*D-U*N*k)*n,t[9]=(E*L*B+C*P*D+U*F*k-E*F*D-C*L*k-U*P*B)*n,t[13]=(E*F*V+C*L*T+U*P*N-E*L*N-C*P*V-U*F*T)*n,t[2]=(P*I*D+R*V*k+L*T*A-P*V*A-R*T*D-L*I*k)*n,t[6]=(E*V*A+M*T*D+U*I*k-E*I*D-M*V*k-U*T*A)*n,t[10]=(E*R*D+M*L*k+U*P*A-E*L*A-M*P*D-U*R*k)*n,t[14]=(E*L*I+M*P*V+U*R*T-E*R*V-M*L*T-U*P*I)*n,t[3]=(P*N*A+R*T*B+F*I*k-P*I*B-R*N*k-F*T*A)*n,t[7]=(E*I*B+M*N*k+C*T*A-E*N*A-M*T*B-C*I*k)*n,t[11]=(E*F*A+M*P*B+C*R*k-E*R*B-M*F*k-C*P*A)*n,t[15]=(E*R*N+M*F*T+C*P*I-E*F*I-M*P*N-C*R*T)*n)}}]),t}();function K(t){return K="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},K(t)}function Z(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,et(r.key),r)}}function tt(t,e,n){return e&&Z(t.prototype,e),n&&Z(t,n),Object.defineProperty(t,"prototype",{writable:!1}),t}function et(t){var e=function(t){if("object"!=K(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var n=e.call(t,"string");if("object"!=K(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==K(e)?e:e+""}w(J,"fromRotVector",function(t,e,n,r,o){var i=Math.sin(e),a=Math.cos(e);t[0]=n*n*(1-a)+a,t[4]=n*r*(1-a)-o*i,t[8]=o*n*(1-a)+r*i,t[1]=n*r*(1-a)+o*i,t[5]=r*r*(1-a)+a,t[9]=r*o*(1-a)-n*i,t[2]=o*n*(1-a)-r*i,t[6]=r*o*(1-a)+n*i,t[10]=o*o*(1-a)+a,t[3]=t[7]=t[11]=t[12]=t[13]=t[14]=0,t[15]=1}),w(J,"determinant",function(t){return b[0]*b[5]*b[10]*b[15]+b[0]*b[9]*b[14]*b[7]+b[0]*b[13]*b[6]*b[11]+b[4]*b[1]*b[14]*b[11]+b[4]*b[9]*b[2]*b[15]+b[4]*b[13]*b[10]*b[3]+b[8]*b[1]*b[6]*b[15]+b[8]*b[5]*b[14]*b[3]+b[8]*b[13]*b[2]*b[7]+b[12]*b[1]*b[10]*b[7]+b[12]*b[5]*b[2]*b[11]+b[12]*b[9]*b[6]*b[3]-b[0]*b[5]*b[14]*b[11]-b[0]*b[9]*b[6]*b[15]-b[0]*b[13]*b[10]*b[7]-b[4]*b[1]*b[10]*b[15]-b[4]*b[9]*b[14]*b[3]-b[4]*b[13]*b[2]*b[11]-b[8]*b[1]*b[14]*b[7]-b[8]*b[5]*b[2]*b[15]-b[8]*b[13]*b[6]*b[3]-b[12]*b[1]*b[6]*b[11]-b[12]*b[5]*b[10]*b[3]-b[12]*b[9]*b[2]*b[7]}),function(){for(var e=[H,X,q,Y,z,J],n=0;n<e.length;n++)t(e[n])}();var nt=tt(function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t)}),rt=function(t){for(var e=1,n=t;n>0;n--)e*=n;return e},ot=function t(e){if(e<0)return t(e+2)/(e+2);for(var n=1,r=e;r>0;r-=2)n*=r;return n},it=function(t,e){var n=(2*t+1)/(4*Math.PI),r=rt(t-Math.abs(e))/rt(t+Math.abs(e));return Math.sqrt(n*r)},at=function t(e,n,r){return n===e?Math.pow(-1,n)*ot(2*n-1)*Math.pow(1-r*r,n/2):n+1===e?(2*n+1)*r*t(n,n,r):((2*e-1)*r*t(e-1,n,r)-(e+n-1)*t(e-2,n,r))/(e-n)};nt.A=function(t){return 1==t?2/3:1&t?0:2*Math.pow(-1,t/2-1)/((t+2)*(t-1))*(rt(t)/(Math.pow(2,t)*Math.pow(rt(t/2),2)))},nt.Y=function(t,e,n,r){return e>0?Math.sqrt(2)*it(t,e)*Math.cos(e*r)*at(t,e,Math.cos(n)):e<0?Math.sqrt(2)*it(t,e)*Math.sin(-e*r)*at(t,-e,Math.cos(n)):it(t,0)*at(t,0,Math.cos(n))},nt.encode2xyz=function(t,e,n,r,o){X.madd(t[0],t[0],e,1),X.madd(t[1],t[1],e,n),X.madd(t[2],t[2],e,r),X.madd(t[3],t[3],e,o),X.madd(t[4],t[4],e,n*o),X.madd(t[5],t[5],e,n*r),X.madd(t[6],t[6],e,3*r*r-1),X.madd(t[7],t[7],e,o*r),X.madd(t[8],t[8],e,o*o-n*n)},nt.encode2=function(t,e,n,r){var o=Math.cos(n),i=Math.sin(r)*Math.sin(n),a=Math.cos(r)*Math.sin(n);this.encode2xyz(t,e,i,o,a)},nt.encode2_2=function(t){X.mul(t[0],t[0],1),X.mul(t[1],t[1],3),X.mul(t[2],t[2],3),X.mul(t[3],t[3],3),X.mul(t[4],t[4],15),X.mul(t[5],t[5],15),X.mul(t[6],t[6],1.25),X.mul(t[7],t[7],15),X.mul(t[8],t[8],3.75)},nt.decode2xyz=function(t,e,n,r,o){for(var i=n*o,a=n*r,u=3*r*r-1,s=o*r,c=o*o-n*n,f=0;f<3;f++)t[f]=e[0][f]+e[1][f]*n+e[2][f]*r+e[3][f]*o+e[4][f]*i+e[5][f]*a+e[6][f]*u+e[7][f]*s+e[8][f]*c},nt.decode2=function(t,e,n,r){var o=Math.cos(n),i=Math.sin(r)*Math.sin(n),a=Math.cos(r)*Math.sin(n);this.decode2xyz(t,e,i,o,a)},nt.mulA=function(t){for(var e=this.A(0),n=1,r=0;r<t.length;r++)r>n*n&&(e=this.A(n),n++),X.mul(t[r],t[r],e)},nt.encode3=function(t,e,n,r,o){for(var i=Math.cos(r),a=Math.sin(r),u=0,s=Math.pow(-1,u)*ot(2*u-1)*Math.pow(a,u),c=0,f=u;f<n;f++){if(f===u+1)c=s,s*=(2*u+1)*i;else if(f>u+1){var l=c;s=((2*f-1)*i*(c=s)-(f+u-1)*l)/(f-u)}var h=t[(f+1)*f+u];X.madd(h,h,e,s)}for(u=1;u<n;u++){s=Math.pow(-1,u)*ot(2*u-1)*Math.pow(a,u),c=0;var p=Math.cos(u*o),v=Math.sin(u*o);for(f=u;f<n;f++)f===u+1?(c=s,s*=(2*u+1)*i):f>u+1&&(l=c,s=((2*f-1)*i*(c=s)-(f+u-1)*l)/(f-u)),h=t[(f+1)*f+u],X.madd(h,h,e,s*p),h=t[(f+1)*f-u],X.madd(h,h,e,s*v)}};var ut=function(t,e){return(2*t+1)*(rt(t-e)/rt(t+e))};nt.encode3_2=function(t,e){for(var n=0;n<e;n++)for(var r=0;r<=n;r++){var o=t[(n+1)*n+r];if(0===r)X.mul(o,o,ut(n,r));else{var i=2*ut(n,r);X.mul(o,o,i),o=t[(n+1)*n-r],X.mul(o,o,i)}}},nt.decode3=function(t,e,n,r,o){var i=Math.cos(r),a=Math.sin(r),u=0,s=Math.pow(-1,u)*ot(2*u-1)*Math.pow(a,u),c=0;X.set(t,0,0,0);for(var f=u;f<n;f++){if(f===u+1)c=s,s*=(2*u+1)*i;else if(f>u+1){var l=c;s=((2*f-1)*i*(c=s)-(f+u-1)*l)/(f-u)}var h=e[(f+1)*f+u];X.madd(t,t,h,s)}for(u=1;u<n;u++){s=Math.pow(-1,u)*ot(2*u-1)*Math.pow(a,u),c=0;var p=Math.cos(u*o),v=Math.sin(u*o);for(f=u;f<n;f++)f===u+1?(c=s,s*=(2*u+1)*i):f>u+1&&(l=c,s=((2*f-1)*i*(c=s)-(f+u-1)*l)/(f-u)),h=e[(f+1)*f+u],X.madd(t,t,h,s*p),h=e[(f+1)*f-u],X.madd(t,t,h,s*v)}};var st=.5*Math.sqrt(1/Math.PI),ct=.5*Math.sqrt(3/Math.PI),ft=Math.sqrt(3/(4*Math.PI)),lt=1/4*Math.sqrt(5/Math.PI),ht=1.5*Math.sqrt(5/(3*Math.PI));nt.Y_2=function(t,e,n,r){if(t>2)return this.Y(t,e,n,r);var o=Math.cos(n),i=Math.sin(r)*Math.sin(n),a=Math.cos(r)*Math.sin(n);return 0==t&&0==e?st:1==t&&0==e?ct*o:1==t&&-1==e?ft*i:1==t&&1==e?ft*a:2==t&&0==e?lt*(3*o*o-1):2==t&&-1==e?ht*i*o:2==t&&1==e?ht*a*o:2==t&&-2==e?ht*i*a:2==t&&2==e?ht/2*(a*a-i*i):void 0};for(var pt=[],vt=0;vt<9;vt++){var yt=nt.A(vt);pt.push(yt)}function mt(t){return mt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},mt(t)}function bt(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,dt(r.key),r)}}function dt(t){var e=function(t){if("object"!=mt(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var n=e.call(t,"string");if("object"!=mt(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==mt(e)?e:e+""}function gt(t,e,n){(function(t,e){if(e.has(t))throw new TypeError("Cannot initialize the same private elements twice on an object")})(t,e),e.set(t,n)}function wt(t,e){return function(t,e){return e.get?e.get.call(t):e.value}(t,xt(e,t))}function _t(t,e,n){return function(t,e,n){if(e.set)e.set.call(t,n);else{if(!e.writable)throw new TypeError("attempted to set read only private field");e.value=n}}(t,xt(e,t),n),n}function xt(t,e){return t.get(function(t,e,n){if("function"==typeof t?t===e:t.has(e))return arguments.length<3?e:n;throw new TypeError("Private element is not present on this object")}(t,e))}var jt=new WeakMap,Ot=new WeakMap,St=new WeakMap,Et=new WeakMap,Pt=new WeakMap,Tt=new WeakMap,kt=function(){function t(e,n){var r=this;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),gt(this,jt,{writable:!0,value:void 0}),gt(this,Ot,{writable:!0,value:void 0}),gt(this,St,{writable:!0,value:void 0}),gt(this,Et,{writable:!0,value:void 0}),gt(this,Pt,{writable:!0,value:void 0}),gt(this,Tt,{writable:!0,value:void 0}),function(t,e,n){(e=dt(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n}(this,"mainloop",function(){var t=performance.now(),e=wt(r,Pt)-t;e>wt(r,Ot)&&(e=wt(r,Ot)),e<-wt(r,Ot)&&(e=-wt(r,Ot)),_t(r,St,wt(r,St)+wt(r,Et)),wt(r,St)>=wt(r,jt)&&(_t(r,St,wt(r,St)-wt(r,jt)),e+=1),_t(r,Pt,t+wt(r,Ot)+e),wt(r,Tt).call(r),t=performance.now(),e=Math.max(1,wt(r,Pt)-t),setTimeout(r.mainloop,e)}),this.setFps(e),_t(this,Tt,n)}return function(t,e){e&&bt(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1})}(t,[{key:"setFps",value:function(t){wt(this,jt)!==t&&(_t(this,jt,0|t),_t(this,Ot,1e3/wt(this,jt)|0),_t(this,St,0),_t(this,Et,1e3%wt(this,jt)),_t(this,Pt,0))}}]),t}();function Mt(t){return Mt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Mt(t)}function Rt(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,At(r.key),r)}}function It(t,e,n){return(e=At(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function At(t){var e=function(t){if("object"!=Mt(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var n=e.call(t,"string");if("object"!=Mt(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==Mt(e)?e:e+""}window.globalParam={},document.all,window.navigator.userAgent.toLowerCase().indexOf(!0)&&(globalParam.windows=1);var Ct=new Array(256);[37,38,39,40,"Z".charCodeAt(0),"X".charCodeAt(0),"C".charCodeAt(0),"V".charCodeAt(0),"A".charCodeAt(0),"W".charCodeAt(0),"D".charCodeAt(0),"S".charCodeAt(0),"F".charCodeAt(0),"G".charCodeAt(0),"H".charCodeAt(0),"J".charCodeAt(0)].forEach(function(t,e){Ct[t]=e});var Ft=null,Nt=null,Bt=null,Ut=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t)}return function(t,e,n){n&&Rt(t,n),Object.defineProperty(t,"prototype",{writable:!1})}(t,0,[{key:"getLoadingCount",value:function(){return t.loadingCount}},{key:"mainloop",value:function(){var e,n,r;for(t.tap=0,t.pressOn?(t.pressCount=t.pressCount+1,1==t.pressCount&&(t.oldcursorX2=t.cursorX,t.oldcursorY2=t.cursorY,t.oldcursorX=t.cursorX,t.oldcursorY=t.cursorY)):t.pressCount>0?(e=t.cursorX-t.oldcursorX2,n=t.cursorY-t.oldcursorY2,t.pressCount<10&&e*e+n*n<16&&(t.tap=1),t.pressCount=-1):t.pressCount=0,t.pressOnRight?t.pressCountRight+=1:t.pressCountRight=0,0===t.loadingCount&&t.mainfunc(),t.oldcursorX=t.cursorX,t.oldcursorY=t.cursorY,r=t.keyflag.length;r--;)t.keyflagOld[r]=t.keyflag[r]}},{key:"loadImage",value:function(e,n,r){var o=new Image,i=!0;if(globalParam.files)for(var a,u=0;a=globalParam.files[u];u++)if(escape(a.name)==e){var s=new FileReader;s.onload=function(t){o.src=t.target.result},s.readAsDataURL(a),i=!1;break}return i&&(o.src=e),t.loadingCount++,o.onerror=function(){t.loadingCount--},console.log("load start",e),o.addEventListener("load",function(e){o.pat||(console.log("load end",o),t.loadingCount--,o.pat=n?t.ctx.createPattern(o,"no-repeat"):t.ctx.createPattern(o,"repeat"),t.imagedatacontext.clearRect(0,0,t.imagedatacanvas.width,t.imagedatacanvas.height),t.imagedatacontext.drawImage(o,0,0),t.imagedatacontext.getImageData&&(o.imagedata=t.imagedatacontext.getImageData(0,0,o.width,o.height))),r&&r(o)}),o}},{key:"getDir",value:function(t){var e=/.*\//.exec(t);return e?e[0]:""}},{key:"loadText",value:function(e,n){var r=!0,o=e.match("([^/]+?)([?#;].*)?$")[1];if(globalParam.files)for(var i,a=0;i=globalParam.files[a];a++)if(escape(i.name)==o){var u=new FileReader;u.onload=function(t){var e=t.target.result;n&&n(e)},u.readAsText(i),r=!1;break}if(!r)return null;var s=t.createXMLHttpRequest();return s.open("GET",e,!0),s.onload=function(e){if(200==s.status||304==s.status){var r=s.responseText;n&&n(r)}else n&&n(null);t.loadingCount--,console.log("loadtext end",t.loadingCount)},s.onerror=function(e){n&&n(null),t.loadingCount--,console.log("loadtext failed",t.loadingCount)},console.log("loadtext start",e),t.loadingCount++,s.send(""),s}},{key:"loadFile",value:function(t,e){var n=new FileReader;n.onload=function(t){e&&e(t.target.result)},n.readAsDataURL(t)}},{key:"loadBinary",value:function(e,n){if("string"!=typeof e)return t.loadFile(e,function(e){t.loadBinary(e,n)}),null;var r=n;console.log("loadbinary start",e),t.loadingCount++;var o=t.createXMLHttpRequest();o.open("GET",e,!0),o.responseType="arraybuffer",o.onload=function(e){!function(e){r&&r(e),t.loadingCount--,console.log("loadbinary end",t.loadingCount)}(o.response)},o.send("")}},{key:"rgb",value:function(t,e,n){return t=(256|255*t).toString(16),e=(256|255*e).toString(16),n=(256|255*n).toString(16),"#"+t.slice(-2)+e.slice(-2)+n.slice(-2)}},{key:"str2rgba",value:function(t,e){var n=e.split(",");return t[0]=Number(n[0]),t[1]=Number(n[1]),t[2]=Number(n[2]),t[3]=Number(n[3]),t}},{key:"rgba",value:function(t,e,n,r){return"rgba("+t+","+e+","+n+","+r+")"}},{key:"hsv2rgb",value:function(t,e){var n,r,o,i,a=e[2],u=e[0],s=e[1];switch(r=a*(1-s),o=a*(1-s*(n=6*u-(6*u|0))),i=a*(1-s*(1-n)),(6*u|0)%6){case 0:t[0]=a,t[1]=i,t[2]=r;break;case 1:t[0]=o,t[1]=a,t[2]=r;break;case 2:t[0]=r,t[1]=a,t[2]=i;break;case 3:t[0]=r,t[1]=o,t[2]=a;break;case 4:t[0]=i,t[1]=r,t[2]=a;break;case 5:t[0]=a,t[1]=r,t[2]=o}return t}},{key:"rgb2hex",value:function(t){var e=(256|255*t[0]).toString(16),n=(256|255*t[1]).toString(16),r=(256|255*t[2]).toString(16);return e.slice(-2)+n.slice(-2)+r.slice(-2)}},{key:"rgb2hsv",value:function(t,e){var n=Math.max(e[0],Math.max(e[1],e[2])),r=Math.min(e[0],Math.min(e[1],e[2]));return n==r?t[0]=0:n==e[0]?t[0]=1/6*(e[1]-e[2])/(n-r)+1:n==e[1]?t[0]=1/6*(e[2]-e[0])/(n-r)+2/6:n==e[2]&&(t[0]=1/6*(e[0]-e[1])/(n-r)+4/6),t[0]-=0|t[0],t[1]=0==n?0:(n-r)/n,t[2]=n,t}},{key:"init",value:function(e,n,r){if(t.canvasgl=n,t.canvas=e,!t.canvas||!t.canvas.getContext)return!1;t.SCREEN_W=t.canvas.getAttribute("width"),t.SCREEN_H=t.canvas.getAttribute("height"),t.ctx=t.canvas.getContext("2d"),t.ctx.clearRect(0,0,t.SCREEN_W,t.SCREEN_H),t.imagedatacanvas=t.createCanvas(1024,1024),t.imagedatacontext=t.imagedatacanvas.getContext("2d");var o=r;o&&(o.onselect=function(){return!1},o.onselectstart=function(){return!1});var i=function(e,n){var r=t.canvasgl,o=0,i=0;r.clientWidth>0&&(o=r.width/r.clientWidth,i=r.height/r.clientHeight);var a=r.getBoundingClientRect();t.cursorX=(e-a.left)*o,t.cursorY=(n-a.top)*i};t.mouseMove=function(t,e){t&&t.addEventListener("pointermove",function(t){t=t||window.event,e(t),t.preventDefault()},!1)},t.mouseDown=function(t,e){t&&t.addEventListener("pointerdown",function(t){t=t||window.event,e(t),t.preventDefault()})},t.mouseUp=function(t,e){t.addEventListener("pointerup",function(t){t=t||window.event,e(t)})},t.mouseMove(o,function(e){if(i(e.pageX,e.pageY),"block"===Ft.style.display){e.currentTarget,t.padX=(e.cursorX-Ft.offsetLeft)/Ft.offsetWidth*2-1,t.padY=(e.cursorY-Ft.offsetTop)/Ft.offsetHeight*2-1;var n=t.padX*t.padX+t.padY*t.padY;n>1&&(n=Math.sqrt(n),t.padX=t.padX/n,t.padY=t.padY/n),a()}}),t.mouseDown(o,function(e){switch(i(e.pageX,e.pageY),e.button){case 0:t.pressOn=1;break;case 2:t.pressOnRight=1}}),t.mouseUp(window,function(e){switch(i(e.pageX,e.pageY),e.button){case 0:t.pressOn=0,t.padX=0,t.padY=0,Ft.style.display="none";break;case 2:t.pressOnRight=0}t.keyflag[4]=0});var a=function(){Nt.style.left=50*(t.padX+1)+"%",Nt.style.top=50*(t.padY+1)+"%"},u=document.getElementById("vertualPadArea");if(t.mouseDown(u,function(e){0===e.button&&(Ft.style.display="block",t.padX=0,t.padY=0,a(),e.stopPropagation())}),navigator.userAgent.match(/iPhone/i)||navigator.userAgent.match(/iPod/i)||navigator.userAgent.match(/Android/i));else{var s=function(e){(e=e||window.event).wheelDelta?(t.wheelDelta=e.wheelDelta/120,window.opera&&(t.wheelDelta=-t.wheelDelta)):e.detail&&(t.wheelDelta=-e.detail/3),e.preventDefault&&e.preventDefault()};window.addEventListener?window.addEventListener("DOMMouseScroll",s,{passive:!0}):document.attachEvent?document.attachEvent("onmousewheel",s):o&&(o.onmousewheel=s),document.body.addEventListener("blur",function(e){for(var n=0;n<t.keyflag.length;n++)t.keyflag[n]=0}),document.body.onkeydown=function(e){var r=(e=e||window.event).keyCode;null!=t.keymap[r]&&(t.keyflag[t.keymap[r]]=1),13==r&&(t.canvasgl.webkitRequestFullScreen(Element.ALLOW_KEYBOARD_INPUT),window.parent.screen.width/t.canvasgl.width>window.parent.screen.height/t.canvasgl.height?(n.style.width="auto",n.style.height="100%"):(n.style.width="100%",n.style.height="auto"))},document.body.onkeyup=function(e){var n=(e=e||window.event).keyCode;null!=t.keymap[n]&&(t.keyflag[t.keymap[n]]=0)},document.body.onblur=function(e){(e=e||window.event).keyCode;for(var n=0;n<t.keyflag.length;n++)t.keyflag[n]=0}}(Ft=document.createElement("div")).style.backgroundColor="#ff0000",Ft.style.opacity="0.3",Ft.style.width="256px",Ft.style.height="256px",Ft.style.position="absolute",Ft.style.left="10px",Ft.style.top="10px",Ft.style.borderRadius="50%",Ft.style.zIndex="10",Ft.style.display="none",Ft.style.marginLeft="-128px",Ft.style.marginTop="-128px",o&&o.appendChild(Ft),(Nt=document.createElement("div")).style.backgroundColor="#00ff00",Nt.style.width="32px",Nt.style.height="32px",Nt.style.position="absolute",Nt.style.borderRadius="50%",Nt.style.marginLeft="-16px",Nt.style.marginTop="-16px",Ft.appendChild(Nt),(Bt=document.createElement("div")).style.backgroundColor="#0000ff",Bt.style.opacity="0.25",Bt.style.width="256px",Bt.style.height="256px",Bt.style.position="absolute",Bt.style.right="10%",Bt.style.bottom="20%",Bt.style.borderRadius="50%",Bt.style.zIndex="100",Bt.style.display="none",Bt.innerHTML="jump",o&&o.appendChild(Bt),t.enableVirtualBtn&&(Bt.style.display="inline"),navigator.userAgent.match(/iPhone/i)||navigator.userAgent.match(/iPod/i)||navigator.userAgent.match(/Android/i)?(Bt.addEventListener("touchstart",function(e){e=e||window.event,t.keyflag[4]=1},!1),window.addEventListener("touchend",function(e){e=e||window.event,t.keyflag[4]=0},!1),Bt.addEventListener("touchmove",function(t){},!1),Bt.addEventListener("touchend",function(e){t.keyflag[4]=0},!1)):(Bt.onmousedown=function(e){e=e||window.event,t.keyflag[4]=1},Bt.onmouseup=function(e){e=e||window.event,t.keyflag[4]=0})}},{key:"setFps",value:function(e,n){t.mainfunc=n,t.fpsman=new kt(e,function(){t.mainloop()}),t.pressCount=0}},{key:"drawText",value:function(t,e,n,r,o,i,a){var u,s,c,f,l=e,h=n;for(u=0,s=r.length;u<s;u++)f=((c=r.charCodeAt(u)-32)>>4)*i,c=(15&c)*a,t.drawImage(o,c,f,i,a,l,h,i,a),l+=i}},{key:"convertURLcode",value:function(t){var e,n,r,o,i=t.length,a="%".charCodeAt(0),u="";for(n=0;n<i;n++){if((o=t.charCodeAt(n))==a)for(n++,224==(240&(o=parseInt(t.slice(n,n+2),16)))?(e=2,o&=15):192==(224&o)?(e=1,o&=31):e=0,n+=1,r=0;r<e;r++)n+=2,o<<=6,o|=63&parseInt(t.slice(n,n+2),16),n+=1;u+=String.fromCharCode(o)}return u}},{key:"fireEvent",value:function(t,e,n){document.all?t.fireEvent("on"+e):(n||(n=document.createEvent("Event")),n.initEvent(e,!0,!0),t.dispatchEvent(n))}},{key:"setText",value:function(t,e){t.innerText=e}},{key:"getText",value:function(t){return t.textContent?t.textContent:t.innerText}},{key:"stringToUtf8",value:function(t){for(var e=unescape(encodeURIComponent(t)),n=new Uint8Array(e.length),r=0;r<e.length;r++)n[r]=e.charCodeAt(r);return n}},{key:"utf8ToString",value:function(t){for(var e="",n=0;n<t.length;n++)e+=String.fromCharCode(t[n]);return decodeURIComponent(escape(e))}}]),t}();function Lt(t){return Lt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Lt(t)}function Vt(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,Dt(r.key),r)}}function Dt(t){var e=function(t){if("object"!=Lt(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var n=e.call(t,"string");if("object"!=Lt(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==Lt(e)?e:e+""}It(Ut,"SCREEN_W",void 0),It(Ut,"SCREEN_H",void 0),It(Ut,"imagedatacanvas",void 0),It(Ut,"imagedatacontext",void 0),It(Ut,"loadingCount",0),It(Ut,"ctx",null),It(Ut,"canvas",null),It(Ut,"canvasgl",null),It(Ut,"cursorX",0),It(Ut,"cursorY",0),It(Ut,"padX",0),It(Ut,"padY",0),It(Ut,"wheelDelta",0),It(Ut,"pressOn",0),It(Ut,"pressCount",0),It(Ut,"pressOnRight",0),It(Ut,"pressCountRight",0),It(Ut,"oldcursorX",0),It(Ut,"oldcursorY",0),It(Ut,"screenscale",1),It(Ut,"tap",0),It(Ut,"keyflag",[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]),It(Ut,"keyflagOld",[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]),It(Ut,"keymap",Ct),It(Ut,"enablePad",1),It(Ut,"createCanvas",function(t,e){var n=document.createElement("canvas");return"undefined"!=typeof G_vmlCanvasManager&&(n=G_vmlCanvasManager.initElement(n)),n.setAttribute("width",t),n.setAttribute("height",e),n}),It(Ut,"hex2rgb",function(t,e){return t[0]=parseInt(e.slice(0,2),16)/255,t[1]=parseInt(e.slice(2,4),16)/255,t[2]=parseInt(e.slice(4,6),16)/255,isNaN(t[0])&&(t[0]=0),isNaN(t[1])&&(t[1]=0),isNaN(t[2])&&(t[2]=0),t}),It(Ut,"createXMLHttpRequest",function(){if(window.XMLHttpRequest)return new XMLHttpRequest;if(!window.ActiveXObject)return null;try{return new ActiveXObject("Msxml2.XMLHTTP")}catch(t){try{return new ActiveXObject("Microsoft.XMLHTTP")}catch(t){return null}}}),It(Ut,"getCurrent",function(){var t="/";if(document.currentScript)t=document.currentScript.src;else{var e=document.getElementsByTagName("script"),n=e[e.length-1];n.src&&(t=n.src)}return t.substring(0,t.lastIndexOf("/")+1)}),It(Ut,"loadJs",function(t,e){});var Gt=function(){function t(e,n,r){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.byteBuffer="number"==typeof e?new Uint8Array(e):r?new Uint8Array(e,n,r):new Uint8Array(e),this.dv=new DataView(this.byteBuffer.buffer,this.byteBuffer.byteOffset,this.byteBuffer.byteLength),this.idx=0}return function(t,e){e&&Vt(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1})}(t,[{key:"getByteIndex",value:function(){return this.idx>>>3}},{key:"fill",value:function(t,e){for(var n=0;n<e;n++)this.setUint8(t)}},{key:"setInt32",value:function(t,e){this.dv.setInt32(this.idx>>3,t,e),this.idx+=32}},{key:"getInt32",value:function(t){var e=this.dv.getInt32(this.idx>>3,t);return this.idx+=32,e}},{key:"setUint8",value:function(t){this.dv.setUint8(this.idx>>3,t),this.idx+=8}},{key:"getUint8",value:function(t){var e=this.dv.getUint8(this.idx>>3,t);return this.idx+=8,e}},{key:"setUint32",value:function(t,e){this.dv.setUint32(this.idx>>3,t,e),this.idx+=32}},{key:"getUint32",value:function(t){var e=this.dv.getUint32(this.idx>>3,t);return this.idx+=32,e}},{key:"setUint16",value:function(t,e){this.dv.setUint16(this.idx>>3,t,e),this.idx+=16}},{key:"getUint16",value:function(t){var e=this.dv.getUint16(this.idx>>3,t);return this.idx+=16,e}},{key:"setUint64",value:function(t,e){var n=t/4294967296|0,r=4294967295&t;e?(this.setUint32(r,e),this.setUint32(n,e)):(this.setUint32(n,e),this.setUint32(r,e))}},{key:"getUint64",value:function(t){var e=this.getUint32(t),n=this.getUint32(t);return t?(n<<32)+e:(e<<32)+n}},{key:"setFloat32",value:function(t,e){this.dv.setFloat32(this.idx>>3,t,e),this.idx+=32}},{key:"getFloat32",value:function(t){var e=this.dv.getFloat32(this.idx>>3,t);return this.idx+=32,e}},{key:"setBytes",value:function(t){for(var e=0;e<t.length;e++)this.setUint8(t[e])}},{key:"getBytes",value:function(t){for(var e=new Uint8Array(t),n=0;n<t;n++)e[n]=this.getUint8();return e}},{key:"setTextBuf",value:function(t,e){for(var n=Ut.stringToUtf8(t),r=(this.dv,0);r<n.length;r++)this.setUint8(n[r]);e&&this.setUint8(0)}},{key:"readTextBuf",value:function(){for(var t,e=this.dv,n=[];0!==(t=e.getUint8(this.idx>>3));)n.push(t),this.idx+=8;return this.idx+=8,Ut.utf8ToString(n)}},{key:"setFloat16",value:function(t,e){this.dv;var n=1-Math.sign(t)>>1,r=Math.abs(t),o=Math.floor(Math.log2(r)),i=n<<15|o+15<<10|1024*(r=r/Math.pow(2,o)-1)&1023;this.setUint16(i,e)}},{key:"readFloat16",value:function(t){this.dv;var e=this.getUint16(t);if(0===e)return 0;var n=e>>15&1,r=(e>>10&31)-15;return(n=1-2*n)*(1*(1023&e)/1024+1)*Math.pow(2,r)}},{key:"outputBit",value:function(t){this.byteBuffer[this.idx>>3]&=~(1<<(7&this.idx)),this.byteBuffer[this.idx>>3]|=t<<(7&this.idx),this.idx++}},{key:"outputBits",value:function(t,e){for(var n=0;n<e;n++)this.outputBit(t>>n&1)}},{key:"outputBitsReverse",value:function(t,e){for(var n=e-1;n>=0;n--)this.outputBit(t>>n&1)}},{key:"readBit",value:function(){var t=this.byteBuffer[this.idx>>3]>>(7&this.idx)&1;return this.idx++,t}},{key:"readBits",value:function(t){for(var e=0,n=0;n<t;n++)e|=this.readBit()<<n;return e}},{key:"readBitsReverse",value:function(t){for(var e=0,n=0;n<t;n++)e=e<<1|this.readBit();return e}}]),t}();function zt(t){return zt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},zt(t)}function Xt(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function Ht(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,Yt(r.key),r)}}function qt(t,e,n){return e&&Ht(t.prototype,e),n&&Ht(t,n),Object.defineProperty(t,"prototype",{writable:!1}),t}function Yt(t){var e=function(t){if("object"!=zt(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var n=e.call(t,"string");if("object"!=zt(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==zt(e)?e:e+""}var Wt=[],Qt=[],$t=[],Jt=function(){function t(){Xt(this,t)}return qt(t,null,[{key:"compress",value:function(t,e,n){var r;if(n){r=[];for(var o=0;o<t.length;){var i=Math.min(n,t.length-o);o+i>=t.length?final=1:final=0,a=Kt(t,o,i,final,e),r=r.concat(a),o+=i}}else r=Kt(t,0,t.length,1,e);return r}},{key:"expand",value:function(t,e,n){for(var r=new Gt(t,e,n),o=[],i=0;!i;){i=r.readBit();var a=r.readBits(2);if(0===a){7&r.idx?r.idx=8+(-8&r.idx):r.idx=-8&r.idx;var u=r.readBits(16);r.readBits(16);for(var s=0;s<u;s++)o.push(r.readBits(8))}else if(1===a||2===a){var c=[];if(1===a){for(s=0;s<=143;s++)c[s]=8;for(s=144;s<=255;s++)c[s]=9;for(s=256;s<=279;s++)c[s]=7;for(s=280;s<=287;s++)c[s]=8;for(Qt=Zt(c),c=[],s=0;s<=31;s++)c[s]=5;$t=Zt(c)}else{var f=r.readBits(5),l=r.readBits(5),h=r.readBits(4),p=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];for(s=0;s<p.length;s++)c[p[s]]=s<h+4?r.readBits(3):0;var v=Zt(c),y=ne(r,f+l+258,v);c=y.slice(0,f+257),Qt=Zt(c),c=y.slice(f+257),$t=Zt(c)}for(;;){var m=te(r,Qt);if(m<256)o.push(m);else{if(256==m)break;if(285===m)m=255;else{var b=m-261;b>=0?m=((m-=257)-(e=4+4*(b>>=2))<<b)+(4<<b)+r.readBits(b):m-=257}o.push(-(m+3)),(b=(m=te(r,$t))-2)>=0&&(m=(m-(e=2+2*(b>>=1))<<b)+(2<<b)+r.readBits(b)),o.push(m+1)}}o=ce(o)}}return o}}]),t}(),Kt=function(t,e,n,r,o){var i=new Gt(new ArrayBuffer(2*n));if(i.outputBit(r),i.outputBits(o,2),0===o){7&i.idx?i.idx=8+(-8&i.idx):i.idx=-8&dx.idx;var a=n;i.outputBits(a,16),i.outputBits(~a,16);for(var u=0;u<t.length;u++)i.outputBits(t[u+e],8)}else{var s=[],c=[],f=[],l=se(t,e,n);if(1===o){for(u=0;u<=143;u++)s[u]=8;for(u=144;u<=255;u++)s[u]=9;for(u=256;u<=279;u++)s[u]=7;for(u=280;u<=287;u++)s[u]=8;for(u=0;u<=31;u++)c[u]=5}else if(2===o){for(u=0;u<19;u++)f.push(5);for(Wt=Zt(f),u=0;u<=143;u++)s[u]=9;for(u=144;u<=255;u++)s[u]=8;for(u=256;u<=279;u++)s[u]=8;for(u=280;u<=287;u++)s[u]=7;for(u=0;u<=31;u++)c[u]=5;for(i.outputBits(s.length-257,5),i.outputBits(c.length-1,5),i.outputBits(f.length-4,4),u=0;u<f.length;u++)i.outputBits(f[u],3);var h=ee(s,Wt);oe(i,h,Wt),h=ee(c,Wt),oe(i,h,Wt)}for(Qt=Zt(s),$t=Zt(c),u=0;u<l.length;u++)if(l[u]>=0)re(i,l[u],Qt);else{a=-l[u];var p=l[++u],v=0,y=0,m=285;a<258&&(m=4*(v=(0|Math.log2(Math.max(a-3,4)))-2)+(a-3>>v)+257,y=a-3&(1<<v)-1),re(i,m,Qt),i.outputBits(y,v),y=p-1&(1<<(v=(0|Math.log2(Math.max(p-1,2)))-1))-1,re(i,m=2*v+(p-1>>v),$t),i.outputBits(y,v)}re(i,256,Qt)}return Array.from(i.byteBuffer).slice(0,Math.ceil(i.idx/8))},Zt=function(t){for(var e=[],n=0,r=0;r<t.length;r++){var o={};o.Len=t[r],o.Code=0,e.push(o),n<t[r]&&(n=t[r])}var i=new Array(n+1);for(r=0;r<i.length;r++)i[r]=0;for(r=0;r<e.length;r++)i[e[r].Len]++;var a=0,u=new Array(n+1);i[0]=0;for(var s=1;s<u.length;s++)a=a+i[s-1]<<1,u[s]=a;for(var c=0;c<e.length;c++){var f=e[c].Len;0!=f&&(e[c].Code=u[f],u[f]++)}var l={};for(r=0;r<e.length;r++)e[r].Len&&(l[e[r].Code]=r);var h={};return h.enc_huffmans=e,h.dec_huffmans=l,h},te=function(t,e){for(var n=e.dec_huffmans,r=e.enc_huffmans,o=1;o<=15;o++){var i=n[t.readBitsReverse(o)];if(null!=i&&r[i].Len===o)return i;t.idx-=o}return null},ee=function(t){for(var e=[],n=0;n<t.length;n++){for(var r=t[n],o=1;o+n<t.length&&r===t[n+o];o++);if(n+=o-1,0===r)for(;o;)o<3?(e.push(0),o-=1):o<11?(e.push(17),e.push(o-3),o=0):o<139?(e.push(18),e.push(o-11),o=0):(e.push(18),e.push(127),o-=138);else for(e.push(r),o-=1;o;)o<3?(e.push(r),o-=1):o<7?(e.push(16),e.push(o-3),o=0):(e.push(16),e.push(3),o-=6)}return e},ne=function(t,e,n){for(var r=[];!(r.length>=e);){var o=te(t,n);if(o<=15)r.push(o);else if(16===o)for(var i=t.readBits(2),a=r[r.length-1],u=0;u<i+3;u++)r.push(a);else if(17===o)for(i=t.readBits(3),u=0;u<i+3;u++)r.push(0);else if(18===o)for(i=t.readBits(7),u=0;u<i+11;u++)r.push(0)}return r},re=function(t,e,n){var r=n.enc_huffmans[e];t.outputBitsReverse(r.Code,r.Len)},oe=function(t,e,n){for(var r=0;r<e.length;r++){var o=e[r];o<=15?re(t,o,n):16===o?(re(t,o,n),r++,t.outputBits(e[r],2)):17===o?(re(t,o,n),r++,t.outputBits(e[r],3)):18===o&&(re(t,o,n),r++,t.outputBits(e[r],7))}},ie=function(){function t(){Xt(this,t),this.front=[],this.behind=[]}return qt(t,[{key:"push",value:function(t){this.front.push(t)}},{key:"shift",value:function(){if(0===this.behind.length){var t=this.behind;this.behind=this.front,this.front=t,this.behind.reverse()}return this.behind.pop()}},{key:"each",value:function(t){for(var e=this.behind.length;e--;)if(t(this.behind[e]))return;for(e=0;e<this.front.length;e++)if(t(this.front[e]))return}},{key:"each_inv1",value:function(t){var e=this.front.length;for(e>0&&e--;e--;)if(t(this.front[e]))return;for(e=0,0===this.front.length&&(e=1);e<this.behind.length;e++)if(t(this.behind[e]))return}},{key:"each_inv",value:function(t){for(var e=this.front.length;e--;)if(t(this.front[e]))return;for(e=0;e<this.behind.length;e++)if(t(this.behind[e]))return}}]),t}(),ae=function(t,e,n){var r=(e[n]<<16)+(e[n+1]<<8)+e[n+2];r in t||(t[r]=new ie),t[r].push(n)},ue=function(t,e,n){t[(e[n]<<16)+(e[n+1]<<8)+e[n+2]].shift()},se=function(t,e,n){for(var r=new Array(n),o=0,i={},a=new DataView(t.buffer),u=Math.max(0,e-32768);u<e;u++)ae(i,t,u);var s=n-2;for(u=0;u<s;u++){var c=e+u,f=0,l=2,h=Math.min(n-u,258)+c,p=h-4,v=i[(t[c]<<16)+(t[c+1]<<8)+t[c+2]];if(v&&v.each_inv(function(t){for(var e=c-t,n=c;n<p&&a.getUint32(n)===a.getUint32(n-e);n+=4);for(;n<h&&a.getUint8(n)===a.getUint8(n-e);n++);return!(n-c<=l)&&(f=e,l=n-c,n===h||void 0)}),f){for(r[o]=-l,r[++o]=f,u+=l-1,m=0;m<l;m++)ae(i,t,m+c);var y=c-32768+l;for(m=Math.max(0,c-32768);m<y;m++)ue(i,t,m)}else{r[o]=t[c],ae(i,t,c);var m=c-32768;m>=0&&ue(i,t,m)}o++}for(;u<n;u++)r[o]=t[e+u],o++;return r.length=o,r},ce=function(t,e){var n;n=e||[];for(var r=0;r<t.length;r++)if(t[r]>=0)n.push(t[r]);else for(var o=-t[r],i=t[++r],a=n.length-i,u=0;u<o;u++)n.push(n[a+u]);return n};function fe(t){return fe="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},fe(t)}function le(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,he(r.key),r)}}function he(t){var e=function(t){if("object"!=fe(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var n=e.call(t,"string");if("object"!=fe(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==fe(e)?e:e+""}var pe=function(t){for(var e=1,n=0,r=t.length,o=0;o<r;){for(var i=Math.min(5550,r-o),a=0;a<i;a++,o++)n+=e+=t[o];e%=65521,n%=65521}return 65536*n+e},ve=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t)}return function(t,e,n){n&&le(t,n),Object.defineProperty(t,"prototype",{writable:!1})}(t,0,[{key:"compress",value:function(t,e,n){var r=[];r[0]=120,r[1]=128,r[1]+=31-((r[0]<<8)+r[1])%31;var o=Array.from(Jt.compress(t,e,n)),i=pe(t),a=new DataView(new ArrayBuffer(4));return a.setUint32(0,i),a=Array.from(new Uint8Array(a.buffer)),r.concat(o).concat(Array.from(a))}},{key:"expand",value:function(t,e,n){var r=new DataView(t),o=(r.getUint16(0),r.getUint32(e+(n-4)),Jt.expand(t,e+2,n-6));return pe(o),o}}]),t}();function ye(t){return ye="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},ye(t)}function me(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,be(r.key),r)}}function be(t){var e=function(t){if("object"!=ye(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var n=e.call(t,"string");if("object"!=ye(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==ye(e)?e:e+""}var de,ge,we=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t)}return function(t,e,n){n&&me(t,n),Object.defineProperty(t,"prototype",{writable:!1})}(t,0,[{key:"toArrayBuffer",value:function(t){var e=t.attributes.channels,n=t.attributes.dataWindow.xMax-t.attributes.dataWindow.xMin+1,r=t.attributes.dataWindow.yMax-t.attributes.dataWindow.yMin+1,o=new Gt(r*(16+2*n*e.length)+400);o.setUint32(20000630,!0),o.setUint16(2,!0),o.setUint16(0,!0);for(var i=t.attributes,a=Object.keys(i),u=0;u<a.length;u++){var s=a[u],c=i[s];o.setTextBuf(s,!0);var f,l="";switch(s){case"channels":l="chlist";break;case"compression":l="compression";break;case"dataWindow":case"displayWindow":l="box2i";break;case"lineOrder":l="lineOrder";break;case"pixelAspectRatio":case"screenWindowWidth":l="float";break;case"screenWindowCenter":l="v2f";break;case"chromaticities":l="chromaticities"}if(o.setTextBuf(l,!0),f=o.idx,o.idx+=32,"box2i"===l)o.setInt32(c.xMin,!0),o.setInt32(c.yMin,!0),o.setInt32(c.xMax,!0),o.setInt32(c.yMax,!0);else if("box2f"===l)o.setFloat32(c.xMin,!0),o.setFloat32(c.yMin,!0),o.setFloat32(c.xMax,!0),o.setFloat32(c.yMax,!0);else if("chlist"===l){e=c;for(var h=0;h<e.length;h++){var p=e[h];o.setTextBuf(p.name,!0),o.setInt32(p.pixel_type,!0),o.setUint8(p.pLiner,!0),o.setUint8(0,!0),o.setUint8(0,!0),o.setUint8(0,!0),o.setInt32(p.xSampling,!0),o.setInt32(p.ySampling,!0)}o.setTextBuf("",!0)}else if("compression"===l)o.setUint8(c);else if("double"===l)o.setFloat64(c,!0);else if("float"===l)o.setFloat32(c,!0);else if("int"===l)o.setInt32(c,!0);else if("lineOrder"===l)o.getUint8(0,!0);else if("string"===l)o.setTextBuf(c,!0);else if("v2i"===l)o.setInt32(c[0],!0),o.setInt32(c[1],!0);else if("v2f"===l)o.setFloat32(c[0],!0),o.setFloat32(c[1],!0);else if("chromaticities"===l)for(var v=0;v<8;v++)o.setFloat32(c[v],!0);var y=o.idx;o.idx=f,o.setUint32((y-f>>3)-4,!0),o.idx=y}o.setTextBuf("",!0);var m=o.idx;o.idx+=64*t.height;var b=o.idx,d=2*t.width*e.length,g=1;3===t.attributes.compression&&(g=16);for(var w=new Gt(new ArrayBuffer(d*g)),_=0;_<r;){b=o.idx,o.idx=m,o.setUint64(b>>3,!0),m=o.idx,o.idx=b,o.setUint32(_,!0),w.idx=0;for(var x=Math.min(g,r-_),j=0;j<x;j++){var O=_*n;for(h=0;h<e.length;h++)for(var S=e[h].data,E=0;E<n;E++)w.setFloat16(S[O+E],!0);_++}var P=new Uint8Array(w.dv.buffer,0,x*d);if(t.attributes.compression){for(var T=P.length>>1,k=new Uint8Array(P.length),M=0;M<T;M++)k[M]=P[M<<1],k[M+T]=P[1+(M<<1)];for(M=k.length-1;M>0;M--)k[M]=k[M]-k[M-1]+128&255;P=ve.compress(k,1)}o.setUint32(P.length,!0),o.setBytes(P)}return o.byteBuffer.buffer.slice(0,o.idx>>3)}},{key:"fromArrayBuffer",value:function(t,e){var n=new Gt(e),r=n.getUint32(!0);if(20000630===r){r=n.getUint16(!0),n.getUint16(!0);for(var o=[];;){var i=n.readTextBuf();if(""===i)break;var a=n.readTextBuf(),u=null,s=n.getUint32(!0),c=n.idx;if("box2i"===a)(u={}).xMin=n.getInt32(!0),u.yMin=n.getInt32(!0),u.xMax=n.getInt32(!0),u.yMax=n.getInt32(!0);else if("box2f"===a)(u={}).xMin=n.getFloat32(!0),u.yMin=n.getFloat32(!0),u.xMax=n.getFloat32(!0),u.yMax=n.getFloat32(!0);else if("chlist"===a)for(u=[];;){var f=[];if(f.name=n.readTextBuf(),""===f.name)break;f.pixel_type=n.getInt32(!0),f.pLinear=n.getUint8(!0),f.reserved=n.getUint8(!0),n.idx+=16,f.xSampling=n.getInt32(!0),f.ySampling=n.getInt32(!0),u.push(f)}else if("compression"===a)u=n.getUint8(!0);else if("double"===a)u=n.getFloat64(!0);else if("float"===a)u=n.getFloat32(!0);else if("int"===a)u=n.getInt32(!0);else if("lineOrder"===a)u=n.getUint8(!0);else if("string"===a){u="";for(var l=0;l<s;l++)u+=String.fromCharCode(n.getUint8(!0))}else if("v2i"===a)(u=[]).push(n.getInt32(!0)),u.push(n.getInt32(!0));else if("v2f"===a)(u=[]).push(n.getFloat32(!0)),u.push(n.getFloat32(!0));else if("chromaticities"===a){u=[];for(var h=0;h<8;h++)u.push(n.getFloat32(!0))}o[i]=u,n.idx=c+(s<<3)}var p=o.channels;t.width=o.dataWindow.xMax-o.dataWindow.xMin+1,t.height=o.dataWindow.yMax-o.dataWindow.yMin+1;var v=t.width*t.height;for(l=0;l<p.length;l++)0===(E=p[l]).pixel_type&&(E.data=new Uint8Array(v)),1===E.pixel_type&&(E.data=new Float32Array(v)),2===E.pixel_type&&(E.data=new Float32Array(v));for(l=0;l<t.height;l++){var y=n.getUint64(!0),m=n.idx;n.idx=y<<3;var b,d=n.getUint32(!0),g=n.getUint32(!0),w=1;if(0===o.compression&&(b=new Gt(n.dv.buffer,n.idx>>3,g)),2===o.compression||3===o.compression)var _=ve.expand(n.dv.buffer,n.idx>>3,g);if(3===o.compression&&(w=Math.min(t.height-d,16)),3===o.compression||2===o.compression){for(var x=new Uint8Array(_.length),j=1;j<_.length;j++)_[j]=_[j-1]-128+_[j]&255;for(y=_.length>>1,j=0;j<y;j++)x[j<<1]=_[j],x[1+(j<<1)]=_[j+y];b=new Gt(x.buffer)}for(var O=0;O<w;O++)for(var S=0;S<p.length;S++){_=(E=p[S]).data;var E,P=(d+O)*t.width;if(0==E.pixel_type)for(var T=0;T<t.width;T++)E.data[P+T]=b.getUint8(!0);else if(1==E.pixel_type)for(T=0;T<t.width;T++)E.data[P+T]=b.readFloat16(!0);else if(2==E.pixel_type)for(T=0;T<t.width;T++)E.data[P+T]=b.getFloat32(!0)}n.idx=m,l+=w-1}t.attributes=o}else alert("exr")}}]),t}();function _e(t){return _e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},_e(t)}function xe(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,Oe(r.key),r)}}function je(t,e,n){return(e=Oe(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function Oe(t){var e=function(t){if("object"!=_e(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var n=e.call(t,"string");if("object"!=_e(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==_e(e)?e:e+""}(ge=document.createElement("canvas")).width=1,ge.height=1,(de=ge.getContext("2d",{willReadFrequently:!0})).createImageData(ge.width,ge.height),new q;var Se=0,Ee=function(){function t(e,n,r){(function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")})(this,t),je(this,"toDataURL",function(t,e,n,r,o,i){return this.toCanvas(n,r,o,i).toDataURL(t,e)}),je(this,"toBlob",function(t,e,n,r,o,i,a){return this.toCanvas(r,o,i,a).toBlob(t,e,n)}),je(this,"toBMP",function(){var t=this.height,e=this.width,n=t*(4*e+1>>>2<<2)*2+14+40,r=new DataStream(n);r.setTextBuf("BM",0),r.setUint32(n,!0),r.setUint16(0,!0),r.setUint16(0,!0),r.setUint32(54,!0),r.setUint32(40,!0),r.setUint32(this.width,!0),r.setUint32(this.height,!0),r.setUint16(1,!0),r.setUint16(32,!0),r.setUint32(0,!0),r.setUint32(this.data.length,!0),r.setUint32(0,!0),r.setUint32(0,!0),r.setUint32(0,!0),r.setUint32(0,!0);var o=this.data;if(1===this.format)for(var i=t;i--;)for(var a=i*e<<2,u=0;u<e;u++)r.setUint8(o[a+2],!0),r.setUint8(o[a+1],!0),r.setUint8(o[a+0],!0),r.setUint8(o[a+3],!0),a+=4;return r.byteBuffer}),e||(e=0,n=0),this.id=Se,Se++,this.width=e,this.height=n,this.data=null,this.format=r,this.width&&(this.format===t.FORMAT_UINT8?(this.imagedata=de.createImageData(this.width,this.height),this.data=this.imagedata.data,this.rgba=new Uint32Array(this.data.buffer)):this.data=new Float32Array(this.width*this.height<<2))}return function(t,e,n){e&&xe(t.prototype,e),n&&xe(t,n),Object.defineProperty(t,"prototype",{writable:!1})}(t,[{key:"scan",value:function(t,e,n,r,o){var i=this.data;void 0===e&&(e=0,n=0,r=this.width,o=this.height);for(var a=0;a<o;a++)for(var u=this.getIndex(e,a+n)<<2,s=0;s<r;s++)t(i,u,e+s,n+a),u+=4}},{key:"copy",value:function(e,n,r,o,i,a,u,s){t.copy(this,e,n,r,o,i,a,u,s)}},{key:"getIndex",value:function(t,e){return e*this.width+t}},{key:"getIndexLoop",value:function(t,e){var n=t%this.width,r=e%this.height;return n<0&&(n+=this.width),r<0&&(r+=this.height),r*this.width+n}},{key:"createExr",value:function(t){var e=this,n={};n.width=e.width,n.height=e.height,n.attributes=[],n.attributes.compression=t,n.attributes.dataWindow={xMin:0,yMin:0,xMax:e.width-1,yMax:e.height-1},n.attributes.displayWindow={xMin:0,yMin:0,xMax:e.width-1,yMax:e.height-1},n.attributes.lineOrder=0,n.attributes.pixelAspectRatio=1,n.attributes.screenWindowCenter=[0,0],n.attributes.screenWindowWidth=1;for(var r=e.width*e.height,o=[],i=0;i<4;i++){var a={};a.data=new Float32Array(r),a.pixel_type=1,a.pLiner=0,a.reserved=0,a.xSampling=1,a.ySampling=1,o.push(a)}o[0].name="A",o[1].name="B",o[2].name="G",o[3].name="R";var u=e.data;for(i=0;i<r;i++){var s=i<<2;o[0].data[i]=u[s+3],o[1].data[i]=u[s+2],o[2].data[i]=u[s+1],o[3].data[i]=u[s+0]}return n.attributes.channels=o,we.toArrayBuffer(n)}},{key:"fill",value:function(t,e,n,r,o,i,a,u){var s=this.data;if(void 0===o)for(var c=s.length,f=0;f<c;f+=4)s[y+0]=t,s[y+1]=e,s[y+2]=n,s[y+3]=r;else for(var l=this.width,h=Math.min(this.height,i+u),p=Math.min(l,o+a),v=i;v<h;v++)for(var y=v*l+o<<2,m=v*l+p<<2;y<m;y+=4)s[y+0]=t,s[y+1]=e,s[y+2]=n,s[y+3]=r}},{key:"clear",value:function(t,e,n,r){var o=this.data;if(void 0===t)o.length,o.fill(0);else for(var i=this.width,a=Math.min(this.height,e+r),u=Math.min(i,t+n),s=e;s<a;s++){var c=s*i+t<<2,f=s*i+u<<2;o.fill(0,c,f)}}},{key:"toCanvas",value:function(t,e,n,r){return void 0===t&&(t=0,e=0,n=this.width,r=this.height),ge.width=n,ge.height=r,de.putImageData(this.toImageData(),0,0,t,e,n,r),ge}},{key:"toImageData",value:function(){var e,n=this.data;if(this.format===t.FORMAT_UINT8)e=this.imagedata;else{e=de.createImageData(this.width,this.height);for(var r=0;r<this.height;r++)for(var o=0;o<this.width;o++)for(var i=r*this.width+o<<2,a=0;a<4;a++)e.data[i+a]=255*n[i+a]}return e}},{key:"gauss",value:function(e,n,r,o,i,a){if(n){var u=this;e=Math.max(1,e);var s=0|n;Te.data.length<u.data.length&&(Te=new t(u.width,u.height)),Te.width=u.width,Te.height=u.height;for(var c=Te,f=r+i-1,l=o+a-1,h=new Array(s),p=0,v=0;v<h.length;v++){var y=v,m=Math.exp(-y*y/(2*e*e));h[v]=m,v>0&&(m*=2),p+=m}for(v=0;v<h.length;v++)h[v]/=p;for(var b=u.height,d=u.width,g=u.data,w=c.data,_=Math.max(0,o-n),x=Math.min(u.height,l+n+1),j=_;j<x;j++){for(var O=j*d,S=O+r<<2,E=O+(f+1)<<2;S<E;S+=4){var P=g[S+3];g[S+0]*=P,g[S+1]*=P,g[S+2]*=P}for(var T=r,k=(S=O+r<<2,O+f+1<<2),M=(y=h[0],j*d+(d-1)<<2),R=j*d<<2;S<k;S+=4)w[S+0]=g[S+0]*y,w[S+1]=g[S+1]*y,w[S+2]=g[S+2]*y,w[S+3]=g[S+3]*y;for(k=Math.min(s,f+1);T<k;T++){var I=S=O+T<<2,A=S;for(v=1;v<s;v++)I=Math.max(I-4,R),A=Math.min(A+4,M),y=h[v],w[S+0]+=(g[I+0]+g[A+0])*y,w[S+1]+=(g[I+1]+g[A+1])*y,w[S+2]+=(g[I+2]+g[A+2])*y,w[S+3]+=(g[I+3]+g[A+3])*y}for(k=Math.min(d-s,f+1);T<k;T++)for(I=S=O+T<<2,A=S,v=1;v<s;v++)I-=4,A+=4,y=h[v],w[S+0]+=(g[I+0]+g[A+0])*y,w[S+1]+=(g[I+1]+g[A+1])*y,w[S+2]+=(g[I+2]+g[A+2])*y,w[S+3]+=(g[I+3]+g[A+3])*y;for(k=Math.min(f+1,d);T<k;T++)for(I=S=O+T<<2,A=S,v=1;v<s;v++)I=Math.max(I-4,R),A=Math.min(A+4,M),y=h[v],w[S+0]+=(g[I+0]+g[A+0])*y,w[S+1]+=(g[I+1]+g[A+1])*y,w[S+2]+=(g[I+2]+g[A+2])*y,w[S+3]+=(g[I+3]+g[A+3])*y}for(g=c.data,w=u.data,T=r;T<f+1;T++){var C=d<<2;for(S=o*d+T<<2,k=(l+1)*d+T<<2,y=h[0];S<k;S+=4*d)w[S+0]=g[S+0]*y,w[S+1]=g[S+1]*y,w[S+2]=g[S+2]*y,w[S+3]=g[S+3]*y;for(j=o,k=Math.min(s,l+1),M=(b-1)*d+T<<2,R=T<<2;j<k;j++)for(I=S=j*d+T<<2,A=S,v=1;v<s;v++)I=Math.max(I-C,R),A=Math.min(A+C,M),y=h[v],w[S+0]+=(g[I+0]+g[A+0])*y,w[S+1]+=(g[I+1]+g[A+1])*y,w[S+2]+=(g[I+2]+g[A+2])*y,w[S+3]+=(g[I+3]+g[A+3])*y;for(k=Math.min(b-s,l+1);j<k;j++)for(I=S=j*d+T<<2,A=S,v=1;v<s;v++)I-=C,A+=C,y=h[v],w[S+0]+=(g[I+0]+g[A+0])*y,w[S+1]+=(g[I+1]+g[A+1])*y,w[S+2]+=(g[I+2]+g[A+2])*y,w[S+3]+=(g[I+3]+g[A+3])*y;for(k=Math.min(b,l+1);j<k;j++)for(I=S=j*d+T<<2,A=S,v=1;v<s;v++)I=Math.max(I-C,R),A=Math.min(A+C,M),y=h[v],w[S+0]+=(g[I+0]+g[A+0])*y,w[S+1]+=(g[I+1]+g[A+1])*y,w[S+2]+=(g[I+2]+g[A+2])*y,w[S+3]+=(g[I+3]+g[A+3])*y;for(S=o*d+T<<2,E=(l+1)*d+T<<2;S<E;S+=4*d)(P=w[S+3])>0&&P<1&&(P=1/P,w[S+0]*=P,w[S+1]*=P,w[S+2]*=P)}}}}],[{key:"packR11G11B10",value:function(t,e){var n=X.alloc(),r=X.alloc();n[0]=Math.floor(Math.log2(Math.max(e[0],1e-5))),n[1]=Math.floor(Math.log2(Math.max(e[1],1e-5))),n[2]=Math.floor(Math.log2(Math.max(e[2],1e-5))),n[0]=Math.max(Math.min(n[0],16),-15),n[1]=Math.max(Math.min(n[1],16),-15),n[2]=Math.max(Math.min(n[2],16),-15),r[0]=Math.max(e[0]*Math.pow(2,-n[0])-1,0),r[1]=Math.max(e[1]*Math.pow(2,-n[1])-1,0),r[2]=Math.max(e[2]*Math.pow(2,-n[2])-1,0),t[0]=(n[0]+15<<3)+Math.floor(8*r[0]),t[1]=(n[1]+15<<3)+Math.floor(8*r[1]),t[2]=(n[2]+15<<3)+Math.floor(8*Pe(8*r[0])),t[3]=(32*r[2]<<3)+Math.floor(8*Pe(8*r[1])),X.free(2)}},{key:"copy",value:function(e,n,r,o,i,a,u,s,c){var f=e.data,l=(e.width,o.data);o.width,u+i>o.width&&(u=o.width-i),s+a>o.height&&(s=o.height-a);var h=n,p=n+u,v=r,y=r+s;if(i<0&&(h-=i,i=0),a<0&&(v-=a,a=0),h<0&&(i-=h,h=0),v<0&&(a-=v,v=0),p>e.width&&(p=e.width),y>e.height&&(y=e.height),e.type===t.FORMAT_UINT8&&o.type===t.FORMAT_UINT8)for(var m=v;m<y;m++)for(var b=e.getIndex(h,m),d=o.getIndex(i,a+m-v),g=h;g<p;g++)e.rgba[b]=o.rgba[d],b++,d++;else for(m=v;m<y;m++)for(b=e.getIndex(h,m),d=o.getIndex(i,a+m-v),b<<=2,d<<=2,g=h;g<p;g++)f[b+0]=l[d+0],f[b+1]=l[d+1],f[b+2]=l[d+2],f[b+3]=l[d+3],b+=4,d+=4}},{key:"loadImg",value:function(e,n,r){if("string"!=typeof e)return Ut.loadFile(e,function(e){t.loadImg(e,n,r)}),null;if(e.indexOf(".exr")>=0)return t.loadExr(e,n,r);var o=new Image;o.src=e;var i=new this;return i.name=e,i.format=n,Ut.loadingCount++,o.onload=function(e){i.width=o.width,i.height=o.height,(ge.width<i.width||ge.height<i.height)&&(ge.width<i.width&&(ge.width=i.width),ge.height<i.height&&(ge.height=i.height),de.createImageData(ge.width,ge.height)),de.clearRect(0,0,ge.width,ge.height),de.drawImage(o,0,0);var n=de.getImageData(0,0,i.width,i.height).data;if(i.format===t.FORMAT_UINT8){i.data=new Uint8Array(i.width*i.height*4),i.rgba=new Uint32Array(i.data.buffer);for(var a=0;a<i.width*i.height*4;a++)i.data[a]=n[a]}else{i.data=new Float32Array(i.width*i.height*4);var u=1/255;for(a=0;a<i.width*i.height*4;a++)i.data[a]=n[a]*u}r&&r(i),Ut.loadingCount--},o.onerror=function(){Ut.loadingCount--},i}},{key:"loadExr",value:function(e,n,r){var o=new t;o.name=e,o.format=n;var i=function(e){var n={};we.fromArrayBuffer(n,e),o.width=n.width,o.height=n.height,o.data=new Float32Array(o.width*o.height*4),o.type="float";for(var i=n.attributes.channels,a=o.data,u={R:-1,G:-1,B:-1,A:-1},s=0;s<i.length;s++)u[i[s].name]=s;var c=u.R,f=u.G,l=u.B,h=o.width*o.height*4;for(s=0;s<h;s+=4)a[s]=i[c].data[s>>2],a[s+1]=i[f].data[s>>2],a[s+2]=i[l].data[s>>2];if((p=u.A)>=0)for(s=0;s<h;s+=4)a[s+3]=i[p].data[s>>2];else for(s=0;s<h;s+=4)a[s+3]=1;if(1===o.format){var p=new X,v=(l=new q,new Uint8Array(h));for(s=0;s<h;s+=4)X.setValue(p,a[s],a[s+1],a[s+2]),t.packR11G11B10(l,p),v[s]=l[0],v[s+1]=l[1],v[s+2]=l[2],v[s+3]=l[3];o.data=v}r&&r(o)};return"string"==typeof e?Ut.loadBinary(e,function(t){i(t)}):e.byteLength?i(e):Ut.loadBinary(e,function(t){i(t)}),o}}]),t}();function Pe(t){return t-Math.floor(t)}je(Ee,"FORMAT_FLOAT32",0),je(Ee,"FORMAT_UINT8",1);var Te=new Ee(1024,1024),ke=void 0;function Me(t){return Me="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Me(t)}function Re(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,Ne(r.key),r)}}function Ie(){return Ie="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(t,e,n){var r=function(t,e){for(;!{}.hasOwnProperty.call(t,e)&&null!==(t=Fe(t)););return t}(t,e);if(r){var o=Object.getOwnPropertyDescriptor(r,e);return o.get?o.get.call(arguments.length<3?t:n):o.value}},Ie.apply(null,arguments)}function Ae(t,e){return Ae=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},Ae(t,e)}function Ce(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(t){}return(Ce=function(){return!!t})()}function Fe(t){return Fe=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},Fe(t)}function Ne(t){var e=function(t){if("object"!=Me(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var n=e.call(t,"string");if("object"!=Me(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==Me(e)?e:e+""}var Be=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&Ae(t,e)}(n,t);var e=function(t){var e=Ce();return function(){var n,r=Fe(t);if(e){var o=Fe(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return function(t,e){if(e&&("object"==Me(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(this,n)}}(n);function n(t,r,o){var i;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,n),(i=e.call(this,t,r,1)).format=o,i.path="",i.gl_texture=n.createTexture(null,t,r,o),ke.bindTexture(ke.TEXTURE_2D,i.gl_texture),ke.texParameteri(ke.TEXTURE_2D,ke.TEXTURE_MAG_FILTER,ke.NEAREST),ke.texParameteri(ke.TEXTURE_2D,ke.TEXTURE_MIN_FILTER,ke.NEAREST),ke.texParameteri(ke.TEXTURE_2D,ke.TEXTURE_WRAP_S,ke.REPEAT),ke.texParameteri(ke.TEXTURE_2D,ke.TEXTURE_WRAP_T,ke.REPEAT),i}return function(t,e,n){e&&Re(t.prototype,e),n&&Re(t,n),Object.defineProperty(t,"prototype",{writable:!1})}(n,[{key:"bind",value:function(){ke.bindTexture(ke.TEXTURE_2D,this.gl_texture)}},{key:"copy",value:function(t,e,n,r){ke.bindTexture(ke.TEXTURE_2D,this.gl_texture),ke.copyTexImage2D(ke.TEXTURE_2D,0,ke.RGBA,t,e,n,r,0)}},{key:"copySub",value:function(t,e,n,r,o,i){ke.bindTexture(ke.TEXTURE_2D,this.gl_texture),ke.copyTexSubImage2D(ke.TEXTURE_2D,0,t,e,n,r,o,i)}},{key:"clamp",value:function(t){ke.bindTexture(ke.TEXTURE_2D,this.gl_texture),t?(ke.texParameteri(ke.TEXTURE_2D,ke.TEXTURE_WRAP_S,ke.CLAMP_TO_EDGE),ke.texParameteri(ke.TEXTURE_2D,ke.TEXTURE_WRAP_T,ke.CLAMP_TO_EDGE)):(ke.texParameteri(ke.TEXTURE_2D,ke.TEXTURE_WRAP_S,ke.REPEAT),ke.texParameteri(ke.TEXTURE_2D,ke.TEXTURE_WRAP_T,ke.REPEAT))}},{key:"filter",value:function(t){ke.bindTexture(ke.TEXTURE_2D,this.gl_texture),t?(ke.texParameteri(ke.TEXTURE_2D,ke.TEXTURE_MAG_FILTER,ke.LINEAR),ke.texParameteri(ke.TEXTURE_2D,ke.TEXTURE_MIN_FILTER,ke.LINEAR)):(ke.texParameteri(ke.TEXTURE_2D,ke.TEXTURE_MAG_FILTER,ke.NEAREST),ke.texParameteri(ke.TEXTURE_2D,ke.TEXTURE_MIN_FILTER,ke.NEAREST))}},{key:"toLinear",value:function(){ke.bindFramebuffer(ke.FRAMEBUFFER,Ye.framebuffer),ke.disable(ke.BLEND),ke.disable(ke.DEPTH_TEST),ke.viewport(0,0,this.width,this.height),xn.postEffect(this,0,0,1,1,Uh.basecolorShader),ke.bindTexture(ke.TEXTURE_2D,this.gl_texture),xn.copyImage(this,0,0,0,0,this.width,this.height),ke.bindTexture(ke.TEXTURE_2D,null),ke.bindFramebuffer(ke.FRAMEBUFFER,null)}},{key:"createTexture",value:function(t,e,r,o){this.gl_texture=n.createTexture(t,width,height,o)}}],[{key:"createDepth",value:function(t,e){var r=new n(t,e);return r.width=t,r.height=e,r.gl_texture=ke.createTexture(),ke.bindTexture(ke.TEXTURE_2D,r.gl_texture),ke.texImage2D(ke.TEXTURE_2D,0,ke.DEPTH_COMPONENT16,t,e,0,ke.DEPTH_COMPONENT,ke.UNSIGNED_SHORT,null),ke.texParameteri(ke.TEXTURE_2D,ke.TEXTURE_WRAP_S,ke.CLAMP_TO_EDGE),ke.texParameteri(ke.TEXTURE_2D,ke.TEXTURE_WRAP_T,ke.CLAMP_TO_EDGE),ke.texParameteri(ke.TEXTURE_2D,ke.TEXTURE_MAG_FILTER,ke.NEAREST),ke.texParameteri(ke.TEXTURE_2D,ke.TEXTURE_MIN_FILTER,ke.NEAREST),r}},{key:"loadImg",value:function(t,e){var r=this;return new Promise(function(o){var i=function(t){return function(e){e.gl_texture=n.createTexture(e),t&&t(e),o(e)}}(e);Ie(Fe(n),"loadImg",r).call(r,t,1,i)})}},{key:"createTexture",value:function(t,e,n,r){var o=ke.createTexture();if(ke.bindTexture(ke.TEXTURE_2D,o),t)ke.texImage2D(ke.TEXTURE_2D,0,ke.RGBA,t.width,t.height,0,ke.RGBA,ke.UNSIGNED_BYTE,t.data);else switch(r){case this.FORMAT.UINT8:ke.texImage2D(ke.TEXTURE_2D,0,ke.RGBA,e,n,0,ke.RGBA,ke.UNSIGNED_BYTE,null);break;case this.FORMAT.FLOAT16:ke.texImage2D(ke.TEXTURE_2D,0,ke.R16F,e,n,0,ke.RED,ke.FLOAT,null);break;case this.FORMAT.RGB10A2:ke.texStorage2D(ke.TEXTURE_2D,1,ke.RGB10_A2,e,n);break;case this.FORMAT.UINT32:ke.texImage2D(ke.TEXTURE_2D,0,ke.RGBA32UI,e,n,0,ke.RGBA_INTEGER,ke.UNSIGNED_INT,null);break;default:ke.texImage2D(ke.TEXTURE_2D,0,ke.RGBA,e,n,0,ke.RGBA,ke.UNSIGNED_BYTE,null)}return ke.texParameteri(ke.TEXTURE_2D,ke.TEXTURE_WRAP_S,ke.CLAMP_TO_EDGE),ke.texParameteri(ke.TEXTURE_2D,ke.TEXTURE_WRAP_T,ke.CLAMP_TO_EDGE),ke.texParameteri(ke.TEXTURE_2D,ke.TEXTURE_MAG_FILTER,ke.NEAREST),ke.texParameteri(ke.TEXTURE_2D,ke.TEXTURE_MIN_FILTER,ke.NEAREST),ke.bindTexture(ke.TEXTURE_2D,null),o}}]),n}(Ee);function Ue(t){return Ue="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Ue(t)}function Le(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,Ve(r.key),r)}}function Ve(t){var e=function(t){if("object"!=Ue(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var n=e.call(t,"string");if("object"!=Ue(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==Ue(e)?e:e+""}!function(t,e,n){(e=Ne(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n}(Be,"FORMAT",{UINT8:0,RGB10A2:1,UINT32:2,FLOAT16:3});var De,Ge=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t);var e=Ye.gl;this.gl_framebuffer=e.createFramebuffer(),this.bindTextures=[]}return function(t,e){e&&Le(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1})}(t,[{key:"texture",value:function(t,e){e||(e=t,t=0),ke.bindFramebuffer(ke.FRAMEBUFFER,this.gl_framebuffer),ke.framebufferTexture2D(ke.FRAMEBUFFER,ke.COLOR_ATTACHMENT0+t,ke.TEXTURE_2D,e.gl_texture,0),this.bindTextures[t]=e}},{key:"bind",value:function(){ke.bindFramebuffer(ke.FRAMEBUFFER,this.gl_framebuffer)}},{key:"clear",value:function(){ke.bindFramebuffer(ke.FRAMEBUFFER,this.gl_framebuffer),ke.clear(ke.COLOR_BUFFER_BIT|ke.DEPTH_BUFFER_BIT)}},{key:"clearColor",value:function(t,e,n,r,o){switch(ke.bindFramebuffer(ke.FRAMEBUFFER,this.gl_framebuffer),this.bindTextures[t].format){case Be.FORMAT.UINT8:ke.clearBufferfv(ke.COLOR,t,[e,n,r,o]);break;case Be.FORMAT.FLOAT16:ke.clearBufferfv(ke.COLOR,t,new Float32Array([e,n,r,o]));break;case Be.FORMAT.RGB10A2:case Be.FORMAT.UINT32:ke.clearBufferuiv(ke.COLOR,t,new Uint32Array([e,n,r,o]));break;default:ke.clearBufferuiv(ke.COLOR,t,new Uint8Array([e,n,r,o]))}}},{key:"depthTexture",value:function(t){ke.bindFramebuffer(ke.FRAMEBUFFER,this.gl_framebuffer),ke.framebufferTexture2D(ke.FRAMEBUFFER,ke.DEPTH_ATTACHMENT,ke.TEXTURE_2D,t.gl_texture,0)}},{key:"drawBuffers",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if(ke.getParameter(ke.FRAMEBUFFER_BINDING)){for(var n=[],r=0;r<e;r++)n.push(ke.NONE);for(r=0;r<t;r++)n.push(ke.COLOR_ATTACHMENT0+(r+e));ke.drawBuffers(n)}}}]),t}();function ze(t){return ze="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},ze(t)}function Xe(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,qe(r.key),r)}}function He(t,e,n){return(e=qe(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function qe(t){var e=function(t){if("object"!=ze(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var n=e.call(t,"string");if("object"!=ze(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==ze(e)?e:e+""}var Ye=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t)}return function(t,e,n){n&&Xe(t,n),Object.defineProperty(t,"prototype",{writable:!1})}(t,0,[{key:"init",value:function(t){ke=t,this.gl=t,ke.clearColor(0,0,0,0),ke.clearDepth(1),ke.enable(ke.DEPTH_TEST),ke.depthFunc(ke.LEQUAL),ke.clear(ke.COLOR_BUFFER_BIT|ke.DEPTH_BUFFER_BIT),ke.enable(ke.CULL_FACE);var e=new Ge;ke.bindFramebuffer(ke.FRAMEBUFFER,e.gl_framebuffer);var n=Be.createDepth(1024,1024);n.filter(!1),e.depthTexture(n);var r=new Be(1024,1024,0);r.clamp(!1),r.filter(!1),e.texture(r),this.framebuffer=e.gl_framebuffer,this.framebuffer_=e,this.fTexture=r,ke.bindTexture(ke.TEXTURE_2D,null),ke.bindFramebuffer(ke.FRAMEBUFFER,null),ke.bindRenderbuffer(ke.RENDERBUFFER,null),ke.clearColor(1,1,1,1);var o=new Ge;o.gl_framebuffer=null,o.clear();var i=new Be(1,1);this.dummyTexture=i.gl_texture,i.copy(0,0,1,1),ke.clearColor(0,0,0,0),this.glIdxBuffer=ke.createBuffer(),ke.bindBuffer(ke.ELEMENT_ARRAY_BUFFER,this.glIdxBuffer),ke.bufferData(ke.ELEMENT_ARRAY_BUFFER,new Uint16Array(this.VERTEX_MAX),ke.DYNAMIC_DRAW),this.glbuffer=ke.createBuffer(),ke.bindBuffer(ke.ARRAY_BUFFER,this.glbuffer),ke.bufferData(ke.ARRAY_BUFFER,new Float32Array(20*this.VERTEX_MAX),ke.DYNAMIC_DRAW);var a=ke.createBuffer();this.fullposbuffer=a,ke.bindBuffer(ke.ARRAY_BUFFER,this.fullposbuffer);var u=new Float32Array(8);return u[0]=-1,u[1]=-1,u[2]=1,u[3]=-1,u[4]=1,u[5]=1,u[6]=-1,u[7]=1,ke.bufferData(ke.ARRAY_BUFFER,u,ke.STATIC_DRAW),!1}}]),t}();De=Ye,He(Ye,"dummyTexture",void 0),He(Ye,"fullposbuffer",void 0),He(Ye,"FACE_MAX",2e4),He(Ye,"VERTEX_MAX",3*De.FACE_MAX);var We=function(){for(var t=function(){},e=new Array(16),n=new Array(16),r=0;r<e.length;r++)e[r]=new Array(1024);return t.backetSort=function(t,r,o,i,a){for(var u=0;u<e.length;u++)n[u]=0;for(o||(o=function(t){return t}),u=i;u<=a;u++){var s=o(t[u])>>r&15;e[s][n[s]]=t[u],n[s]++}var c=i;for(u=0;u<e.length;u++)for(var f=0;f<n[u];f++)t[c]=e[u][f],c++},t.kisu=function(t,e,n,r){for(var o=0;o<32;o+=4)this.backetSort(t,o,e,n,r)},t.qSort=function(t,e,n,r){if(!(n<=e)){for(var o,i=e,a=n,u=t[n+1+e>>1];;){for(;r(t[i],u)<0;)i++;for(;r(t[a],u)>0;)a--;if(i>=a)break;if(o=t[i],t[i]=t[a],t[a]=o,a--,++i>n||a<e)break}this.qSort(t,e,i-1,r),this.qSort(t,a+1,n,r)}},t}(),Qe=We;function $e(t){return $e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},$e(t)}function Je(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,Ke(r.key),r)}}function Ke(t){var e=function(t){if("object"!=$e(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var n=e.call(t,"string");if("object"!=$e(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==$e(e)?e:e+""}var Ze=function(t){this.message=t,this.name="UserException"},tn={},en=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.path="",this.name="",this.source="",this.option=[],this.included_files=[]}return function(t,e,n){e&&Je(t.prototype,e),n&&Je(t,n),Object.defineProperty(t,"prototype",{writable:!1})}(t,[{key:"setUniform",value:function(t,e){var n=this.unis[t];if(n){var r=n.location;switch(n.type){case"int":ke.uniform1i(r,e);break;case"float":ke.uniform1f(r,e);break;case"float[]":ke.uniform1fv(r,e);break;case"vec2":ke.uniform2fv(r,e);break;case"vec3":ke.uniform3fv(r,e);break;case"mat3":ke.uniformMatrix3fv(r,!1,e);break;case"mat4":ke.uniformMatrix4fv(r,!1,e);break;case"sampler2D":case"usampler2D":case"isampler2D":ke.activeTexture(ke.TEXTURE0+n.tex_count),ke.uniform1i(n.location,n.tex_count),e?ke.bindTexture(ke.TEXTURE_2D,e.gl_texture):ke.bindTexture(ke.TEXTURE_2D,Ye.dummyTexture)}}}},{key:"load",value:function(){var t=this;Ut.loadText(this.path,function(e){t.source=e,t.include(e)})}},{key:"include",value:function(){for(var t,e=this,n=(this.source,/\#include\((.+)\)/g),r=[];null!==(t=n.exec(this.source));){var o=t[1];this.included_files.includes(o)?this.source=this.source.replace(t[0],""):r.push(o)}if(0===r.length)try{return this.createShader2()}catch(t){return alert(this.path+"\n"+t.message),null}this.includes_count=r.length;for(var i=0;i<r.length;i++){var a=function(t){return function(n){e.includes_count--,e.source=e.source.replace("#include("+t+")",n),e.included_files.push(t),0===e.includes_count&&e.include()}}(r[i]),u=Ut.getDir(this.path);Ut.loadText(u+r[i],a)}}},{key:"createShader2",value:function(){for(var e=this.options,n=this.source,r=0;r<e.length;r++){var o=e[r],i=new RegExp("/\\*\\["+o+"\\]","g");n=n.replace(i,""),i=new RegExp("\\["+o+"\\]\\*/","g"),n=n.replace(i,""),Math.pow(2,r)}i=/\/\*\[(.+)\]/g;for(var a,u=[];a=i.exec(n);){var s=a[1];u.push(s)}for(r=0;r<u.length;r++)s=u[r],i=new RegExp("/\\*\\["+s+"\\][\\s\\S]*?\\["+s+"\\]\\*/","g"),n=n.replace(i,"");var c=(n=" \n \t\t\t#pragma optionNV(inline all) \n \t\t\t#pragma optionNV(unroll all)  \n"+n).match(/\[vertexshader\]([\s\S]*)\[fragmentshader\]([\s\S]*)/),f=c[1],l=c[2],h=!1;"#"===l.charAt(0)?(l=(l="#version 300 es\nprecision mediump float;  \n \n"+l.replace("#version 300 es","")).replaceAll("texture2D(","texture("),h=!0):l="precision mediump float;  \n "+l;var p,v=n.match(/uniform .+?;/g),y=Ye.gl,m=t.compileShader(f,l);for(this.program=m,p=h?f.match(/in .+?;/g):(f+l).match(/attribute .+?;/g),this.atts={},tn.vec2={size:2,type:y.FLOAT},tn.vec3={size:3,type:y.FLOAT},tn.vec4={size:4,type:y.FLOAT},tn.float={size:1,type:y.FLOAT},r=0;r<p.length;r++){var b=(x=p[r].match(/(\S+)\s+(\S+)\s*;/))[2],d=tn[x[1]],g={location:y.getAttribLocation(m,b),type:d};this.atts[b]=g,g.location>=0&&(y.enableVertexAttribArray(g.location),y.vertexAttribPointer(g.location,1,y.FLOAT,!1,0,0))}if(this.outnum=1,h){var w=l.match(/layout .+?;/g);w&&(this.outnum=w.length)}this.unis={};var _=0;for(r=0;r<v.length;r++){b=(x=v[r].match(/(\S+)\s+([^\[\s]+)\S*\s*;/))[2];var x,j={};j.location=y.getUniformLocation(this.program,b),j.type=x[1],(x=v[r].match(/\[\d+\]/))&&(j.type+="[]"),this.unis[b]=j,/.*sampler.*/.test(j.type)&&(j.tex_count=_,_++)}}}],[{key:"load",value:function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],r=new t;return r.path=e,r.options=n,r.load(),r}},{key:"create",value:function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",o=new t;return o.path=r,o.options=n,o.source=e,o.include(),o}},{key:"compileShader",value:function(t,e){var n=Ye.gl,r=n.createShader(n.VERTEX_SHADER);if(n.shaderSource(r,t),n.compileShader(r),!n.getShaderParameter(r,n.COMPILE_STATUS))throw new Ze(n.getShaderInfoLog(r));var o=n.createShader(n.FRAGMENT_SHADER);if(n.shaderSource(o,e),n.compileShader(o),!n.getShaderParameter(o,n.COMPILE_STATUS))throw new Ze(n.getShaderInfoLog(o));var i=n.createProgram();if(n.attachShader(i,r),n.attachShader(i,o),n.linkProgram(i),!n.getProgramParameter(i,n.LINK_STATUS))throw new Ze(n.getProgramInfoLog(i));return n.useProgram(i),i}}]),t}();function nn(t){return nn="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},nn(t)}function rn(t,e,n){return(e=un(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function on(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,un(r.key),r)}}function an(t,e,n){return e&&on(t.prototype,e),n&&on(t,n),Object.defineProperty(t,"prototype",{writable:!1}),t}function un(t){var e=function(t){if("object"!=nn(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var n=e.call(t,"string");if("object"!=nn(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==nn(e)?e:e+""}function sn(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var cn,fn,ln,hn={},pn=(new Float32Array(9),new Float32Array(2),Math.PI,"./lib/"),vn=ln=1,yn=++ln,mn=1024,bn=an(function t(){sn(this,t),this.matrix=new J,this.viewmatrix=new J,this.viewmatrix2=new J,this.color=new X,this.type,this.power=1}),dn=function(){this.name="",this.envTexture="",this.sun=new bn,this.area=new bn},gn=function(){this.name="",this.baseColor=new X,this.baseColorMap=null,this.opacity=1,this.metallic=0,this.metalColor=new X,this.roughness=1,this.ior=0,this.subRoughness=0,this.emt=0,this.pbrMap=null,this.heightMap=null,this.heightMapPower=0,this.lightMap=null,this.offsetx=0,this.offsety=0,this.uv="",this.bold=1,this.shader=""},wn=function(){this.vertices=new Uint16Array(3),this.environments=new Array(2),this.environmentRatio=0},_n=function(){this.bold=1,this.pos=[],this.pos[0]=new X,this.pos[1]=new X,this.material=0},xn=function(){function t(){for(sn(this,t),rn(this,"drawLine",function(e,n){if(0!==n){var r,o=this,i=o.lines,a=this.shaders.plain,u=q.alloc();r=i[e].material,t.encode(u,r.baseColor),cn.uniform4f(a.unis.uColor.location,u[0],u[1],u[2],u[3]),globalParam.windows||cn.lineWidth(r.bold),cn.lineWidth(2),o.stereoDraw(function(){cn.uniformMatrix4fv(a.unis.projectionMatrix.location,!1,o.pvMatrix),cn.drawArrays(cn.LINES,2*e,2*n)}),q.free(1)}}),this.rf=0,this.smoothing=0,this.viewMatrix=new J,this.worldMatrix=new z,this.projectionMatrix=new J,this.pvMatrix=new J,this.vertices_index=0,this.faces_index=0,this.lines_index=0,this.vertices_static_index=0,this.faces_static_index=0,this.materials_static_index=0,this.viewport=new Float32Array(4),this.viewport[0]=0,this.viewport[1]=0,this.viewport[2]=100,this.viewport[3]=100,this.znear=.1,this.zfar=80,this.aov=1,this.renderTarget,this.canvasTarget,this.bold=1,this.lineColor=new q,this.env2Texture=null,this.shadowTexture=null,this.envbufTexture=null,this.materials=[],e=0;e<256;e++)this.materials.push(new gn);for(this.environments=[],e=0;e<8;e++)this.environments.push(new dn);for(this.lights=[],this.lines=new Array(40960),this.faces=new Array(40960),e=this.faces.length;e--;)this.faces[e]=new wn,this.lines[e]=new _n;this.stackTransMatrix=new Array,this.stackIndex=0;for(var e=32;e--;)this.stackTransMatrix.push(new J);this.faces_index=this.faces_static_index,this.lines_index=0,this.vertices_index=this.vertices_static_index,this.materials_index=this.materials_static_index}return an(t,[{key:"setStatic",value:function(){this.faces_static_index=0,this.vertices_static_index=this.vertices_index,this.materials_static_index=this.materials_index}},{key:"clear",value:function(){this.faces_index=this.faces_static_index,this.lines_index=0,this.vertices_index=this.vertices_static_index,this.materials_index=this.materials_static_index}},{key:"render",value:function(t,e){}},{key:"drawCelestialSphere",value:function(e,n,r){var o=this.shaders.celestialsphere;r&&(o=this.shaders.celestialsphere_f);var i=J.alloc();J.getInv(i,n),cn.useProgram(o.program),cn.uniformMatrix4fv(o.unis.projectionMatrix.location,!1,i),t.postEffect(e,0,0,1,1,o),J.free(1)}},{key:"setFace",value:function(t,e,n,r){var o=this.verticesFloat32Array,i=this.vertices_index,a=(this.faces,this.faces_index,new X);X.cross2(a,t,e,n),X.normalize(a,a);var u=this.faces[this.faces_index];u.material=r,u.vertices[0]=i,u.vertices[1]=i+1,u.vertices[2]=i+2;var s=this.environments[0];u.environments[0]=s,u.environments[1]=s,u.environmentRatio=0,o[20*i]=t[0],o[20*i+1]=t[1],o[20*i+2]=t[2],o[20*i+3]=a[0],o[20*i+4]=a[1],o[20*i+5]=a[2],o[20*i+14]=0,o[20*i+17]=0,o[20*i+18]=0,o[20*i+19]=0,o[20*++i]=e[0],o[20*i+1]=e[1],o[20*i+2]=e[2],o[20*i+3]=a[0],o[20*i+4]=a[1],o[20*i+5]=a[2],o[20*i+14]=0,o[20*i+17]=0,o[20*i+18]=0,o[20*i+19]=0,o[20*++i]=n[0],o[20*i+1]=n[1],o[20*i+2]=n[2],o[20*i+3]=a[0],o[20*i+4]=a[1],o[20*i+5]=a[2],o[20*i+14]=0,o[20*i+17]=0,o[20*i+18]=0,o[20*i+19]=0,this.vertices_index+=3,this.faces_index+=1}},{key:"setLine",value:function(t,e,n){var r=this.lines[this.lines_index];r.material=n,this.lines_index++,X.copy(r.pos[0],t),X.copy(r.pos[1],e)}},{key:"loadShader",value:function(t,e){e||(e=t),this.shaders[e]=en.load(t)}},{key:"init",value:function(e,n){cn=Ye.gl,this.gl=cn,this.clear(),this.texture32=new Be(1024,1024,1),hn.vec2={size:2,type:cn.FLOAT},hn.vec3={size:3,type:cn.FLOAT},hn.vec4={size:4,type:cn.FLOAT},hn.float={size:1,type:cn.FLOAT},this.env2Texture=new Be(mn,mn),this.shadowTexture=new Be(mn,mn),this.shadowTexture.clamp(!0),cn.bindTexture(cn.TEXTURE_2D,this.shadowTexture.gl_texture),this.envbufTexture=new Be(1024,512),this.indexBuffer=new Uint16Array(Ye.VERTEX_MAX),this.verticesFloat32Array=new Float32Array(20*Ye.VERTEX_MAX),this.shaders=[],fn=this.shaders;for(var r=["shadow_dec","shadow","plain","half","multiadd","fill","add","average","average2","average3","decode","rough","celestialsphere","celestialsphere_f","envset","gauss","normal","cube2polar","hud","u32tof111110","directional","copy","copy2","hextiling","basecolor"],o=0;o<r.length;o++){var i=r[o];this.loadShader(pn+"shader/"+i+".shader",i)}t.plainShader=en.create(" \t\t\t[vertexshader] \t\t\tattribute vec2 aPos; \t\t\tuniform vec2 uPosScale; \t\t\tuniform vec2 uPosOffset; \t\t\t\tuniform vec2 uUvScale; \t\t\tuniform vec2 uUvOffset; \t\t\tvarying vec2 vUv; \t\t\tvoid main(void){ \t\t\t\tgl_Position = vec4(aPos * uPosScale + uPosOffset,1.0,1.0); \t\t\t\tvUv = (aPos+ 1.0) * 0.5 * uUvScale +  uUvOffset; \t\t\t} \t\t\t[fragmentshader] \t\t\tvarying lowp vec2 vUv; \t\t\tuniform sampler2D uSampler; \t\t\tvoid main(void){ \t\t\t\tgl_FragColor= texture2D(uSampler,vUv); \t\t\t} ")}},{key:"setViewport",value:function(t,e,n,r){this.viewport[0]=t,this.viewport[1]=e,this.viewport[2]=n,this.viewport[3]=r,cn.viewport(t,e,n,r)}}],[{key:"setDrawBuffers",value:function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;if(t.getParameter(t.FRAMEBUFFER_BINDING)){for(var r=[],o=0;o<n;o++)r.push(t.NONE);for(o=0;o<e;o++)r.push(t.COLOR_ATTACHMENT0+(o+n));t.drawBuffers(r)}}}]),t}();function jn(t){return jn="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},jn(t)}function On(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,Sn(r.key),r)}}function Sn(t){var e=function(t){if("object"!=jn(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var n=e.call(t,"string");if("object"!=jn(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==jn(e)?e:e+""}rn(xn,"setUniform",function(t,e,n,r){!function(t,e,n,r){if(e){var o=e.location;switch(e.type){case"int":t.uniform1i(o,n);break;case"float":t.uniform1f(o,n);break;case"float[]":t.uniform1fv(o,n);break;case"vec2":t.uniform2fv(o,n);break;case"vec3":t.uniform3fv(o,n);break;case"mat3":t.uniformMatrix3fv(o,!1,n);break;case"mat4":t.uniformMatrix4fv(o,!1,n);break;case"sampler2D":case"usampler2D":case"isampler2D":t.activeTexture(t.TEXTURE0+r),t.uniform1i(e.location,r),n?t.bindTexture(t.TEXTURE_2D,n.gl_texture):t.bindTexture(t.TEXTURE_2D,Ye.dummyTexture)}}}(t,e,n,r)}),xn.Material=gn,xn.Face=wn,xn.RF_OUTLINE=vn,xn.RF_DOUBLE_SIDED=yn,xn.orthoMatrix=function(t,e,n,r,o){J.setValue(t,-1/e,0,0,0,0,1/n,0,0,0,0,2/(o-r),0,0,0,-(o+r)/(o-r),1)},xn.calcMainShaderName=function(t){for(var e=["lightMap","heightMapPower","pbrMap"],n=0,r=0;r<e.length;r++)"opacity"===e[r]?1!==t[e[r]]&&(n|=1<<r):t[e[r]]&&(n|=1<<r);t.metallic&&(n|=4);var o=[];t.lightMap?o.push("lightmap"):o.push("lightprobe"),t.heightMapPower&&o.push("height"),t.pbrMap&&o.push("pbr"),xn.main_shader_org;var i="main_"+n;if(!fn[i]){var a=pn+this.mainshader_path,u=fn.main.source;fn[i]=en.create(u,o,a)}return"main_"+n},xn.calcST=function(t,e,n,r,o,i,a,u,s,c,f){var l=u-i,h=s-a,p=c-i,v=f-a,y=r[0]-n[0],m=r[1]-n[1],b=r[2]-n[2],d=o[0]-n[0],g=o[1]-n[1],w=o[2]-n[2],_=l*v-p*h;return 0===_||(_=1/_,t[0]=(h*d-v*y)*_,t[1]=(h*g-v*m)*_,t[2]=(h*w-v*b)*_,e[0]=-(l*d-p*y)*_,e[1]=-(l*g-p*m)*_,e[2]=-(l*w-p*b)*_),X.mul(t,t,1/X.scalar2(t)),X.mul(e,e,1/X.scalar2(e)),!1},xn.loadShader=function(t,e){var n={};return Ut.loadText(t,function(e){try{var r=xn.createShader(e);r.name=t;for(var o=Object.keys(r),i=0;i<o.length;i++)n[o[i]]=r[o[i]]}catch(e){alert(t+"\n"+e.message)}}),n},xn.copyImage=function(t,e,n,r,o,i,a){cn.bindTexture(cn.TEXTURE_2D,t.gl_texture),cn.copyTexSubImage2D(cn.TEXTURE_2D,0,e,n,r,o,i,a)},xn.postEffect=function(t,e,n,r,o,i){if(cn.disable(cn.DEPTH_TEST),cn.depthMask(!1),i.program){cn.useProgram(i.program),xn.setDrawBuffers(cn,i.outnum);var a=i.unis,u=i.atts;a.uUvScale&&cn.uniform2f(a.uUvScale.location,r,o),a.uUvOffset&&cn.uniform2f(a.uUvOffset.location,e,n),a.uUnit&&cn.uniform2f(a.uUnit.location,1/t.width,1/t.height),t&&(cn.activeTexture(cn.TEXTURE0),cn.bindTexture(cn.TEXTURE_2D,t.gl_texture),a.uSampler&&i.setUniform("uSampler",t)),cn.bindBuffer(cn.ARRAY_BUFFER,Ye.fullposbuffer),cn.vertexAttribPointer(u.aPos.location,2,cn.FLOAT,!1,0,0),cn.bindBuffer(cn.ARRAY_BUFFER,Ye.fullposbuffer),cn.drawArrays(cn.TRIANGLE_FAN,0,4)}},xn.packFloat=function(t,e){var n=Math.max(e[0],Math.max(e[1],e[2])),r=Math.ceil(Math.log(n+.01)/Math.log(2));n=1/Math.pow(2,r),t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t[3]=(r+128)/255},xn.unpackFloat=function(t,e){t[0]=e[0]*(1-((e[3]>>7&1)<<1)),t[1]=e[1]*(1-((e[3]>>6&1)<<1)),t[2]=e[2]*(1-((e[3]>>5&1)<<1));var n=Math.floor((31&e[3])-15),r=Math.pow(2,n)/255;t[0]=t[0]*r,t[1]=t[1]*r,t[2]=t[2]*r},xn.encode=function(t,e){var n=Math.max(e[0],Math.max(e[1],e[2])),r=Math.ceil(Math.log(n+.01)/Math.log(2));n=1/Math.pow(2,r),t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t[3]=(r+128)/255},xn.decode2=function(t,e){var n=Math.floor(256*e[2]-128),r=Math.floor(256*e[3]-128);Math.pow(2,n),t[0]=e[0]*Math.pow(2,n),t[1]=e[1]*Math.pow(2,r)},xn.drawCopy=function(t,e,n,r,o,i,a,u,s){null==u&&(s=o,o=t,i=t=e,a=a=n,u=n=r,r=s);var c=fn.copy,f=c.unis;cn.useProgram(c.program),cn.uniform2f(f.uPosScale.location,n,r),cn.uniform2f(f.uPosOffset.location,t,e),xn.postEffect(o,i,a,u,s,c)},xn.gauss=function(t,e,n,r,o,i,a,u){for(var s=new Array(5),c=0,f=0;f<s.length;f++){var l=1+2*f,h=Math.exp(l*l*-.5/n);s[f]=h,f>0&&(h*=2),c+=h}for(f=0;f<s.length;f++)s[f]/=c;var p=fn.gauss,v=p.unis;cn.useProgram(p.program),cn.uniform1fv(v.weight.location,s),cn.bindBuffer(cn.ARRAY_BUFFER,Ye.fullposbuffer),cn.uniform2f(v.uAxis.location,1/t*a,0),xn.postEffect(r,o,i,a,u,p),xn.copyImage(r,0,r.height-e,0,0,t,e),cn.uniform2f(v.uAxis.location,0,1/r.height),xn.postEffect(r,0,(r.height-e)/r.height,t/r.width,e/r.height,p)},xn.initNormal=function(t){var e=fn.normal;cn.bindTexture(cn.TEXTURE_2D,t.gl_texture),cn.texParameteri(cn.TEXTURE_2D,cn.TEXTURE_MAG_FILTER,cn.LINEAR),cn.texParameteri(cn.TEXTURE_2D,cn.TEXTURE_MIN_FILTER,cn.LINEAR),cn.disable(cn.BLEND),cn.disable(cn.DEPTH_TEST),cn.useProgram(e.program),xn.postEffect(t,0,0,1,1,e),xn.copyImage(t,0,0,0,0,t.width,t.height)},xn.LightSource=bn,xn.perspectiveMatrix=function(t,e,n,r,o,i,a){null==i&&(a=o,o=-(r=n*(i=r)),e=-(n=e*i)),J.setValue(t,2*i/(n-e),0,0,0,0,2*i/(r-o),0,0,(n+e)/(n-e),(r+o)/(r-o),-(i+a)/(a-i),-1,0,0,-2*i*a/(a-i),0)},xn.mainshader_path="shader/main.shader";var En=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t)}return function(t,e){e&&On(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1})}(t,[{key:"init",value:function(){this.tex128=new Be(128,128,0),this.shShader=[];for(var t=0;t<9;t++)this.shShader.push(en.load("./engine/spherical_harmonics/sh"+t+".shader"));this.sigmaShader=en.load("./engine/spherical_harmonics/sigma.shader")}},{key:"calcSHcoef",value:function(t,e,n){var r=window.engine;this.createSHcoeff(t,e,n,function(t,e,n,o){r.drawSub(t,e,n,o)});var o=new Uint8Array(36);ke.readPixels(0,0,9,1,ke.RGBA,ke.UNSIGNED_BYTE,o);for(var i=1/(1024*Math.PI),a=[],u=new q,s=0;s<9;s++){u[0]=o[4*s+0],u[1]=o[4*s+1],u[2]=o[4*s+2],u[3]=o[4*s+3];var c=[0,0,0];xn.unpackFloat(c,u),c[0]=c[0]*i,c[1]=c[1]*i,c[2]=c[2]*i,a.push(c)}return nt.mulA(a),a}},{key:"createSHcoeff",value:function(t,e,n,r){var o=window.engine,i=o.ono3d,a=this.tex128,u=i.envbufTexture;o.graphics.createCubeMap(u,t,e,n,256,r),ke.bindFramebuffer(ke.FRAMEBUFFER,Ye.framebuffer);for(var s=0;s<9;s++){ke.bindFramebuffer(ke.FRAMEBUFFER,Ye.framebuffer),ke.clearColor(0,0,0,0),ke.clear(ke.COLOR_BUFFER_BIT),ke.viewport(0,0,128,64),a.copySub(0,0,0,0,128,64),xn.postEffect(u,0,0,1024/u.width,512/u.height,this.shShader[s]),a.copySub(0,0,0,0,128,32),a.copySub(0,32,0,32,64,32);for(var c=a.width;1<c;)1==(c>>=1)?(ke.bindFramebuffer(ke.FRAMEBUFFER,null),i.setViewport(s,0,1,1)):i.setViewport(0,0,c,c),xn.postEffect(a,0,0,2*c/a.width,2*c/a.width,this.sigmaShader),xn.copyImage(a,0,0,0,0,c,c)}return ke.bindFramebuffer(ke.FRAMEBUFFER,null),i.setViewport(0,0,1,9),xn.copyImage(a,0,0,0,0,9,1),a}}]),t}(),Pn=new En;function Tn(t){return Tn="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Tn(t)}function kn(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,Mn(r.key),r)}}function Mn(t){var e=function(t){if("object"!=Tn(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var n=e.call(t,"string");if("object"!=Tn(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==Tn(e)?e:e+""}var Rn=Math.min,In=Math.max,An=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.min=new X,this.max=new X}return function(t,e,n){e&&kn(t.prototype,e),n&&kn(t,n),Object.defineProperty(t,"prototype",{writable:!1})}(t,[{key:"calcSupport",value:function(t,e){for(var n=0;n<3;n++)e[n]<0?t[n]=this.min[n]:t[n]=this.max[n]}}],[{key:"add",value:function(t,e,n){for(var r=0;r<3;r++)e.min[r]<n.min[r]?t.min[r]=e.min[r]:t.min[r]=n.min[r],e.max[r]>n.max[r]?t.max[r]=e.max[r]:t.max[r]=n.max[r]}},{key:"hitCheck",value:function(t,e){for(var n=0;n<3;n++)if(t.min[n]>e.max[n]||t.max[n]<e.min[n])return!1;return!0}},{key:"hitCheckLine",value:function(t,e,n){var r=-99999,o=99999,i=X.alloc();X.sub(i,n,e);for(var a=0;a<3;a++){var u=i[a];if(u>0)(s=(t.min[a]-e[a])/u)>r&&(r=s),(s=(t.max[a]-e[a])/u)<o&&(o=s);else if(u<0){var s;(s=(t.max[a]-e[a])/u)>r&&(r=s),(s=(t.min[a]-e[a])/u)<o&&(o=s)}else if(t.min[a]>e[a]||t.max[a]<e[a])return X.free(1),this.result=-1,-1}return X.free(1),this.result=0,r>o&&(this.result=-1),r}},{key:"createFromPoints",value:function(t,e){for(var n=0;n<3;n++)t.min[n]=e[0][n],t.max[n]=e[0][n];e.forEach(function(e){for(var n=0;n<3;n++)t.min[n]=Rn(e[n]),t.max[n]=In(e[n])})}},{key:"createFromPolygon",value:function(t,e,n,r,o){if(o)for(var i=0;i<3;i++)t.min[i]=Rn(Rn(Rn(e[i],n[i]),r[i]),o[i]),t.max[i]=In(In(In(e[i],n[i]),r[i]),o[i]);else for(i=0;i<3;i++)t.min[i]=Rn(Rn(e[i],n[i]),r[i]),t.max[i]=In(In(e[i],n[i]),r[i])}},{key:"addPoint",value:function(t,e){for(var n=0;n<3;n++)t.min[n]=Math.min(t.min[n],e[n]),t.max[n]=Math.max(t.max[n],e[n])}},{key:"aabbCast",value:function(t,e,n){return X.sub(Cn.min,e.min,n.max),X.sub(Cn.max,e.max,n.min),this.hitCheckLine(Cn,X.ZERO,t)}}]),t}();!function(t,e,n){(e=Mn(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n}(An,"result",void 0),t(An);var Cn=new An;function Fn(t){return Fn="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Fn(t)}function Nn(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,Bn(r.key),r)}}function Bn(t){var e=function(t){if("object"!=Fn(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var n=e.call(t,"string");if("object"!=Fn(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==Fn(e)?e:e+""}var Un=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.children=new Array(2),this.element=null}return function(t,e){e&&Nn(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1})}(t,[{key:"find",value:function(t){t(this)||this.children.forEach(function(e){e&&e.find(t)})}}]),t}();function Ln(t){return Ln="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Ln(t)}function Vn(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,Dn(r.key),r)}}function Dn(t){var e=function(t){if("object"!=Ln(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var n=e.call(t,"string");if("object"!=Ln(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==Ln(e)?e:e+""}function Gn(t,e,n,r){if(e===n)return t[e];var o=new Un;o.aabb=new An,Qe.qSort(t,e,n,function(t,e){return t.aabb.min[r]-e.aabb.min[r]});var i=(n+e)/2|0;return r=[1,2,0][r],o.children[0]=Gn(t,e,i,r),o.children[1]=Gn(t,i+1,n,r),o.element=null,An.add(o.aabb,o.children[0].aabb,o.children[1].aabb),o}var zn=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.root}return function(t,e,n){n&&Vn(t,n),Object.defineProperty(t,"prototype",{writable:!1})}(t,0,[{key:"createAABBTree",value:function(t){return Gn(t,0,t.length-1,0)}}]),t}();function Xn(t){return Xn="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Xn(t)}function Hn(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,Yn(r.key),r)}}function qn(t,e,n){return(e=Yn(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function Yn(t){var e=function(t){if("object"!=Xn(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var n=e.call(t,"string");if("object"!=Xn(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==Xn(e)?e:e+""}var Wn=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t)}return function(t,e,n){n&&Hn(t,n),Object.defineProperty(t,"prototype",{writable:!1})}(t,0,[{key:"getOuterCenter",value:function(t,e,n,r){var o=H.len2(r,n),i=H.len2(r,e),a=H.len2(e,n),u=o*(i+a-o),s=i*(a+o-i),c=a*(o+i-a);H.mul(t,e,u),H.madd(t,t,n,s),H.madd(t,t,r,c),H.mul(t,t,1/(u+s+c))}},{key:"getOuterCenter3_sub",value:function(t,e,n,r){var o=X.len2(r,n),i=X.len2(r,e),a=X.len2(e,n),u=o*(i+a-o),s=i*(a+o-i),c=a*(o+i-a);X.mul(t,e,u),X.madd(t,t,n,s),X.madd(t,t,r,c),X.mul(t,t,1/(u+s+c))}},{key:"getOuterCenter3",value:function(t,e,n,r,o){var i=X.len2(r,n),a=X.len2(r,e),u=X.len2(e,n),s=X.len2(e,o),c=X.len2(n,o),f=X.len2(r,o),l=i*s*(c+f-i)+a*c*(f+i-c)+u*f*(i+c-f)-2*i*c*f,h=i*s*(a+f-s)+a*c*(f+s-a)+u*f*(s+a-f)-2*s*a*f,p=i*s*(c+u-s)+a*c*(u+s-c)+u*f*(s+c-u)-2*s*c*u,v=i*s*(a+u-i)+a*c*(u+i-a)+u*f*(i+a-u)-2*i*a*u;if(Math.abs(l+h+p+v)>1e-5){var y=1/(l+h+p+v);X.mul(t,e,l*y),X.madd(t,t,n,h*y),X.madd(t,t,r,p*y),X.madd(t,t,o,v*y)}else t[0]=NaN}},{key:"LINE_POINT",value:function(t,e,n,r){var o=X.alloc(),i=X.alloc();X.sub(o,n,e),X.sub(i,r,e);var a=X.dot(o,i);if(a<=0)X.copy(t,e);else{var u=o[0]*o[0]+o[1]*o[1]+o[2]*o[2];a>u?X.copy(t,n):X.madd(t,e,o,a/u)}return X.free(2),X.len2(t,r)}},{key:"triangleCheck",value:function(t,e,n){var r=X.alloc(),o=X.alloc();X.cross2(r,t,e,n);for(var i=[t,e,n,t],a=0,u=0;u<3;u++){var s=i[u],c=i[u+1];if(X.sub(o,c,s),X.cross(o,r,o),X.dot(o,s)>0){a=u+1<<1;break}}return X.free(2),a}},{key:"triangle_zero",value:function(t,e,n,r){var o=X.alloc(),i=X.alloc();X.cross2(i,e,n,r);var a=[e,n,r,e,n],u=this.triangleCheck(e,n,r);if(0===u)X.mul(t,i,X.dot(i,e)/X.scalar2(i));else{var s=(u>>1)-1,c=a[s],f=a[s+1],l=a[s+2];X.sub(o,f,c);var h=-X.dot(c,o),p=X.dot(o,o);h<0?u+=$n(t,c,l):h>p?u+=$n(t,l,f):X.madd(t,c,o,h/p)}return X.free(2),u}},{key:"calcSquarePos",value:function(t,e,n,r,o,i){var a=X.alloc(),u=X.alloc(),s=X.alloc(),c=X.alloc(),f=X.alloc();X.cross3(f,e,r,n,o),X.sub(a,n,e),X.sub(u,r,o),X.sub(s,e,i),X.sub(c,o,i);for(var l,h=0,p=0,v=0,y=0;y<3;y++){var m=(y+1)%3,b=(y+2)%3;h+=(a[m]*u[b]-a[b]*u[m])*f[y],p+=(a[m]*c[b]+s[m]*u[b]-(a[b]*c[m]+s[b]*u[m]))*f[y],v+=(s[m]*c[b]-s[b]*c[m])*f[y]}if(h){l=p*p-4*h*v<0?-p/(2*h):(-p+Math.sqrt(p*p-4*h*v))/(2*h);var d=X.alloc();X.sub(d,e,o),X.cross(d,d,f);var g=X.alloc();X.sub(g,n,r),X.cross(g,f,g);var w=X.alloc();X.sub(w,n,i),(l<0&&X.dot(d,s)>0||l>1&&X.dot(g,w)>0)&&(l=(-p-Math.sqrt(p*p-4*h*v))/(2*h)),X.free(3)}else l=-v/p;t[0]=l;var _=X.alloc(),x=X.alloc();return X.madd(_,o,u,l),X.madd(_,_,a,-l),X.sub(_,_,e),X.mul(x,a,l),X.add(x,x,e),X.sub(x,i,x),t[1]=X.dot(x,_)/X.dot(_,_),X.free(7),l}},{key:"TETRA_POINT",value:function(t,e,n){for(var r=X.alloc(),o=!0,i=0;i<4;i++){var a=n[i+1&3],u=n[i+2&3],s=n[i+3&3],c=n[i];X.cross2(r,a,u,s);var f=X.dot(a,r),l=X.dot(e,r)-f,h=X.dot(c,r)-f;if(h*h<=1e-10||l*h<0){o=!1;break}t&&(t[i]=l/h)}return X.free(1),o}}]),t}();qn(Wn,"LINE_LINE",function(t,e,n,r,o,i){var a=X.alloc(),u=X.alloc(),s=X.alloc(),c=X.alloc();if(X.sub(a,r,n),!(a[0]||a[1]||a[2]))return X.copy(t,n),this.LINE_POINT(e,o,i,t),void X.free(4);if(X.sub(u,i,o),!(u[0]||u[1]||u[2]))return X.copy(e,o),this.LINE_POINT(t,n,r,e),void X.free(4);if(X.cross(s,a,u),X.scalar(s)){X.cross(s,u,s);var f=X.dot(s,a);X.sub(c,o,n);var l=X.dot(s,c);if(l*f>=0&&l*l<=f*f){X.cross(s,a,u),X.cross(s,a,s);var h=X.dot(s,u),p=-X.dot(s,c);if(p*h>=0&&p*p<=h*h)return X.madd(t,n,a,l/f),X.madd(e,o,u,p/h),void X.free(4)}}var v,y=this.LINE_POINT(c,n,r,o);X.copy(t,c),X.copy(e,o),(v=this.LINE_POINT(c,n,r,i))<y&&(y=v,X.copy(t,c),X.copy(e,i)),(v=this.LINE_POINT(c,o,i,n))<y&&(y=v,X.copy(t,n),X.copy(e,c)),(v=this.LINE_POINT(c,o,i,r))<y&&(y=v,X.copy(t,r),X.copy(e,c)),X.free(4)}),qn(Wn,"TRIANGLE_POINT",function(t,e,n,r,o){var i=X.alloc(),a=X.alloc(),u=X.alloc(),s=X.alloc();a[0]=n[1]*r[2]-n[2]*r[1]+e[2]*(-n[1]+r[1])+e[1]*(n[2]-r[2]),a[1]=n[2]*r[0]-n[0]*r[2]+e[0]*(-n[2]+r[2])+e[2]*(n[0]-r[0]),a[2]=n[0]*r[1]-n[1]*r[0]+e[1]*(-n[0]+r[0])+e[0]*(n[1]-r[1]);for(var c=[e,n,r,e,n],f=0;f<3;f++){var l=c[f],h=c[f+1],p=c[f+2];if(X.sub(s,o,l),X.sub(i,h,l),X.cross(u,a,i),X.dot(u,s)<=0){var v=X.dot(s,i),y=X.dot(i,i);return v<0?this.LINE_POINT(t,l,p,o):v>y?this.LINE_POINT(t,h,p,o):X.madd(t,l,i,v/y),void X.free(4)}}X.madd(t,o,a,-X.dot(a,s)/(a[0]*a[0]+a[1]*a[1]+a[2]*a[2])),X.free(4)}),qn(Wn,"TRIANGLE_LINE",function(t,e,n,r,o){var i=X.alloc(),a=X.alloc(),u=X.alloc(),s=X.alloc();if(X.cross2(a,t,e,n),X.sub(i,t,r),X.sub(u,o,r),0===(o=X.dot(a,u)))return X.free(4),99999;var c=X.dot(a,i)/o;X.madd(u,r,u,c);for(var f=[t,e,n,t],l=0;l<3;l++){var h=f[l],p=f[l+1];if(X.sub(i,p,h),X.cross(s,a,i),X.sub(i,u,h),X.dot(s,i)<=0)return X.free(4),99999}return X.free(4),c}),qn(Wn,"lineWeight",function(t,e,n,r){var o=new X;if(X.sub(o,n,r),0===o[0]&&0===o[1])return t[0]=1,void(t[1]=0);var i=X.dot(o,n),a=X.dot(o,e),u=X.dot(o,r);t[0]=(a-i)/(u-i),t[1]=1-t[0]}),qn(Wn,"triangleWeight",function(t,e,n,r,o){var i=[n,r,o,n,r],a=new X,u=new X;X.setValue(t,1,0,0);for(var s=0;s<3;s++){X.sub(a,i[s+1],i[s+2]),0===a[0]&&0===a[1]&&0===a[2]?X.sub(a,i[s],i[s+1]):(X.cross2(u,i[s],i[s+1],i[s+2]),X.cross(a,a,u));var c=X.dot(a,i[s+1]),f=X.dot(a,e),l=X.dot(a,i[s]);l-c!==0&&(t[s]=(f-c)/(l-c))}});var Qn=new X,$n=function(t,e,n){var r,o=Qn;X.sub(o,n,e);var i=-X.dot(o,e);if(i<=0)X.copy(t,e),r=-1;else{var a=X.scalar2(o);i>a?(X.copy(t,n),r=1):(X.madd(t,e,o,i/a),r=0)}return r},Jn=-9999999,Kn=function(t,e,n,r){var o=X.alloc(),i=X.alloc(),a=0;X.sub(i,n,e);for(var u=[e,n,r,e,n],s=0;s<3;s++)if(X.cross(o,t,i),X.sub(i,u[s+2],u[s+1]),X.dot(o,u[s])*X.dot(o,i)>0){a|=1<<s;break}return X.free(2),a},Zn=function(t,e,n,r,o){if(0===X.scalar2(t))return Jn;if(e.type===Yo.MESH)return e.convexCast(t,n,r,o);if(n.type===Yo.MESH){var i=new X;X.mul(i,t,-1);var a=n.convexCast(i,e,r,o);return o&&X.mul(o,o,-1),r&&X.madd(r,r,o,-a),a}var u=X.alloc();X.scalar(t),X.mul(u,t,1);for(var s=X.alloc(),c=[],f=[],l=0;l<4;l++)c.push(X.alloc()),f.push(X.alloc());var h=X.alloc();X.copy(s,u);var p=1,v=0;e.calcSupportB(f[0],s),n.calcSupportReverseB(c[0],s),X.sub(c[0],f[0],c[0]),X.cross(s,c[0],u),X.cross(s,u,s),X.dot(s,c[0])>0&&X.mul(s,s,-1);for(var y=[c[0],c[1],c[2],c[0],c[1],c[2]],m=[0,2,0,1,1,0,2],b=99999999;;){if(0===X.scalar2(s)){console.log("0vec");break}if(e.calcSupportB(f[p],s),n.calcSupportReverseB(c[p],s),X.sub(c[p],f[p],c[p]),X.dot(c[p],s)<=X.dot(s,c[0])+.01)break;if(1===p)X.sub(h,c[0],c[1]),X.cross(s,h,u),X.dot(c[0],s)>0&&X.mul(s,s,-1),p++;else if(2===p){var d=Kn(u,c[0],c[1],c[2]);if(0===d?(X.cross2(s,c[0],c[1],c[2]),X.dot(s,u)<0&&X.mul(s,s,-1),p++):(X.copy(y[m[d]],y[2]),X.sub(h,c[0],c[1]),X.cross(s,h,u),X.dot(c[0],s)>0&&X.mul(s,s,-1)),0===X.scalar(s))break}else{var g=b;for(l=0;l<3;l++)if(!Kn(u,c[l],y[l+1],c[3])&&(X.cross2(s,c[l],y[l+1],c[3]),0!==X.dot(s,u))){X.copy(y[l+2],c[3]),X.cross2(s,c[0],y[1],c[2]),X.dot(u,s)<0&&X.mul(s,s,-1),g=-X.dot(s,c[0])/X.dot(s,u);break}if(g>=b)break;b=g}if(18===++v&&console.log("lo!!"),v>21){console.log("loooop!!");break}}var w=Jn;if(p>2){X.cross2(s,c[0],c[1],c[2]),-X.dot(s,u)<0&&X.mul(s,s,-1),o&&(o.set(s),X.norm(o)),r&&!o&&X.copy(r,s);var _=-X.dot(s,u);if(w=0!==_?X.dot(s,c[0])/_:-X.dot(u,c[0]),r&&o){X.mul(s,u,-w);var x=new X;for(Wn.triangleWeight(x,s,c[0],c[1],c[2]),X.setValue(r,0,0,0),l=0;l<3;l++)X.madd(r,r,f[l],x[l]);X.sub(r,r,s)}w/=1}return X.free(11),w};function tr(t){return tr="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},tr(t)}function er(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,nr(r.key),r)}}function nr(t){var e=function(t){if("object"!=tr(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var n=e.call(t,"string");if("object"!=tr(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==tr(e)?e:e+""}var rr=new X,or=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.matrix=new z,this.bold=0,this.inv_matrix=new z,this.aabb=new An,this.parent=null,this.callbackFunc=null,this.name="",this.groups=1,this.notgroups=0}return function(t,e){e&&er(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1})}(t,[{key:"calcSupport",value:function(t,e){t[0]=this.matrix[9],t[1]=this.matrix[10],t[2]=this.matrix[11]}},{key:"calcSupportReverse",value:function(t,e){X.mul(rr,e,-1),this.calcSupport(t,rr)}},{key:"calcSupportB",value:function(t,e){this.calcSupport(t,e),X.madd(t,t,e,this.bold/X.scalar(e))}},{key:"calcSupportReverseB",value:function(t,e){this.calcSupportReverse(t,e),X.madd(t,t,e,-this.bold/X.scalar(e))}},{key:"calcAABB",value:function(t){t||(t=this.aabb);for(var e=X.alloc(),n=X.alloc(),r=0;r<3;r++)X.setValue(e,0,0,0),e[r]=1,this.calcSupport(n,e),t.max[r]=n[r]+this.bold,e[r]=-1,this.calcSupport(n,e),t.min[r]=n[r]-this.bold;X.free(2)}},{key:"refresh",value:function(){z.getInv(this.inv_matrix,this.matrix),this.calcAABB()}},{key:"rayCast",value:function(t,e,n){ar.matrix[9]=t[0],ar.matrix[10]=t[1],ar.matrix[11]=t[2],ar.refresh();var r=X.alloc();X.sub(r,e,t);var o=Zn(r,ar,this,n);return X.free(1),o}}]),t}(),ir=0;or.MESH=ir++,or.CUBOID=ir++,or.SPHERE=ir++,or.CYLINDER=ir++,or.CAPSULE=ir++,or.CONE=ir++,or.CONVEX_HULL=ir++,or.TRIANGLE=ir++,or.INVALID=-9999999,or.SPHERE_LINE=function(t,e,n,r,o){var i=X.alloc(),a=X.alloc();X.sub(i,t,n),X.sub(a,e,t);var u=X.dot(a,a),s=X.dot(i,a),c=X.dot(i,i)-r*r;if(X.free(2),0===u)return or.INVALID;var f=s*s-u*c;return f<0?or.INVALID:(f=(-s-Math.sqrt(f))/u,o&&(X.madd(o,t,a,f),X.sub(o,o,n),X.norm(o)),f)};var ar=new or;function ur(t){return ur="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},ur(t)}function sr(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,cr(r.key),r)}}function cr(t){var e=function(t){if("object"!=ur(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var n=e.call(t,"string");if("object"!=ur(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==ur(e)?e:e+""}function fr(t,e){return fr=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},fr(t,e)}function lr(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(t){}return(lr=function(){return!!t})()}function hr(t){return hr=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},hr(t)}z.setValue(ar.matrix,1,0,0,0,1,0,0,0,1,0,0,0),ar.bold=0;var pr=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&fr(t,e)}(n,t);var e=function(t){var e=lr();return function(){var n,r=hr(t);if(e){var o=hr(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return function(t,e){if(e&&("object"==ur(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(this,n)}}(n);function n(){var t;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,n),(t=e.call(this)).type=or.SPHERE,t}return function(t,e){e&&sr(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1})}(n,[{key:"calcSupport",value:function(t,e){t[0]=this.matrix[9],t[1]=this.matrix[10],t[2]=this.matrix[11]}},{key:"refresh",value:function(){this.calcAABB()}},{key:"rayCast",value:function(t,e,n){var r=X.alloc();X.setValue(r,this.matrix[9],this.matrix[10],this.matrix[11]);var o=or.SPHERE_LINE(t,e,r,this.bold,n);return X.free(1),o}}]),n}(or);function vr(t){return vr="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},vr(t)}function yr(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,mr(r.key),r)}}function mr(t){var e=function(t){if("object"!=vr(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var n=e.call(t,"string");if("object"!=vr(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==vr(e)?e:e+""}function br(t,e){return br=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},br(t,e)}function dr(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(t){}return(dr=function(){return!!t})()}function gr(t){return gr=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},gr(t)}var wr=-1/Math.sqrt(5),_r=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&br(t,e)}(n,t);var e=function(t){var e=dr();return function(){var n,r=gr(t);if(e){var o=gr(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return function(t,e){if(e&&("object"==vr(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(this,n)}}(n);function n(){var t;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,n),(t=e.call(this)).type=or.CONE,t}return function(t,e){e&&yr(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1})}(n,[{key:"calcSupport",value:function(t,e){z.dotMat33Vec3(t,this.inv_matrix,e),X.norm(t),t[1]<wr?X.set(t,0,1,0):(t[1]=0,X.nrm(t,t),t[1]=1,X.mul(t,t,-1)),z.dotVec3(t,this.matrix,t)}},{key:"rayCast",value:function(t,e,n){var r=-99999,o=99999,i=!1,a=X.alloc(),u=X.alloc();z.dotVec3(u,this.inv_matrix,t),z.dotVec3(a,this.inv_matrix,e),X.sub(a,a,u);var s=u[1];if(0===a[1])if(s*s>1)r=99999;else{var c=.5*(1-u),f=a[0]*a[0]+a[2]*a[2],l=u[0]*a[0]+u[2]*a[2],h=u[0]*u[0]+u[2]*u[2]-c*c;0===f?u[0]*u[0]+u[2]*u[2]>c*c&&(r=999999):r=(y=l*l-f*h)<0?999999:Math.max(r,(-l-Math.sqrt(y))/f)}else if(u[2]-=1,f=.8*(a[0]*a[0]+a[1]*a[1]+a[2]*a[2])-a[1]*a[1],(y=(l=.8*(u[0]*a[0]+u[1]*a[1]+u[2]*a[2])-u[1]*a[1])*l-f*(h=.8*(u[0]*u[0]+u[1]*u[1]+u[2]*u[2])-u[1]*u[1]))<0)r=99999;else{f>0?(r=(-l-Math.sqrt(y))/f,o=(-l+Math.sqrt(y))/f):f<0?a[2]>0?o=(-l+Math.sqrt(y))/f:r=(-l-Math.sqrt(y))/f:l<0?r=-h/(2*l):o=-h/(2*l);var p=1/a[1];if(p>0){o=Math.min(o,(1-s)*p);var v=(-1-s)*p;v>r&&(r=v,i=!0)}else o=Math.min(o,(-1-s)*p),r=Math.max(r,(1-s)*p)}if(r>o)r=or.INVALID,n&&X.set(n,0,0,0);else if(n){if(X.madd(u,u,a,r),i)X.set(n,0,-1,0);else{var y=this.matrix[9]*this.matrix[9]+this.matrix[10]*this.matrix[10]+this.matrix[11]*this.matrix[11];X.set(n,u[0],.5/y,u[2])}Y.dotVec3(n,this.matrix,n),X.norm(n)}return X.free(2),r}}]),n}(or);function xr(t){return xr="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},xr(t)}function jr(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,Or(r.key),r)}}function Or(t){var e=function(t){if("object"!=xr(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var n=e.call(t,"string");if("object"!=xr(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==xr(e)?e:e+""}function Sr(t,e){return Sr=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},Sr(t,e)}function Er(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(t){}return(Er=function(){return!!t})()}function Pr(t){return Pr=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},Pr(t)}var Tr=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&Sr(t,e)}(n,t);var e=function(t){var e=Er();return function(){var n,r=Pr(t);if(e){var o=Pr(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return function(t,e){if(e&&("object"==xr(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(this,n)}}(n);function n(){var t;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,n),(t=e.call(this)).type=or.CYLINDER,t}return function(t,e){e&&jr(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1})}(n,[{key:"calcSupport",value:function(t,e){var n=this.matrix,r=e[0]*n[3]+e[1]*n[4]+e[2]*n[5];t[1]=r<0?-1:1;var o=e[0]*n[0]+e[1]*n[1]+e[2]*n[2],i=e[0]*n[6]+e[1]*n[7]+e[2]*n[8];0!==(r=Math.sqrt(o*o+i*i))&&(r=1/r),t[0]=o*r,t[2]=i*r,z.dotVec3(t,n,t)}},{key:"rayCast",value:function(t,e,n){var r=-99999,o=99999,i=X.alloc(),a=X.alloc();z.dotVec3(a,this.inv_matrix,t),z.dotVec3(i,this.inv_matrix,e),X.sub(i,i,a);var u=i[1],s=a[1];if(0===u&&s*s>1)return X.free(2),or.INVALID;(u=1/u)>0?(o=Math.min(o,(1-s)*u),r=Math.max(r,(-1-s)*u)):(o=Math.min(o,(-1-s)*u),r=Math.max(r,(1-s)*u));var c=i[0]*i[0]+i[2]*i[2],f=a[0]*i[0]+a[2]*i[2],l=a[0]*a[0]+a[2]*a[2]-1,h=!1;if(0===c){if(a[0]*a[0]+a[2]*a[2]>1)return X.free(2),or.INVALID}else{var p=f*f-c*l;if(p<0)return X.free(2),or.INVALID;var v=(-f-Math.sqrt(p))/c;r<v&&(r=v,h=!0),o=Math.min(o,(-f+Math.sqrt(p))/c)}return r>o?(X.free(2),or.INVALID):(n&&(h?(X.madd(a,a,i,r),X.setValue(n,a[0],0,a[2])):X.setValue(n,0,a[1],0),Y.dotVec3(n,this.matrix,n),X.norm(n)),X.free(2),r)}}]),n}(or);function kr(t){return kr="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},kr(t)}function Mr(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,Rr(r.key),r)}}function Rr(t){var e=function(t){if("object"!=kr(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var n=e.call(t,"string");if("object"!=kr(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==kr(e)?e:e+""}function Ir(t,e){return Ir=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},Ir(t,e)}function Ar(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(t){}return(Ar=function(){return!!t})()}function Cr(t){return Cr=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},Cr(t)}var Fr=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&Ir(t,e)}(n,t);var e=function(t){var e=Ar();return function(){var n,r=Cr(t);if(e){var o=Cr(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return function(t,e){if(e&&("object"==kr(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(this,n)}}(n);function n(){var t;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,n),(t=e.call(this)).type=or.CAPSULE,t}return function(t,e){e&&Mr(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1})}(n,[{key:"calcSupport",value:function(t,e){var n=this.matrix;X.setValue(t,n[3],n[4],n[5]),X.dot(t,e)<0&&X.mul(t,t,-1),t[0]+=n[9],t[1]+=n[10],t[2]+=n[11]}},{key:"rayCast",value:function(t,e,n){var r=or.INVALID,o=X.alloc(),i=X.alloc(),a=Tr.prototype.rayCast.call(this,t,e,n);(r===or.INVALID||a<r)&&(r=a);var u=this.matrix;return X.setValue(o,u[3]+u[9],u[4]+u[10],u[5]+u[11]),a=or.SPHERE_LINE(t,e,o,this.bold,i),(r===or.INVALID||a<r&&a!==or.INVALID)&&(r=a,n&&X.copy(n,i)),X.setValue(o,-u[3]+u[9],-u[4]+u[10],-u[5]+u[11]),a=or.SPHERE_LINE(t,e,o,this.bold,i),(r===or.INVALID||a<r&&a!==or.INVALID)&&(r=a,n&&X.copy(n,i)),X.free(2),n&&r===or.INVALID&&X.setValue(n,0,0,0),r}}]),n}(or);function Nr(t){return Nr="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Nr(t)}function Br(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,Ur(r.key),r)}}function Ur(t){var e=function(t){if("object"!=Nr(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var n=e.call(t,"string");if("object"!=Nr(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==Nr(e)?e:e+""}function Lr(){return Lr="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(t,e,n){var r=function(t,e){for(;!{}.hasOwnProperty.call(t,e)&&null!==(t=Gr(t)););return t}(t,e);if(r){var o=Object.getOwnPropertyDescriptor(r,e);return o.get?o.get.call(arguments.length<3?t:n):o.value}},Lr.apply(null,arguments)}function Vr(t,e){return Vr=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},Vr(t,e)}function Dr(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(t){}return(Dr=function(){return!!t})()}function Gr(t){return Gr=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},Gr(t)}var zr=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&Vr(t,e)}(n,t);var e=function(t){var e=Dr();return function(){var n,r=Gr(t);if(e){var o=Gr(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return function(t,e){if(e&&("object"==Nr(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(this,n)}}(n);function n(){var t;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,n),(t=e.call(this)).type=or.CUBOID,t.bold=0,t}return function(t,e){e&&Br(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1})}(n,[{key:"calcSupport",value:function(t,e){var n=this.matrix;n[0]*e[0]+n[1]*e[1]+n[2]*e[2]<0?t[0]=-1:t[0]=1,n[3]*e[0]+n[4]*e[1]+n[5]*e[2]<0?t[1]=-1:t[1]=1,n[6]*e[0]+n[7]*e[1]+n[8]*e[2]<0?t[2]=-1:t[2]=1,z.dotVec3(t,n,t)}},{key:"rayCast",value:function(t,e,r){if(0!==this.bold)return Lr(Gr(n.prototype),"rayCast",this).call(this,t,e,r);var o,i=-99999,a=99999,u=X.alloc(),s=X.alloc();z.dotVec3(s,this.inv_matrix,t),z.dotVec3(u,this.inv_matrix,e),X.sub(u,u,s);for(var c=0;c<3;c++){var f=u[c],l=s[c];if(0!==f){f=1/f,a=Math.min(a,(Math.sign(f)-l)*f);var h=(-Math.sign(f)-l)*f;i<h&&(i=h,o=c)}else if(l*l>1)return X.free(2),or.INVALID}return X.free(2),i<a?(r&&(r[0]=this.matrix[3*o],r[1]=this.matrix[3*o+1],r[2]=this.matrix[3*o+2],X.mul(r,r,-Math.sign(u[o])),X.norm(r)),i):or.INVALID}}]),n}(or);function Xr(t){return Xr="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Xr(t)}function Hr(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,qr(r.key),r)}}function qr(t){var e=function(t){if("object"!=Xr(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var n=e.call(t,"string");if("object"!=Xr(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==Xr(e)?e:e+""}function Yr(t,e){return Yr=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},Yr(t,e)}function Wr(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(t){}return(Wr=function(){return!!t})()}function Qr(t){return Qr=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},Qr(t)}var $r=new pr;z.setValue($r.matrix,1,0,0,0,1,0,0,0,1,0,0,0),$r.bold=0;var Jr=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&Yr(t,e)}(n,t);var e=function(t){var e=Wr();return function(){var n,r=Qr(t);if(e){var o=Qr(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return function(t,e){if(e&&("object"==Xr(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(this,n)}}(n);function n(){var t;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,n),(t=e.call(this)).type=or.CONVEX_HULL,t.poses=[],t}return function(t,e){e&&Hr(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1})}(n,[{key:"calcSupport",value:function(t,e){var n=0,r=this.poses,o=X.alloc();Y.dotVec3(o,this.inv_matrix,e);for(var i=X.dot(o,r[n]),a=1;a<r.length;a++){var u=X.dot(o,r[a]);u>i&&(i=u,n=a)}z.dotVec3(t,this.matrix,r[n]),X.free(1)}},{key:"rayCast",value:function(t,e,n){$r.matrix[9]=t[0],$r.matrix[10]=t[1],$r.matrix[11]=t[2],$r.refresh();var r=X.alloc();X.sub(r,e,t);var o=Zn(r,$r,this,n);return X.free(1),o}}]),n}(or);function Kr(t){return Kr="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Kr(t)}function Zr(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,to(r.key),r)}}function to(t){var e=function(t){if("object"!=Kr(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var n=e.call(t,"string");if("object"!=Kr(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==Kr(e)?e:e+""}function eo(t,e){return eo=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},eo(t,e)}function no(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(t){}return(no=function(){return!!t})()}function ro(t){return ro=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},ro(t)}for(var oo=[],io=0;io<2;io++){var ao=new Jr;ao.poses=new Array(3),oo.push(ao)}var uo=0,so=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&eo(t,e)}(n,t);var e=function(t){var e=no();return function(){var n,r=ro(t);if(e){var o=ro(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return function(t,e){if(e&&("object"==Kr(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(this,n)}}(n);function n(){var t;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,n),(t=e.call(this)).type=Yo.MESH,t.triangles=[],t.aabbTreeRoot=null,t}return function(t,e){e&&Zr(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1})}(n,[{key:"createTree",value:function(){var t=oo[0],e=[],n=new z;t.matrix=n,t.inv_matrix=n,this.triangles.forEach(function(n){var r=new Un;r.aabb=new An,r.element=n,e.push(r),t.poses=n,t.calcAABB(r.aabb)}),this.aabbTreeRoot=zn.createAABBTree(e)}},{key:"hitCheck",value:function(t,e,n){var r=999999999,o=X.alloc(),i=X.alloc(),a=X.alloc(),u=oo[uo];u.matrix=this.matrix,u.inv_matrix=this.inv_matrix,uo++;var s=z.alloc(),c=z.alloc();z.dot(s,this.inv_matrix,n.matrix),z.dot(c,n.inv_matrix,this.matrix);var f=An.alloc(),l=n.matrix,h=n.inv_matrix;return n.matrix=s,n.inv_matrix=c,n.calcAABB(f),n.matrix=l,n.inv_matrix=h,z.free(2),this.aabbTreeRoot.find(function(s){if(!An.hitCheck(s.aabb,f))return 1;if(s.element){var c=u;s.element,u.poses=s.element,c.calcAABB();var l=Yo.calcClosestWithoutBold(o,i,c,n);l<r&&(X.cross2(a,u.poses[0],u.poses[1],u.poses[2]),Y.dotVec3(a,u.matrix,a),r=l,t.set(o),e.set(i))}return 0}),uo--,X.free(3),An.free(1),r}},{key:"rayCast",value:function(t,e,n){var r=this,o=Yo.INVALID,i=(X.alloc(),X.alloc()),a=X.alloc();z.dotVec3(i,this.inv_matrix,t),z.dotVec3(a,this.inv_matrix,e);for(var u=An.alloc(),s=0;s<3;s++)u.min[s]=Math.min(i[s],a[s]),u.max[s]=Math.max(i[s],a[s]);return this.aabbTreeRoot.find(function(t){if(!An.hitCheck(t.aabb,u))return 1;var e=An.hitCheckLine(t.aabb,i,a);if(An.result<0)return 1;if(e>o&&o!==Yo.INVALID)return 1;if(!t.element)return 0;var s=t.element,c=s[0],f=s[1],l=s[2],h=Wn.TRIANGLE_LINE(c,f,l,i,a);return(h<o||o<0)&&h>0&&(o=h,n&&(X.cross2(n,c,f,l),Y.dotVec3(n,r.matrix,n),X.norm(n))),0}),X.free(3),An.free(1),o}},{key:"convexCast",value:function(t,e,n,r){var o=99999,i=oo[uo];i.matrix=this.matrix,i.inv_matrix=this.inv_matrix,uo++;var a=X.alloc(),u=X.alloc(),s=X.alloc(),c=X.alloc();Y.dotVec3(s,this.inv_matrix,t);var f=z.alloc(),l=z.alloc();z.dot(f,this.inv_matrix,e.matrix),z.dot(l,e.inv_matrix,this.matrix);var h=An.alloc(),p=e.matrix,v=e.inv_matrix;e.matrix=f,e.inv_matrix=l,e.calcAABB(h),e.matrix=p,e.inv_matrix=v,z.free(2);var y=An.alloc();return X.sub(y.min,h.min,s),X.sub(y.max,h.max,s),An.add(y,y,h),this.aabbTreeRoot.find(function(f){if(!An.hitCheck(f.aabb,y))return 1;var l=An.aabbCast(s,f.aabb,h);if(An.result<0)return 1;if(l>o)return 1;if(!f.element)return 0;i.poses=f.element,i.calcAABB();var p=Zn(t,i,e,a,u);return p<o&&p!==Yo.INVALID&&(X.cross2(c,i.poses[0],i.poses[1],i.poses[2]),X.dot(c,u)<0&&(o=p,n.set(a),r.set(u))),0}),X.free(4),uo--,o>=99999&&(o=Yo.INVALID),An.free(2),o}}]),n}(Jr);function co(t){return co="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},co(t)}function fo(t,e){return fo=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},fo(t,e)}function lo(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(t){}return(lo=function(){return!!t})()}function ho(t){return ho=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},ho(t)}var po=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&fo(t,e)}(n,t);var e=function(t){var e=lo();return function(){var n,r=ho(t);if(e){var o=ho(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return function(t,e){if(e&&("object"==co(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(this,n)}}(n);function n(){var t;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,n),(t=e.call(this)).poses.push(new X),t.poses.push(new X),t.poses.push(new X),t}return function(t){return Object.defineProperty(t,"prototype",{writable:!1}),t}(n)}(Jr);function vo(t){return vo="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},vo(t)}function yo(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,bo(r.key),r)}}function mo(t,e,n){return e&&yo(t.prototype,e),n&&yo(t,n),Object.defineProperty(t,"prototype",{writable:!1}),t}function bo(t){var e=function(t){if("object"!=vo(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var n=e.call(t,"string");if("object"!=vo(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==vo(e)?e:e+""}for(var go,wo,_o,xo=mo(function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.v=new Int32Array(3),this.cross=new X,this.len=0}),jo=[],Oo=[],So=[],Eo=[],Po=0;Po<256;Po++){jo.push(new X),Oo.push(new X),So.push(new xo);var To=new Int32Array(2);Eo.push(To)}var ko=new X,Mo=function(t,e,n){var r,o=ko;X.sub(o,n,e);var i=-X.dot(o,e);if(i<=0)X.copy(t,e),r=-1;else{var a=X.scalar2(o);i>a?(X.copy(t,n),r=1):(X.madd(t,e,o,i/a),r=0)}return r},Ro=function(t,e,n,r){var o=X.alloc(),i=X.alloc();X.cross2(i,e,n,r);var a=[e,n,r,e,n],u=function(t,e,n){var r=X.alloc(),o=X.alloc();X.cross2(r,t,e,n);for(var i=[t,e,n,t],a=0,u=0;u<3;u++){var s=i[u],c=i[u+1];if(X.sub(o,c,s),X.cross(o,r,o),X.dot(o,s)>0){a=u+1<<1;break}}return X.free(2),a}(e,n,r);if(0===u)X.mul(t,i,X.dot(i,e)/X.scalar2(i));else{var s=(u>>1)-1,c=a[s],f=a[s+1],l=a[s+2];X.sub(o,f,c);var h=-X.dot(c,o),p=X.dot(o,o);h<0?u+=Mo(t,c,l):h>p?u+=Mo(t,l,f):X.madd(t,c,o,h/p)}return X.free(2),u},Io=function(t,e,n){var r,o,i=jo;for(o=0;o<wo&&!(So[o].len<0);o++);return o===wo&&wo++,r=So[o],X.setValue(r.v,t,e,n),X.cross2(r.cross,i[t],i[e],i[n]),X.norm(r.cross),r.len=X.dot(r.cross,i[t]),r.len<0&&(r.len*=-1,X.mul(r.cross,r.cross,-1)),r};for(Po=0;Po<128;Po++)To=[-1,-1],Eo.push(To);var Ao=function(t,e){for(var n=0;n<go;n++)if(Eo[n][0]===t&&Eo[n][1]===e||Eo[n][0]===e&&Eo[n][1]===t)return void(Eo[n][0]=-1);for(n=0;n<go&&!(Eo[n][0]<0);n++);n>=go&&go++;var r=Eo[n];r[0]=t,r[1]=e};function Co(t){return Co="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Co(t)}function Fo(t,e){return Fo=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},Fo(t,e)}function No(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(t){}return(No=function(){return!!t})()}function Bo(t){return Bo=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},Bo(t)}function Uo(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,Vo(r.key),r)}}function Lo(t,e,n){return e&&Uo(t.prototype,e),n&&Uo(t,n),Object.defineProperty(t,"prototype",{writable:!1}),t}function Vo(t){var e=function(t){if("object"!=Co(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var n=e.call(t,"string");if("object"!=Co(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==Co(e)?e:e+""}function Do(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var Go=function(t,e,n,r){var o=X.alloc(),i=X.alloc(),a=X.alloc(),u=X.alloc(),s=jo,c=Oo,f=-1,l=-1;X.add(u,n.aabb.min,n.aabb.max),X.sub(u,u,r.aabb.min),X.sub(u,u,r.aabb.max),X.mul(u,u,-.5),n.calcSupport(c[0],u),r.calcSupportReverse(s[0],u),X.sub(s[0],c[0],s[0]),X.copy(u,s[0]),_o=1,l=1;for(var h=0,p=!1;;){n.calcSupportReverse(i,u),r.calcSupport(o,u),X.sub(o,i,o);for(var v=X.dot(s[0],u),y=1;y<_o;y++)(_=X.dot(s[y],u))<v&&(v=_);if(X.dot(o,u)>=v-1e-7)break;if(X.copy(s[l],o),X.copy(c[l],i),_o<4&&_o++,2===_o)Mo(u,s[0],s[1]),0===(v=X.scalar2(u))&&(u[0]=-(s[0][1]-s[1][1]),u[1]=s[0][2]-s[1][2],u[2]=s[0][0]-s[1][0]),X.dot(u,s[0])<0&&X.mul(u,u,-1),l=2;else if(3===_o)Ro(u,s[0],s[1],s[2]),0===(v=X.scalar2(u))&&(X.cross2(u,s[0],s[1],s[2]),X.dot(u,s[0])<0&&X.mul(u,u,-1)),l=3;else{for(l=0,v=-1,y=0;y<4;y++){var m=s[y],b=s[y+1&3],d=s[y+2&3],g=s[y+3&3];X.cross2(a,b,d,g);var w=X.dot(b,a);if(w*(X.dot(m,a)-w)>0){var _=Ro(a,b,d,g),x=X.scalar2(a);(v<0||x<v)&&(v=x,l=y,X.copy(u,a))}}if(v<0){p=!0;break}}if(32===++h&&console.log("gjk!!"),h>33){console.log("loooop!!");break}}if(p)if(t||e){for(_o<3&&console.log("AAA"),wo=0,_o=4,h=0,y=0;y<4;y++)Io(y,y+1&3,y+2&3);for(;;){for(y=0;y<wo;y++)if(So[y].len>=0){v=(j=So[y]).len;break}for(;y<wo;y++)So[y].len<v&&So[y].len>=0&&(v=(j=So[y]).len);if(n.calcSupport(i,j.cross),r.calcSupportReverse(o,j.cross),X.sub(o,i,o),X.dot(o,j.cross)<j.len+1e-7)break;for(X.copy(s[_o],o),X.copy(c[_o],i),go=0,y=0;y<wo;y++){var j;(j=So[y]).len<0||X.dot(o,j.cross)-j.len>1e-7&&(Ao(j.v[0],j.v[1]),Ao(j.v[1],j.v[2]),Ao(j.v[2],j.v[0]),j.len2=j.len,j.len=-1)}var O=!0;for(y=0;y<go;y++)Eo[y][0]<0||(Io(Eo[y][0],Eo[y][1],_o),O=!1);if(O)break;if(_o++,32===++h&&console.log("epa!!"),h>33)return console.log("loooop!!"),X.free(4),1e6}for(X.mul(u,j.cross,j.len),S=new X,Wn.triangleWeight(S,u,s[j.v[0]],s[j.v[1]],s[j.v[2]]),X.setValue(t,0,0,0),y=0;y<3;y++)X.madd(t,t,c[j.v[y]],S[y]);X.sub(e,t,u),f=-j.len}else console.log("ARIENAI");else if(f=X.scalar(u),t&&e){var S=new X;if(1===_o)X.copy(t,c[0]);else if(2===_o){Wn.lineWeight(S,u,s[0],s[1]),X.setValue(t,0,0,0);for(y=0;y<3;y++)X.madd(t,t,c[y],S[y])}else{4===_o&&(X.copy(s[l],s[3]),X.copy(c[l],c[3])),Wn.triangleWeight(S,u,s[0],s[1],s[2]),X.setValue(t,0,0,0);for(y=0;y<3;y++)X.madd(t,t,c[y],S[y])}X.sub(e,t,u)}return X.free(4),f},zo=(Math.min,Math.max,-9999999),Xo=Lo(function t(){Do(this,t),this.pairId=-1,this.col1=null,this.col2=null}),Ho=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&Fo(t,e)}(n,t);var e=function(t){var e=No();return function(){var n,r=Bo(t);if(e){var o=Bo(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return function(t,e){if(e&&("object"==Co(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(this,n)}}(n);function n(){var t;return Do(this,n),(t=e.call(this)).pos1=new X,t.pos2=new X,t}return Lo(n)}(Xo),qo=function(){var t=qo=function(){this.collisions=[],this.collisionIndexList=[];for(var t=1023;t--;)this.collisionIndexList.push(t);for(this.aabbSorts=[],this.aabbHitListMain=[],this.hitList=[],this.hitListIndex=0,t=0;t<1024;t++)this.aabbHitListMain.push(new Xo),this.hitList.push(new Ho);for(t=0;t<3;t++)this.aabbSorts.push([])};t.INVALID=zo;var e=0,n=t.MESH=e++,r=t.CUBOID=e++,o=t.SPHERE=e++,i=(t.CYLINDER=e++,t.CAPSULE=e++),a=(t.CONE=e++,t.CONVEX_HULL=e++,t.TRIANGLE=e++);t.prototype.addCollision=function(t){t.id=this.collisionIndexList.pop(),this.collisions.push(t);for(var e=0;e<3;e++)this.aabbSorts[e].push(t)},t.prototype.deleteCollision=function(t){for(var e=this.collisions,n=0;n<e.length;n++)if(e[n]===t){this.collisionIndexList.push(e[n].id),e.splice(n,1);break}for(var r=0;r<3;r++){var o=this.aabbSorts[r];for(n=0;n<o.length;n++)if(o[n]===t){o.splice(n,1);break}}},t.prototype.sortList=function(){for(var t=0;t<3;t++)this.aabbSorts[t].sort(function(e,n){return e.aabb.min[t]-n.aabb.min[t]})},t.prototype.calcAABBHitList=function(){for(var t=new Array(3),e=(new Array(3),1);e<t.length;e++)t[e]=new Array(1024);return function(){var e=this.aabbHitListMain;this.sortList();for(var n=0,r=this.aabbSorts[0],o=0;o<r.length;o++)for(var i=r[o].aabb.max[0],a=o+1;a<r.length&&!(i<=r[a].aabb.min[0]);a++)r[o].groups&r[a].groups&&!(r[o].notgroups&r[a].notgroups)&&(r[o].id<r[a].id?(e[n].col1=r[o],e[n].col2=r[a]):(e[n].col1=r[a],e[n].col2=r[o]),e[n].pairId=qo.getPairId(r[o].id,r[a].id),n++);Qe.kisu(e,function(t){return t.pairId},0,n-1);for(var u=1;u<3;u++){var s=0,c=(r=this.aabbSorts[u],t[u]);for(o=0;o<r.length;o++)for(i=r[o].aabb.max[u],a=o+1;a<r.length&&!(i<=r[a].aabb.min[u]);a++)r[o].groups&r[a].groups&&!(r[o].notgroups&r[a].notgroups)&&(c[s]=qo.getPairId(r[o].id,r[a].id),s++);c[s]=17179869184,Qe.kisu(c,null,0,s-1)}s=0;var f=0,l=0;for(u=0;u<n;u++){for(var h=e[u].pairId;t[1][f]<h;f++);for(;t[2][l]<h;l++);t[1][f]==h&&t[2][l]==h&&(e[s].pairId=e[u].pairId,e[s].col1=e[u].col1,e[s].col2=e[u].col2,s++)}return e[s].pairId=-1,e}}(),t.prototype.convexCastAll=function(t,e,n,r){var o=this;n===r&&(n=0,r=99999);var i=new An,a=new An;X.madd(i.min,t.aabb.min,e,n),X.madd(i.max,t.aabb.max,e,n),X.madd(a.min,t.aabb.min,e,r),X.madd(a.max,t.aabb.max,e,r),An.add(i,i,a),this.hitListIndex=0;var u=X.alloc(),s=X.alloc();if(this.aabbSorts[0].forEach(function(a){if(t.groups&a.groups&&!(t.notgroups&a.notgroups)&&An.hitCheck(i,a.aabb)&&An.aabbCast(e,t.aabb,a.aabb)){var c=Zn(e,t,a,u,s);if(c!==zo&&c>=n&&c<=r){var f=o.hitList[o.hitListIndex];X.copy(f.pos1,u),X.copy(f.pos2,s),f.col1=t,f.col2=a,f.len=c,o.hitListIndex++}}}),X.free(2),0===this.hitListIndex)return null;for(var c=this.hitList[0],f=1;f<this.hitListIndex;f++){var l=this.hitList[f];l.len<c.len&&(c=l)}return c},t.prototype.rayCastAll=function(t,e,n,r,o){r===o&&(r=0,o=99999);var i=this.aabbSorts[0];this.hitListIndex=0;var a=X.alloc(),u=X.alloc();n||(n=(1<<30)-1),X.add(u,t,e);for(var s=0;s<i.length;s++){var c=i[s];if(c.groups&n&&(An.hitCheckLine(c.aabb,t,u),!(An.result<0))){var f=i[s].rayCast(t,u,a);if(f!==zo&&f>=0){var l=this.hitList[this.hitListIndex];X.madd(l.pos1,t,e,f),X.copy(l.pos2,a),l.col2=i[s],l.len=f,this.hitListIndex++}}}if(X.free(2),0===this.hitListIndex)return null;for(var h=this.hitList[0],p=1;p<this.hitListIndex;p++){var v=this.hitList[p];v.len<h.len&&(h=v)}return h},t.prototype.checkClosestAll=function(t){var e=this.aabbSorts[0];this.hitListIndex=0;for(var n=X.alloc(),r=X.alloc(),o=0;o<e.length&&!(t.aabb.max[0]<e[o].aabb.min[0]);o++)if(!(t.aabb.min[0]>e[o].aabb.max[0])&&t.groups&e[o].groups&&!(t.notgroups&e[o].notgroups)&&qo.calcClosest(n,r,t,e[o])<0){var i=this.hitList[this.hitListIndex];X.copy(i.pos1,n),X.copy(i.pos2,r),i.col1=t,i.col2=e[o],this.hitListIndex++}return X.free(2),this.hitList},t.prototype.checkHitAll=function(t){var e=this.aabbSorts[0];this.hitListIndex=0;for(var n=0;n<e.length&&!(t.aabb.max[0]<e[n].aabb.min[0]);n++)if(!(t.aabb.min[0]>e[n].aabb.max[0])&&t.groups&e[n].groups&&!(t.notgroups&e[n].notgroups)&&qo.calcClosest(null,null,t,e[n],1)<0){var r=this.hitList[this.hitListIndex];r.col1=t,r.col2=e[n],this.hitListIndex++}return this.hitList},t.checkHit=function(t,e){return qo.calcClosest(null,null,t,e)},t.calcClosest=function(t,e,n,r){var o=u(t,e,n,r),i=0;if(o>0&&(i=1),o-=n.bold+r.bold,!t||!e)return o;var a=X.alloc();return X.sub(a,e,t),i||X.mul(a,a,-1),X.norm(a),X.madd(t,t,a,n.bold),X.madd(e,e,a,-r.bold),X.free(1),o};var u=function(t,e,r,o){var i=9999;if(r.type===n)i=r.hitCheck(t,e,o);else if(o.type===n)i=o.hitCheck(e,t,r);else{var a=s[8*r.type+o.type];a?t&&e?i=a(t,e,r,o):(i=a(t=X.alloc(),e=X.alloc(),r,o),X.free(2)):i=Go(t,e,r,o)}return i};t.calcClosestWithoutBold=u;var s=new Array(64);for(e=0;e<64;e++)s[e]=null;var c=function(t,e,n){s[8*e+t]=function(t,e,r,o){return n(e,t,o,r)},s[8*t+e]=n};return c(o,o,function(t,e,n,r){return X.setValue(t,n.matrix[9],n.matrix[10],n.matrix[11]),X.setValue(e,r.matrix[9],r.matrix[10],r.matrix[11]),X.len(t,e)}),c(i,o,function(t,e,n,r){var o=n.matrix,i=X.alloc(),a=X.alloc();return X.setValue(i,o[9]+o[3],o[10]+o[4],o[11]+o[5]),X.setValue(a,o[9]-o[3],o[10]-o[4],o[11]-o[5]),X.setValue(e,r.matrix[9],r.matrix[10],r.matrix[11]),Wn.LINE_POINT(t,i,a,e),X.free(2),X.len(t,e)}),c(a,o,function(t,e,n,r){return X.setValue(e,r.matrix[9],r.matrix[10],r.matrix[11]),Wn.TRIANGLE_POINT(t,n.v[0],n.v[1],n.v[2],e),X.len(t,e)}),c(r,o,function(t,e,n,r){var o=X.alloc(),i=X.alloc(),a=X.alloc();i[0]=r.matrix[9]-n.matrix[9],i[1]=r.matrix[10]-n.matrix[10],i[2]=r.matrix[11]-n.matrix[11];var u=1;X.setValue(t,r.matrix[9],r.matrix[10],r.matrix[11]),X.setValue(e,r.matrix[9],r.matrix[10],r.matrix[11]);for(var s=0;s<3;s++){X.setValue(o,n.matrix[3*s+0],n.matrix[3*s+1],n.matrix[3*s+2]);var c=X.dot(o,i),f=X.dot(o,o);c>f?(X.madd(t,t,o,1-c/f),u=0):c<-f?(X.madd(t,t,o,-(1+c/f)),u=0):a[s]=c>0?(f-c)/X.scalar(o):(-f-c)/X.scalar(o)}if(u){var l=0;for(s=1;s<3;s++)a[l]*a[l]>a[s]*a[s]&&(l=s);return X.setValue(o,n.matrix[3*l+0],n.matrix[3*l+1],n.matrix[3*l+2]),X.madd(t,e,o,a[l]/X.scalar(o)),X.free(3),-X.len(t,e)}return X.free(3),X.len(t,e)}),t.prototype.All=function(t,e){for(var n=X.alloc(),r=X.alloc(),o=(X.alloc(),this.aabbSorts[0],Date.now(),0);o<this.collisions.length;o++)this.collisions[o].refresh();performance.mark("aabbStart");var i=this.calcAABBHitList();for(performance.mark("aabbEnd"),Qe.kisu(t,null,0,e-1),performance.mark("collisionStart"),this.hitListIndex=0,o=0;i[o].pairId>0;o++){var a=i[o],u=a.col1,s=a.col2;if(qo.calcClosest(n,r,u,s)<0){var c=this.hitList[this.hitListIndex];X.copy(c.pos1,n),X.copy(c.pos2,r),c.col1=u,c.col2=s,c.pairId=i[o].pairId,this.hitListIndex++,u.callbackFunc&&u.callbackFunc(u,s,c.pos1,c.pos2),s.callbackFunc&&s.callbackFunc(s,u,c.pos2,c.pos1)}}this.hitList[this.hitListIndex].col1=null,this.collisionCount=o,performance.mark("collisionEnd"),X.free(3)},t.getPairId=function(t,e){return t<e?t<<16|e:e<<16|t},t.Sphere=pr,t.Cuboid=zr,t.Cylinder=Tr,t.Cone=_r,t.Capsule=Fr,t.ConvexHull=Jr,t.Mesh=so,t.Triangle=po,t}(),Yo=qo;function Wo(t){return Wo="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Wo(t)}function Qo(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,$o(r.key),r)}}function $o(t){var e=function(t){if("object"!=Wo(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var n=e.call(t,"string");if("object"!=Wo(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==Wo(e)?e:e+""}var Jo=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.obj1=null,this.obj2=null,this.pos1=new X,this.pos2=new X,this.impulse=new X,this.axisM=new Y,this.axis=[],this.axis[0]=new Float32Array(this.axisM.buffer,0,3),this.axis[1]=new Float32Array(this.axisM.buffer,12,3),this.axis[2]=new Float32Array(this.axisM.buffer,24,3),this.coeffM=new Y,this.offset=new X}return function(t,e,n){e&&Qo(t.prototype,e),n&&Qo(t,n),Object.defineProperty(t,"prototype",{writable:!1})}(t,[{key:"calcConstraintPre",value:function(){}},{key:"calcConstraint",value:function(){}},{key:"calcDiffVelocity",value:function(t){var e=X.alloc();this.obj1.calcVelocity(t,this.pos1),this.obj2.calcVelocity(e,this.pos2),X.sub(t,e,t),X.free(1)}},{key:"addImpulse",value:function(t){var e=X.alloc();this.obj1.addImpulse(this.pos1,t),X.mul(e,t,-1),this.obj2.addImpulse(this.pos2,e),X.free(1)}},{key:"addImpulse2",value:function(t){var e=X.alloc();this.obj1.addImpulse2(this.pos1,t),X.mul(e,t,-1),this.obj2.addImpulse2(this.pos2,e),X.free(1)}},{key:"addImpulseR",value:function(t){var e=X.alloc();this.obj1.addImpulseR(t),X.mul(e,t,-1),this.obj2.addImpulseR(e),X.free(1)}},{key:"calcEfficM",value:function(t){var e=Y.alloc();this.obj1.calcEfficM(e,this.pos1),this.obj2.calcEfficM(t,this.pos2),Y.add(t,t,e),Y.free(1)}}],[{key:"calcEffic",value:function(t,e,n){Y.dotVec3(t,e,n),X.mul(t,n,1/X.dot(t,n))}},{key:"calcEffic2",value:function(t,e,n,r,o){Y.dotVec3(t,n,r);var i=X.dot(t,r),a=X.dot(t,o);Y.dotVec3(t,n,o);var u=X.dot(t,r),s=X.dot(t,o),c=1/(i*s-a*u);t[0]=(s*r[0]-u*o[0])*c,t[1]=(s*r[1]-u*o[1])*c,t[2]=(s*r[2]-u*o[2])*c,e[0]=(-a*r[0]+i*o[0])*c,e[1]=(-a*r[1]+i*o[1])*c,e[2]=(-a*r[2]+i*o[2])*c}},{key:"calcEffic3",value:function(t,e,n,r,o,i,a){Y.getInv(r,r),Y.calcTranspose(r,r),Y.dotVec3(t,r,o),Y.dotVec3(e,r,i),Y.dotVec3(n,r,a)}}]),t}();function Ko(t){return Ko="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Ko(t)}function Zo(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,ti(r.key),r)}}function ti(t){var e=function(t){if("object"!=Ko(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var n=e.call(t,"string");if("object"!=Ko(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==Ko(e)?e:e+""}function ei(t,e){return ei=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},ei(t,e)}function ni(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(t){}return(ni=function(){return!!t})()}function ri(t){return ri=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},ri(t)}var oi=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&ei(t,e)}(n,t);var e=function(t){var e=ni();return function(){var n,r=ri(t);if(e){var o=ri(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return function(t,e){if(e&&("object"==Ko(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(this,n)}}(n);function n(){var t;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,n),(t=e.call(this)).pos1ex=new X,t.pos2ex=new X,t.impulseR=new X,t.rM=new Y,t.fricCoe=0,t}return function(t,e){e&&Zo(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1})}(n,[{key:"calcPre",value:function(){var t=this.obj1,e=this.obj2,n=X.alloc(),r=Y.alloc();t.fix||(t.impFlg=1),e.fix||(e.impFlg=1),X.norm(this.axis[0]),this.axis[1][0]=this.axis[0][2],this.axis[1][1]=this.axis[0][0],this.axis[1][2]=-this.axis[0][1],this.axis[2][0]=-this.axis[0][1],this.axis[2][1]=this.axis[0][2],this.axis[2][2]=this.axis[0][0],Y.add(this.rM,t.getInvInertiaTensor(),e.getInvInertiaTensor()),Y.getInv(this.rM,this.rM),X.sub(this.offset,this.pos2,this.pos1),X.normalize(n,this.offset),X.madd(this.offset,this.offset,n,-.001),X.mul(this.offset,this.offset,pu.ERP),this.fricCoe=t.getFriction()*e.getFriction(),this.calcDiffVelocity(n);var o=t.getRestitution()*e.getRestitution();X.scalar2(n)<.05&&(o=0),X.madd(this.offset,this.offset,this.axis[0],X.dot(n,this.axis[0])*o),this.calcEfficM(r);var i=X.alloc(),a=X.alloc();Jo.calcEffic(i,r,this.axis[0]);for(var u=0;u<3;u++)this.coeffM[3*u]=i[u];for(Jo.calcEffic2(i,a,r,this.axis[1],this.axis[2]),u=0;u<3;u++)this.coeffM[3*u+1]=i[u],this.coeffM[3*u+2]=a[u];X.free(2),t.getExPos(this.pos1ex,this.pos1),e.getExPos(this.pos2ex,this.pos2),this.counter++,X.free(1),Y.free(1)}},{key:"calcConstraintPre",value:function(){this.calcPre();var t=X.alloc();X.setValue(t,0,0,0),Y.dotVec3(t,this.axisM,this.impulse),this.addImpulse(t),this.addImpulseR(this.impulseR),X.free(1)}},{key:"calcConstraint",value:function(){var t=X.alloc(),e=new X,n=X.alloc();Y.copy(e,this.impulse),this.calcDiffVelocity(t),X.add(t,t,this.offset),Y.dotVec3(n,this.coeffM,t),X.add(this.impulse,this.impulse,n),this.impulse[0]=Math.max(this.impulse[0],0),this.impulse[0]*=pu.CFM;var r=this.impulse[0]*this.fricCoe,o=.01*r;t[0]*t[0]+t[1]*t[1]+t[2]*t[2]>1e-4&&(r*=.9),(i=this.impulse[1]*this.impulse[1]+this.impulse[2]*this.impulse[2])>r*r&&(i=r/Math.sqrt(i),this.impulse[1]*=i,this.impulse[2]*=i),X.sub(n,this.impulse,e),Y.dotVec3(n,this.axisM,n),this.addImpulse(n);var i,a=X.alloc();X.copy(a,this.impulseR),X.sub(t,this.obj2.rotV,this.obj1.rotV),X.madd(t,t,this.axis[0],-X.dot(t,this.axis[0])),Y.dotVec3(n,this.rM,t),X.add(this.impulseR,this.impulseR,n),X.copy(n,this.impulseR),(i=X.scalar2(n))>o*o&&X.madd(this.impulseR,this.impulseR,n,o/Math.sqrt(i)-1),X.mul(this.impulseR,this.impulseR,pu.CFM),X.sub(n,this.impulseR,a),this.addImpulseR(n),X.free(3)}}]),n}(Jo);function ii(t){return ii="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},ii(t)}function ai(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,ui(r.key),r)}}function ui(t){var e=function(t){if("object"!=ii(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var n=e.call(t,"string");if("object"!=ii(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==ii(e)?e:e+""}function si(t,e){return si=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},si(t,e)}function ci(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(t){}return(ci=function(){return!!t})()}function fi(t){return fi=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},fi(t)}for(var li=[],hi=0;hi<3;hi++)li.push(new X);var pi=new Array(3),vi=new Array(3),yi=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&si(t,e)}(n,t);var e=function(t){var e=ci();return function(){var n,r=fi(t);if(e){var o=fi(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return function(t,e){if(e&&("object"==ii(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(this,n)}}(n);function n(){var t;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,n),(t=e.call(this)).lim=new Array(3),t.motorMax=0,t.bane=new X,t}return function(t,e){e&&ai(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1})}(n,[{key:"calcPre",value:function(){var t=Y.alloc();this.calcEfficM(t),this.calcCoeffM(t),Y.free(1)}},{key:"calcConstraintPre",value:function(){this.calcPre();var t=X.alloc();Y.dotVec3(t,this.axisM,this.impulse),this.addImpulse(t),X.free(1)}},{key:"calcConstraint",value:function(){var t=X.alloc(),e=X.alloc();X.copy(t,this.impulse),this.calcDiffVelocity(e),X.add(e,e,this.offset),Y.dotVec3(e,this.coeffM,e),X.add(this.impulse,this.impulse,e),X.mul(this.impulse,this.impulse,pu.CFM);for(var n=0;n<pu.DIMENSION;n++)0!==this.motorMax&&0===n?this.impulse[n]=MAX(this.impulse[n],this.motorMax):this.lim[n]||(this.impulse[n]=MAX(this.impulse[n],0));X.sub(e,this.impulse,t),Y.dotVec3(e,this.axisM,e),this.addImpulse(e),X.free(2)}},{key:"calcCoeffM",value:function(t){for(var e=0,n=0;n<pu.DIMENSION;n++)X.scalar(this.axis[n])?(pi[e]=this.axis[n],vi[e]=li[n],e++):li[n].fill(0);for(1==e?Jo.calcEffic(vi[0],t,pi[0]):2==e?Jo.calcEffic2(vi[0],vi[1],t,pi[0],pi[1]):3==e&&Jo.calcEffic3(vi[0],vi[1],vi[2],t,pi[0],pi[1],pi[2]),n=0;n<pu.DIMENSION;n++)this.coeffM[n]=li[n][0],this.coeffM[n+3]=li[n][1],this.coeffM[n+6]=li[n][2]}}]),n}(Jo);function mi(t){return mi="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},mi(t)}function bi(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,di(r.key),r)}}function di(t){var e=function(t){if("object"!=mi(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var n=e.call(t,"string");if("object"!=mi(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==mi(e)?e:e+""}function gi(t,e){return gi=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},gi(t,e)}function wi(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(t){}return(wi=function(){return!!t})()}function _i(t){return _i=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},_i(t)}new X;var xi=new Y,ji=(new X,function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&gi(t,e)}(n,t);var e=function(t){var e=wi();return function(){var n,r=_i(t);if(e){var o=_i(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return function(t,e){if(e&&("object"==mi(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(this,n)}}(n);function n(){return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,n),e.call(this)}return function(t,e){e&&bi(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1})}(n,[{key:"calcPre",value:function(){Y.add(xi,this.obj1.inv_inertiaTensor,this.obj2.inv_inertiaTensor),this.calcCoeffM(xi)}},{key:"calcConstraintPre",value:function(){this.calcPre();var t=X.alloc();Y.dotVec3(t,this.axisM,this.impulse),this.addImpulseR(t),X.free(1)}},{key:"calcConstraint",value:function(){var t=X.alloc(),e=X.alloc();X.copy(t,this.impulse),X.sub(e,this.obj2.rotV,this.obj1.rotV),X.add(e,e,this.offset),Y.dotVec3(e,this.coeffM,e),X.add(this.impulse,this.impulse,e),X.mul(this.impulse,this.impulse,pu.CFM);for(var n=0;n<pu.DIMENSION;n++){var r=this.impulse[n];0!==this.motorMax&&0===n?(r>this.motorMax&&(this.impulse[n]=this.motorMax),r<-this.motorMax&&(this.impulse[n]=-this.motorMax)):r<0&&(this.impulse[n]=0)}X.sub(e,this.impulse,t),Y.dotVec3(e,this.axisM,e),this.addImpulseR(e),X.free(2)}}]),n}(yi));function Oi(t){return Oi="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Oi(t)}function Si(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,Ei(r.key),r)}}function Ei(t){var e=function(t){if("object"!=Oi(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var n=e.call(t,"string");if("object"!=Oi(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==Oi(e)?e:e+""}var Pi=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.use_breaking=0,this.breaking_threshold=0,this.disable_collisions=!1,this.enabled=!1,this.object1=null,this.object2=null,this.matrix=new z,this.matrix2=new z,this.use_limit_lin=new X,this.limit_lin_lower=new X,this.limit_lin_upper=new X,this.use_spring=new X,this.spring_damping=new X,this.spring_stiffness=new X,this.use_motor_lin=0,this.motor_lin_max_impulse=1,this.motor_lin_target_velocity=1,this.use_limit_ang=new X,this.limit_ang_lower=new X,this.limit_ang_upper=new X,this.use_spring_ang=new X,this.spring_damping_ang=new X,this.spring_stiffness_ang=new X,this.use_motor_ang=0,this.motor_ang_max_impulse=1,this.motor_ang_target_velocity=1,this.linConstraint=new yi,this.angConstraint=new ji}return function(t,e){e&&Si(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1})}(t,[{key:"setConstraint",value:function(){var t,e=X.alloc(),n=X.alloc(),r=X.alloc(),o=q.alloc(),i=q.alloc(),a=Y.alloc(),u=z.alloc(),s=z.alloc(),c=this.object1,f=this.object2;z.dot(u,this.object1.matrix,this.matrix),z.dot(s,this.object2.matrix,this.matrix2),X.setValue(this.linConstraint.pos1,u[9],u[10],u[11]),X.setValue(this.linConstraint.pos2,s[9],s[10],s[11]);for(var l=0;l<3;l++){var h=3*l,p=1/Math.sqrt(u[h]*u[h]+u[h+1]*u[h+1]+u[h+2]*u[h+2]);u[3*l]=u[h]*p,u[3*l+1]=u[h+1]*p,u[3*l+2]=u[h+2]*p,p=1/Math.sqrt(s[h]*s[h]+s[h+1]*s[h+1]+s[h+2]*s[h+2]),s[3*l]=s[h]*p,s[3*l+1]=s[h+1]*p,s[3*l+2]=s[h+2]*p}for(this.parent===this.object1||(q.toMat33(obj1m,s),Y.copy(obj2m,u)),this.linConstraint.obj1=c,this.linConstraint.obj2=f,this.angConstraint.obj1=c,this.angConstraint.obj2=f,X.sub(n,this.linConstraint.pos2,this.linConstraint.pos1),this.linConstraint.calcDiffVelocity(r),X.setValue(this.linConstraint.offset,0,0,0),l=0;l<pu.DIMENSION;l++)t=this.linConstraint.axis[l],X.setValue(t,u[3*l],u[3*l+1],u[3*l+2]),this.use_spring[l]&&(X.mul(e,t,DT*X.dot(t,n)*this.spring_stiffness[l]),X.madd(e,e,t,DT*X.dot(t,r)*this.spring_damping[l]),this.linConstraint.addImpulse2(e)),this.use_limit_lin[l]?((p=X.dot(t,n))<this.limit_lin_lower[l]?(p=this.limit_lin_lower[l]-p,X.mul(t,t,-1)):p>this.limit_lin_upper[l]?p-=this.limit_lin_upper[l]:X.mul(t,t,0),this.limit_lin_lower[l]==this.limit_lin_upper[l]?this.linConstraint.lim[l]=1:this.linConstraint.lim[l]=0,X.madd(this.linConstraint.offset,this.linConstraint.offset,t,p)):X.mul(t,t,0),this.use_motor_lin&&0===l&&(this.linConstraint.motorMax=this.motor_lin_max_impulse);X.mul(this.linConstraint.offset,this.linConstraint.offset,pu.ERP),this.use_motor_lin&&X.madd(this.linConstraint.offset,this.linConstraint.offset,this.linConstraint.axis[0],this.motor_lin_target_velocity),Y.getInv(a,u),Y.dot(a,a,s),Y.getEuler(n,a),X.sub(r,this.object2.rotV,this.object1.rotV),q.setValue(o,1,0,0,0),X.setValue(this.angConstraint.bane,0,0,0);for(var v=0;v<pu.DIMENSION;v++){l=v,t=this.angConstraint.axis[l],0===l?X.setValue(t,s[0],s[1],s[2]):2===l?(X.setValue(t,u[3],u[4],u[5]),X.setValue(e,s[0],s[1],s[2]),X.cross(t,e,t)):1===l&&X.setValue(t,u[3],u[4],u[5]),X.norm(t);var y=n[l];if(this.use_spring_ang[l]){var m=this.angConstraint.bane;X.madd(m,m,t,y*this.spring_stiffness_ang[l]*DT),X.madd(m,m,t,X.dot(r,t)*this.spring_damping_ang[l]*DT)}this.use_limit_ang[l]?(y<this.limit_ang_lower[l]?(y=this.limit_ang_lower[l]-y,X.mul(t,t,-1)):y>this.limit_ang_upper[l]?y-=this.limit_ang_upper[l]:X.mul(t,t,0),q.fromRotVector(i,y,t[0],t[1],t[2]),q.qdot(o,o,i)):X.mul(t,t,0),this.use_motor_ang&&0===l&&(this.angConstraint.motorMax=this.motor_ang_max_impulse)}q.toTorque(this.angConstraint.offset,o),X.mul(this.angConstraint.offset,this.angConstraint.offset,pu.ERP),this.use_motor_ang&&X.madd(this.angConstraint.offset,this.angConstraint.offset,this.angConstraint.axis[0],this.motor_ang_target_velocity),c.fix||(c.impFlg=!0),f.fix||(f.impFlg=!0),X.free(3),q.free(2),Y.free(1),z.free(2)}},{key:"calcConstraintPre",value:function(){this.linConstraint.calcConstraintPre(),this.angConstraint.calcConstraintPre()}},{key:"calcConstraint",value:function(){this.linConstraint.calcConstraint(),this.angConstraint.calcConstraint()}},{key:"bane",value:function(){this.angConstraint.addImpulseR(this.angConstraint.bane)}}]),t}();function Ti(t){return Ti="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Ti(t)}function ki(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,Mi(r.key),r)}}function Mi(t){var e=function(t){if("object"!=Ti(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var n=e.call(t,"string");if("object"!=Ti(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==Ti(e)?e:e+""}var Ri=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.rotV=new X,this.oldrotV=new X,this.type=0,this.impFlg=!1,this.points=[]}return function(t,e){e&&ki(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1})}(t,[{key:"addImpulse",value:function(){}},{key:"addImpulseR",value:function(){}}]),t}();function Ii(t){return Ii="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Ii(t)}function Ai(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,Ci(r.key),r)}}function Ci(t){var e=function(t){if("object"!=Ii(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var n=e.call(t,"string");if("object"!=Ii(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==Ii(e)?e:e+""}function Fi(t,e){return Fi=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},Fi(t,e)}function Ni(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(t){}return(Ni=function(){return!!t})()}function Bi(t){return Bi=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},Bi(t)}Math.min;var Ui=Math.max,Li=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&Fi(t,e)}(n,t);var e=function(t){var e=Ni();return function(){var n,r=Bi(t);if(e){var o=Bi(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return function(t,e){if(e&&("object"==Ii(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(this,n)}}(n);function n(){var t;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,n),(t=e.call(this)).name,t.type=pu.RIGID,t.fix=1,t.moveflg=1,t.matrix=new z,t.inv_matrix=new z,t.collision=null,t.collisionSize=new X,t.mass=1,t.inv_mass=0,t.COMBase=new X,t.COM=new X,t.inertiaTensorBase=new Y,t.inertiaTensor=new Y,t.inv_inertiaTensor=new Y,t.friction=.2,t.restitution=0,t.location=new X,t.scale=new X,t.rotq=new q,t.v=new X,t.oldv=new X,t}return function(t,e){e&&Ai(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1})}(n,[{key:"calcPre",value:function(){var t=X.alloc(),e=Y.alloc(),n=this.matrix;z.fromLSR(n,this.location,this.scale,this.rotq),Y.dotVec3(t,this.inertiaTensor,this.rotV),q.toMat33(e,this.rotq),Y.dot(this.inertiaTensor,e,this.inertiaTensorBase),Y.getInv(e,e),Y.dot(this.inertiaTensor,this.inertiaTensor,e),Y.getInv(this.inv_inertiaTensor,this.inertiaTensor),Y.dotVec3(this.rotV,this.inv_inertiaTensor,t),q.rotVec3(this.COM,this.rotq,this.COMBase),X.add(this.COM,this.COM,this.location),this.refreshCollision(),X.free(1),Y.free(1)}},{key:"refreshInertia",value:function(){if(this.collision){var t=this.collision.type,e=this.parent.object,n=e.bound_box.max[0]*e.scale[0],r=e.bound_box.max[1]*e.scale[1],o=e.bound_box.max[2]*e.scale[2];switch(Y.mul(this.inertiaTensorBase,this.inertiaTensorBase,0),X.setValue(this.COMBase,0,0,0),t){case Yo.CAPSULE:case Yo.CYLINDER:var i=2*r,a=(x=Ui(n,o))*x/4+i*i/12;this.inertiaTensorBase[0]=a,this.inertiaTensorBase[4]=.5*x*x,this.inertiaTensorBase[8]=a;break;case Yo.CUBOID:this.inertiaTensorBase[0]=1/3*(r*r+o*o),this.inertiaTensorBase[4]=1/3*(n*n+o*o),this.inertiaTensorBase[8]=1/3*(n*n+r*r);break;case Yo.CONE:var u=Ui(n,r),s=3/80*(4*u*u+4*o*o),c=.3*u*u;this.inertiaTensorBase[0]=s,this.inertiaTensorBase[4]=s,this.inertiaTensorBase[8]=c,X.setValue(this.COMBase,0,0,.5*-o);break;case Yo.CONVEX_HULL:case Yo.MESH:var f=this.mesh.faces,l=this.mesh.vertices,h=0,p=X.alloc();X.setValue(p,0,0,0);for(var v=X.alloc(),y=X.alloc(),m=X.alloc(),b=X.alloc(),d=Y.alloc(),g=0;g<f.length;g++)for(var w=0;w<f[g].idxnum-2;w++){X.vecmul(y,l[f[g].idx[0]].pos,e.scale),X.vecmul(m,l[f[g].idx[1+w]].pos,e.scale),X.vecmul(b,l[f[g].idx[2+w]].pos,e.scale);var _=(y[1]*m[2]*b[0]+y[2]*m[0]*b[1]+y[0]*m[1]*b[2]-y[2]*m[1]*b[0]-y[0]*m[2]*b[1]-y[1]*m[0]*b[2])*(1/6);X.add(v,y,m),X.add(v,v,b),X.mul(v,v,.25),Di(d,y,m,b),X.madd(p,p,v,_),h+=_,Y.madd(this.inertiaTensorBase,this.inertiaTensorBase,d,_)}0!==h&&(h=1/h),X.mul(this.COMBase,p,h),Y.mul(this.inertiaTensorBase,this.inertiaTensorBase,h),Vi(d,this.COMBase),Y.madd(this.inertiaTensorBase,this.inertiaTensorBase,d,-1),X.free(5),Y.free(1);break;case Yo.SPHERE:default:var x;g=.4*(x=Ui(n,Ui(r,o)))*x,this.inertiaTensorBase[0]=g,this.inertiaTensorBase[4]=g,this.inertiaTensorBase[8]=g}this.inv_mass=1/this.mass,1===this.fix&&(this.mass=9999999,this.inv_mass=0),Y.mul(this.inertiaTensorBase,this.inertiaTensorBase,this.mass)}}},{key:"refreshCollision",value:function(){this.matrix;var t=this.collision;if(t){var e=this.collisionSize[0]*this.scale[0],n=this.collisionSize[1]*this.scale[1],r=this.collisionSize[2]*this.scale[2];switch(t.bold=this.bold,t.type){case Yo.SPHERE:var o=Ui(Ui(e,n),r);t.bold+=o,e=n=r=0;break;case Yo.CAPSULE:o=Math.max(e,r),n=Math.max(n-o,0),t.bold+=o;break;case Yo.MESH:case Yo.CONVEX_HULL:for(var i=this.mesh.vertices,a=0;a<i.length;a++);var u=q.alloc();q.setValue(u,this.rotq[0],-this.rotq[1],-this.rotq[2],-this.rotq[3]),q.free(1),e=this.scale[0],n=this.scale[1],r=this.scale[2]}var s=X.alloc();X.setValue(s,e,n,r),z.fromLSR(t.matrix,this.location,s,this.rotq),X.free(1),this.fix?t.notgroups=1:t.notgroups=0,t.refresh()}}},{key:"update",value:function(t){if(!this.fix){var e=q.alloc(),n=X.alloc();X.mul(this.rotV,this.rotV,this.onophy.ANGDAMP);var r=X.scalar(this.rotV);if(r>0){var o=1/r;q.fromRotVector(e,r*t,this.rotV[0]*o,this.rotV[1]*o,this.rotV[2]*o),q.qdot(this.rotq,e,this.rotq),X.sub(n,this.COM,this.location),q.rotVec3(n,e,n),X.sub(n,this.COM,n),X.sub(n,n,this.location),X.add(this.location,this.location,n)}X.mul(this.v,this.v,this.onophy.LINDAMP),X.madd(this.location,this.location,this.v,t),this.impFlg=0,q.free(1),X.free(1)}}},{key:"calcEfficM",value:function(t,e){var n=X.alloc(),r=Y.alloc();X.sub(n,e,this.COM),Y.setValue(r,0,n[2],-n[1],-n[2],0,n[0],n[1],-n[0],0),Y.dot(t,r,this.inv_inertiaTensor),Y.dot(t,t,r),Y.mul(t,t,-1),t[0]+=this.inv_mass,t[4]+=this.inv_mass,t[8]+=this.inv_mass,X.free(1),Y.free(1)}},{key:"calcVelocity",value:function(t,e){X.sub(t,e,this.COM),X.cross(t,this.rotV,t),X.add(t,t,this.v)}},{key:"addImpulse",value:function(t,e){if(!this.fix){X.madd(this.v,this.v,e,this.inv_mass);var n=X.alloc();X.sub(n,t,this.COM),X.cross(n,n,e),Y.dotVec3(n,this.inv_inertiaTensor,n),X.add(this.rotV,this.rotV,n),X.free(1)}}},{key:"addImpulse2",value:function(t,e){if(!this.fix){var n,r,o=X.alloc(),i=X.alloc(),a=X.alloc();if(X.mul(o,e,this.inv_mass),n=X.scalar(o),X.sub(a,t,this.COM),X.cross(i,a,e),Y.dotVec3(i,this.inv_inertiaTensor,i),X.cross(a,a,i),n+(r=X.scalar(a))){var u=1/(n+r);n*=u,r*=u,X.madd(this.v,this.v,o,n),X.madd(this.rotV,this.rotV,i,r)}X.free(3)}}},{key:"addImpulseR",value:function(t){if(!this.fix){var e=X.alloc();Y.dotVec3(e,this.inv_inertiaTensor,t),X.add(this.rotV,this.rotV,e),X.free(1)}}},{key:"getExPos",value:function(t,e){z.getInv(this.inv_matrix,this.matrix),z.dotVec3(t,this.inv_matrix,e)}},{key:"getFriction",value:function(){return this.friction}},{key:"getRestitution",value:function(){return this.restitution}},{key:"getInvInertiaTensor",value:function(){return this.inv_inertiaTensor}}]),n}(Ri),Vi=function(t,e){var n=e[0],r=e[1],o=e[2];t[0]=r*r+o*o,t[1]=-n*r,t[2]=-n*o,t[3]=-r*n,t[4]=n*n+o*o,t[5]=-r*o,t[6]=-o*n,t[7]=-o*r,t[8]=n*n+r*r},Di=function(t,e,n,r){var o=e[0]+n[0]+r[0],i=e[0]*e[0]+n[0]*n[0]+r[0]*r[0],a=e[0]*e[1]+n[0]*n[1]+r[0]*r[1],u=e[1]+n[1]+r[1],s=e[1]*e[1]+n[1]*n[1]+r[1]*r[1],c=e[1]*e[2]+n[1]*n[2]+r[1]*r[2],f=e[2]+n[2]+r[2],l=e[2]*e[2]+n[2]*n[2]+r[2]*r[2],h=e[2]*e[0]+n[2]*n[0]+r[2]*r[0];t[0]=u*u+s+f*f+l,t[1]=-(o*u+a),t[2]=-(o*f+h),t[3]=-(o*u+a),t[4]=o*o+i+f*f+l,t[5]=-(u*f+c),t[6]=-(o*f+h),t[7]=-(u*f+c),t[8]=o*o+i+u*u+s,Y.mul(t,t,.05)};function Gi(t){return Gi="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Gi(t)}function zi(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,Xi(r.key),r)}}function Xi(t){var e=function(t){if("object"!=Gi(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var n=e.call(t,"string");if("object"!=Gi(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==Gi(e)?e:e+""}function Hi(t,e){return Hi=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},Hi(t,e)}function qi(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(t){}return(qi=function(){return!!t})()}function Yi(t){return Yi=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},Yi(t)}Math.min,Math.max;var Wi=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&Hi(t,e)}(n,t);var e=function(t){var e=qi();return function(){var n,r=Yi(t);if(e){var o=Yi(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return function(t,e){if(e&&("object"==Gi(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(this,n)}}(n);function n(){var t;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,n),(t=e.call(this)).p=new Array(3),t.face=null,t.bold=0,t.cloth=null,t.ratio=new X,t.type=pu.FACE,t}return function(t,e){e&&zi(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1})}(n,[{key:"calcVelocity",value:function(t){X.mul(t,this.p[0].v,this.ratio[0]),X.madd(t,t,this.p[1].v,this.ratio[1]),X.madd(t,t,this.p[2].v,this.ratio[2])}},{key:"addImpulse",value:function(t,e){for(var n=0;n<pu.DIMENSION;n++)this.p[n].fix||X.madd(this.p[n].v,this.p[n].v,e,this.ratio[n]*this.cloth.inv_mass)}},{key:"addImpulse2",value:function(t,e){for(var n=0;n<pu.DIMENSION;n++)this.p[n].fix||X.madd(this.p[n].v,this.p[n].v,e,this.ratio[n]*this.cloth.inv_mass)}},{key:"calcEfficM",value:function(t){for(var e=0,n=0;n<3;n++)this.p[n].fix||(e+=this.ratio[n]*this.ratio[n]);e*=this.cloth.inv_mass,t[0]=t[4]=t[8]=e,t[1]=t[2]=t[3]=t[5]=t[6]=t[7]=0}},{key:"getFriction",value:function(){return this.cloth.friction}},{key:"getRestitution",value:function(){return this.cloth.restitution}},{key:"getInvInertiaTensor",value:function(){return Y.ZERO}},{key:"getExPos",value:function(t,e){X.copy(t,this.ratio)}}]),n}(Ri);function Qi(t){return Qi="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Qi(t)}function $i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function Ji(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,Zi(r.key),r)}}function Ki(t,e,n){return e&&Ji(t.prototype,e),n&&Ji(t,n),Object.defineProperty(t,"prototype",{writable:!1}),t}function Zi(t){var e=function(t){if("object"!=Qi(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var n=e.call(t,"string");if("object"!=Qi(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==Qi(e)?e:e+""}function ta(t,e){return ta=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},ta(t,e)}function ea(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function na(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(t){}return(na=function(){return!!t})()}function ra(t){return ra=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},ra(t)}var oa=Math.min,ia=Math.max,aa=new Yo.Triangle,ua=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&ta(t,e)}(n,t);var e=function(t){var e=na();return function(){var n,r=ra(t);if(e){var o=ra(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return function(t,e){if(e&&("object"==Qi(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return ea(t)}(this,n)}}(n);function n(t,r,o){var i;$i(this,n),(i=e.call(this)).type=pu.CLOTH,i.bold=.015,i.points=[],i.edges=[],i.bends=[],i.faces=[],i.facesSort=[],i.air_damping=0,i.vel_damping=0,i.restitution=0,i.friction=.1,i.inv_pointMass,i.tension={},i.bending={},i.tension.stiffness=0,i.tension.damping=0,i.bending.stiffness=0,i.bending.damping=5;for(var a=0;a<t;a++)i.points.push(new sa),i.points[a].cloth=ea(i);for(a=0;a<r;a++){var u=new ca;u.cloth=ea(i),u.setting=i.tension,i.edges.push(u)}for(a=0;a<o;a++)i.faces.push(new fa),i.faces[a].cloth=ea(i),i.facesSort.push(i.faces[a]);return i.aabb=new An,i}return Ki(n,[{key:"addBend",value:function(t,e){var n,r,o=this.bends;if(t===e)return 0;for(n=0,r=o.length;n<r;n++)if(o[n].point1===t&&o[n].point2===e||o[n].point1===e&&o[n].point2===t)return 0;for(n=0,r=this.edges.length;n<r;n++)if(this.edges[n].point1===t&&this.edges[n].point2===e||this.edges[n].point1===e&&this.edges[n].point2===t)return 0;var i=new ca;return o.push(i),i.cloth=this,i.point1=t,i.point2=e,i.setting=this.bending,1}},{key:"init",value:function(){for(var t=this.edges,e=0;e<t.length;e++)for(var n=e+1;n<t.length;n++)t[e].point1===t[n].point1?this.addBend(t[e].point2,t[n].point2):this.edges[e].point1===t[n].point2?this.addBend(t[e].point2,t[n].point1):t[e].point2===t[n].point1?this.addBend(t[e].point1,t[n].point2):this.edges[e].point2===t[n].point2&&this.addBend(t[e].point1,t[n].point1);for(e=0;e<this.bends.length;e++)this.bends[e].len=X.len(this.bends[e].point1.location,this.bends[e].point2.location);this.inv_pointMass=1/this.mass,this.bending.damping/=15,this.tension.damping/=15}},{key:"rayCast",value:function(t,e,n){for(var r=this.faces,o=(this.points999,9999999),i=0;i<r.length;i++){var a=r[i];if(An.hitCheckLine(a.aabb,e,n)){a.points[0].location,a.points[1].location,a.points[2].location;var u=Wn.TRIANGLE_LINE(a.points[0].location,a.points[1].location,a.points[2].location,e,n);u<o&&(o=u,t.face=a,t.p1=a.points[0],t.p2=a.points[1],t.p3=a.points[2]),4===a.idxnum&&(u=Wn.TRIANGLE_LINE(a.points[0].location,a.points[2].location,a.points[3].location,e,n))<o&&(o=u,t.face=a,t.p1=a.points[0],t.p2=a.points[2],t.p3=a.points[3])}}return o}},{key:"getPhyFace",value:function(t,e,r,o,i){var a=n.disablePhyFace.pop(),u=new X,s=new X;a.cloth=this,a.face=o,a.p[0]=t,a.p[1]=e,a.p[2]=r,X.sub(u,e.location,t.location),X.sub(s,r.location,t.location),X.cross(u,u,s);for(var c=[t.location,e.location,r.location,t.location,e.location],f=0;f<3;f++){X.sub(s,c[f+2],c[f+1]),X.cross(s,u,s);var l=X.dot(s,c[f+1]),h=X.dot(s,c[f]),p=X.dot(s,i);a.ratio[f]=(l-p)/(l-h)}return a}},{key:"calcPre",value:function(t){var e=this;if(this.edges.forEach(function(t){t.calcPre(e.onophy.dt,0)}),this.bends.forEach(function(t){t.calcPre(e.onophy.dt,0)}),this.use_collision){this.aabb.min.set(this.points[0].location),this.aabb.max.set(this.points[0].location);for(var n=0;n<this.faces.length;n++){4===(u=this.faces[n]).idxnum?An.createFromPolygon(u.aabb,u.points[0].location,u.points[1].location,u.points[2].location,u.points[3].location):An.createFromPolygon(u.aabb,u.points[0].location,u.points[1].location,u.points[2].location);for(var r=0;r<3;r++)u.aabb.min[r]-=this.bold,u.aabb.max[r]+=this.bold;for(r=0;r<3;r++)this.aabb.min[r]=oa(this.aabb.min[r],u.aabb.min[r]),this.aabb.max[r]=ia(this.aabb.max[r],u.aabb.max[r])}this.facesSort.sort(function(t,e){return t.aabb.min[0]-e.aabb.min[0]});var o=t.collider.aabbSorts[0];aa.bold=this.bold;var i=new X,a=new X;for(new X,new X,n=0;n<o.length;n++)if(null!==o[n].parent&&o[n].type!==Yo.MESH){if(o[n].aabb.min[0]>this.aabb.max[0])break;if(An.hitCheck(o[n].aabb,this.aabb))for(r=0;r<this.faces.length;r++){var u=this.faces[r];if(An.hitCheck(u.aabb,o[n].aabb))for(var s=0;s<u.idxnum-2;s++)if(X.copy(aa.poses[0],u.points[0].location),X.copy(aa.poses[1],u.points[1].location),X.copy(aa.poses[2],u.points[2].location),aa.aabb=u.aabb,Yo.calcClosest(i,a,o[n],aa)<0){var c=this.getPhyFace(u.points[0],u.points[1+s],u.points[2+s],u,a);t.registHitConstraint(o[n].parent,i,c,a)}}}}}},{key:"calcConstraintPre",value:function(){var t=this;this.edges.forEach(function(e){e.calcConstraintPre(t.mass)}),this.bends.forEach(function(e){e.calcConstraintPre(t.mass)})}},{key:"calcConstraint",value:function(){for(var t=this,e=0;e<5;e++)this.edges.forEach(function(e){e.calcConstraint(t.mass)}),this.bends.forEach(function(e){e.calcConstraint(t.mass)})}},{key:"update",value:function(t){for(var e=0;e<this.points.length;e++)this.points[e].update(t,this.mass)}},{key:"calcCollision",value:function(t,e){if(An.hitCheck(t.aabb,this.aabb)){var n=new Yo.Triangle,r=new Yo.Triangle;n.bold=this.bold,r.bold=t.bold;for(var o,i,a,u,s=X.alloc(),c=X.alloc(),f=X.alloc(),l=X.alloc(),h=0,p=0;p<this.facesSort.length;p++){var v=99999,y=this.facesSort[p];n.aabb=y.aabb;for(var m=h;m<t.facesSort.length;m++){var b=t.facesSort[m];if(y.aabb.min[0]>b.aabb.max[0])h=m;else{if(y.aabb.max[0]<b.aabb.min[0])break;if(An.hitCheck(y.aabb,b.aabb)){r.aabb=b.aabb;for(var d=0;d<y.idxnum-2;d++){n.poses[0]=y.points[0].location,n.poses[1]=y.points[1+d].location,n.poses[2]=y.points[2+d].location;for(var g=0;g<b.idxnum-2;g++){r.poses[0]=b.points[0].location,r.poses[1]=b.points[1+g].location,r.poses[2]=b.points[2+g].location;var w=Yo.calcClosest(s,c,n,r);w<v&&(v=w,o=y,i=b,a=d,u=g,X.copy(f,s),X.copy(l,c))}}}}}if(v<0){y=o,b=i;var _=this.getPhyFace(y.points[0],y.points[1+a],y.points[2+a],y,f),x=this.getPhyFace(b.points[0],b.points[1+u],b.points[2+u],b,l);e.registHitConstraint(_,f,x,l)}}X.free(4)}}}]),n}(Li),sa=function(){var t=function(){this.v=new X,this.location=new X,this.fix=!1};return t.prototype.update=function(t){this.fix||(X.madd(this.location,this.location,this.v,t),this.v[1]-=this.cloth.onophy.GRAVITY*t)},t}(),ca=function(){function t(){$i(this,t),this.point1=null,this.point2=null,this.impulse=0,this.len,this.n=new X,this.offset=0,this.cloth=null}return Ki(t,[{key:"calcPre",value:function(t){var e=X.alloc();this.cloth.mass,X.sub(e,this.point2.location,this.point1.location);var n=X.scalar(e);X.nrm(this.n,e),n=this.len-n,this.offset=10*Math.abs(n),this.l=n,X.sub(e,this.point2.v,this.point1.v),n=X.dot(e,this.n),X.free(1)}},{key:"calcConstraintPre",value:function(){var t=X.alloc();X.mul(t,this.n,this.impulse),this.point1.fix||this.point2.fix||X.mul(t,t,.5),this.point1.fix||X.add(this.point1.v,this.point1.v,t),this.point2.fix||X.sub(this.point2.v,this.point2.v,t),X.free(1)}},{key:"calcConstraint",value:function(t){var e=X.alloc(),n=X.alloc(),r=this.impulse;X.sub(e,this.point2.v,this.point1.v),this.impulse+=X.dot(e,this.n)*(1*this.setting.damping)+this.setting.stiffness*-this.l,this.impulse>this.offset&&(this.impulse=this.offset),this.impulse<-this.offset&&(this.impulse=-this.offset),this.impulse*=.9,X.mul(n,this.n,this.impulse-r),this.point1.fix||this.point2.fix||X.mul(n,n,.5),this.point1.fix||X.add(this.point1.v,this.point1.v,n),this.point2.fix||X.sub(this.point2.v,this.point2.v,n),X.free(2)}}]),t}(),fa=Ki(function t(){$i(this,t),this.points=[null,null,null],this.aabb=new An,this.cloth=null});function la(t){return la="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},la(t)}function ha(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function pa(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,ya(r.key),r)}}function va(t,e,n){return e&&pa(t.prototype,e),n&&pa(t,n),Object.defineProperty(t,"prototype",{writable:!1}),t}function ya(t){var e=function(t){if("object"!=la(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var n=e.call(t,"string");if("object"!=la(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==la(e)?e:e+""}function ma(t,e){return ma=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},ma(t,e)}function ba(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function da(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(t){}return(da=function(){return!!t})()}function ga(t){return ga=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},ga(t)}ua.Point=sa,ua.Face=fa;var wa=Math.min,_a=Math.max,xa=new Yo.ConvexHull;xa.poses=new Array(3);var ja=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&ma(t,e)}(n,t);var e=function(t){var e=da();return function(){var n,r=ga(t);if(e){var o=ga(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return function(t,e){if(e&&("object"==la(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return ba(t)}(this,n)}}(n);function n(t,r,o){var i;ha(this,n),(i=e.call(this)).type=pu.CLOTH,i.bold=.015,i.points=[],i.edges=[],i.faces=[],i.facesSort=[],i.air_damping=0,i.vel_damping=0,i.restitution=0,i.friction=.1,i.inv_mass,i.tension={},i.bending={},i.tension.stiffness=0,i.tension.damping=0,i.bending.stiffness=0,i.bending.damping=5;for(var a=0;a<t;a++)i.points.push(new Oa),i.points[a].cloth=ba(i);for(a=0;a<r;a++){var u=new Sa;u.cloth=ba(i),u.setting=i.tension,i.edges.push(u)}for(a=0;a<o;a++)i.faces.push(new Ea),i.faces[a].cloth=ba(i),i.facesSort.push(i.faces[a]);return i.aabb=new An,i}return va(n,[{key:"addBend",value:function(t,e){if(t===e)return 0;if(this.edges.some(function(n){return n.point1===t&&n.point2===e||n.point1===e&&n.point2===t}))return 0;var n=new Sa;return n.cloth=this,n.point1=t,n.point2=e,n.setting=this.bending,n.len=X.len(t.location,e.location),this.edges.push(n),1}},{key:"init",value:function(){for(var t=this.edges,e=t.length,n=0;n<e;n++)for(var r=n+1;r<e;r++)t[n].point1===t[r].point1?this.addBend(t[n].point2,t[r].point2):this.edges[n].point1===t[r].point2?this.addBend(t[n].point2,t[r].point1):t[n].point2===t[r].point1?this.addBend(t[n].point1,t[r].point2):this.edges[n].point2===t[r].point2&&this.addBend(t[n].point1,t[r].point1);this.inv_mass=1/this.mass,this.tension.stiffness*=1e3*this.inv_mass,this.bending.stiffness*=1e3*this.inv_mass,this.tension.damping*=this.inv_mass,this.bending.damping*=this.inv_mass}},{key:"rayCast",value:function(t,e,n){for(var r=this.faces,o=(this.points999,9999999),i=0;i<r.length;i++){var a=r[i];if(An.hitCheckLine(a.aabb,e,n)){a.points[0].location,a.points[1].location,a.points[2].location;var u=Wn.TRIANGLE_LINE(a.points[0].location,a.points[1].location,a.points[2].location,e,n);u<o&&(o=u,t.face=a,t.p1=a.points[0],t.p2=a.points[1],t.p3=a.points[2]),4===a.idxnum&&(u=Wn.TRIANGLE_LINE(a.points[0].location,a.points[2].location,a.points[3].location,e,n))<o&&(o=u,t.face=a,t.p1=a.points[0],t.p2=a.points[2],t.p3=a.points[3])}}return o}},{key:"getPhyFace",value:function(t,e,n,r,o){var i=ua.disablePhyFace.pop(),a=new X,u=new X;i.cloth=this,i.face=r,i.p[0]=t,i.p[1]=e,i.p[2]=n,X.sub(a,e.location,t.location),X.sub(u,n.location,t.location),X.cross(a,a,u);for(var s=[t.location,e.location,n.location,t.location,e.location],c=0;c<3;c++){X.sub(u,s[c+2],s[c+1]),X.cross(u,a,u);var f=X.dot(u,s[c+1]),l=X.dot(u,s[c]),h=X.dot(u,o);i.ratio[c]=(f-h)/(f-l)}return i}},{key:"calcPre",value:function(t){for(var e=this,n=t.dt/5,r=0;r<5;r++)this.edges.forEach(function(t){t.calcPre(n)}),this.points.forEach(function(t){t.update(n)});if(this.use_collision){this.aabb.min.set(this.points[0].location),this.aabb.max.set(this.points[0].location);for(var o=1;o<this.faces.length;o++){var i=this.faces[o];4===i.idxnum?An.createFromPolygon(i.aabb,i.points[0].location,i.points[1].location,i.points[2].location,i.points[3].location):An.createFromPolygon(i.aabb,i.points[0].location,i.points[1].location,i.points[2].location);for(var a=0;a<3;a++)i.aabb.min[a]-=this.bold,i.aabb.max[a]+=this.bold;for(a=0;a<3;a++)this.aabb.min[a]=wa(this.aabb.min[a],i.aabb.min[a]),this.aabb.max[a]=_a(this.aabb.max[a],i.aabb.max[a])}var u=t.collider.aabbSorts[0];xa.bold=this.bold;var s=X.alloc(),c=X.alloc(),f=X.alloc();u.forEach(function(n){if(null!==n.parent)return n.aabb.min[0]>e.aabb.max[0]?0:void(An.hitCheck(n.aabb,e.aabb)&&e.faces.forEach(function(r){if(An.hitCheck(r.aabb,n.aabb))for(var o=0;o<r.idxnum-2;o++)if(xa.poses[0]=r.points[0].location,xa.poses[1]=r.points[1+o].location,xa.poses[2]=r.points[2+o].location,xa.aabb=r.aabb,Yo.calcClosest(s,c,n,xa)<0&&(X.cross2(f,xa.poses[0],xa.poses[1],xa.poses[2]),X.dot(f,s)<X.dot(f,c))){var i=e.getPhyFace(r.points[0],r.points[1+o],r.points[2+o],r,c);t.registHitConstraint(n.parent,s,i,c)}}))}),X.free(3)}}},{key:"calcConstraintPre",value:function(){}},{key:"calcConstraint",value:function(){}},{key:"update",value:function(t){}}]),n}(Li),Oa=function(){var t=function(){this.v=new X,this.location=new X,this.fix=!1};return t.prototype.addImpulse=function(t){this.fix||X.add(this.v,this.v,t)},t.prototype.update=function(t){this.fix||(X.madd(this.location,this.location,this.v,t),this.v[1]-=this.cloth.onophy.GRAVITY*t)},t}(),Sa=function(){function t(){ha(this,t),this.point1=null,this.point2=null,this.len,this.cloth=null}return va(t,[{key:"calcPre",value:function(t){var e=X.alloc(),n=X.alloc(),r=0;X.sub(e,this.point2.location,this.point1.location),X.normalize(n,e),r=(X.scalar(e)-this.len)*this.setting.stiffness,X.sub(e,this.point2.v,this.point1.v),r+=X.dot(e,n)*this.setting.damping,X.mul(e,n,r*t),this.point1.addImpulse(e),X.mul(e,e,-1),this.point2.addImpulse(e),X.free(2)}}]),t}(),Ea=va(function t(){ha(this,t),this.points=[null,null,null],this.aabb=new An,this.cloth=null});function Pa(t){return Pa="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Pa(t)}function Ta(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function ka(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,Ra(r.key),r)}}function Ma(t,e,n){return e&&ka(t.prototype,e),n&&ka(t,n),Object.defineProperty(t,"prototype",{writable:!1}),t}function Ra(t){var e=function(t){if("object"!=Pa(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var n=e.call(t,"string");if("object"!=Pa(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==Pa(e)?e:e+""}function Ia(t,e){return Ia=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},Ia(t,e)}function Aa(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function Ca(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(t){}return(Ca=function(){return!!t})()}function Fa(t){return Fa=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},Fa(t)}ja.Point=Oa,ja.Face=Ea,Math.min,Math.max;var Na=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&Ia(t,e)}(n,t);var e=function(t){var e=Ca();return function(){var n,r=Fa(t);if(e){var o=Fa(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return function(t,e){if(e&&("object"==Pa(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return Aa(t)}(this,n)}}(n);function n(t,r,o){var i;Ta(this,n),(i=e.call(this)).type=pu.CLOTH,i.bold=.015,i.points=[],i.edges=[],i.bends=[],i.faces=[],i.facesSort=[],i.structual_stiffness=400,i.bending_stiffness=0,i.spring_damping=5,i.air_damping=0,i.vel_damping=0,i.restitution=0,i.friction=.1;for(var a=0;a<t;a++)i.points.push(new ua.Point),i.points[a].cloth=Aa(i);for(a=0;a<r;a++)i.edges.push(new Ba),i.edges[a].cloth=Aa(i);for(a=0;a<o;a++)i.faces.push(new ua.Face),i.faces[a].cloth=Aa(i),i.facesSort.push(i.faces[a]);return i.aabb=new An,i}return Ma(n,[{key:"init",value:function(){for(var t=this.points,e=this.edges,n=0;n<t.length;n++)q.set(t[n].rotq,1,0,0,0);for(n=0;n<e.length;n++)X.sub(e[n].sabun,e[n].point2.location,e[n].point1.location),X.mul(e[n].sabun,e[n].sabun,.5),e[n].point1.rotq[0]*=-1,q.rotVec3(e[n].sabun,e[n].point1.rotq,e[n].sabun),e[n].point1.rotq[0]*=-1;this.inv_pointMass=1/(this.mass/this.points.length)}},{key:"calcPre",value:function(t){ua.prototype.calcPre.call(this,t)}},{key:"calcConstraintPre",value:function(){}},{key:"calcConstraint",value:function(t){}}]),n}(ua),Ba=function(){function t(){Ta(this,t),this.point1=null,this.point2=null,this.len,this.sabun=new X,this.cloth=null,this.impulse=0,this.n=new X}return Ma(t,[{key:"calcPre",value:function(){var t=X.alloc(),e=X.alloc(),n=X.alloc(),r=X.alloc(),o=q.alloc();q.rotVec3(t,this.point1.rotq,this.sabun),q.rotVec3(e,this.point2.rotq,this.sabun),X.add(n,t,e),X.sub(n,this.point2.location,n),X.sub(n,n,this.point1.location);var i=X.scalar(n);0!==i&&(i*=3e3*this.cloth.push,X.mul(r,n,1/i),X.sub(n,this.point2.v,this.point1.v),i+=X.dot(n,r)*this.cloth.damping,X.mul(r,r,i*this.cloth.inv_pointMass*this.cloth.onophy.dt),this.point1.fix||(X.add(this.point1.v,this.point1.v,r),X.cross(n,t,r),X.add(this.point1.rotV,this.point1.rotV,n)),this.point2.fix||(X.mul(r,r,-1),X.add(this.point2.v,this.point2.v,r),X.mul(n,e,-1),X.cross(n,n,r),X.add(this.point2.rotV,this.point2.rotV,n))),q.qmdot(o,this.point2.rotq,this.point1.rotq,-1),q.toTorque(r,o),X.mul(r,r,this.cloth.onophy.DT*this.cloth.inv_pointMass*this.cloth.bending_stiffness*2),X.add(this.point1.rotV,this.point1.rotV,r),X.sub(this.point2.rotV,this.point2.rotV,r),X.mul(this.point1.rotV,this.point1.rotV,.999),X.mul(this.point2.rotV,this.point2.rotV,.999),q.free(1),X.free(4)}}]),t}();function Ua(t){return Ua="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Ua(t)}function La(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,Va(r.key),r)}}function Va(t){var e=function(t){if("object"!=Ua(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var n=e.call(t,"string");if("object"!=Ua(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==Ua(e)?e:e+""}var Da=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.defaultLength=0,this.k=1,this.c=0,this.p0=new X,this.p1=new X,this._p0=new X,this._p1=new X,this.con1Obj=null,this.con1Pos=new X,this.con2Obj=null,this.con2Pos=new X}return function(t,e){e&&La(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1})}(t,[{key:"calc",value:function(t){var e=X.alloc(),n=X.alloc(),r=X.alloc();if(this.con1?(z.dotVec3(this.p0,this.con1.matrix,this.con1Pos),this.con1.calcVelocity(n,this.p0)):X.sub(n,this.p0,this._p0),this.con2){if(this.con2.type===pu.FACE){X.set(this.p1,0,0,0);for(var o=0;o<3;o++)X.madd(this.p1,this.p1,this.con2.p[o].location,this.con2.ratio[o])}else z.dotVec3(this.p1,this.con2.matrix,this.con2Pos);this.con2.calcVelocity(e,this.p1)}else X.sub(e,this.p1,this._p1);X.sub(e,e,n),X.sub(n,this.p1,this.p0);var i=-this.defaultLength+X.scalar(n);X.normalize(r,n);var a=this.c*X.dot(e,r),u=i*this.f;X.mul(r,r,(a+u)*t),this.con1&&this.con1.addImpulse2(this.p0,r),this.con2&&(X.mul(r,r,-1),this.con2.addImpulse2(this.p1,r)),X.copy(this._p0,this.p0),X.copy(this._p1,this.p1),X.free(3)}}]),t}();function Ga(t){return Ga="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Ga(t)}function za(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,Xa(r.key),r)}}function Xa(t){var e=function(t){if("object"!=Ga(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var n=e.call(t,"string");if("object"!=Ga(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==Ga(e)?e:e+""}var Ha=new z,qa=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.location=new X,this.locationV=new X,this.idx=-1,this.idx_diff=new X,this.C=new Y,this.C.fill(0),this.type=1}return function(t,e){e&&za(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1})}(t,[{key:"getInvInertiaTensor",value:function(){return z.mul(Ha,Ha,0),Ha}},{key:"getFriction",value:function(){return 0}},{key:"getExPos",value:function(t,e){X.copy(t,e)}},{key:"addImpulseR",value:function(t){}},{key:"addImpulse",value:function(t,e){var n=this,r=e[0]*this.inv_mass,o=e[1]*this.inv_mass,i=e[2]*this.inv_mass;n.idx<0?X.mul(n.locationV,e,this.inv_mass):this.domain.neighborhoods(n,function(t,e,n,a,u,s){var c=n*e._mass;e.locationV[0]+=c*r,e.locationV[1]+=c*o,e.locationV[2]+=c*i})}},{key:"getRestitution",value:function(){return 0}},{key:"calcEfficM",value:function(t,e){Y.mul(t,t,0),t[0]+=this.inv_mass,t[4]+=this.inv_mass,t[8]+=this.inv_mass}},{key:"calcVelocity",value:function(t,e){var n=this,r=this.domain,o=r.grid,i=r.grid_res,a=Math.pow(i,2);t[0]=n.locationV[0],t[1]=n.locationV[1],t[2]=n.locationV[2],n.idx<0||this.domain.neighborhoods(n,function(e,n,r,u,s,c){if(!n.fix){var f=n.idx,l=n.locationV[0],h=n.locationV[1],p=n.locationV[2],v=o[f-1],y=o[f+1],m=o[f-i],b=o[f+i],d=o[f-a],g=o[f+a];l+=(v.pressure-n.pressure)*v.w_x-(y.pressure-n.pressure)*n.w_x,h+=(m.pressure-n.pressure)*m.w_y-(b.pressure-n.pressure)*n.w_y,p+=(d.pressure-n.pressure)*d.w_z-(g.pressure-n.pressure)*n.w_z,t[0]+=l*r,t[1]+=h*r,t[2]+=p*r}})}}]),t}();function Ya(t){return Ya="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Ya(t)}function Wa(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,Qa(r.key),r)}}function Qa(t){var e=function(t){if("object"!=Ya(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var n=e.call(t,"string");if("object"!=Ya(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==Ya(e)?e:e+""}qa.prototype.rotV=new X,qa.prototype.hitflg=1,Math.min,Math.max;var $a=function(){function t(e,n){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.onophy=null,this.location=new X,this.field_size=new X,X.copy(this.location,e),X.copy(this.field_size,n);var r=Math.max(Math.max(this.field_size[0],this.field_size[1]),this.field_size[2]);this.grid_res=16,this.cell_size=r/this.grid_res,this._cell_size=1/this.cell_size,this.particle_size=this.cell_size/2,this.density=1e3,this.particles=[],this.phash=[],qa.prototype.mass=4/3*Math.PI*Math.pow(this.particle_size,3)*this.density,qa.prototype.size=this.particle_size,qa.prototype.inv_mass=1/qa.prototype.mass,this.grid=[],this.grid_enable=[];for(var o=this.grid_res,i=Math.pow(o,2),a=0;a<o;a++)for(var u=0;u<o;u++)for(var s=0;s<o;s++){var c=new au;c.idx=s+u*o+a*i,(s<=0||s>=o-1||u<=0||u>=o-1||a<=0||a>=o-1)&&(c.fix=1,c.edge=1,c.capacity=0),this.grid.push(c),this.grid_enable.push(c)}var f=[];for(s=0;s<this.grid.length;s++)f.push([]);this.phash=f,this.phash2=new Array(8*this.grid.length)}return function(t,e){e&&Wa(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1})}(t,[{key:"neighborhoods",value:function(t,e){this._cell_size;var n,r=this.grid,o=this.grid_res,i=this.grid_res*this.grid_res,a=t.idx_diff[0],u=t.idx_diff[1],s=t.idx_diff[2],c=a*a,f=u*u,l=s*s,h=.5*(.25-a+c),p=.5*(.25-u+f),v=.5*(.25-s+l),y=.75-c,m=.75-f,b=.75-l,d=h+a,g=p+u,w=v+s,_=t.idx-i-o-1,x=-1-a,j=-1-u,O=-1-s,S=p*v;e(t,r[_],S*h,x,j,O),e(t,r[_+1],S*y,x+1,j,O),e(t,r[_+2],S*d,x+2,j,O),S=m*v,e(t,r[n=_+o],S*h,x,j+1,O),e(t,r[n+1],S*y,x+1,j+1,O),e(t,r[n+2],S*d,x+2,j+1,O),S=g*v,e(t,r[n=_+2*o],S*h,x,j+2,O),e(t,r[n+1],S*y,x+1,j+2,O),e(t,r[n+2],S*d,x+2,j+2,O),S=p*b,e(t,r[n=_+i],S*h,x,j,O+1),e(t,r[n+1],S*y,x+1,j,O+1),e(t,r[n+2],S*d,x+2,j,O+1),S=m*b,e(t,r[n=_+o+i],S*h,x,j+1,O+1),e(t,r[n+1],S*y,x+1,j+1,O+1),e(t,r[n+2],S*d,x+2,j+1,O+1),S=g*b,e(t,r[n=_+2*o+i],S*h,x,j+2,O+1),e(t,r[n+1],S*y,x+1,j+2,O+1),e(t,r[n+2],S*d,x+2,j+2,O+1),S=p*w,e(t,r[n=_+2*i],S*h,x,j,O+2),e(t,r[n+1],S*y,x+1,j,O+2),e(t,r[n+2],S*d,x+2,j,O+2),S=m*w,e(t,r[n=_+o+2*i],S*h,x,j+1,O+2),e(t,r[n+1],S*y,x+1,j+1,O+2),e(t,r[n+2],S*d,x+2,j+1,O+2),S=g*w,e(t,r[n=_+2*o+2*i],S*h,x,j+2,O+2),e(t,r[n+1],S*y,x+1,j+2,O+2),e(t,r[n+2],S*d,x+2,j+2,O+2)}},{key:"createParticle",value:function(t){var e=new qa;return X.copy(e.location,t),e.domain=this,this.particles.push(e),e}},{key:"preProcess",value:function(t,e){var n=this,r=this.grid,o=this.phash;r.length,this.grid_enable.forEach(function(t){t.mass=0,t.locationV.fill(0);var e=t.idx;o[e].splice(0,o[e].length)}),this.p2g(t),this.calcGrid(t),this.liquidPreProcess(t);var i=new X,a=new X,u=new Yo.Sphere;u.bold=this.particle_size;var s=e.rigidBodies,c=(this.particles,new X),f=new X,l=this.grid_res,h=Math.pow(l,2);s.forEach(function(t){X.sub(c,t.collision.aabb.min,n.location),X.sub(f,t.collision.aabb.max,n.location),X.mul(c,c,n._cell_size),X.mul(f,f,n._cell_size);for(var r=0;r<3;r++)c[r]=Math.max(0,(0|c[r])-1),f[r]=Math.min(l-1,1+(0|f[r]));for(var s=c[2];s<=f[2];s++)for(var p=c[1];p<=f[1];p++)for(var v=c[0];v<=f[0];v++)o[s*h+p*l+v].forEach(function(n){if(u.matrix[9]=n.location[0],u.matrix[10]=n.location[1],u.matrix[11]=n.location[2],u.refresh(),Yo.calcClosest(i,a,u,t.collision)<0){var r=e.registHitConstraint(n,i,t,a);r&&e.readjustHitConstraint(r)}})})}},{key:"afterProcess",value:function(t){this.liquidAfterProcess(t),this.g2p(t,0)}},{key:"p2g",value:function(t){var e=this.phash,n=this.particles,r=(this.cell_size,this.field_size[0],this.field_size[1],this.field_size[2],this._cell_size),o=this.grid_res,i=Math.pow(this.grid_res,2);this.grid,this.phash2.fill(0);for(var a=n.length,u=0;u<a;u++){var s=n[u],c=(s.location[0]-this.location[0])*r,f=(s.location[1]-this.location[1])*r,l=(s.location[2]-this.location[2])*r;if(c<1||c>=o-1||f<1||f>=o-1||l<1||l>=o-1)s.idx=-1;else{s.idx_diff[0]=c-(0|c)-.5,s.idx_diff[1]=f-(0|f)-.5,s.idx_diff[2]=l-(0|l)-.5;var h=(c|=0)+(f|=0)*o+(l|=0)*i;s.idx=h,e[h].push(s),this.p2gFunc(s),s.locationV.fill(0)}}}},{key:"p2gFunc",value:function(t){for(var e=this.grid,n=this.grid_res,r=this.grid_res*this.grid_res,o=t.idx_diff[0],i=t.idx_diff[1],a=t.idx_diff[2],u=o*o,s=i*i,c=a*a,f=.5*(.25-o+u),l=.5*(.25-i+s),h=.5*(.25-a+c),p=.75-u,v=.75-s,y=.75-c,m=f+o,b=l+i,d=h+a,g=t.idx-r-n-1,w=-1-o,_=-1-i,x=-1-a,j=t.C,O=this.p2gSub,S=t.locationV[0]+j[0]*w+j[3]*_+j[6]*x,E=t.locationV[1]+j[1]*w+j[4]*_+j[7]*x,P=t.locationV[2]+j[2]*w+j[5]*_+j[8]*x,T=0;T<3;T++){j=t.C;var k=[h,y,d][T],M=l*k,R=g+T*r,I=S+j[6]*T,A=E+j[7]*T,C=P+j[8]*T;O(t,e[R],M*f,I,A,C),O(t,e[R+1],M*p,I+j[0],A+j[1],C+j[2]),O(t,e[R+2],M*m,I+2*j[0],A+2*j[1],C+2*j[2]),I+=j[3],A+=j[4],C+=j[5],M=v*k,O(t,e[R+=n],M*f,I,A,C),O(t,e[R+1],M*p,I+j[0],A+j[1],C+j[2]),O(t,e[R+2],M*m,I+2*j[0],A+2*j[1],C+2*j[2]),M=b*k,I+=j[3],A+=j[4],C+=j[5],O(t,e[R+=n],M*f,I,A,C),O(t,e[R+1],M*p,I+j[0],A+j[1],C+j[2]),O(t,e[R+2],M*m,I+2*j[0],A+2*j[1],C+2*j[2])}}},{key:"p2gSub",value:function(t,e,n,r,o,i){e.mass+=n,e.locationV[0]+=n*r,e.locationV[1]+=n*o,e.locationV[2]+=n*i}},{key:"liquidPreProcess",value:function(t){var e=this,n=1/6;this.grid_enable.splice(0,this.grid_enable.length);var r=this.cell_size,o=r/t,i=this.grid_res,a=Math.pow(this.grid_res,2),u=this.grid,s=r*r*r*this.density,c=-1;u.forEach(function(t){if(c++,!(t.fix||(t.m_x=0,t.m_y=0,t.m_z=0,t.w_x=0,t.w_y=0,t.w_z=0,t.w=0,t.coef_x=0,t.coef_y=0,t.coef_z=0,t.capacity<=0))){var r=u[c-1],f=u[c+1],l=u[c-i],h=u[c+i],p=u[c-a],v=u[c+a],y=t.mass+f.mass,m=t.mass+h.mass,b=t.mass+v.mass;if(t.m_x=y,t.m_y=m,t.m_z=b,0!==y&&(t.w_x=1/y),0!==m&&(t.w_y=1/m),0!==b&&(t.w_z=1/b),t.capacity&&f.capacity&&(t.coef_x=.5*(t.capacity+f.capacity)),t.capacity&&h.capacity&&(t.coef_y=.5*(t.capacity+h.capacity)),t.capacity&&v.capacity&&(t.coef_z=.5*(t.capacity+v.capacity)),t.m_x*=t.coef_x,t.m_y*=t.coef_y,t.m_z*=t.coef_z,t.w_x*=t.coef_x,t.w_y*=t.coef_y,t.w_z*=t.coef_z,r.w_x+t.w_x+l.w_y+t.w_y+t.w_z+p.w_z!==0){t.gap=(t.mass-s*t.capacity)*o;var d=r.coef_x+t.coef_x+l.coef_y+t.coef_y+t.coef_z+p.coef_z;0!==d&&(e.grid_enable.push(t),d=1/d,t.w=d,t.m_x*=n,t.m_y*=n,t.m_z*=n,t.gap<0||t.capacity<1?t.pressure=0:t.pressure*=.5)}}})}},{key:"liquidAfterProcess",value:function(t){var e=this.grid,n=this.grid_res,r=Math.pow(n,2);this.grid_enable.forEach(function(t){var o=t.idx,i=e[o-1],a=e[o+1],u=e[o-n],s=e[o+n],c=e[o-r],f=e[o+r];t.locationV[0]+=(i.pressure-t.pressure)*i.w_x-(a.pressure-t.pressure)*t.w_x,t.locationV[1]+=(u.pressure-t.pressure)*u.w_y-(s.pressure-t.pressure)*t.w_y,t.locationV[2]+=(c.pressure-t.pressure)*c.w_z-(f.pressure-t.pressure)*t.w_z})}},{key:"calcGrid",value:function(t){for(var e=this.grid,n=Ja*t,r=e.length,o=0;o<r;o++){var i=e[o];i.mass<1e-4||i.fix?(i.mass=0,i._mass=0,i.locationV.fill(0),i.pressure=0):(i._mass=1/i.mass,i.locationV[0]*=i._mass,i.locationV[1]*=i._mass,i.locationV[2]*=i._mass,i.locationV[1]-=n,i.mass>.5&&(this.phash2[o]=!0),i.mass*=qa.prototype.mass)}}},{key:"g2p",value:function(t,e){var n=this,r=this.phash,o=this.particles,i=new X,a=new X,u=[1,1,1];X.mad(i,this.location,u,this.cell_size+this.particle_size),X.add(a,this.location,this.field_size),X.mad(a,a,u,-this.cell_size-this.particle_size);for(var s=1/t,c=r.length,f=this.particle_size,l=(Math.pow(f,2),this.grid_res),h=Math.pow(l,2),p=0;p<c;p++)for(var v=r[p],y=v.length,m=0;m<y;m++){for(var b=v[m],d=m+1;d<y;d++){var g=v[d];this.kasanariFunc(b,g)}r[p+1].forEach(function(t){n.kasanariFunc(b,t)}),r[p+l].forEach(function(t){n.kasanariFunc(b,t)}),r[p+h].forEach(function(t){n.kasanariFunc(b,t)}),r[p+h+l].forEach(function(t){n.kasanariFunc(b,t)}),r[p+1+l].forEach(function(t){n.kasanariFunc(b,t)}),r[p+1+h].forEach(function(t){n.kasanariFunc(b,t)}),r[p+1+h+l].forEach(function(t){n.kasanariFunc(b,t)})}for(p=0;p<o.length;p++){var w=(b=o[p]).C;for(b.idx>=0&&(b.locationV,w.fill(0),this.neighborhoods(b,this.g2pFunc),Y.mul(w,w,4)),m=0;m<3;m++){var _=b.location[m];b.location[m]+=b.locationV[m]*t;var x=i[m];b.location[m]<x&&(b.location[m]=x,b.locationV[m]=(b.location[m]-_)*s),x=a[m],b.location[m]>x&&(b.location[m]=x,b.locationV[m]=(b.location[m]-_)*s)}}}},{key:"kasanariFunc",value:function(t,e){var n=this.particle_size,r=Math.pow(n,2),o=t.location[0]-e.location[0],i=t.location[1]-e.location[1],a=t.location[2]-e.location[2];if(o*o+i*i+a*a<r){var u=o*o+i*i+a*a;0!==u&&(u=(n-(u=Math.sqrt(u)))/u*10),o*=u,i*=u,a*=u,t.locationV[0]+=o,t.locationV[1]+=i,t.locationV[2]+=a,e.locationV[0]-=o,e.locationV[1]-=i,e.locationV[2]-=a}}},{key:"g2pFunc",value:function(t,e,n,r,o,i){var a=e.locationV[0]*n,u=e.locationV[1]*n,s=e.locationV[2]*n;t.locationV[0]+=a,t.locationV[1]+=u,t.locationV[2]+=s;var c=t.C;c[0]+=a*r,c[1]+=u*r,c[2]+=s*r,c[3]+=a*o,c[4]+=u*o,c[5]+=s*o,c[6]+=a*i,c[7]+=u*i,c[8]+=s*i}},{key:"solvProcess",value:function(t){new X,new X,new X;var e=this.grid,n=this.grid_res,r=Math.pow(n,2);this.grid_enable.forEach(function(t){var o=t.idx,i=e[o-1],a=e[o+1],u=e[o-n],s=e[o+n],c=e[o-r],f=e[o+r],l=t.gap-(-(i.locationV[0]+t.locationV[0])*i.m_x+(a.locationV[0]+t.locationV[0])*t.m_x-(u.locationV[1]+t.locationV[1])*u.m_y+(s.locationV[1]+t.locationV[1])*t.m_y-(c.locationV[2]+t.locationV[2])*c.m_z+(f.locationV[2]+t.locationV[2])*t.m_z);t.pressure=(+i.pressure*i.coef_x+a.pressure*t.coef_x+u.pressure*u.coef_y+s.pressure*t.coef_y+c.pressure*c.coef_z+f.pressure*t.coef_z+l)*t.w,t.pressure=Math.max(t.pressure,0)})}},{key:"calcViscosity",value:function(t){for(var e=this.grid_res,n=this.grid,r=1;r<e-1;r++)for(var o=1;o<e-1;o++)if(0!==(h=n[l=r*e+o]).mass){var i=n[l-1],a=n[l+1],u=n[l-e],s=n[l+e],c=i.mass+a.mass+u.mass+s.mass+h.mass;if(0!==c&&0!==h.mass){c=1/c;var f=h.locationV2;X.mul(f,h.locationV,h.mass),X.mad(f,f,i.locationV,i.mass),X.mad(f,f,a.locationV,a.mass),X.mad(f,f,u.locationV,u.mass),X.mad(f,f,s.locationV,s.mass),X.mul(f,f,c)}else X.mul(f,h.locationV,1)}for(r=1;r<e-1;r++)for(o=1;o<e-1;o++){var l,h=n[l=r*e+o];if(!(Ka<=.01)){var p=Za/Ka;p*=t,X.sub(h.locationV2,h.locationV2,h.locationV),X.mad(h.locationV,h.locationV,h.locationV2,p)}}}}]),t}(),Ja=9.8,Ka=1e3,Za=1,tu=1,eu=function(t,e){this.id=tu,tu++,this.location=new X,this.locationV=new X,this.rotation=0,this.rotationV=0,this.size=t,this.mass=e*this.size*this.size*Math.PI,this.moment=.4*this.mass*this.size*this.size,this.inv_mass=1/this.mass,this.inv_moment=1/this.moment,this.inv_restCoe=5,this.fricCoe=.2,this.type=0,this.hitflg=3,e<0?(this.mass=99999999,this.moment=99999999,this.inv_mass=0,this.inv_moment=0,this.fix=!0):this.fix=!1};eu.prototype.addImpulse=function(t,e){this.inv_mass>0&&(X.mad(this.locationV,this.locationV,e,this.inv_mass),this.rotationV+=X.cross(t,e)*this.inv_moment)},eu.prototype.calcVel=function(t,e){t[0]=this.locationV[0],t[1]=this.locationV[1],t[0]+=-e[1]*this.rotationV,t[1]+=e[0]*this.rotationV};var nu=function(){this.obj1=null,this.obj2=null,this.pos1=new X,this.pos2=new X,this.nVec=new X,this.offset=new X,this.nEffic=0,this.nImpulse=0,this.tVec=new X,this.tEffic=0,this.tImpulse=0,this.restCoe=0,this.fricCoe=0};nu.prototype.calcEffic=function(t){var e=this.obj1,n=this.obj2,r=X.cross(t,this.pos1),o=r*r*e.inv_moment;return r=X.cross(t,this.pos2),0===n.type?(o+=r*r*n.inv_moment,1/(e.inv_mass+n.inv_mass+X.dot(t,this.tVec)*o)):1/(e.inv_mass+n.inv_mass)};var ru=new X;nu.prototype.calcDiffVelocity=function(t){var e=this.obj1,n=this.obj2;e.calcVel(t,this.pos1),n.calcVel(ru,this.pos2),X.sub(t,ru,t)},nu.prototype.addImpulse=function(t){var e=this.obj1,n=this.obj2;e.addImpulse(this.pos1,t),X.mul(t,t,-1),n.addImpulse(this.pos2,t),X.mul(t,t,-1)};for(var ou=[],iu=1024;iu--;)ou.push(new nu);var au=function(){this.locationV=new X,this.locationV2=new X,this.mass=0,this.gap=0,this.pressure=0,this.fix=!1,this.w_x=0,this.w_y=0,this.w_z=0,this.m_x=0,this.m_y=0,this.m_z=0,this.coef_x=0,this.coef_y=0,this.coef_z=0,this.capacity=1,this.count=0,this.hitcount=0,this.edge=0};function uu(t){return uu="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},uu(t)}function su(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,fu(r.key),r)}}function cu(t,e,n){return(e=fu(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function fu(t){var e=function(t){if("object"!=uu(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var n=e.call(t,"string");if("object"!=uu(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==uu(e)?e:e+""}Math.min,Math.max;var lu=0,hu=[];for(lu=0;lu<1024;lu++)hu.push(new oi);var pu=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),cu(this,"createRigidBody",function(){var t=new Li;return t.parent=this,this.rigidBodies.push(t),t}),cu(this,"addPhyObj",function(e){e.onophy=this,e.type===t.RIGID?(this.rigidBodies.push(e),this.collider.addCollision(e.collision)):this.clothes.push(e)}),cu(this,"deleteRigidBody",function(t){for(var e=this.rigidBodies,n=e.length;n--;)if(e[n]===t){t.collision&&this.deleteCollision(t.collision),e.splice(n,1);break}}),cu(this,"createJoint",function(){var t=new Pi;return this.joints.push(t),t}),cu(this,"addJoint",function(t){this.joints.push(t)}),cu(this,"deleteJoint",function(t){for(var e=this.joints,n=e.length;n--;)if(e[n]===t){e.splice(n,1);break}}),cu(this,"add",function(t){t.constructor===Da&&this.springs.push(t)}),cu(this,"remove",function(t){t.constructor===Da&&this.springs.forEach(function(e,n,r){if(e===t)return r.splice(n,1),!1})}),cu(this,"createSpring",function(){var t=new Da;return this.springs.push(t),t}),cu(this,"deleteSpring",function(t){for(var e=this.springs,n=0;n<e.length;n++)if(e[n]===t){e.splice(n,1);break}}),this.rigidBodies=[],this.springs=[],this.clothes=[],this.joints=[],this.repetition=0,this.fluids=[],this.collider=new Yo,this.hitConstraints=[],this.disableList=new Array(1024),this.ANGDAMP=0,this.LINDAMP=0,this.GRAVITY=9.81}return function(t,e){e&&su(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1})}(t,[{key:"init",value:function(){for(var t=this.rigidBodies,e=t.length;e--;){var n=t[e];n.collision&&this.collider.deleteCollision(n.collision),t.splice(e,1)}var r=this.joints;for(e=r.length;e--;)r.splice(e,1);var o=this.springs;for(e=o.length;e--;)o.splice(e,1)}},{key:"removeHitConstraint",value:function(e){var n=this.hitConstraints[e];this.hitConstraints.splice(e,1),n.obj1.type===t.FACE&&ua.disablePhyFace.push(n.obj1),n.obj2.type===t.FACE&&ua.disablePhyFace.push(n.obj2),hu.push(n)}},{key:"readjustHitConstraint",value:function(e){for(var n,r=e.obj1,o=e.obj2,i=e.pos1,a=e.pos2,u=this.hitConstraints,s=u.length;s--;)if(r===(n=u[s]).obj1&&o===n.obj2&&X.len2(n.pos1,i)<.01&&X.len2(n.pos2,a)<.01){if(n===e)continue;X.add(e.impulse,e.impulse,n.impulse),X.add(e.impulseR,e.impulseR,n.impulseR),this.removeHitConstraint(s)}if(r.type===t.RIGID&&o.type===t.RIGID){var c=0;for(s=u.length;s--;)(n=u[s]).obj1===r&&n.obj2===o&&(X.dot(n.axis[0],e.axis[0])<0||++c>8)&&this.removeHitConstraint(s)}}},{key:"registHitConstraint",value:function(t,e,n,r,o){return 0===X.len2(e,r)?null:(o||(o=hu.pop(),this.hitConstraints.push(o),o.obj1=t,o.obj2=n,X.setValue(o.impulse,0,0,0),X.setValue(o.impulseR,0,0,0)),X.copy(o.pos1,e),X.copy(o.pos2,r),X.sub(o.axis[0],r,e),X.norm(o.axis[0]),o.counter=0,o)}},{key:"calc",value:function(e){var n=this;this.DT=e,this.dt=e;var r=this.rigidBodies;for(new X,i=this.rigidBodies.length;i--;)this.rigidBodies[i].calcPre();for(var o=0,i=0;i<this.joints.length;i++)this.joints[i].disable_collisions&&(this.disableList[o]=Yo.getPairId(this.joints[i].object1.collision.id,this.joints[i].object2.collision.id),o++);this.disableList[o]=-1,this.collider.All(this.disableList,o);var a=this.collider.hitList;for(i=0;a[i].col1;i++){var u=a[i];u.col1.parent&&u.col2.parent&&(v=this.registHitConstraint(u.col1.parent,u.pos1,u.col2.parent,u.pos2))&&this.readjustHitConstraint(v)}for(this.joints.forEach(function(t){t.setConstraint()}),this.joints.forEach(function(t){t.bane()}),this.springs.forEach(function(t){t.calc(e)}),this.clothes.forEach(function(t){t.calcPre(n)}),i=0;i<this.clothes.length;i++)for(var s=i+1;s<this.clothes.length;s++);var c,f=new X,l=new X,h=new X,p=new X;for(this.hitConstraints.forEach(function(e){var r=e,o=r.obj1,i=r.obj2;if(0!==r.counter){if(o.type!==t.RIGID||i.type!==t.RIGID)return o.type===t.FACE&&ua.disablePhyFace.push(r.obj1),i.type===t.FACE&&ua.disablePhyFace.push(r.obj2),void(r.obj1=null);var a,u;z.dotVec3(f,o.matrix,r.pos1ex),X.sub(p,f,r.axis[0]),(a=i.collision.rayCast(f,p))===Yo.INVALID&&(a=999),X.madd(l,f,r.axis[0],-a),z.dotVec3(h,i.matrix,r.pos2ex),X.add(p,h,r.axis[0]),(u=o.collision.rayCast(h,p))===Yo.INVALID&&(u=999),u<a&&(X.copy(l,h),X.madd(f,l,r.axis[0],u),a=u),a>=0?r.obj1=null:n.registHitConstraint(o,f,i,l,r)}}),i=this.hitConstraints.length;i--;){var v;(v=this.hitConstraints[i]).obj1||(this.hitConstraints.splice(i,1),hu.push(v))}for(i=this.rigidBodies.length;i--;){var y=r[i];y.fix||(y.v[1]+=-this.GRAVITY*e)}this.fluids.forEach(function(t){t.preProcess(e,n)}),performance.mark("impulseStart");var m=[];for(Array.prototype.push.apply(m,this.hitConstraints),Array.prototype.push.apply(m,this.joints),this.clothes,i=0;i<m.length;i++)m[i].calcConstraintPre();for(c=0;c<10;c++){for(i=0;i<m.length;i++)m[i].calcConstraint();this.fluids.forEach(function(t){t.solvProcess(e)})}this.fluids.forEach(function(t){t.afterProcess(e)}),this.clothes.forEach(function(t){t.calcConstraintPre()}),this.clothes.forEach(function(t){t.calcConstraint()}),this.repetition=c,performance.mark("impulseEnd"),this.LINDAMP=.96,this.ANGDAMP=.96,this.LINDAMP=Math.pow(this.LINDAMP,e),this.ANGDAMP=Math.pow(this.ANGDAMP,e),this.rigidBodies.forEach(function(t){t.update(e)}),this.clothes.forEach(function(t){t.update(e)})}}]),t}();cu(pu,"CFM",.99),cu(pu,"ERP",10),pu.RigidBody=Li,pu.Joint=Pi,pu.RIGID=lu++,pu.CLOTH=lu++,pu.FACE=lu++,pu.Spring_MESH=lu++;var vu=ua.disablePhyFace=[];for(lu=0;lu<1024;lu++)vu.push(new Wi);function yu(t){return yu="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},yu(t)}function mu(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function bu(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,gu(r.key),r)}}function du(t,e,n){return e&&bu(t.prototype,e),n&&bu(t,n),Object.defineProperty(t,"prototype",{writable:!1}),t}function gu(t){var e=function(t){if("object"!=yu(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var n=e.call(t,"string");if("object"!=yu(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==yu(e)?e:e+""}pu.DIMENSION=3,pu.Cloth=ua,pu.Cloth2=ja,pu.SoftBody=Na;var wu=0,_u=function(){function t(){mu(this,t),this.nodes=[],this.rootNode}return du(t,[{key:"getItem",value:function(t){wu=0;var e=this.rootNode.getItem(t);return this.searchCount=wu,e}},{key:"_createBspTree",value:function(t,e,n){var r,o=this.nodes;t===e?r=o[t]:(r=new ju.Node,this.nodes.push(r));for(var i=o[t].element.calcSupportReverse(n),a=t+1;a<=e;a++){var u=o[a].element.calcSupportReverse(n);u<i&&(i=u)}if(r.collision.m=i,X.copy(r.collision.v,n),t===e)return r;var s=(e+t)/2|0,c=new X,f=new X,l=-99999;for(a=t;a<=e;a++)for(var h=o[a].element,p=0;p<4;p++){X.normalize(f,h.bsps[p].v);for(var v=t;v<=e;v++)(b=o[v]).rsupport=b.element.calcSupportReverse(f),b.support=b.element.calcSupport(f);Qe.qSort(o,t,e,function(t,e){return t.rsupport-e.rsupport||t.support-e.support}),X.mul(f,f,-1);var y=o[t].element.calcSupportReverse(f);for(v=t+1;v<=s;v++){var m=o[v].element.calcSupportReverse(f);m<y&&(y=Math.min(y,m))}l<(y=o[s+1].collision.m+y)&&(l=y,X.mul(c,f,-1))}for(v=t;v<=e;v++){var b;(b=o[v]).rsupport=b.element.calcSupportReverse(c),b.support=b.element.calcSupport(c)}return Qe.qSort(o,t,e,function(t,e){return t.rsupport-e.rsupport||t.support-e.support}),r.child2=this._createBspTree(s+1,e,c),X.mul(c,c,-1),r.child1=this._createBspTree(t,s,c),r}}]),t}(),xu=function(){function t(){mu(this,t),this.child1=null,this.child2=null,this.element=null,this.collision=new ju}return du(t,[{key:"getItem",value:function(t){if(wu++,this.element){for(var e=this.element.bsps,n=0;n<4;n++)if(X.dot(e[n].v,t)-e[n].m<0)return null;return this.element}return this.collision.hitCheck(t)?this.child1.getItem(t)||this.child2.getItem(t):null}}]),t}(),ju=function(){function t(){mu(this,t),this.m=0,this.v=new X}return du(t,[{key:"hitCheck",value:function(t){return this.m<=X.dot(t,this.v)}}],[{key:"createBspTree",value:function(e){for(var n=new t.Tree,r=new X,o=0;o<e.length;o++){var i=new t.Node;i.element=e[o],n.nodes.push(i);for(var a=e[o],u=a.bsps=[],s=0;s<4;s++){var c=a.p[s+1&3],f=a.p[s+2&3],l=a.p[s+3&3],h=a.p[s];X.cross2(r,l,f,c);var p=X.dot(r,c),v=X.dot(r,h);v=1/(v-p);var y=new t;X.mul(y.v,r,v),y.m=p*v,u.push(y)}}var m=new X(1,0,0);return n.rootNode=n._createBspTree(0,n.nodes.length-1,m),n}}]),t}();ju.Tree=_u,ju.Node=xu;var Ou=function(){var t={},e=t,n=function(){this.pIdx=[-1,-1,-1,-1],this.p=[-1,-1,-1,-1],this.center=new X,this.r=0};return n.prototype.calcSupport=function(t){for(var e=X.dot(this.p[0],t),n=1;n<4;n++)e=Math.max(e,X.dot(this.p[n],t));return e},n.prototype.calcSupportReverse=function(t){for(var e=X.dot(this.p[0],t),n=1;n<4;n++)e=Math.min(e,X.dot(this.p[n],t));return e},e.create=function(t){var e=[];if(0===t.length)return e;var r=new X,o=new X;X.copy(r,t[0]),X.copy(o,t[0]);for(var i=1;i<t.length;i++)r[0]=Math.min(r[0],t[i][0]),r[1]=Math.min(r[1],t[i][1]),r[2]=Math.min(r[2],t[i][2]),o[0]=Math.max(o[0],t[i][0]),o[1]=Math.max(o[1],t[i][1]),o[2]=Math.max(o[2],t[i][2]);var a=new X;X.sub(a,o,r);var u=10*X.scalar(a);X.madd(a,r,a,.5),t.push(new X),X.setValue(t[t.length-1],a[0]+u,a[1]-u,a[2]+u),t.push(new X),X.setValue(t[t.length-1],a[0]-u,a[1]-u,a[2]+u),t.push(new X),X.setValue(t[t.length-1],a[0],a[1]+u,a[2]+u),t.push(new X),X.setValue(t[t.length-1],a[0],a[1],a[2]-u);var s,c=new n,f=t.length;c.pIdx[0]=f-4,c.pIdx[1]=f-3,c.pIdx[2]=f-2,c.pIdx[3]=f-1,Wn.getOuterCenter3(c.center,t[c.pIdx[0]],t[c.pIdx[1]],t[c.pIdx[2]],t[c.pIdx[3]]),c.r=X.len2(c.center,t[c.pIdx[0]]),e.push(c);var l=function(t){for(var e=0;e<s.length;e++){var n=s[e];if(n.pIdx[0]==t.pIdx[2]&&n.pIdx[1]==t.pIdx[1]&&n.pIdx[2]==t.pIdx[0]||n.pIdx[0]==t.pIdx[1]&&n.pIdx[1]==t.pIdx[0]&&n.pIdx[2]==t.pIdx[2]||n.pIdx[0]==t.pIdx[0]&&n.pIdx[1]==t.pIdx[2]&&n.pIdx[2]==t.pIdx[1]||n.pIdx[2]==t.pIdx[2]&&n.pIdx[1]==t.pIdx[1]&&n.pIdx[0]==t.pIdx[0]||n.pIdx[2]==t.pIdx[1]&&n.pIdx[1]==t.pIdx[0]&&n.pIdx[0]==t.pIdx[2]||n.pIdx[2]==t.pIdx[0]&&n.pIdx[1]==t.pIdx[2]&&n.pIdx[0]==t.pIdx[1])return void s.splice(e,1)}s.push(t)};for(i=0;i<t.length-4;i++){s=[];for(var h=e.length;h--;)if(c=e[h],X.len2(c.center,t[i])<c.r-.01){for(var p=[0,1,2,3,0,1],v=0;v<4;v++)(y=new n).pIdx[0]=c.pIdx[p[v]],y.pIdx[1]=c.pIdx[p[v+1]],y.pIdx[2]=c.pIdx[p[v+2]],y.pIdx[3]=i,l(y);e.splice(h,1)}for(h=0;h<s.length;h++)c=s[h],Wn.getOuterCenter3(c.center,t[c.pIdx[0]],t[c.pIdx[1]],t[c.pIdx[2]],t[c.pIdx[3]]),isNaN(c.center[0])||(c.r=X.len2(c.center,t[c.pIdx[0]]),e.push(c))}for(f=t.length-4,h=e.length;h--;)((c=e[h]).pIdx[0]>=f||c.pIdx[1]>=f||c.pIdx[2]>=f||c.pIdx[3]>=f)&&e.splice(h,1);t.splice(f,4);var y=new X,m=new X;for(h=e.length;h--;){if(c=e[h],X.cross2(y,t[c.pIdx[0]],t[c.pIdx[1]],t[c.pIdx[2]]),X.sub(m,t[c.pIdx[3]],t[c.pIdx[0]]),X.dot(y,m)>0){var b=c.pIdx[0];c.pIdx[0]=c.pIdx[1],c.pIdx[1]=b}for(i=0;i<4;i++)c.p[i]=t[c.pIdx[i]]}return e},t}(),Su=Ou;function Eu(t){return Eu="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Eu(t)}function Pu(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,ku(r.key),r)}}function Tu(t,e,n){return e&&Pu(t.prototype,e),n&&Pu(t,n),Object.defineProperty(t,"prototype",{writable:!1}),t}function ku(t){var e=function(t){if("object"!=Eu(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var n=e.call(t,"string");if("object"!=Eu(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==Eu(e)?e:e+""}var Mu=Tu(function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.name="",this.blend_method="OPAQUE",this.baseColor=new X,X.setValue(this.baseColor,1,1,1),this.baseColorMap="",this.opacity=1,this.specular=0,this.metallic=0,this.roughness=0,this.ior=1,this.subRoughness=0,this.radiant_energy=0,this.pbrMap="",this.heightMap="",this.heightMapPower=0,this.heightBase=.5,this.lightMap="",this.uv="",this.fresnel=0,this.shader="",this.uvOffset=[0,0]}),Ru=1,Iu=2,Au=3,Cu=4;function Fu(t){return Fu="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Fu(t)}function Nu(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,Uu(r.key),r)}}function Bu(t,e,n){return e&&Nu(t.prototype,e),n&&Nu(t,n),Object.defineProperty(t,"prototype",{writable:!1}),t}function Uu(t){var e=function(t){if("object"!=Fu(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var n=e.call(t,"string");if("object"!=Fu(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==Fu(e)?e:e+""}var Lu=Bu(function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.name="",this.bones=[]});function Vu(t){return Vu="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Vu(t)}function Du(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,zu(r.key),r)}}function Gu(t,e,n){return e&&Du(t.prototype,e),n&&Du(t,n),Object.defineProperty(t,"prototype",{writable:!1}),t}function zu(t){var e=function(t){if("object"!=Vu(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var n=e.call(t,"string");if("object"!=Vu(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==Vu(e)?e:e+""}Lu.prototype.objecttype=Iu;var Xu=Gu(function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.name="",this.data=[]});function Hu(t){return Hu="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Hu(t)}function qu(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,Wu(r.key),r)}}function Yu(t,e,n){return e&&qu(t.prototype,e),n&&qu(t,n),Object.defineProperty(t,"prototype",{writable:!1}),t}function Wu(t){var e=function(t){if("object"!=Hu(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var n=e.call(t,"string");if("object"!=Hu(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==Hu(e)?e:e+""}var Qu=Yu(function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.name="",this.parent="",this.length=0,this.matrix=new z,this.matrix_local=new z,this.i_matrix_local=new z});function $u(t){return $u="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},$u(t)}function Ju(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,Zu(r.key),r)}}function Ku(t,e,n){return e&&Ju(t.prototype,e),n&&Ju(t,n),Object.defineProperty(t,"prototype",{writable:!1}),t}function Zu(t){var e=function(t){if("object"!=$u(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var n=e.call(t,"string");if("object"!=$u(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==$u(e)?e:e+""}var ts=Ku(function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.name="",this.type="",this.color=new X,this.energy=0,this.viewmatrix=new J,this.angle=0,this.use_shaodw=!1});function es(t){return es="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},es(t)}function ns(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,os(r.key),r)}}function rs(t,e,n){return e&&ns(t.prototype,e),n&&ns(t,n),Object.defineProperty(t,"prototype",{writable:!1}),t}function os(t){var e=function(t){if("object"!=es(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var n=e.call(t,"string");if("object"!=es(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==es(e)?e:e+""}var is=rs(function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.name="",this.name_full="",this.library="",this.use_auto_smooth=0,this.auto_smooth_angle=0,this.vertices=[],this.colors=[],this.shcoefs=[],this.shapeKeys=[],this.faces=[],this.edges=[],this.flg=0,this.uv_layers=[]});is.prototype.objecttype=Ru;var as=0,us=1;function ss(t){return ss="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},ss(t)}function cs(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,fs(r.key),r)}}function fs(t){var e=function(t){if("object"!=ss(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var n=e.call(t,"string");if("object"!=ss(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==ss(e)?e:e+""}var ls=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.location=new X,this.rotation_mode=as,this.rotation=new q,this.scale=new X,this.constraints=[],X.setValue(this.location,0,0,0),X.setValue(this.rotation,0,0,0,0),X.setValue(this.scale,1,1,1)}return function(t,e,n){e&&cs(t.prototype,e),n&&cs(t,n),Object.defineProperty(t,"prototype",{writable:!1})}(t,[{key:"reset",value:function(){X.setValue(this.location,0,0,0),X.setValue(this.rotation,0,0,0,0),X.setValue(this.scale,1,1,1)}}],[{key:"copy",value:function(t,e){X.copy(t.location,e.location),X.copy(t.scale,e.scale),q.copy(t.rotation,e.rotation)}},{key:"add",value:function(t,e,n){X.add(t.location,e.location,n.location);for(var r=0;r<3;r++)t.scale[r]=e.scale[r]*n.scale[r];q.qdot(t.rotation,e.rotation,n.rotation)}},{key:"blend",value:function(t,e,n,r){this.mul(t,e,1-r),this.mad(t,t,n,r)}},{key:"sub",value:function(t,e,n){X.sub(t.location,e.location,n.location);for(var r=0;r<3;r++)t.scale[r]=e.scale[r]/n.scale[r];q.qmdot(t.rotation,e.rotation,n.rotation)}},{key:"mul",value:function(t,e,n){X.mul(t.location,e.location,n);for(var r=0;r<3;r++)t.scale[r]=(e.scale[r]-1)*n+1;q.qmul(t.rotation,e.rotation,n)}},{key:"mad",value:function(t,e,n,r){X.mad(t.location,e.location,n.location,r);for(var o=0;o<3;o++)t.scale[o]=e.scale[o]*((n.scale[o]-1)*r+1);var i=q.alloc();q.qmul(i,n.rotation,r),q.qdot(t.rotation,i,e.rotation),q.free(1)}}]),t}();function hs(t){return hs="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},hs(t)}function ps(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,vs(r.key),r)}}function vs(t){var e=function(t){if("object"!=hs(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var n=e.call(t,"string");if("object"!=hs(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==hs(e)?e:e+""}var ys=function(){function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.armature=e.data,this.poseBones=[],this.matrices=[];for(var n=0;n<e.data.bones.length;n++)this.poseBones.push(new ls),this.matrices.push(new z)}return function(t,e,n){e&&ps(t.prototype,e),n&&ps(t,n),Object.defineProperty(t,"prototype",{writable:!1})}(t,[{key:"setAction",value:function(t,e,n){for(var r=this.armature,o=this.poseBones,i=0;i<o.length;i++){var a=o[i],u=r.bones[i];Jf.addaction(a,u.name,t,e,n)}}},{key:"reset",value:function(){for(var t=0;t<this.poseBones.length;t++)this.poseBones[t].reset()}}],[{key:"copy",value:function(t,e){for(var n=0;n<e.poseBones.length;n++)ls.copy(t.poseBones[n],e.poseBones[n])}},{key:"add",value:function(t,e,n){for(var r=0;r<e.poseBones.length;r++)ls.add(t.poseBones[r],e.poseBones[r],n.poseBones[r])}},{key:"sub",value:function(t,e,n){for(var r=0;r<e.poseBones.length;r++)ls.sub(t.poseBones[r],e.poseBones[r],n.poseBones[r])}},{key:"blend",value:function(t,e,n,r){for(var o=0;o<e.poseBones.length;o++)ls.blend(t.poseBones[o],e.poseBones[o],n.poseBones[o],r)}},{key:"madd",value:function(t,e,n,r){for(var o=0;o<e.poseBones.length;o++)ls.madd(t.poseBones[o],e.poseBones[o],n.poseBones[o],r)}},{key:"mul",value:function(t,e,n){for(var r=0;r<e.poseBones.length;r++)ls.mul(t.poseBones[r],e.poseBones[r],n)}}]),t}();function ms(t){return ms="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},ms(t)}function bs(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,ds(r.key),r)}}function ds(t){var e=function(t){if("object"!=ms(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var n=e.call(t,"string");if("object"!=ms(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==ms(e)?e:e+""}var gs=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.name="",this.frame_start=0,this.frame_end=0,this.objects=[],this.world=""}return function(t,e){e&&bs(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1})}(t,[{key:"calcMatrix",value:function(t,e){for(var n=0;n<this.objects.length;n++)this.objects[n].resetMatrix();for(n=0;n<this.objects.length;n++)this.objects[n].calcMatrix(t,e)}},{key:"setFrame",value:function(t){for(var e=this.objects,n=(this.o3o,0);n<e.length;n++)e[n].flg=!1;for(n=0;n<e.length;n++)e[n].setFrame(t,!1)}}]),t}();function ws(t){return ws="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},ws(t)}function _s(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,js(r.key),r)}}function xs(t,e,n){return e&&_s(t.prototype,e),n&&_s(t,n),Object.defineProperty(t,"prototype",{writable:!1}),t}function js(t){var e=function(t){if("object"!=ws(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var n=e.call(t,"string");if("object"!=ws(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==ws(e)?e:e+""}var Os=xs(function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.name="",this.name_full="",this.envTexture="",this.color=new X});function Ss(t){return Ss="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Ss(t)}function Es(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,Ts(r.key),r)}}function Ps(t,e,n){return e&&Es(t.prototype,e),n&&Es(t,n),Object.defineProperty(t,"prototype",{writable:!1}),t}function Ts(t){var e=function(t){if("object"!=Ss(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var n=e.call(t,"string");if("object"!=Ss(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==Ss(e)?e:e+""}var ks=Ps(function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.breaking_threshold=0,this.disable_collisions=!1,this.enabled=!1,this.limit_ang_lower=new X,this.limit_ang_upper=new X,this.limit_lin_lower=new X,this.limit_lin_upper=new X,this.motor_ang_max_impulse=1,this.motor_ang_target_velocity=1,this.motor_lin_max_impulse=1,this.motor_lin_target_velocity=1,this.object1=null,this.object2=null,this.spring_damping=new X,this.spring_stiffness=new X,this.spring_damping_ang=new X,this.spring_stiffness_ang=new X,this.use_breaking=0,this.use_limit_ang=new X,this.use_limit_lin=new X,this.use_motor_ang=0,this.use_motor_lin=0,this.use_spring=new X,this.use_spring_ang=new X,this.type=""});function Ms(t){return Ms="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Ms(t)}function Rs(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,As(r.key),r)}}function Is(t,e,n){return e&&Rs(t.prototype,e),n&&Rs(t,n),Object.defineProperty(t,"prototype",{writable:!1}),t}function As(t){var e=function(t){if("object"!=Ms(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var n=e.call(t,"string");if("object"!=Ms(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==Ms(e)?e:e+""}var Cs=Is(function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.type="",this.mass=1,this.collision_shape="",this.friction=.5,this.restitution=0,this.bold=0,this.collision_groups=0});function Fs(t){return Fs="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Fs(t)}function Ns(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,Us(r.key),r)}}function Bs(t,e,n){return e&&Ns(t.prototype,e),n&&Ns(t,n),Object.defineProperty(t,"prototype",{writable:!1}),t}function Us(t){var e=function(t){if("object"!=Fs(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var n=e.call(t,"string");if("object"!=Fs(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==Fs(e)?e:e+""}var Ls=Bs(function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t)});function Vs(t){return Vs="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Vs(t)}function Ds(t,e){return Ds=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},Ds(t,e)}function Gs(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(t){}return(Gs=function(){return!!t})()}function zs(t){return zs=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},zs(t)}Ls.array=function(t){for(var e=this.size,n=new ArrayBuffer(e*t),r=[],o=0;o<t;o++){var i=new this(n,e*o);r.push(i)}return r.buf=new Int8Array(n),r},Ls.size=0;var Xs=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&Ds(t,e)}(n,t);var e=function(t){var e=Gs();return function(){var n,r=zs(t);if(e){var o=zs(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return function(t,e){if(e&&("object"==Vs(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(this,n)}}(n);function n(t,r){var o;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,n),o=e.call(this),t||(t=new ArrayBuffer(n.size),r=0),o.pos=new Float32Array(t,r,3),o.normal=new Float32Array(t,r+12,3),o.groupWeights=new Float32Array(t,r+24,3),o.groupWeights.set([1,0,0]),o.groups=new Int8Array(t,r+36,3),o.groups.set([-1,-1,-1]),o}return function(t){return Object.defineProperty(t,"prototype",{writable:!1}),t}(n)}(Ls);function Hs(t){return Hs="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Hs(t)}function qs(t,e){return qs=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},qs(t,e)}function Ys(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(t){}return(Ys=function(){return!!t})()}function Ws(t){return Ws=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},Ws(t)}Xs.size=40;var Qs=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&qs(t,e)}(n,t);var e=function(t){var e=Ys();return function(){var n,r=Ws(t);if(e){var o=Ws(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return function(t,e){if(e&&("object"==Hs(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(this,n)}}(n);function n(t,r){var o;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,n),o=e.call(this),t||(t=new ArrayBuffer(n.size),r=0),o.idx=new Int16Array(t,r,4),o.idx.set([-1,-1,-1,-1]),o.normal=new Float32Array(t,r+8,3),o.material=null,o.flg=0,o.fs=0,o.mat=-1,o.idxnum=3,o}return function(t){return Object.defineProperty(t,"prototype",{writable:!1}),t}(n)}(Ls);function $s(t){return $s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},$s(t)}function Js(t,e){return Js=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},Js(t,e)}function Ks(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(t){}return(Ks=function(){return!!t})()}function Zs(t){return Zs=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},Zs(t)}Qs.size=28;var tc=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&Js(t,e)}(n,t);var e=function(t){var e=Ks();return function(){var n,r=Zs(t);if(e){var o=Zs(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return function(t,e){if(e&&("object"==$s(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(this,n)}}(n);function n(t,r){var o;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,n),o=e.call(this),t||(t=new ArrayBuffer(n.size),r=0),o.vIndices=new Int16Array(t,r,2),o.fIndices=new Int16Array(t,r+4,2),o.fIndices.set([-1,-1]),o}return function(t){return Object.defineProperty(t,"prototype",{writable:!1}),t}(n)}(Ls);tc.size=8;var ec=4096,nc=new is;nc.ratios=[],nc.vertices=Xs.array(ec),nc.faces=Qs.array(ec),nc.edges=tc.array(ec);for(var rc=0;rc<ec;rc++)nc.ratios.push(new q);var oc=nc;function ic(t){return ic="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},ic(t)}function ac(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,uc(r.key),r)}}function uc(t){var e=function(t){if("object"!=ic(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var n=e.call(t,"string");if("object"!=ic(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==ic(e)?e:e+""}for(var sc=new Mu,cc=new Array(256),fc=[],lc=0;lc<9;lc++)fc.push(new X);var hc=new Array(64),pc=new Array(64),vc=new Array(64);for(lc=pc.length;lc--;)pc[lc]=new z;var yc=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.name="",this.type="",this.hide_render=0,this.visible_camera=1,this.visible_shadow=1,this.data="",this.modifiers=[],this.location=new X,this.scale=new X,this.rotation_mode=us,this.rotation=new q,this.matrix=new z;var e=new An;this.bound_box=e,X.setValue(e.min,-1,-1,-1),X.setValue(e.max,1,1,1),this.bound_type="",this.parent="",this.iparentmatrix=new z,this.parent_bone=null,this.pose=null,this.material_slots=[],this.animation_data=null,this.groups=[],this.rigid_body=new Cs,this.rigid_body_constraint=new ks,this.flg=!1,this.pose=null,this.static=0,this.flg=!1,this.phyObj=null,this.collision=null}return function(t,e){e&&ac(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1})}(t,[{key:"createCollision",value:function(){var t=this;if(!t.show_bounds)return null;var e=null,n=t.bound_type;if(t.rigid_body.type&&(n=t.rigid_body.collision_shape),"SPHERE"==n)e=new Yo.Sphere;else if("BOX"==n)e=new Yo.Cuboid;else if("CYLINDER"==n)e=new Yo.Cylinder;else if("CONE"==n)e=new Yo.Cone;else if("CAPSULE"==n)e=new Yo.Capsule;else if("CONVEX_HULL"==n){var r=t.data;e=new Yo.ConvexHull,r.vertices.forEach(function(t){e.poses.push(t.pos)})}else"MESH"==n&&(r=t.data,e=new Yo.Mesh,r.vertices.forEach(function(t){e.poses.push(t.pos)}),r.faces.forEach(function(t){var n=[];n[0]=e.poses[t.idx[0]],n[1]=e.poses[t.idx[1]],n[2]=e.poses[t.idx[2]],e.triangles.push(n)}),e.createTree());return e?(e.name=t.name,e.obj=this,this.collision=e,t.rigid_body.collision_groups&&(e.groups=t.rigid_body.collision_groups),e):void 0}},{key:"linkCopy",value:function(){var e=new t;return e.name=this.name,e.name_full=this.name_full+"_copy",e.type=this.type,e.objecttype=this.objecttype,e.hide_render=this.hide_render,X.copy(e.location,this.location),X.copy(e.scale,this.scale),this.rotation_mode=this.rotation_mode,q.copy(e.rotation,this.rotation),e.iparentmatrix=this.iparentmatrix,e.data=this.data,e.modifiers=this.modifiers,e.o3o=this.o3o,"ARMATURE"===e.type&&(e.pose=new ys(e)),this.parent&&(e.parent=this.parent.name_full+"_copy"),e.parent_bone=this.parent_bone,e.material_slots=this.material_slots,this.animation_data&&(e.animation_data={},e.animation_data.action=this.animation_data.action,e.animation_data.slot=this.animation_data.slot),e.groups=this.groups,e.show_bounds=this.show_bounds,e.bound_type=this.bound_type,e.createCollision(),e}},{key:"setFrame",value:function(t,e){var n=this;if(this.animation_data)if(this.animation_data.action){var r=this.animation_data.action.slots.find(function(t){return t.name===n.animation_data.slot});if(!r)return;this.addAction(r,t,e,1)}else if(this.animation_data.nla_tracks)for(var o=this.animation_data.nla_tracks,i=0;i<o.length;i++)if(!o[i].mute){var a=o[i].strips;if(a.length){var u=0;for(u=1;u<a.length&&!(t<a[u].frame_start);u++);u>0&&u--;var s=a[u];if(s.action&&(r=s.action.slots.find(function(t){return t.name===s.action_slot}),r)){var c=1;if(t-s.frame_start<s.blend_in&&(c=Math.min(1,(t-s.frame_start)/s.blend_in)),s.frame_end-t<s.blend_out&&(c=Math.max(0,(s.frame_end-t)/s.blend_out)),0!==c){var f;switch(s.extrapolation){case"HOLD":f=Math.max(s.frame_start,t),f=Math.min(s.frame_end,t);break;case"HOLD_FORWARD":f=Math.min(s.frame_end,t);break;default:f=t}s.frame_end<f||s.frame_start>f||this.addAction(r,f-s.frame_start+s.action_frame_start,e,c)}}}}}},{key:"addAction",value:function(t,e,n,r){if(Jf.addaction(this,"",t,e,n,r),this.objecttype===Iu)for(var o=this.data,i=this.pose.poseBones,a=0;a<i.length;a++){var u=i[a],s=o.bones[a];Jf.addaction(u,s.name,t,e,n,r)}}},{key:"resetMatrix",value:function(){if(this.flg=!1,this.objecttype===Iu)for(var t=this.data,e=0;e<t.bones.length;e++)t.bones[e].flg=!1}},{key:"searchObject",value:function(t){if(!this.children)return!1;var e=this.children.find(function(e){return e.object.name===t});return e||(this.children.forEach(function(n){if(e=n.searchObject(t))return!1}),e)}},{key:"calcMatrix",value:function(t,e){var n=this,r=this.matrix,o=this.phyObj;if(this.collision,o&&"PASSIVE"!==n.rigid_body.type&&!e&&o.type===OnoPhy.RIGID)return z.copy(r,o.matrix),void(this.flg=!0);if(n.rotation_mode===as?z.fromLSR(r,n.location,n.scale,n.rotation):z.fromLSE(r,n.location,n.scale,n.rotation),this.objecttype===Iu)for(var i=0;i<this.data.bones.length;i++)this.calcBoneMatrix(i,t,e);if(n.parent){var a=n.parent;a?(a.calcMatrix(t,e),z.dot(r,n.iparentmatrix,r),n.parent_bone&&(i=n.parent_bone-1,r[11]-=a.data.bones[i].length,z.dot(r,a.data.bones[i].matrix_local,r),z.dot(r,a.data.bones[i].matrix,r)),z.dot(r,a.matrix,r)):z.dot(r,ono3d.worldMatrix,r)}else z.dot(r,ono3d.worldMatrix,r);if(this.collision&&this.refreshCollision(),o&&("PASSIVE"!=n.rigid_body.type&&!e||o.type!==OnoPhy.RIGID||(X.setValue(o.v,0,0,0),X.copy(o.v,o.location),X.setValue(o.rotV,0,0,0),z.copy(o.matrix,this.matrix),z.toLSR(o.location,o.scale,o.rotq,o.matrix),0!=t?(X.sub(o.v,o.location,o.v),X.mul(o.v,o.v,1/t)):X.mul(o.v,o.v,0)),o.type===OnoPhy.CLOTH)){bc(_=oc,n.data);var u=z.alloc();this.calcModifiers(_),z.dot(u,ono3d.worldMatrix,this.matrix),_.vertices;var s=u[0],c=u[1],f=u[2],l=u[3],h=u[4],p=u[5],v=u[6],y=u[7],m=u[8],b=u[9],d=u[10],g=u[11],w=oc.vertices,_=oc,x=o.points;for(i=0;i<_.vertexSize;i++)if(x[i].fix||e){var j=x[i].location,O=w[i].pos[0],S=w[i].pos[1],E=w[i].pos[2];j[0]=s*O+l*S+v*E+b,j[1]=c*O+h*S+y*E+d,j[2]=f*O+p*S+m*E+g}z.free(1)}this.flg=!0}},{key:"_draw",value:function(t){var e=this;if("MESH"!==e.type)return null;if(e.hide_render)return null;if(!e.visible_camera)return null;var n=e.o3o;cc[0]=mc(sc,"defaultMaterial");var r=n.materials,o=e.material_slots;if(o){var i=1;o.forEach(function(t){var e=t,o=r.find(function(t){return t.name_full==e});cc[i]=mc(o,n.name+"_"+o.name_full),i++})}else i=1,r.foreach(function(t){cc[i]=mc(t,n.name+"_"+t.name),i++});this.freezeMesh(oc),oc.vertices;var a,u,s,c,f,l=ono3d.verticesFloat32Array,h=ono3d.vertices_index,p=ono3d.faces,v=ono3d.faces_index,y=0,m=(ono3d.materials,ono3d.smoothing),b=0,d=0;oc.uv_layerSize&&(c=oc.uv_layers[0].data,f=oc.uv_layers[0].data),oc.uv_layerSize>=2&&(f=oc.uv_layers[1].data);var g=oc.vertices,w=oc.faces;for(i=0;i<oc.faceSize;i++){var _=w[i].normal,x=w[i].idx;3==w[i].idxnum?X.cross2(_,g[x[0]].pos,g[x[1]].pos,g[x[2]].pos):X.cross3(_,g[x[0]].pos,g[x[2]].pos,g[x[1]].pos,g[x[3]].pos),X.norm(_)}if(e.data.use_auto_smooth||engine.use_smoothing){for(i=0;i<oc.vertexSize;i++)g[i].normal.fill(0);for(i=0;i<oc.faceSize;i++){x=w[i].idx;var j=w[i].normal;_=g[x[0]].normal,X.add(_,_,j),_=g[x[1]].normal,X.add(_,_,j),_=g[x[2]].normal,X.add(_,_,j),4==w[i].idxnum&&(_=g[x[3]].normal,X.add(_,_,j))}for(i=oc.vertexSize;i--;)X.norm(g[i].normal);m=1}else m=0;var O=null;O||(O=ono3d.environments[0].lightProbe);var S=null;if(O){var E=O.bspTree,P=new X;X.setValue(P,this.matrix[9],this.matrix[10],this.matrix[11]),S=E.getItem(P)}if(S){var T=O.shcoefs,k=S.bsps,M=S.pIdx;fc.forEach(function(t){X.setValue(t,0,0,0)});for(var R=0;R<4;R++){var I=T[M[R]],A=X.dot(k[R].v,P)-k[R].m;for(i=0;i<fc.length;i++)X.madd(fc[i],fc[i],I[i],A)}}else{var C=engine.scene.objects.find(function(t){return"LIGHT"===t.type&&"ENVIRONMENT"===t.data.type});if(C&&C.default_shcoef){var F=C.default_shcoef;for(i=0;i<fc.length;i++)fc[i].set(F[i])}else fc.forEach(function(t){X.setValues(t,0,0,0)}),engine.scene.world&&(X.mul(fc[0],engine.scene.world.color,.7),X.mul(fc[2],engine.scene.world.color,.3))}var N=v,B=20*h,U=X.alloc(),L=X.alloc(),V=X.alloc(),D=X.alloc();if(!(1&t))if(2&t)for(i=0;i<oc.faceSize;i++){x=(a=w[i]).idx,x=(a=w[i]).idx;for(var G=0;G<a.idxnum-2;G++){u=p[N],N++,y++,u.material=null,u.vertices[0]=h,u.vertices[1]=h+1,u.vertices[2]=h+2;var z=g[G],H=[0,1+G,2+G];for(R=0;R<3;R++)z=g[x[H[R]]],l[B]=z.pos[0],l[B+1]=z.pos[1],l[B+2]=z.pos[2],h++,B+=20}}else{for(i=0;i<oc.faceSize;i++)for(x=(a=w[i]).idx,G=0;G<a.idxnum-2;G++){u=p[N],N++,y++;var q=a.normal;u.material=ono3d.materials[cc[a.mat+1]],s=null,a.mat>=0&&c&&(b=u.material.offsetx,d=u.material.offsety,s=c[i]);var Y=null;f&&(Y=f[i]),X.setValue(U,-q[1],q[2],q[0]),X.setValue(L,q[2],-q[0],q[1]),u.material.heightMap&&xn.calcST(U,L,g[x[0]].pos,g[x[1+G]].pos,g[x[2+G]].pos,s[0],s[1],s[2*(1+G)],s[2*(1+G)+1],s[2*(2+G)],s[2*(2+G)+1]),u.vertices[0]=h,u.vertices[1]=h+1,u.vertices[2]=h+2,z=g[G];var W=a.normal[0]*(1-m),Q=a.normal[1]*(1-m),$=a.normal[2]*(1-m);for(H=[0,1+G,2+G],R=0;R<3;R++)z=g[x[H[R]]],l[B]=z.pos[0],l[B+1]=z.pos[1],l[B+2]=z.pos[2],l[B+3]=D[0]=z.normal[0]*m+W,l[B+4]=D[1]=z.normal[1]*m+Q,l[B+5]=D[2]=z.normal[2]*m+$,l[B+6]=U[0],l[B+7]=U[1],l[B+8]=U[2],l[B+9]=L[0],l[B+10]=L[1],l[B+11]=L[2],s&&(l[B+12]=s[2*H[R]]+b,l[B+13]=s[2*H[R]+1]+d),Y&&(l[B+15]=Y[2*H[R]]+b,l[B+16]=Y[2*H[R]+1]+d),nt.decode2xyz(V,fc,D[0],D[1],D[2]),l[B+17]=V[0],l[B+18]=V[1],l[B+19]=V[2],h++,B+=20}if(ono3d.rf&xn.RF_OUTLINE){var K,Z=J.alloc();J.getInv(Z,ono3d.viewMatrix);var tt=Z[12],et=Z[13],rt=Z[14];for(J.free(1),i=0;i<oc.faceSize;i++)K=w[i],1-a.fs?(D=K.normal,(g[(x=K.idx)[0]].pos[0]-tt)*D[0]+(g[x[0]].pos[1]-et)*D[1]+(g[x[0]].pos[2]-rt)*D[2]<0?K.cul=1:K.cul=-1):K.cul=0;var ot=ono3d.materials[ono3d.materials_index];ono3d.materials_index++;var it=ono3d.materials[ono3d.materials_index];ono3d.materials_index++,X.copy(ot.baseColor,ono3d.lineColor),ot.opacity=1,ot.shader="plain",ot.bold=ono3d.lineWidth,ot.name="line",X.copy(it.baseColor,ono3d.lineColor),it.opacity=.99*ono3d.lineColor[3],it.shader="plain",it.bold=ono3d.lineWidth,it.name="line_alpha";var at=oc.edges,ut=ono3d.lines_index,st=ono3d.lines;for(i=0;i<oc.edgeSize;i++){var ct=ot;if(!((pt=at[i]).fIndices[0]<0)){if(pt.fIndices[1]<0){var ft=ono3d.materials[cc[w[pt.fIndices[0]].mat+1]];if(w[pt.fIndices[0]].cul<1)continue;1!==ft.opacity&&(ct=it)}else{if(w[pt.fIndices[0]].cul*w[pt.fIndices[1]].cul>-1)continue;ft=ono3d.materials[cc[w[pt.fIndices[0]].mat+1]];var lt=ono3d.materials[cc[w[pt.fIndices[1]].mat+1]];1===ft.opacity&&1===lt.opacity||(ct=it)}(ht=st[ut]).material=ct,ut++,X.copy(ht.pos[0],g[pt.vIndices[0]].pos),X.copy(ht.pos[1],g[pt.vIndices[1]].pos)}}ono3d.lines_index=ut}}if(1&t){for(ot=ono3d.materials[ono3d.materials_index],ono3d.materials_index++,it=ono3d.materials[ono3d.materials_index],ono3d.materials_index++,X.copy(ot.baseColor,ono3d.lineColor),ot.opacity=1,ot.shader="plain",ot.bold=ono3d.lineWidth,ot.name="line",X.copy(it.baseColor,ono3d.lineColor),it.opacity=.99*ono3d.lineColor[3],it.shader="plain",it.bold=ono3d.lineWidth,it.name="line_alpha",at=oc.edges,ut=ono3d.lines_index,st=ono3d.lines,i=0;i<oc.edgeSize;i++){var ht,pt=at[i];ct=ot,(ht=st[ut]).material=ct,ut++,X.copy(ht.pos[0],g[pt.vIndices[0]].pos),X.copy(ht.pos[1],g[pt.vIndices[1]].pos)}ono3d.lines_index=ut}ono3d.vertices_index=h,ono3d.faces_index+=y,X.free(4)}},{key:"freezeMesh",value:function(t){bc(t,this.data);var e,n=!1;if(e=this.phyObj,n|=this.calcModifiers(t),e&&(e.type===OnoPhy.SPRING_MESH||e.type===OnoPhy.CLOTH)){for(var r=e.points.length;r--;)X.copy(t.vertices[r].pos,e.points[r].location);n=!0}var o=z.alloc();if(!n){z.dot(o,ono3d.worldMatrix,this.matrix);for(var i=t.vertices,a=o[0],u=o[1],s=o[2],c=o[3],f=o[4],l=o[5],h=o[6],p=o[7],v=o[8],y=o[9],m=o[10],b=o[11],d=0;d<t.vertexSize;d++){var g=i[d].pos,w=g[0],_=g[1],x=g[2];g[0]=a*w+c*_+h*x+y,g[1]=u*w+f*_+p*x+m,g[2]=s*w+l*_+v*x+b}if(z.determinant(o)<0){var j=t.faces;for(d=0;d<t.faceSize;d++){var O=j[d].idx,S=O[0];O[0]=O[2],O[2]=S}if(t.uv_layerSize){var E=t.uv_layers[0].data;for(d=0;d<t.faceSize;d++){var P=E[d];S=P[0],P[0]=P[4],P[4]=S,S=P[1],P[1]=P[5],P[5]=S}}}}z.free(1)}},{key:"modMirror",value:function(t,e){var n,r,o,i,a=this,u=t,s=u.vertices,c=u.vertexSize,f=0;e.use_x&&(f=0),e.use_y&&(f=1),e.use_z&&(f=2);var l,h,p=null;for(u.uv_layerSize&&(p=u.uv_layers[0].data),m=0;m<c;m++){i=s[m],(o=s[m+c]).pos[0]=i.pos[0],o.pos[1]=i.pos[1],o.pos[2]=i.pos[2],o.pos[f]*=-1;for(var v=0;v<i.groups.length;v++)o.groups[v]=i.groups[v],o.groupWeights[v]=i.groupWeights[v]}for(var y=u.faceSize,m=0;m<y;m++){for(r=(h=u.faces[m]).idx,(l=u.faces[y+m]).idxnum=h.idxnum,n=l.idx,v=0;v<h.idxnum;v++){var b=h.idxnum-v;0==v&&(b=0),Math.abs(s[r[b]].pos[f])>1e-4?n[v]=r[b]+c:n[v]=r[b]}l.material=h.material,l.mat=h.mat,l.fs=h.fs}for(var d=0;d<u.uv_layerSize;d++){var g=2*y-(w=u.uv_layers[d].data).length;for(m=0;m<g;m++)w.push([])}if(p){var w=p;for(m=0;m<y;m++)for(h=u.faces[m],v=0;v<h.idxnum;v++)b=h.idxnum-v,0==v&&(b=0),w[m+y][2*v]=w[m][2*b],w[m+y][2*v+1]=w[m][2*b+1]}var _=0;for(m=0;m<u.edgeSize;m++){var x=u.edges[_+u.edgeSize],j=u.edges[m];Math.abs(s[j.vIndices[0]].pos[f])<.01&&Math.abs(s[j.vIndices[1]].pos[f])<.01?j.fIndices[1]=j.fIndices[0]+y:(x.vIndices[0]=j.vIndices[0]+c,x.vIndices[1]=j.vIndices[1]+c,x.fIndices[0]=j.fIndices[0]+y,j.fIndices[1]>=0?x.fIndices[1]=j.fIndices[1]+y:x.fIndices[1]=-1,_++)}for(u.edgeSize+=_,m=0;m<a.groups.length;m++){hc[m]=m;var O=a.groups[m];if(O.match(/L$/))O=O.replace(/L$/,"R");else{if(!O.match(/R$/))continue;O=O.replace(/R$/,"L")}for(v=0;v<a.groups.length;v++)if(O===a.groups[v]){hc[m]=v;break}}for(v=0;v<c;v++)for(var S=s[c+v],E=0;E<8;E++)S.groups[E]<0||(S.groups[E]=hc[S.groups[E]]);u.faceSize+=y,u.vertexSize+=c}},{key:"modArmature",value:function(t,e){var n,r,o,i,a,u,s,c,f=t,l=f.vertices,h=this.groups;if(e.object){var p=this.o3o.objects_name_hash[e.object];if(p||(p=e.object),p){var v=z.alloc(),y=z.alloc();z.getInv(y,p.matrix),z.dot(v,y,this.matrix);for(var m=p.data.bones,b=(p.boneMatrices,h.length);b--;){vc[b]=!1,r=h[b],n=pc[b];for(var d=0,g=m.length;d<g;d++)if(m[d].name==r){vc[b]=!0,z.dot(n,m[d].matrix,v),z.dot(n,p.matrix,n);break}}var w=X.alloc();for(d=0;d<f.vertexSize;d++){s=l[d].pos;var _=(c=l[d]).groups;o=0,i=0,a=0;var x=0;for(b=_.length;b--;)_[b]<0||vc[_[b]]&&(u=c.groupWeights[b],z.dotVec3(w,pc[_[b]],s),o+=w[0]*u,i+=w[1]*u,a+=w[2]*u,x+=u);x>0?(x=1/x,s[0]=o*x,s[1]=i*x,s[2]=a*x):e.vertex_group>=0&&z.dotVec3(s,pc[e.vertex_group],s)}return X.free(1),z.free(2),1}}}},{key:"calcModifiers",value:function(t){for(var e=0,n=0,r=this.modifiers.length;n<r;n++){var o=this.modifiers[n];"MIRROR"!=o.type&&e||("MIRROR"==o.type?e|=this.modMirror(t,o):"ARMATURE"==o.type?e|=this.modArmature(t,o):"MESH_DEFORM"==o.type&&(e|=this.modMeshDeform(t,o)))}return e}},{key:"drawSimple",value:function(t){var e=this;if("MESH"!==e.type)return null;if(e.hide_render)return null;var n=e.o3o;cc[0]=mc(sc,"defaultMaterial");var r=n.materials,o=e.material_slots;if(o){var i=1;o.forEach(function(t){var e=t,o=r.find(function(t){return t.name_full==e});cc[i]=mc(o,n.name+"_"+o.name_full),i++})}else i=1,r.foreach(function(t){cc[i]=mc(t,n.name+"_"+t.name),i++});this.freezeMesh(oc),oc.vertices;var a,u,s,c,f=ono3d.verticesFloat32Array,l=ono3d.vertices_index,h=ono3d.faces,p=ono3d.faces_index,v=0,y=(ono3d.materials,ono3d.smoothing,0),m=0;oc.uv_layerSize&&(c=oc.uv_layers[0].data,oc.uv_layers[0].data),oc.uv_layerSize>=2&&oc.uv_layers[1].data;var b=p,d=5*l,g=oc.vertices,w=oc.faces;for(i=0;i<oc.faceSize;i++)for(var _=(a=w[i]).idx,x=0;x<a.idxnum-2;x++){u=h[b],b++,v++,u.material=ono3d.materials[cc[a.mat+1]],s=null,a.mat>=0&&c&&(y=u.material.offsetx,m=u.material.offsety,s=c[i]),u.vertices[0]=l,u.vertices[1]=l+1,u.vertices[2]=l+2;for(var j=g[x],O=[0,1+x,2+x],S=0;S<3;S++)j=g[_[O[S]]],f[d]=j.pos[0],f[d+1]=j.pos[1],f[d+2]=j.pos[2],s&&(f[d+3]=s[2*O[S]]+y,f[d+4]=s[2*O[S]+1]+m),l++,d+=5}ono3d.vertices_index=l,ono3d.faces_index+=v}},{key:"calcBoneMatrix",value:function(t,e,n){if(!this.data.bones[t].flg){var r=this,o=r.data.bones[t],i=o.matrix,a=r.pose.poseBones[t];if(dc(i,a),z.dot(i,o.matrix_local,i),o.parent){var u=o.parent.id;this.calcBoneMatrix(u,e,n),z.dot(i,r.data.bones[u].matrix,i)}if(r.pose.poseBones)for(var s=r.pose.poseBones[t],c=0;c<s.constraints.length;c++){var f=s.constraints[c];if("COPY_ROTATION"===f.type){var l=this.o3oInstance.objectInstances[f.target.idx];l.calcMatrix(e,n),Y.copy(i,l.matrix)}}z.dot(i,i,o.i_matrix_local),a.flg=!0}}},{key:"refreshCollision",value:function(){var t=this.matrix,e=this.collision;if(e){z.alloc();var n=this.bound_box,r=.5*(n.max[0]-n.min[0]),o=.5*(n.max[1]-n.min[1]),i=.5*(n.max[2]-n.min[2]),a=Math.sqrt(t[0]*t[0]+t[1]*t[1]+t[2]*t[2]),u=Math.sqrt(t[3]*t[3]+t[4]*t[4]+t[5]*t[5]),s=Math.sqrt(t[6]*t[6]+t[7]*t[7]+t[8]*t[8]);e.bold=0,z.copy(e.matrix,t);var c=Y.alloc();switch(e.type){case Yo.SPHERE:a*=r,u*=o,s*=i;var f=Math.max(Math.max(a,u),s);e.bold=f,z.setInit(e.matrix),e.matrix[9]=t[9],e.matrix[10]=t[10],e.matrix[11]=t[11];break;case Yo.CAPSULE:f=Math.max(a*r,s*i),e.bold=f;var l=r,h=Math.max(u*o-f,0)/u,p=i;Y.scale(c,l,h,p),Y.dot(e.matrix,e.matrix,c)}z.free(1),Y.free(1),e.refresh()}}}]),t}(),mc=function(t,e){for(var n,r=ono3d.materials,o=0;o<ono3d.materials_index;o++)if(r[o].name===e)return o;return n=r[o],ono3d.materials_index++,"OPAQUE"!=t.blend_method?n.blend_method=1:n.blend_method=0,n.offsetx=t.uvOffset[0],n.offsety=t.uvOffset[1],n.name=e,X.copy(n.baseColor,t.baseColor),n.opacity=t.opacity,n.metallic=t.metallic,n.specular=t.specular,n.roughness=t.roughness,n.ior=t.ior,n.subRoughness=t.subRoughness,n.emt=t.emt,n.radiant_energy=t.radiant_energy,n.baseColorMap=t.baseColorMap,n.orgMap=t.orgMap,n.heightMap=t.heightMap,n.heightMapPower=t.heightMapPower,n.heightBase=t.heightBase,n.pbrMap=t.pbrMap,n.lightMap=t.lightMap,n.shader=t.shader,o},bc=function(t,e){t.name=e.name,t.vertices.buf.set(e.vertices.buf),t.vertexSize=e.vertexSize,t.edges.buf.set(e.edges.buf),t.edgeSize=e.edgeSize;for(var n=0;n<e.faceSize;n++){var r=t.faces[n],o=e.faces[n];r.material=o.material,r.mat=o.mat,r.idxnum=o.idxnum,r.fs=o.fs}e.faces.length>0&&t.faces.buf.set(e.faces.buf),t.faceSize=e.faceSize;var i=e.uv_layersSize-t.uv_layers.length;for(n=0;n<i;n++)t.uv_layers.push(new Xu);for(n=0;n<e.uv_layerSize;n++){var a=e.uv_layers[n].data;t.uv_layers.length<=n&&t.uv_layers.push(new Xu);var u=t.uv_layers[n].data;i=e.faceSize-u.length;for(var s=0;s<i;s++)u.push([]);for(s=0;s<e.faceSize;s++)u[s][0]=a[s][0],u[s][1]=a[s][1],u[s][2]=a[s][2],u[s][3]=a[s][3],u[s][4]=a[s][4],u[s][5]=a[s][5],u[s][6]=a[s][6],u[s][7]=a[s][7]}t.uv_layerSize=e.uv_layerSize},dc=function(t,e){e.rotation_mode===as?z.fromLSR(t,e.location,e.scale,e.rotation):z.fromLSE(t,e.location,e.scale,e.rotation)};function gc(t){return gc="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},gc(t)}function wc(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,xc(r.key),r)}}function _c(t,e,n){return e&&wc(t.prototype,e),n&&wc(t,n),Object.defineProperty(t,"prototype",{writable:!1}),t}function xc(t){var e=function(t){if("object"!=gc(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var n=e.call(t,"string");if("object"!=gc(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==gc(e)?e:e+""}var jc=_c(function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.name="",this.endframe=0,this.id_root="",this.slots=[]}),Oc=0,Sc={LINER:Oc++,SPLINE:Oc++},Ec=0,Pc={NONE:Ec++,LOOP:Ec++,LINER:Ec++,SPLINE:Ec++};function Tc(t){return Tc="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Tc(t)}function kc(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,Rc(r.key),r)}}function Mc(t,e,n){return e&&kc(t.prototype,e),n&&kc(t,n),Object.defineProperty(t,"prototype",{writable:!1}),t}function Rc(t){var e=function(t){if("object"!=Tc(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var n=e.call(t,"string");if("object"!=Tc(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==Tc(e)?e:e+""}var Ic=Mc(function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.target="",this.type="",this.idx="",this.interpolatemode=Sc.LINER,this.repeatmode=Pc.NONE,this.keys=[],this.params=[]}),Ac=0,Cc={ROT_QUAT:Ac++,ROT_EULER:Ac++,LOCATION:Ac++,SCALE:Ac++,SHAPEKEY:Ac++,OFFSET:Ac++};function Fc(t){return Fc="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Fc(t)}function Nc(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,Uc(r.key),r)}}function Bc(t,e,n){return e&&Nc(t.prototype,e),n&&Nc(t,n),Object.defineProperty(t,"prototype",{writable:!1}),t}function Uc(t){var e=function(t){if("object"!=Fc(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var n=e.call(t,"string");if("object"!=Fc(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==Fc(e)?e:e+""}var Lc=Bc(function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.name="",this.type="",this.distance=2,this.falloff=.1});function Vc(t){return Vc="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Vc(t)}function Dc(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,Gc(r.key),r)}}function Gc(t){var e=function(t){if("object"!=Vc(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var n=e.call(t,"string");if("object"!=Vc(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==Vc(e)?e:e+""}var zc=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.distance=0,this.normal=new X}return function(t,e,n){e&&Dc(t.prototype,e),n&&Dc(t,n),Object.defineProperty(t,"prototype",{writable:!1})}(t,[{key:"calc",value:function(t,e,n){X.cross2(this.normal,t,e,n),X.norm(this.normal),this.distance=X.dot(this.normal,t)}},{key:"checkFront",value:function(t){return this.distance<=X.dot(t,this.normal)}},{key:"hitCheck",value:function(t){return this.distance<=X.dot(t,this.normal)}}],[{key:"intersection",value:function(t,e,n){var r=X.dot(e.normal,n.normal),o=1/(1-r*r),i=(e.distance-r*n.distance)*o,a=(n.distance-r*e.distance)*o;t[0]=i*e.normal[0]+a*n.normal[0],t[1]=i*e.normal[1]+a*n.normal[1],t[2]=i*e.normal[2]+a*n.normal[2]}},{key:"intersection3",value:function(t,e,n,r){var o=new X;this.intersection(t,e,n),X.cross(o,e.normal,n.normal);var i=X.dot(o,r.normal);if(!i)return!0;var a=(-X.dot(t,r.normal)+r.distance)/i;t[0]+=o[0]*a,t[1]+=o[1]*a,t[2]+=o[2]*a}}]),t}();function Xc(t){return Xc="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Xc(t)}function Hc(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,qc(r.key),r)}}function qc(t){var e=function(t){if("object"!=Xc(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var n=e.call(t,"string");if("object"!=Xc(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==Xc(e)?e:e+""}var Yc=new Array(32),Wc=new X,Qc=new X,$c=new X,Jc=new X,Kc=new X,Zc=new X,tf=new X,ef=new X,nf=new Array(32),rf=function(){function t(e,n,r,o,i,a){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.min=new X(-o/2,-i/2,-a/2),this.max=new X(o/2,i/2,a/2),this.matrix=new z}return function(t,e){e&&Hc(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1})}(t,[{key:"support",value:function(t,e){for(var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,r=0;r<3;r++)(this.matrix[0+3*r]*e[0]+this.matrix[1+3*r]*e[1]+this.matrix[2+3*r]*e[2])*n>0?t[r]=this.max[r]:t[r]=this.min[r];z.dotVec3(t,this.matrix,t)}},{key:"supportReverse",value:function(t,e){this.support(t,e,-1)}},{key:"checkDoublePlane",value:function(t,e){engine.draw_data.calc_count++;var n=X.dot(t.normal,e.normal);if(n>.9999)return!1;if(n<-.9999)return t.distance+e.distance>=0;X.cross($c,t.normal,e.normal),zc.intersection(Wc,t,e),X.add(ef,t.normal,e.normal);for(var r=0;r<3;r++)if(Zc[0]=this.matrix[0+3*r],Zc[1]=this.matrix[1+3*r],Zc[2]=this.matrix[2+3*r],!(X.dot(t.normal,Zc)*X.dot(e.normal,Zc)>0)&&(X.cross(Zc,$c,Zc),X.dot(ef,Zc)<0&&X.mul(Zc,Zc,-1),this.checkPoint(Wc,Zc)))return!0;return!1}},{key:"checkPoint",value:function(t,e){return this.support(Qc,e),X.dot(t,e)>X.dot(Qc,e)}},{key:"checkTriplePlane",value:function(t,e,n){engine.draw_data.calc_count++;var r,o=X.dot(t.normal,e.normal);if(o>.9999)return t.distance>e.distance?this.checkDoublePlane(t,n):this.checkDoublePlane(e,n);if(o<-.9999)return t.distance+e.distance>=0||this.checkDoublePlane(t,n);if(X.cross(Wc,t.normal,e.normal),(r=X.dot(n.normal,Wc))*r<1e-8)return zc.intersection(Wc,t,e),!n.checkFront(Wc);if((r=zc.intersection3(Wc,t,e,n))*r<1e-8)return!1;X.cross($c,t.normal,e.normal),X.cross(Jc,e.normal,n.normal),X.cross(Kc,n.normal,t.normal),X.mul($c,$c,-Math.sign(X.dot($c,n.normal))),X.mul(Jc,Jc,-Math.sign(X.dot(Jc,t.normal))),X.mul(Kc,Kc,-Math.sign(X.dot(Kc,e.normal)));for(var i=0;i<3;i++)if(Zc[0]=this.matrix[0+3*i],Zc[1]=this.matrix[1+3*i],Zc[2]=this.matrix[2+3*i],X.mul(Zc,Zc,-Math.sign(X.dot(Zc,$c))),!(X.dot(Zc,Jc)>0||X.dot(Zc,Kc)>0)&&this.checkPoint(Wc,Zc))return!0;for(i=0;i<3;i++){if(Zc[0]=this.matrix[0+3*i],Zc[1]=this.matrix[1+3*i],Zc[2]=this.matrix[2+3*i],X.cross(tf,Zc,$c),X.mul(tf,tf,-Math.sign(X.dot(tf,Jc))),X.dot(tf,Kc)<0&&this.checkPoint(Wc,tf))return!0;if(X.cross(tf,Zc,Jc),X.mul(tf,tf,-Math.sign(X.dot(tf,Kc))),X.dot(tf,$c)<0&&this.checkPoint(Wc,tf))return!0;if(X.cross(tf,Zc,Kc),X.mul(tf,tf,-Math.sign(X.dot(tf,$c))),X.dot(tf,Jc)<0&&this.checkPoint(Wc,tf))return!0}return!1}},{key:"checkPlanes",value:function(t,e){for(var n=t[e],r=0;r<e;r++){if(this.checkDoublePlane(t[r],n))return!0;for(var o=r+1;o<e;o++)if(this.checkTriplePlane(t[r],t[o],n))return!0}return!1}},{key:"check",value:function(t,e,n){for(var r=t[n],o=0;o<r.length;o++){e[n]=r[o];var i=this.checkPlanes(e,n);if(!i&&n+1<t.length&&(i=this.check(t,e,n+1)),!i)return!1}return!0}},{key:"pack",value:function(t){for(var e=0;e<t[0].length;e++)if(nf[0]=t[0][e],!this.check(t,nf,1))return!1;return!0}},{key:"pick",value:function(t,e){for(var n=e;n<t.length;n++){Yc[e]=t[n];var r=!1;if(e+1>=t.length||e+1>=4){for(var o=[],i=0;i<e+1;i++)o.push(Yc[i]);if(0===e)return!1;r=this.pack(o)}else r=this.pick(t,e+1);if(r)return!0}}},{key:"checkConvexes",value:function(t,e){for(var n=[],r=0;r<t.length;r++)if(t[r].instance!==e){for(var o=t[r].planes,i=[],a=0,u=0;u<o.length;u++)if(this.support(Wc,o[u].normal),X.dot(Wc,o[u].normal)<o[u].distance)a++;else{if(this.supportReverse(Wc,o[u].normal),X.dot(Wc,o[u].normal)>o[u].distance){a=-1;break}i.push(o[u])}if(!(a<0)){if(a===o.length)return!0;if(n.push(i),n.length>=4)break}}return!(n.length<=1)&&this.pack(n)}}]),t}();function of(t){return of="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},of(t)}function af(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,uf(r.key),r)}}function uf(t){var e=function(t){if("object"!=of(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var n=e.call(t,"string");if("object"!=of(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==of(e)?e:e+""}for(var sf=[],cf=0;cf<9;cf++)sf.push(new X);var ff=new Yo.Sphere,lf=new Yo.Cuboid,hf=new Yo.Cylinder,pf=new Yo.Cone,vf=new Yo.Capsule,yf=new Mu,mf=[];for(cf=0;cf<128;cf++)mf.push(new z);var bf=new is,df=new Array(256),gf=4096;bf.ratios=[],bf.vertices=Xs.array(gf),bf.faces=Qs.array(gf),bf.edges=tc.array(gf);var wf=new Array(64);for(cf=0;cf<gf;cf++)bf.ratios.push(new q);var _f=Math.abs,xf=new Array(64),jf=new Array(64);for(cf=xf.length;cf--;)xf[cf]=new z;function Of(t){var e=null,n=t.bound_type;if(t.rigid_body.type&&(n=t.rigid_body.collision_shape),"SPHERE"==n)e=new Yo.Sphere;else if("BOX"==n)e=new Yo.Cuboid;else if("CYLINDER"==n)e=new Yo.Cylinder;else if("CONE"==n)e=new Yo.Cone;else if("CAPSULE"==n)e=new Yo.Capsule;else if("CONVEX_HULL"==n){var r=t.data;e=new Yo.ConvexHull,r.vertices.forEach(function(t){e.poses.push(t.pos)})}else"MESH"==n&&(r=t.data,e=new Yo.Mesh,r.vertices.forEach(function(t){e.poses.push(t.pos)}),r.faces.forEach(function(t){var n=[];n[0]=e.poses[t.idx[0]],n[1]=e.poses[t.idx[1]],n[2]=e.poses[t.idx[2]],e.triangles.push(n)}),e.createTree());return e&&(e.name=t.name,t.rigid_body&&(e.groups=t.rigid_body.collision_groups)),e}var Sf=function(){function t(e){if(function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.object=e,this.matrix=new z,this.boneMatrices=[],this.boneFlgs=[],this.children=[],e.objecttype===Iu)for(var n=e.data.bones,r=0;r<n.length;r++)this.boneMatrices.push(new z),this.boneFlgs.push(!1)}return function(t,e){e&&af(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1})}(t,[{key:"createCollision",value:function(){var t=this.object;if(!t.show_bounds)return null;var e=Of(t);return e.obj=this,this.collision=e,e}},{key:"createPhyObj",value:function(){var t,e,n=this,r=null,o=n.object,i=(oc.vertices,oc.faces);if(o.rigid_body.type){var a=o.rigid_body;a.collision_shape,r=new pu.RigidBody;var u=Of(o);if(r.collision=u,u){u.type!==Yo.MESH&&u.type!==Yo.CONVEX_HULL||(r.mesh=o.data),u.parent=r;var s=o.bound_box;r.collisionSize[0]=.5*(s.max[0]-s.min[0]),r.collisionSize[1]=.5*(s.max[1]-s.min[1]),r.collisionSize[2]=.5*(s.max[2]-s.min[2])}"ACTIVE"===a.type&&(r.fix=!1),r.friction=a.friction,r.restitution=a.restitution,a.bold?r.bold=a.bold:r.bold=0,r.mass=a.mass,r.name=o.name,z.toLSR(r.location,r.scale,r.rotq,n.matrix)}for(var c=0;c<o.modifiers.length;c++)if("CLOTH"===(e=o.modifiers[c]).type||"SOFT_BODY"===e.type){for(o.data,n.freezeMesh(oc),"CLOTH"===e.type?((r=new pu.Cloth2(oc.vertexSize,oc.edgeSize,oc.faceSize)).air_damping=e.air_damping,r.mass=e.mass,r.speed=1,r.tension.stiffness=e.tension_stiffness,r.tension.damping=e.tension_damping,r.bending.stiffness=e.bending_stiffness,r.bending.damping=e.bending_damping,r.air_damping=e.air_damping,r.vel_damping=e.vel_damping,r.use_collision=e.use_collision,r.use_collision&&(r.groups=0)):((r=new pu.SoftBody(oc.vertexSize,oc.edgeSize,oc.faceSize)).friction=e.friction,r.mass=e.mass,r.speed=1,r.pull=.1*e.pull,r.push=.1*e.push,r.damping=e.damping,r.bending_stiffness=e.bend),t=oc.vertices,h=0;h<oc.vertexSize;h++){X.copy(r.points[h].location,t[h].pos),r.points[h].id=h;for(var f=0;f<t[h].groups.length&&!(t[h].groups[f]<0);f++)if(o.groups[t[h].groups[f]]===e.pin){r.points[h].fix=!0;break}}for(h=0;h<oc.faceSize;h++){var l=i[h];if(r.faces[h].idxnum=l.idxnum,l.idxnum>=3)for(f=0;f<l.idxnum;f++)r.faces[h].points[f]=r.points[l.idx[f]]}for(var h=0;h<oc.edgeSize;h++){var p=oc.edges[h];r.edges[h].point1=r.points[p.vIndices[0]],r.edges[h].point2=r.points[p.vIndices[1]]}for(h=0;h<r.edges.length;h++)r.edges[h].len=X.len(r.edges[h].point1.location,r.edges[h].point2.location);r.init()}else if("FLUID"===e.type&&"DOMAIN"===e.fluid_type){var v=new X;s=new X,z.dotVec3(v,this.matrix,o.bound_box.min),z.dotVec3(s,this.matrix,o.bound_box.max),X.sub(s,s,v);var y=new $a(v,s);this.fluid=y}return r&&(r.name=o.name,r.parent=n,r.refreshCollision(),r.refreshInertia(),this.phyObj=r),r}},{key:"searchObject",value:function(t){if(!this.children)return!1;var e=this.children.find(function(e){return e.object.name===t});return e||(this.children.forEach(function(n){if(e=n.searchObject(t))return!1}),e)}},{key:"getTempCollision",value:function(t){var e,n=this.object,r=X.alloc();if(X.setValue(r,1,1,1),"MESH"===n.type){var o=n.bound_box;r[0]=.5*(o.max[0]-o.min[0]),r[1]=.5*(o.max[1]-o.min[1]),r[2]=.5*(o.max[2]-o.min[2])}switch(n.bound_type){case"SPHERE":e=ff;break;case"BOX":e=lf;break;case"CYLINDER":e=hf;break;case"CONE":e=pf;break;case"CAPSULE":e=vf}z.copy(e.matrix,this.matrix);for(var i=e.matrix,a=0;a<3;a++)for(var u=0;u<3;u++)i[3*a+u]*=r[a];switch(e.groups=t,e.notgroups=0,e.bold=0,n.bound_type){case"SPHERE":r[0]=Math.sqrt(i[0]*i[0]+i[1]*i[1]+i[2]*i[2]),r[1]=Math.sqrt(i[3]*i[3]+i[4]*i[4]+i[5]*i[5]),r[2]=Math.sqrt(i[6]*i[6]+i[7]*i[7]+i[8]*i[8]),e.bold=Math.max(Math.max(r[0],r[1]),r[2]);break;case"CAPSULE":r[0]=Math.sqrt(i[0]*i[0]+i[1]*i[1]+i[2]*i[2]),r[1]=Math.sqrt(i[3]*i[3]+i[4]*i[4]+i[5]*i[5]),r[2]=Math.sqrt(i[6]*i[6]+i[7]*i[7]+i[8]*i[8]),e.bold=Math.max(r[0],r[2]);var s=(r[1]-e.bold)/r[1];i[3]*=s,i[4]*=s,i[5]*=s}return e.refresh(),X.free(1),e}},{key:"hitCheck",value:function(t,e){var n=this.getTempCollision(e);return t.checkHitAll(n)}},{key:"resetMatrix",value:function(){this.flg=!1;for(var t=0;t<this.boneFlgs.length;t++)this.boneFlgs[t]=!1}},{key:"calcBoneMatrix",value:function(t,e,n){if(!this.boneFlgs[t]){var r=this.boneMatrices[t],o=this.object,i=o.data.bones[t],a=o.pose.poseBones[t];if(h=r,(p=a).rotation_mode===as?z.fromLSR(h,p.location,p.scale,p.rotation):z.fromLSE(h,p.location,p.scale,p.rotation),z.dot(r,i.matrix,r),i.parent){var u=i.parent.id;this.calcBoneMatrix(u,e,n),z.dot(r,this.boneMatrices[u],r)}if(o.poseBones)for(var s=o.poseBones[t],c=0;c<s.constraints.length;c++){var f=s.constraints[c];if("COPY_ROTATION"===f.type){var l=this.o3oInstance.objectInstances[f.target.idx];l.calcMatrix(e,n),Y.copy(r,l.matrix)}}z.dot(r,r,i.imatrix),a.flg=!0}var h,p}},{key:"refreshCollision",value:function(){var t=this.matrix,e=this.object,n=this.collision;if(n){z.alloc();var r=e.bound_box,o=.5*(r.max[0]-r.min[0]),i=.5*(r.max[1]-r.min[1]),a=.5*(r.max[2]-r.min[2]),u=Math.sqrt(t[0]*t[0]+t[1]*t[1]+t[2]*t[2]),s=Math.sqrt(t[3]*t[3]+t[4]*t[4]+t[5]*t[5]),c=Math.sqrt(t[6]*t[6]+t[7]*t[7]+t[8]*t[8]);n.bold=0,z.copy(n.matrix,t);var f=Y.alloc();switch(n.type){case Yo.SPHERE:u*=o,s*=i,c*=a;var l=Math.max(Math.max(u,s),c);n.bold=l,z.setInit(n.matrix),n.matrix[9]=t[9],n.matrix[10]=t[10],n.matrix[11]=t[11];break;case Yo.CAPSULE:l=Math.max(u*o,c*a),n.bold=l;var h=o,p=Math.max(s*i-l,0)/s,v=a;Y.scale(f,h,p,v),Y.dot(n.matrix,n.matrix,f)}z.free(1),Y.free(1),n.refresh()}}},{key:"calcMatrix",value:function(t,e){var n=this.object,r=this.matrix,o=this.phyObj,i=this.o3oInstance;if(o&&"PASSIVE"!==n.rigid_body.type&&!e&&o.type===pu.RIGID)return z.copy(r,o.matrix),void(this.flg=!0);n.rotation_mode===as?z.fromLSR(r,n.location,n.scale,n.rotation):z.fromLSE(r,n.location,n.scale,n.rotation);for(var a=0;a<this.boneMatrices.length;a++)this.calcBoneMatrix(a,t,e);if(n.parent){var u=n.parent,s=i.searchObject(u.name);s?(s.calcMatrix(t,e),z.dot(r,n.iparentmatrix,r),n.parent_bone&&(a=n.parent_bone-1,this.matrix[11]-=u.data.bones[a].length,z.dot(r,u.data.bones[a].matrix,r),z.dot(r,s.boneMatrices[a],r)),z.dot(r,s.matrix,r)):z.dot(r,ono3d.worldMatrix,r)}else z.dot(r,ono3d.worldMatrix,r);if(n.sprite){var c=new z;z.setInit(c),c[9]=-r[9],c[10]=-r[10],c[11]=-r[11],z.dot(r,c,r);var f=new z,l=function(t,e){var n=new X,o=new X,i=new X;X.setValues(i,r[3*e],r[3*e+1],r[3*e+2]),X.mul(i,i,-1),1===e?X.setValues(n,r[0],r[1],r[2]):X.setValues(n,-r[3],-r[4],-r[5]),X.normalize(n,n),X.setValues(o,engine.camera.matrix[6],engine.camera.matrix[7],engine.camera.matrix[8]);var a=1;X.dot(n,o)>0&&(a=-1),X.cross(o,o,i),X.normalize(o,o);var u=X.dot(n,o);u=Math.max(Math.min(u,1),-1),(u=Math.acos(u)*a)?z.fromRotVector(t,u,i[0],i[1],i[2]):z.setInit(t)};l(f,1),z.dot(r,f,r),l(f,0),z.dot(r,f,r),c[9]=-c[9],c[10]=-c[10],c[11]=-c[11],z.dot(r,c,r)}if(this.collision&&this.refreshCollision(),o&&("PASSIVE"!=n.rigid_body.type&&!e||o.type!==pu.RIGID||(X.setValue(o.v,0,0,0),X.copy(o.v,o.location),X.setValue(o.rotV,0,0,0),z.copy(o.matrix,this.matrix),z.toLSR(o.location,o.scale,o.rotq,o.matrix),0!=t?(X.sub(o.v,o.location,o.v),X.mul(o.v,o.v,1/t)):X.mul(o.v,o.v,0)),o.type===pu.CLOTH)){Pf(S=oc,n.data);var h=z.alloc();this.calcModifiers(S),z.dot(h,ono3d.worldMatrix,this.matrix),S.vertices;var p=h[0],v=h[1],y=(c=h[2],h[3]),m=h[4],b=h[5],d=h[6],g=h[7],w=h[8],_=h[9],x=h[10],j=h[11],O=oc.vertices,S=oc,E=o.points;for(a=0;a<S.vertexSize;a++)if(E[a].fix||e){var P=E[a].location,T=O[a].pos[0],k=O[a].pos[1],M=O[a].pos[2];P[0]=p*T+y*k+d*M+_,P[1]=v*T+m*k+g*M+x,P[2]=c*T+b*k+w*M+j}z.free(1)}this.flg=!0}},{key:"modMeshDeform",value:function(t,e){if(!e.basePos)return 0;this.object,this.o3oInstance.objectInstances_hash[e.object].freezeMesh(bf);for(var n=bf.vertices,r=e.binddata,o=q.alloc(),i=0;i<bf.faceSize;i++){var a=bf.faces[i],u=n[a.idx[0]].pos,s=n[a.idx[1]].pos,c=n[a.idx[2]].pos,f=n[a.idx[3]].pos,l=mf[i];X.sub(o,s,u),l[0]=o[0],l[1]=o[1],l[2]=o[2],4==a.idxnum?(X.sub(o,c,o),X.sub(o,o,f),l[6]=o[0],l[7]=o[1],l[8]=o[2],X.sub(o,f,u),l[3]=o[0],l[4]=o[1],l[5]=o[2]):(X.sub(o,c,u),l[3]=o[0],l[4]=o[1],l[5]=o[2]),4===a.idx?X.cross3(o,u,c,s,f):X.cross2(o,u,s,c),X.norm(o),l[9]=o[0],l[10]=o[1],l[11]=o[2]}for(i=0;i<t.vertexSize;i++){var h=r[i],p=t.vertices[i];X.setValue(p.pos,0,0,0);for(var v=0;v<h.length;v++){var y=h[v];z.dotVec4(o,mf[y.idx],y.pweight),X.add(o,n[bf.faces[y.idx].idx[0]].pos,o),X.madd(p.pos,p.pos,o,y.weight)}}return q.free(1),1}},{key:"modMirror",value:function(t,e){var n,r,o,i,a=this.object,u=t,s=u.vertices,c=u.vertexSize,f=0;e.use_x&&(f=0),e.use_y&&(f=1),e.use_z&&(f=2);var l,h,p=null;for(u.uv_layerSize&&(p=u.uv_layers[0].data),m=0;m<c;m++){i=s[m],(o=s[m+c]).pos[0]=i.pos[0],o.pos[1]=i.pos[1],o.pos[2]=i.pos[2],o.pos[f]*=-1;for(var v=0;v<i.groups.length;v++)o.groups[v]=i.groups[v],o.groupWeights[v]=i.groupWeights[v]}for(var y=u.faceSize,m=0;m<y;m++){for(r=(h=u.faces[m]).idx,(l=u.faces[y+m]).idxnum=h.idxnum,n=l.idx,v=0;v<h.idxnum;v++){var b=h.idxnum-v;0==v&&(b=0),_f(s[r[b]].pos[f])>1e-4?n[v]=r[b]+c:n[v]=r[b]}l.material=h.material,l.mat=h.mat,l.fs=h.fs}for(var d=0;d<u.uv_layerSize;d++){var g=2*y-(w=u.uv_layers[d].data).length;for(m=0;m<g;m++)w.push([])}if(p){var w=p;for(m=0;m<y;m++)for(h=u.faces[m],v=0;v<h.idxnum;v++)b=h.idxnum-v,0==v&&(b=0),w[m+y][2*v]=w[m][2*b],w[m+y][2*v+1]=w[m][2*b+1]}var _=0;for(m=0;m<u.edgeSize;m++){var x=u.edges[_+u.edgeSize],j=u.edges[m];_f(s[j.vIndices[0]].pos[f])<.01&&_f(s[j.vIndices[1]].pos[f])<.01?j.fIndices[1]=j.fIndices[0]+y:(x.vIndices[0]=j.vIndices[0]+c,x.vIndices[1]=j.vIndices[1]+c,x.fIndices[0]=j.fIndices[0]+y,j.fIndices[1]>=0?x.fIndices[1]=j.fIndices[1]+y:x.fIndices[1]=-1,_++)}for(u.edgeSize+=_,m=0;m<a.groups.length;m++){wf[m]=m;var O=a.groups[m];if(O.match(/L$/))O=O.replace(/L$/,"R");else{if(!O.match(/R$/))continue;O=O.replace(/R$/,"L")}for(v=0;v<a.groups.length;v++)if(O===a.groups[v]){wf[m]=v;break}}for(v=0;v<c;v++)for(var S=s[c+v],E=0;E<8;E++)S.groups[E]<0||(S.groups[E]=wf[S.groups[E]]);u.faceSize+=y,u.vertexSize+=c}},{key:"modArmature",value:function(t,e){var n,r,o,i,a,u=t,s=u.vertices,c=this.object;if(this.o3oInstance){this.o3oInstance.objectInstances;var f,l,h,p=c.groups;if(e.object){var v=this.o3oInstance.searchObject(e.object);if(v){var y=z.alloc(),m=z.alloc();z.getInv(m,v.matrix),z.dot(y,m,this.matrix),z.getInv(m,y);for(var b=v.object.data.bones,d=v.boneMatrices,g=p.length;g--;){jf[g]=!1,r=p[g],n=xf[g];for(var w=0,_=b.length;w<_;w++)if(b[w].name==r){jf[g]=!0,z.dot(n,d[w],y),z.dot(n,m,n);break}}var x=X.alloc();for(w=0;w<u.vertexSize;w++){l=s[w].pos;var j=(h=s[w]).groups;o=0,i=0,a=0;var O=0;for(g=j.length;g--;)j[g]<0||jf[j[g]]&&(f=h.groupWeights[g],z.dotVec3(x,xf[j[g]],l),o+=x[0]*f,i+=x[1]*f,a+=x[2]*f,O+=f);O>0?(O=1/O,l[0]=o*O,l[1]=i*O,l[2]=a*O):e.vertex_group>=0&&z.dotVec3(l,xf[e.vertex_group],l)}X.free(1),z.free(2)}}}}},{key:"calcModifiers",value:function(t){for(var e=0,n=this.object,r=0,o=n.modifiers.length;r<o;r++){var i=n.modifiers[r];"MIRROR"!=i.type&&e||("MIRROR"==i.type?e|=this.modMirror(t,i):"ARMATURE"==i.type?e|=this.modArmature(t,i):"MESH_DEFORM"==i.type&&(e|=this.modMeshDeform(t,i)))}return e}},{key:"freezeMesh",value:function(t){var e=this.object;Pf(t,e.data);var n,r=!1;if(n=this.phyObj,r|=this.calcModifiers(t),n&&(n.type===pu.SPRING_MESH||n.type===pu.CLOTH)){for(var o=n.points.length;o--;)X.copy(t.vertices[o].pos,n.points[o].location);r=!0}var i=z.alloc();if(!r){z.dot(i,ono3d.worldMatrix,this.matrix);for(var a=t.vertices,u=i[0],s=i[1],c=i[2],f=i[3],l=i[4],h=i[5],p=i[6],v=i[7],y=i[8],m=i[9],b=i[10],d=i[11],g=0;g<t.vertexSize;g++){var w=a[g].pos,_=w[0],x=w[1],j=w[2];w[0]=u*_+f*x+p*j+m,w[1]=s*_+l*x+v*j+b,w[2]=c*_+h*x+y*j+d}if(z.determinant(i)<0){var O=t.faces;for(g=0;g<t.faceSize;g++){var S=O[g].idx,E=S[0];S[0]=S[2],S[2]=E}if(t.uv_layerSize){var P=t.uv_layers[0].data;for(g=0;g<t.faceSize;g++){var T=P[g];E=T[0],T[0]=T[4],T[4]=E,E=T[1],T[1]=T[5],T[5]=E}}}}z.free(1)}},{key:"drawStatic",value:function(t,e,n){var r=ono3d.faces_index;this.draw(t,e,n);for(var o=ono3d.faces_index-r,i=[],a=ono3d.faces,u=0;u<o;u++){var s=new xn.Face;copyFace(s,a[u+r]),i.push(s)}return i}},{key:"drawWireframe",value:function(t,e,n){this._draw(t,e,n,1)}},{key:"draw",value:function(t,e,n){var r={};r.target=this,r.environment=t,r.environment2=e,r.envratio=n,engine.instance_draw_list.push(r)}},{key:"setOcclusion",value:function(){if("MESH"!==this.object.type)return null;this.freezeMesh(oc);for(var t=oc.vertices,e=0;e<oc.vertexSize;e++)t[e].normal.fill(0);var n,r,o=oc.faces;for(e=0;e<oc.faceSize;e++){var i=o[e].normal,a=o[e].idx;3==o[e].idxnum?X.cross2(i,t[a[0]].pos,t[a[1]].pos,t[a[2]].pos):X.cross3(i,t[a[0]].pos,t[a[2]].pos,t[a[1]].pos,t[a[3]].pos)}for(e=0;e<oc.faceSize;e++);var u=J.alloc();J.getInv(u,ono3d.viewMatrix);var s=u[12],c=u[13],f=u[14];for(J.free(1),e=0;e<oc.faceSize;e++){r=(n=o[e]).normal;var l=t[n.idx[0]].pos;(l[0]-s)*r[0]+(l[1]-c)*r[1]+(l[2]-f)*r[2]<0?n.cul=1:n.cul=-1}var h=[],p=oc.edges;for(i=new X,e=0;e<oc.edgeSize;e++){var v=p[e];if(!(v.fIndices[0]<0)){if(v.fIndices[1]<0){if(o[v.fIndices[0]].cul<1)continue}else if(o[v.fIndices[0]].cul*o[v.fIndices[1]].cul>-1)continue;if((m=new zc).calc(t[v.vIndices[0]].pos,t[v.vIndices[1]].pos,engine.camera.p),v.fIndices[1]<0){var y=o[v.fIndices[0]];y.idx[0]!=v.vIndices[0]&&y.idx[0]!=v.vIndices[1]&&X.sub(i,t[v.vIndices[0]].pos,t[y.idx[0]].pos),y.idx[1]!=v.vIndices[0]&&y.idx[1]!=v.vIndices[1]&&X.sub(i,t[v.vIndices[0]].pos,t[y.idx[1]].pos),y.idx[2]!=v.vIndices[0]&&y.idx[2]!=v.vIndices[1]&&X.sub(i,t[v.vIndices[0]].pos,t[y.idx[2]].pos),X.dot(m.normal,i)<0&&(X.mul(m.normal,m.normal,-1),m.distance*=-1)}else X.dot(m.normal,o[v.fIndices[0]].normal)+X.dot(m.normal,o[v.fIndices[1]].normal)<0&&(X.mul(m.normal,m.normal,-1),m.distance*=-1);h.push(m)}}for(e=0;e<oc.faceSize;e++){var m;a=(n=o[e]).idx,1==n.cul&&((m=new zc).calc(t[n.idx[0]].pos,t[n.idx[1]].pos,t[n.idx[2]].pos),h.push(m))}return h}},{key:"trueDraw",value:function(t,e,n,r){"WIRE"===this.object.display_type?this.drawWireframe(t,e,n):this._draw(t,e,n,r)}},{key:"checkOcclusion",value:function(t){var e=new rf;return X.copy(e.min,this.object.bound_box.min),X.copy(e.max,this.object.bound_box.max),z.dot(e.matrix,ono3d.worldMatrix,this.matrix),e.matrix,!e.checkConvexes(t,this)}},{key:"checkBoundingPlanes",value:function(t){var e=!0,n=z.alloc(),r=X.alloc(),o=this.object.bound_box;z.dot(n,ono3d.worldMatrix,this.matrix);for(var i=0;i<t.bounding_planes.length;i++){for(var a=t.bounding_planes[i],u=0;u<3;u++)n[3*u+0]*a.normal[0]+n[3*u+1]*a.normal[1]+n[3*u+2]*a.normal[2]>0?r[u]=o.max[u]:r[u]=o.min[u];if(z.dotVec3(r,n,r),!a.hitCheck(r)){e=!1;break}}return z.free(1),X.free(1),e}},{key:"_draw",value:function(t,e,n,r){var o=this.object;if("MESH"!==o.type)return null;var i=o.o3o;df[0]=Ef(yf,"defaultMaterial");var a=i.materials,u=null;this.o3oInstance.custom_material&&(u=this.o3oInstance.custom_material),u&&(df[0]=Ef(u,u.name_full));var s=o.material_slots;if(s){var c=1;s.forEach(function(t){if(u)df[c]=df[0];else{var e=t,n=a.find(function(t){return t.name_full==e});df[c]=Ef(n,i.name+"_"+n.name_full)}c++})}else c=1,a.foreach(function(t){df[c]=u?df[0]:Ef(t,i.name+"_"+t.name),c++});t||(t=ono3d.environments[0],n=0),e||(e=ono3d.environments[0]),this.freezeMesh(oc),oc.vertices;var f,l,h,p,v,y=ono3d.verticesFloat32Array,m=ono3d.vertices_index,b=ono3d.faces,d=ono3d.faces_index,g=0,w=(ono3d.materials,ono3d.smoothing),_=0,x=0;oc.uv_layerSize&&(p=oc.uv_layers[0].data,v=oc.uv_layers[0].data),oc.uv_layerSize>=2&&(v=oc.uv_layers[1].data);var j=oc.vertices,O=oc.faces;for(c=0;c<oc.faceSize;c++){var S=O[c].normal,E=O[c].idx;3==O[c].idxnum?X.cross2(S,j[E[0]].pos,j[E[1]].pos,j[E[2]].pos):X.cross3(S,j[E[0]].pos,j[E[2]].pos,j[E[1]].pos,j[E[3]].pos),X.norm(S)}if(o.data.use_auto_smooth||engine.use_smoothing){for(c=0;c<oc.vertexSize;c++)j[c].normal.fill(0);for(c=0;c<oc.faceSize;c++){E=O[c].idx;var P=O[c].normal;S=j[E[0]].normal,X.add(S,S,P),S=j[E[1]].normal,X.add(S,S,P),S=j[E[2]].normal,X.add(S,S,P),4==O[c].idxnum&&(S=j[E[3]].normal,X.add(S,S,P))}for(c=oc.vertexSize;c--;)X.norm(j[c].normal)}else w=0;var T=t.lightProbe;T||(T=ono3d.environments[0].lightProbe);var k=null;if(T){var M=T.bspTree,R=new X;X.setValue(R,this.matrix[9],this.matrix[10],this.matrix[11]),k=M.getItem(R)}if(k){var I=T.shcoefs,A=k.bsps,C=k.pIdx;sf.forEach(function(t){X.setValue(t,0,0,0)});for(var F=0;F<4;F++){var N=I[C[F]],B=X.dot(A[F].v,R)-A[F].m;for(c=0;c<sf.length;c++)X.madd(sf[c],sf[c],N[c],B)}}else if(ono3d.environments[0].default_shcoef){var U=ono3d.environments[0].default_shcoef;for(c=0;c<sf.length;c++)sf[c].set(U[c])}else sf.forEach(function(t){X.setValue(t,0,0,0)});var L=d,V=20*m,D=X.alloc(),G=X.alloc(),z=X.alloc(),H=X.alloc();if(!(1&r))if(2&r)for(c=0;c<oc.faceSize;c++){E=(f=O[c]).idx,E=(f=O[c]).idx;for(var q=0;q<f.idxnum-2;q++){l=b[L],L++,g++,l.material=null,l.vertices[0]=m,l.vertices[1]=m+1,l.vertices[2]=m+2;var Y=j[q],W=[0,1+q,2+q];for(F=0;F<3;F++)Y=j[E[W[F]]],y[V]=Y.pos[0],y[V+1]=Y.pos[1],y[V+2]=Y.pos[2],m++,V+=20}}else{for(c=0;c<oc.faceSize;c++)for(E=(f=O[c]).idx,q=0;q<f.idxnum-2;q++){l=b[L],L++,g++;var Q=f.normal;l.material=ono3d.materials[df[f.mat+1]],l.environments[0]=t,l.environments[1]=e,l.environmentRatio=n,h=null,f.mat>=0&&p&&(_=l.material.offsetx,x=l.material.offsety,h=p[c]);var $=null;v&&($=v[c]),X.setValue(D,-Q[1],Q[2],Q[0]),X.setValue(G,Q[2],-Q[0],Q[1]),l.material.heightMap&&xn.calcST(D,G,j[E[0]].pos,j[E[1+q]].pos,j[E[2+q]].pos,h[0],h[1],h[2*(1+q)],h[2*(1+q)+1],h[2*(2+q)],h[2*(2+q)+1]),l.vertices[0]=m,l.vertices[1]=m+1,l.vertices[2]=m+2,Y=j[q];var K=f.normal[0]*(1-w),Z=f.normal[1]*(1-w),tt=f.normal[2]*(1-w);for(W=[0,1+q,2+q],F=0;F<3;F++)Y=j[E[W[F]]],y[V]=Y.pos[0],y[V+1]=Y.pos[1],y[V+2]=Y.pos[2],y[V+3]=H[0]=Y.normal[0]*w+K,y[V+4]=H[1]=Y.normal[1]*w+Z,y[V+5]=H[2]=Y.normal[2]*w+tt,y[V+6]=D[0],y[V+7]=D[1],y[V+8]=D[2],y[V+9]=G[0],y[V+10]=G[1],y[V+11]=G[2],h&&(y[V+12]=h[2*W[F]]+_,y[V+13]=h[2*W[F]+1]+x),y[V+14]=l.environmentRatio,$&&(y[V+15]=$[2*W[F]]+_,y[V+16]=$[2*W[F]+1]+x),nt.decode2xyz(z,sf,H[0],H[1],H[2]),y[V+17]=z[0],y[V+18]=z[1],y[V+19]=z[2],m++,V+=20}if(ono3d.rf&xn.RF_OUTLINE){var et,rt=J.alloc();J.getInv(rt,ono3d.viewMatrix);var ot=rt[12],it=rt[13],at=rt[14];for(J.free(1),c=0;c<oc.faceSize;c++)et=O[c],1-f.fs?(H=et.normal,(j[(E=et.idx)[0]].pos[0]-ot)*H[0]+(j[E[0]].pos[1]-it)*H[1]+(j[E[0]].pos[2]-at)*H[2]<0?et.cul=1:et.cul=-1):et.cul=0;var ut=ono3d.materials[ono3d.materials_index];ono3d.materials_index++;var st=ono3d.materials[ono3d.materials_index];ono3d.materials_index++,X.copy(ut.baseColor,ono3d.lineColor),ut.opacity=1,ut.shader="plain",ut.bold=ono3d.lineWidth,ut.name="line",X.copy(st.baseColor,ono3d.lineColor),st.opacity=.99*ono3d.lineColor[3],st.shader="plain",st.bold=ono3d.lineWidth,st.name="line_alpha";var ct=oc.edges,ft=ono3d.lines_index,lt=ono3d.lines;for(c=0;c<oc.edgeSize;c++){var ht=ut;if(!((mt=ct[c]).fIndices[0]<0)){if(mt.fIndices[1]<0){var pt=ono3d.materials[df[O[mt.fIndices[0]].mat+1]];if(O[mt.fIndices[0]].cul<1)continue;1!==pt.opacity&&(ht=st)}else{if(O[mt.fIndices[0]].cul*O[mt.fIndices[1]].cul>-1)continue;pt=ono3d.materials[df[O[mt.fIndices[0]].mat+1]];var vt=ono3d.materials[df[O[mt.fIndices[1]].mat+1]];1===pt.opacity&&1===vt.opacity||(ht=st)}(yt=lt[ft]).material=ht,ft++,X.copy(yt.pos[0],j[mt.vIndices[0]].pos),X.copy(yt.pos[1],j[mt.vIndices[1]].pos)}}ono3d.lines_index=ft}}if(1&r){for(ut=ono3d.materials[ono3d.materials_index],ono3d.materials_index++,st=ono3d.materials[ono3d.materials_index],ono3d.materials_index++,X.copy(ut.baseColor,ono3d.lineColor),ut.opacity=1,ut.shader="plain",ut.bold=ono3d.lineWidth,ut.name="line",X.copy(st.baseColor,ono3d.lineColor),st.opacity=.99*ono3d.lineColor[3],st.shader="plain",st.bold=ono3d.lineWidth,st.name="line_alpha",ct=oc.edges,ft=ono3d.lines_index,lt=ono3d.lines,c=0;c<oc.edgeSize;c++){var yt,mt=ct[c];ht=ut,(yt=lt[ft]).material=ht,ft++,X.copy(yt.pos[0],j[mt.vIndices[0]].pos),X.copy(yt.pos[1],j[mt.vIndices[1]].pos)}ono3d.lines_index=ft}ono3d.vertices_index=m,ono3d.faces_index+=g,X.free(4)}},{key:"getPoints",value:function(){this.freezeMesh(oc);for(var t,e=oc.vertexSize,n=[],r=0;r<e;r++)t=new X,X.copy(t,oc.vertices[r].pos),n.push(t);return n}},{key:"bind",value:function(t){var e=this.o3oInstance.objectInstances_hash[t.object],n=(this.object,new is),r=4096;for(n.ratios=[],n.vertices=Xs.array(r),n.faces=Qs.array(r),n.edges=tc.array(r),u=0;u<r;u++)n.ratios.push(new q);e.freezeMesh(n),this.freezeMesh(oc);for(var o=[],i=X.alloc(),a=X.alloc(),u=0;u<oc.vertexSize;u++){for(var s=oc.vertices[u].pos,c=[],f=0;f<n.faceSize;f++){for(var l=99999999,h=0;h<n.faces[f].idxnum-2;h++)Wn.TRIANGLE_POINT(i,n.vertices[n.faces[f].idx[0]].pos,n.vertices[n.faces[f].idx[1+h]].pos,n.vertices[n.faces[f].idx[2+h]].pos,s),l=Math.min(l,X.len2(i,s));for(h=0,h=0;h<c.length&&!(c[h].weight>l);h++);h<2&&((y={idx:-1,weight:99999,len:0,pweight:[0,0,0]}).idx=f,y.weight=l,c.splice(h,0,y),c.splice(2,c.length-2))}var p=0,v=X.alloc();for(f=0;f<c.length;f++){var y=c[f];if(0===y.weight){for(h=0;h<y.length;h++)c[h].weight=0;y.weight=1,p=1;break}y.weight=1/Math.sqrt(y.weight),p+=y.weight;var m=n.faces[y.idx];X.cross2(i,n.vertices[m.idx[0]].pos,n.vertices[m.idx[1]].pos,n.vertices[m.idx[2]].pos),X.norm(i),X.sub(a,s,n.vertices[m.idx[0]].pos),y.len=X.dot(i,a),4==m.idxnum?(Wn.calcSquarePos(y.pweight,n.vertices[m.idx[0]].pos,n.vertices[m.idx[1]].pos,n.vertices[m.idx[2]].pos,n.vertices[m.idx[3]].pos,s),y.pweight[2]=y.pweight[0]*y.pweight[1]):(X.sub(v,n.vertices[m.idx[2]].pos,n.vertices[m.idx[1]].pos),X.add(v,n.vertices[m.idx[0]].pos,v),Wn.calcSquarePos(y.pweight,n.vertices[m.idx[0]].pos,n.vertices[m.idx[1]].pos,n.vertices[m.idx[2]].pos,v,s),y.pweight[2]=0),y.pweight[3]=y.len}for(X.free(1),p=1/p,f=0;f<c.length;f++)c[f].weight*=p;o.push(c)}t.binddata=o;var b=[];for(u=0;u<n.vertexSize;u++)b.push(new X),X.copy(b[u],n.vertices[u].pos);t.basePos=b,X.free(2)}}]),t}(),Ef=function(t,e){for(var n,r=ono3d.materials,o=0;o<ono3d.materials_index;o++)if(r[o].name===e)return o;return n=r[o],ono3d.materials_index++,"OPAQUE"!=t.blend_method?n.blend_method=1:n.blend_method=0,n.offsetx=t.uvOffset[0],n.offsety=t.uvOffset[1],n.name=e,X.copy(n.baseColor,t.baseColor),n.opacity=t.opacity,n.metallic=t.metallic,n.specular=t.specular,n.roughness=t.roughness,n.ior=t.ior,n.subRoughness=t.subRoughness,n.emt=t.emt,n.baseColorMap=t.baseColorMap,n.orgMap=t.orgMap,n.heightMap=t.heightMap,n.heightMapPower=t.heightMapPower,n.heightBase=t.heightBase,n.pbrMap=t.pbrMap,n.lightMap=t.lightMap,n.shader=t.shader,o},Pf=function(t,e){t.name=e.name,t.vertices.buf.set(e.vertices.buf),t.vertexSize=e.vertexSize,t.edges.buf.set(e.edges.buf),t.edgeSize=e.edgeSize;for(var n=0;n<e.faceSize;n++){var r=t.faces[n],o=e.faces[n];r.material=o.material,r.mat=o.mat,r.idxnum=o.idxnum,r.fs=o.fs}e.faces.length>0&&t.faces.buf.set(e.faces.buf),t.faceSize=e.faceSize;var i=e.uv_layersSize-t.uv_layers.length;for(n=0;n<i;n++)t.uv_layers.push(new Xu);for(n=0;n<e.uv_layerSize;n++){var a=e.uv_layers[n].data;t.uv_layers.length<=n&&t.uv_layers.push(new Xu);var u=t.uv_layers[n].data;i=e.faceSize-u.length;for(var s=0;s<i;s++)u.push([]);for(s=0;s<e.faceSize;s++)u[s][0]=a[s][0],u[s][1]=a[s][1],u[s][2]=a[s][2],u[s][3]=a[s][3],u[s][4]=a[s][4],u[s][5]=a[s][5],u[s][6]=a[s][6],u[s][7]=a[s][7]}t.uv_layerSize=e.uv_layerSize};function Tf(t){return Tf="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Tf(t)}function kf(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,Mf(r.key),r)}}function Mf(t){var e=function(t){if("object"!=Tf(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var n=e.call(t,"string");if("object"!=Tf(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==Tf(e)?e:e+""}var Rf=function(){function t(e,n){if(function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.objectInstances=[],this.objectInstances_hash=[],this.lightInstances=[],e){var r;r=n||e.objects;for(var o=0;o<r.length;o++)null!=(a=r[o])&&(a.idx=o,(u=new Sf(a)).o3oInstance=this,this.objectInstances.push(u),this.objectInstances_hash[a.name]=u);for(z.setInit(ono3d.worldMatrix),this.calcMatrix(0,!0),this.objectInstances.forEach(function(t){t.createPhyObj(),t.createCollision()}),o=0;o<r.length;o++)if(r[o].rigid_body_constraint){var i=If(r[o],this.objectInstances);this.objectInstances[o].joint=i}for(o=0;o<r.length;o++)for(var a=r[o],u=this.objectInstances[o],s=0;s<a.modifiers.length;s++)"MESH_DEFORM"===a.modifiers[s].type&&u.bind(a.modifiers[s])}}return function(t,e){e&&kf(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1})}(t,[{key:"searchObject",value:function(t){var e=this.objectInstances,n=e.find(function(e){return e.object.name===t});return n||(e.forEach(function(e){if(n=e.searchObject(t))return!1}),n)}},{key:"calcMatrix",value:function(t,e){for(var n=0;n<this.objectInstances.length;n++)this.objectInstances[n].resetMatrix();for(n=0;n<this.objectInstances.length;n++)this.objectInstances[n].calcMatrix(t,e)}},{key:"draw",value:function(){this.objectInstances.forEach(function(t){t.object.hide_render||t.draw()})}},{key:"joinCollision",value:function(t){var e=this.objectInstances;new z,e.forEach(function(e){e.collision&&t.addCollision(e.collision)})}},{key:"joinPhyObj",value:function(t){var e=this.objectInstances,n=new z;e.forEach(function(e){e.phyObj&&t.addPhyObj(e.phyObj),e.fluid&&t.fluids.push(e.fluid)});for(var r=0;r<e.length;r++)if(e[r].joint){var o=e[r].joint;z.getInv(n,o.parent.matrix),z.dot(o.matrix,n,e[r].matrix),z.getInv(n,o.child.matrix),z.dot(o.matrix2,n,e[r].matrix),t.addJoint(e[r].joint)}}}]),t}(),If=function(t,e){var n=function(t){for(var n=0;n<e.length;n++)if(t==e[n].object.name)return e[n].phyObj;return null},r=t.rigid_body_constraint;if(r.enabled&&r.object1&&r.object2){var o=null;(o=new pu.Joint).breaking_threshold=r.breaking_threshold,o.disable_collisions=r.disable_collisions,o.enabled=r.enabled,X.copy(o.limit_ang_lower,r.limit_ang_lower),X.copy(o.limit_ang_upper,r.limit_ang_upper),X.copy(o.limit_lin_lower,r.limit_lin_lower),X.copy(o.limit_lin_upper,r.limit_lin_upper),o.motor_ang_max_impulse=r.motor_ang_max_impulse,o.motor_ang_target_velocity=r.motor_ang_target_velocity,o.motor_lin_max_impulse=r.motor_lin_max_impulse,o.motor_lin_target_velocity=r.motor_lin_target_velocity,o.object1=r.object1,o.object2=r.object2,X.copy(o.spring_damping,r.spring_damping),X.copy(o.spring_stiffness,r.spring_stiffness),X.copy(o.spring_damping_ang,r.spring_damping_ang),X.copy(o.spring_stiffness_ang,r.spring_stiffness_ang),o.use_breaking=r.use_breaking,X.copy(o.use_limit_ang,r.use_limit_ang),X.copy(o.use_limit_lin,r.use_limit_lin),o.use_motor_ang=r.use_motor_ang,o.use_motor_lin=r.use_motor_lin,X.copy(o.use_spring,r.use_spring),X.copy(o.use_spring_ang,r.use_spring_ang);var i=0;"FIXED"==r.type?i=119:"POINT"==r.type?i=7:"HINGE"==r.type?i=87:"SLIDER"==r.type?i=118:"PISTON"==r.type&&(i=102);for(var a=0;a<3;a++)i>>a&1&&(o.use_limit_lin[a]=1,o.limit_lin_upper[a]=0,o.limit_lin_lower[a]=0),i>>a&16&&(o.use_limit_ang[a]=1,o.limit_ang_upper[a]=0,o.limit_ang_lower[a]=0);"GENERIC_SPRING"!=r.type&&(X.setValue(o.use_spring,0,0,0),X.setValue(o.use_spring_ang,0,0,0)),"MOTOR"==r.type?(X.setValue(o.use_limit_lin,0,0,0),X.setValue(o.use_limit_ang,0,0,0),X.setValue(o.use_spring,0,0,0),X.setValue(o.use_spring_ang,0,0,0)):(o.use_motor_lin=0,o.use_motor_ang=0),o.object1=n(o.object1.name),o.object2=n(o.object2.name),o.parent=o.object1,o.child=o.object2;var u=new z,s=e[t.idx];return z.getInv(u,o.parent.matrix),z.dot(o.matrix,u,s.matrix),z.getInv(u,o.child.matrix),z.dot(o.matrix2,u,s.matrix),o}};function Af(t){return Af="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Af(t)}function Cf(){var t=Vf(),e=t.m(Cf),n=(Object.getPrototypeOf?Object.getPrototypeOf(e):e.__proto__).constructor;function r(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===n||"GeneratorFunction"===(e.displayName||e.name))}var o={throw:1,return:2,break:3,continue:3};function i(t){var e,n;return function(r){e||(e={stop:function(){return n(r.a,2)},catch:function(){return r.v},abrupt:function(t,e){return n(r.a,o[t],e)},delegateYield:function(t,o,i){return e.resultName=o,n(r.d,Ff(t),i)},finish:function(t){return n(r.f,t)}},n=function(t,n,o){r.p=e.prev,r.n=e.next;try{return t(n,o)}finally{e.next=r.n}}),e.resultName&&(e[e.resultName]=r.v,e.resultName=void 0),e.sent=r.v,e.next=r.n;try{return t.call(this,e)}finally{r.p=e.prev,r.n=e.next}}}return(Cf=function(){return{wrap:function(e,n,r,o){return t.w(i(e),n,r,o&&o.reverse())},isGeneratorFunction:r,mark:t.m,awrap:function(t,e){return new Gf(t,e)},AsyncIterator:Lf,async:function(t,e,n,o,a){return(r(e)?Uf:Bf)(i(t),e,n,o,a)},keys:Nf,values:Ff}})()}function Ff(t){if(null!=t){var e=t["function"==typeof Symbol&&Symbol.iterator||"@@iterator"],n=0;if(e)return e.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length))return{next:function(){return t&&n>=t.length&&(t=void 0),{value:t&&t[n++],done:!t}}}}throw new TypeError(Af(t)+" is not iterable")}function Nf(t){var e=Object(t),n=[];for(var r in e)n.unshift(r);return function t(){for(;n.length;)if((r=n.pop())in e)return t.value=r,t.done=!1,t;return t.done=!0,t}}function Bf(t,e,n,r,o){var i=Uf(t,e,n,r,o);return i.next().then(function(t){return t.done?t.value:i.next()})}function Uf(t,e,n,r,o){return new Lf(Vf().w(t,e,n,r),o||Promise)}function Lf(t,e){function n(r,o,i,a){try{var u=t[r](o),s=u.value;return s instanceof Gf?e.resolve(s.v).then(function(t){n("next",t,i,a)},function(t){n("throw",t,i,a)}):e.resolve(s).then(function(t){u.value=t,i(u)},function(t){return n("throw",t,i,a)})}catch(t){a(t)}}var r;this.next||(Df(Lf.prototype),Df(Lf.prototype,"function"==typeof Symbol&&Symbol.asyncIterator||"@asyncIterator",function(){return this})),Df(this,"_invoke",function(t,o,i){function a(){return new e(function(e,r){n(t,i,e,r)})}return r=r?r.then(a,a):a()},!0)}function Vf(){var t,e,n="function"==typeof Symbol?Symbol:{},r=n.iterator||"@@iterator",o=n.toStringTag||"@@toStringTag";function i(n,r,o,i){var s=r&&r.prototype instanceof u?r:u,c=Object.create(s.prototype);return Df(c,"_invoke",function(n,r,o){var i,u,s,c=0,f=o||[],l=!1,h={p:0,n:0,v:t,a:p,f:p.bind(t,4),d:function(e,n){return i=e,u=0,s=t,h.n=n,a}};function p(n,r){for(u=n,s=r,e=0;!l&&c&&!o&&e<f.length;e++){var o,i=f[e],p=h.p,v=i[2];n>3?(o=v===r)&&(s=i[(u=i[4])?5:(u=3,3)],i[4]=i[5]=t):i[0]<=p&&((o=n<2&&p<i[1])?(u=0,h.v=r,h.n=i[1]):p<v&&(o=n<3||i[0]>r||r>v)&&(i[4]=n,i[5]=r,h.n=v,u=0))}if(o||n>1)return a;throw l=!0,r}return function(o,f,v){if(c>1)throw TypeError("Generator is already running");for(l&&1===f&&p(f,v),u=f,s=v;(e=u<2?t:s)||!l;){i||(u?u<3?(u>1&&(h.n=-1),p(u,s)):h.n=s:h.v=s);try{if(c=2,i){if(u||(o="next"),e=i[o]){if(!(e=e.call(i,s)))throw TypeError("iterator result is not an object");if(!e.done)return e;s=e.value,u<2&&(u=0)}else 1===u&&(e=i.return)&&e.call(i),u<2&&(s=TypeError("The iterator does not provide a '"+o+"' method"),u=1);i=t}else if((e=(l=h.n<0)?s:n.call(r,h))!==a)break}catch(e){i=t,u=1,s=e}finally{c=1}}return{value:e,done:l}}}(n,o,i),!0),c}var a={};function u(){}function s(){}function c(){}e=Object.getPrototypeOf;var f=[][r]?e(e([][r]())):(Df(e={},r,function(){return this}),e),l=c.prototype=u.prototype=Object.create(f);function h(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,c):(t.__proto__=c,Df(t,o,"GeneratorFunction")),t.prototype=Object.create(l),t}return s.prototype=c,Df(l,"constructor",c),Df(c,"constructor",s),s.displayName="GeneratorFunction",Df(c,o,"GeneratorFunction"),Df(l),Df(l,o,"Generator"),Df(l,r,function(){return this}),Df(l,"toString",function(){return"[object Generator]"}),(Vf=function(){return{w:i,m:h}})()}function Df(t,e,n,r){var o=Object.defineProperty;try{o({},"",{})}catch(t){o=0}Df=function(t,e,n,r){function i(e,n){Df(t,e,function(t){return this._invoke(e,n,t)})}e?o?o(t,e,{value:n,enumerable:!r,configurable:!r,writable:!r}):t[e]=n:(i("next",0),i("throw",1),i("return",2))},Df(t,e,n,r)}function Gf(t,e){this.v=t,this.k=e}function zf(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,Xf(r.key),r)}}function Xf(t){var e=function(t){if("object"!=Af(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var n=e.call(t,"string");if("object"!=Af(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==Af(e)?e:e+""}function Hf(t,e,n,r,o,i,a){try{var u=t[i](a),s=u.value}catch(t){return void n(t)}u.done?e(s):Promise.resolve(s).then(r,o)}function qf(t){return function(){var e=this,n=arguments;return new Promise(function(r,o){var i=t.apply(e,n);function a(t){Hf(i,r,o,a,u,"next",t)}function u(t){Hf(i,r,o,a,u,"throw",t)}a(void 0)})}}var Yf=null;function Wf(t,e){return Qf.apply(this,arguments)}function Qf(){return(Qf=qf(Cf().mark(function t(e,n){return Cf().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,Ll.texture(e,function(t){n&&n(t)});case 2:return t.abrupt("return",t.sent);case 3:case"end":return t.stop()}},t)}))).apply(this,arguments)}var $f={};$f.rotation_quaternion=Cc.ROT_QUAT,$f.rotation_euler=Cc.ROT_EULER,$f.location=Cc.LOCATION,$f.scale=Cc.SCALE,$f.offset=Cc.OFFSET,$f.value=Cc.SHAPEKEY;var Jf=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.libraries=[],this.scenes=[],this.worlds=[],this.collections=[],this.objects=[],this.objects_name_hash=[],this.materials=[],this.meshes=[],this.meshes_name_hash=[],this.armatures=[],this.actions=[],this.actions_name_hash=[],this.lights=[],this.cameras=[],this.environments=[],this.reflectionProbes=[]}return function(t,e,n){e&&zf(t.prototype,e),n&&zf(t,n),Object.defineProperty(t,"prototype",{writable:!1})}(t,[{key:"getCollectionObjectList",value:function(t){var e=this,n=[];return t?(t.children.forEach(function(t){var r=e.getCollectionObjectList(t);n=n.concat(r)}),t.objects.forEach(function(t){n.push(e.objects_name_hash[t])}),n):n}},{key:"createInstance",value:function(){return new Rf(this)}},{key:"calcMatrix",value:function(t,e){for(var n=0;n<this.objects.length;n++)this.objects[n].resetMatrix();for(n=0;n<this.objects.length;n++)this.objects[n].calcMatrix(t,e)}},{key:"getAction",value:function(t){var e=this.actions.find(function(t){return t.name_full===this},t);return e?(e.library&&(e=this.libraries_name_hash[e.library].o3o.actions.find(function(t){return t.name_full===this},e.name)),e):null}}],[{key:"calcAov",value:function(t){return Math.max(t.sensor_width,t.sensor_height)/t.lens*.5}}]),t}();!function(t,e,n){(e=Xf(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n}(Jf,"Material",Mu),Jf.setOno3d=function(t){Yf=t,window.ono3d=t},Jf.load=function(t,e){return new Promise(function(n){var r=new Jf;Ut.loadText(t,function(){var o=qf(Cf().mark(function o(i){return Cf().wrap(function(o){for(;;)switch(o.prev=o.next){case 0:if(i){o.next=5;break}e&&e(null),n(null),o.next=11;break;case 5:return o.next=7,tl(r,t,i);case 7:if(!e){o.next=10;break}return o.next=10,e(r);case 10:n(r);case 11:case"end":return o.stop()}},o)}));return function(t){return o.apply(this,arguments)}}())})};var Kf={};Kf.armatures=Lu,Kf.actions=jc,Kf.objects=yc,Kf.scenes=gs,Kf.worlds=Os,Kf.lights=ts,Kf.reflectionprobes=Lc,Kf.bones=Qu,Kf.uv_layers=Xu,Kf.fcurves=Ic;var Zf=function t(e,n){for(var r in n){var o=n[r],i=e[r];if(null!=o){var a=Af(o);if("string"==a||"number"==a)e[r]=o;else if(i instanceof Int8Array||i instanceof Int16Array)for(var u=0;u<o.length;u++)i[u]=0|o[u];else if(i instanceof Float32Array)for(u=0;u<o.length;u++)i[u]=o[u];else if(i instanceof Array&&o.length>0)if("string"==typeof o[0]||"number"==typeof o[0])e[r]=o;else if(Kf[r])for(u=0;u<o.length;u++){var s=new Kf[r];t(s,o[u]),i.push(s)}else if(i.length>0)for(u=0;u<o.length;u++)t(i[u],o[u]);else e[r]=o;else e[r]=o}}},tl=function(){var t=qf(Cf().mark(function t(e,n,r){var o,i,a,u,s,c,f,l,h,p,v,y,m,b,d,g,w,_,x,j,O,S,E,P,T,k,M,R,I,A,C,F,N,B,U,L,V,D,G,X,H,q,Y,W,Q,$,J,K,Z,tt,et;return Cf().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:for(u=/.*\//.exec(n),s="./",u&&(s=u[0]),c=JSON.parse(r),f=c.materials.length,o=0;o<f;o++)e.materials.push(new Mu);f=c.meshes.length,o=0;case 8:if(!(o<f)){t.next=19;break}if(l=c.meshes[o],h=new is,e.meshes.push(h),!l.library){t.next=14;break}return t.abrupt("continue",16);case 14:h.vertices=Xs.array(l.vertices.length),h.faces=Qs.array(l.faces.length);case 16:o++,t.next=8;break;case 19:Zf(e,c),p=e.libraries,o=0;case 22:if(!(o<p.length)){t.next=32;break}return v=p[o],y=(y=v.filepath.replace(/^\/\//,s)).replace(/\.blend/,".o3o"),t.next=28,Uh.AssetManager.o3o(y);case 28:v.o3o=t.sent;case 29:o++,t.next=22;break;case 32:e.libraries_name_hash={},e.libraries.forEach(function(t){e.libraries_name_hash[t.name_full]=t}),t.t0=Cf().keys(e);case 35:if((t.t1=t.t0()).done){t.next=45;break}if("collections"!==(m=t.t1.value)){t.next=39;break}return t.abrupt("continue",35);case 39:if("libraries"!==m){t.next=41;break}return t.abrupt("continue",35);case 41:if((b=e[m])instanceof Array)for(o=0;o<b.length;o++)b[o].o3o=e;t.next=35;break;case 45:for(d in e.objects.forEach(function(t){var n=t;t.library&&(n=e.libraries_name_hash[t.library].o3o.objects_name_hash[t.name]),e.objects_name_hash[t.name_full]=n}),e.collections)for(g=e.collections[d],o=0;o<g.children.length;o++)g.children[o]=e.collections[g.children[o]];w={MESH:{objecttype:Ru,target:"meshes"},ARMATURE:{objecttype:Iu,target:"armatures"},LIGHT:{objecttype:Au,target:"lights"},LIGHT_PROBE:{objecttype:Cu,target:"reflectionProbes"},CAMERA:{objecttype:Au,target:"cameras"}},i=e.objects.length;case 50:if(!i--){t.next=86;break}j=e.objects[i],(O=w[j.type])?(j.objecttype=O.objecttype,S=null,(S=e[O.target].find(function(t){return t.name_full===this},j.data)).library&&(x=S.name,E=e.libraries_name_hash[S.library].o3o,S=E[O.target].find(function(t){return t.name_full===this},S.name)),j.data=S):(j.objecttype="",j.data=null),j.parent=e.objects.find(function(t){return t.name===this},j.parent),k=0;case 56:if(!(k<j.modifiers.length)){t.next=70;break}x=j.modifiers[k].vertex_group,j.modifiers[k].vertex_group=-1,P=0;case 60:if(!(P<j.groups.length)){t.next=67;break}if(j.groups[P]!==x){t.next=64;break}return j.modifiers[k].vertex_group=P,t.abrupt("break",67);case 64:P++,t.next=60;break;case 67:k++,t.next=56;break;case 70:if(j.animation_data&&j.animation_data.action&&(j.animation_data.action=e.getAction(j.animation_data.action)),j.rigid_body_constraint&&(j.rigid_body_constraint.object1=e.objects.find(function(t){return t.name===this},j.rigid_body_constraint.object1),j.rigid_body_constraint.object2=e.objects.find(function(t){return t.name===this},j.rigid_body_constraint.object2)),!j.animation_data||!j.animation_data.nla_tracks){t.next=83;break}T=j.animation_data.nla_tracks,k=0;case 75:if(!(k<T.length)){t.next=83;break}if((M=T[k].strips).length){t.next=79;break}return t.abrupt("continue",80);case 79:for(P=0;P<M.length;P++)(R=M[P]).action=e.getAction(R.action);case 80:k++,t.next=75;break;case 83:j.createCollision();case 84:t.next=50;break;case 86:o=0;case 87:if(!(o<e.meshes.length)){t.next=111;break}for(h=e.meshes[o],i=0;i<h.vertices.length;i++)if(0==(I=h.vertices[i]).groupWeights.length)for(o=0;o<I.groups.length;o++)I.groupWeights.push(1/I.groups.length);h.vertexSize=h.vertices.length,i=0;case 92:if(!(i<h.faces.length)){t.next=105;break}A=h.faces[i],k=0;case 95:if(!(k<4)){t.next=101;break}if(!(A.idx[k]<0)){t.next=98;break}return t.abrupt("break",101);case 98:k++,t.next=95;break;case 101:A.idxnum=k;case 102:i++,t.next=92;break;case 105:h.faceSize=h.faces.length,h.uv_layerSize=h.uv_layers.length,h.double_sided&&(h.flg&=~xn.RF_DOUBLE_SIDED,h.flg|=xn.RF_DOUBLE_SIDED,delete h.double_sided);case 108:o++,t.next=87;break;case 111:for(C=new yc,o=0;o<e.actions.length;o++)for(F=e.actions[o],N=F.slots,B=0;B<N.length;B++)for(U=N[B],i=0;i<U.fcurves.length;i++){for(L=U.fcurves[i],V=L.keys,delete L.keys,L.keys=[],L.params=[],L.interpolations=[],k=0;k<V.length;k++)L.keys.push(V[k].f),L.params.push(V[k].p),L.interpolations.push(V[k].i);"rotation_euler"===L.type&&(L.type="rotation"),C[L.type]||(L.idx=-1),C[L.type]&&!C[L.type].buffer&&(L.idx=-1)}for(i=e.objects.length;i--;)if("ARMATURE"===(j=e.objects[i]).type&&(j.pose=new ys(j),j.data.bones,j.pose.poseBones))for(k=0;k<j.pose.poseBones.length;k++)if((D=j.pose.poseBones[k]).constraints)for(P=0;P<D.constraints.length;P++)(G=D.constraints[P]).target=e.objects.find(function(t){return t.name===this},G.target);else D.constraints=[];for(o=e.meshes.length;o--;)for(h=e.meshes[o],i=h.faces.length;i--;)(A=h.faces[i]).material=e.materials[A.mat];o=e.armatures.length;case 117:if(!o--){t.next=135;break}X=e.armatures[o],i=X.bones.length;case 120:if(!i--){t.next=133;break}H=X.bones[i],z.getInv(H.i_matrix_local,H.matrix_local),k=X.bones.length;case 124:if(!k--){t.next=130;break}if(H.parent!==X.bones[k].name){t.next=128;break}return H.parent=X.bones[k],t.abrupt("break",130);case 128:t.next=124;break;case 130:H.id=i;case 131:t.next=120;break;case 133:t.next=117;break;case 135:for(i=e.objects.length;i--;)if((j=e.objects[i]).parent&&j.parent_bone)for(o=0;o<j.parent.data.bones.length;o++)j.parent_bone==j.parent.data.bones[o].name&&(j.parent_bone=o+1);s=Ut.getDir(n),e.name=n,(u=/[^\/]*$/.exec(n))&&(e.name=u[0]),e.objects.forEach(function(t){if("MESH"===t.type){var e=t.data.vertices;t.bound_box=new An,e.forEach(function(e){An.addPoint(t.bound_box,e.pos)})}}),e.meshes.forEach(function(t){e.meshes_name_hash[t.name_full]=t}),e.actions.forEach(function(t){e.actions_name_hash[t.name_full]=t}),o=e.worlds.length;case 144:if(!o--){t.next=154;break}if(!(q=e.worlds[o]).envTexture){t.next=152;break}return u=/[^\\\/]*$/.exec(q.envTexture),y=s+u[0],t.next=151,engine.loadEnvTexture(y);case 151:q.envTexture=t.sent;case 152:t.next=144;break;case 154:for(e.scenes_name_hash=[],o=e.scenes.length;o--;){for(_=e.scenes[o],i=_.objects.length;i--;)_.objects[i]=e.objects_name_hash[_.objects[i]];_.world=e.worlds.find(function(t){return t.name_full===this},_.world),e.scenes_name_hash[_.name]=_}Y=function(t,e){return""===t?null:(/[^\/\/]*$/.exec(t),Wf(t.replace(/^\/\//,s),function(t){var n=Ye.gl;n.bindTexture(n.TEXTURE_2D,t.gl_texture),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_S,n.REPEAT),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_T,n.REPEAT),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MAG_FILTER,n.LINEAR),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MIN_FILTER,n.LINEAR),e&&e(t)}))},o=e.materials.length;case 158:if(!o--){t.next=174;break}return W=e.materials[o],Q=function(t){var e=t;return function(t){var n=Ye.gl;"Closest"===e.interpolation&&(n.bindTexture(n.TEXTURE_2D,t.gl_texture),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MAG_FILTER,n.NEAREST),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MIN_FILTER,n.NEAREST),n.bindTexture(n.TEXTURE_2D,null)),"sRGB"===e.colorspace&&(t.toLinear(),n.bindTexture(n.TEXTURE_2D,t.gl_texture),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_S,n.REPEAT),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_T,n.REPEAT),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MIN_FILTER,n.NEAREST_MIPMAP_NEAREST),n.generateMipmap(n.TEXTURE_2D),n.bindTexture(n.TEXTURE_2D,null),n.bindFramebuffer(n.FRAMEBUFFER,null),e.colorspace="_sRGB")}}(W),t.next=163,Y(W.baseColorMap,Q);case 163:if(W.baseColorMap=t.sent,W.heightMap=Y(W.heightMap,function(t){var e=Ye.gl;e.bindTexture(e.TEXTURE_2D,t.gl_texture),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.NEAREST_MIPMAP_NEAREST),e.generateMipmap(e.TEXTURE_2D)}),W.lightMap=Y(W.lightMap),""===W.shader){t.next=172;break}if(!Yf.shaders[W.shader]){t.next=169;break}return t.abrupt("continue",172);case 169:Ut.getCurrent(),$=W.shader,Yf.shaders[$]=xn.loadShader(s+$+".shader");case 172:t.next=158;break;case 174:for(J=function(t,e,n,r){var o,i;for(o=0,i=t.length;o<i;o++)if(t[o].vIndices[0]===e&&t[o].vIndices[1]===n||t[o].vIndices[0]===n&&t[o].vIndices[1]===e)return t[o].fIndices[0]<0?t[o].fIndices[0]=r:t[o].fIndices[1]=r,0;var a=new tc;return a.vIndices[0]=e,a.vIndices[1]=n,a.fIndices[0]=r,a.fIndices[1]=-1,t.push(a),1},o=0;o<e.meshes.length;o++){for(K=e.meshes[o].faces,e.meshes[o].edges?Z=e.meshes[o].edges:(Z=[],e.meshes[o].edges=Z),i=0,a=K.length;i<a;i++){for((A=K[i]).idx[3]>=0?A.idxnum=4:A.idxnum=3,k=0;k<A.idxnum-1;k++)J(Z,A.idx[k],A.idx[k+1],i);J(Z,A.idx[A.idxnum-1],A.idx[0],i)}for(e.meshes[o].edgeSize=Z.length,tt=tc.array(e.meshes[o].edgeSize),i=0;i<Z.length;i++)et=tt[i].vIndices,new Int8Array(et.buffer,et.byteOffset).set(new Int8Array(Z[i].vIndices.buffer));e.meshes[o].edges=tt}return t.abrupt("return",e);case 178:case"end":return t.stop()}},t)}));return function(e,n,r){return t.apply(this,arguments)}}(),el=(Jf.addaction=function(t,e,n,r,o,i){var a,u,s,c,f,l,h,p,v,y,m=q.alloc();void 0===i&&(i=1);var b=1-i;o&&(/\.R/.test(e)?e=e.replace(".R",".L"):/\.L/.test(e)&&(e=e.replace(".L",".R")));for(var d=n.fcurves,g=0,w=d.length;g<w;g++)if(d[g].target===e){for(h=(l=d[g]).keys,p=l.interpolations,c=r,a=0,u=l.keys.length-1,c<h[a]&&(c=l.CYCLES&&l.keys.length>1?h[u]-(h[a]-c)%(h[u]-h[a]):h[a]),c>h[u]&&(c=l.CYCLES&&l.keys.length>1?h[a]+(c-h[u])%(h[u]-h[a]):h[u]);a+1<u;)h[s=a+u>>1]<=c?a=s:u=s;c===h[a]&&(v=l.params[a]),c===h[u]?v=l.params[u]:"C"===p[a]?v=l.params[a]:(f=(c-h[a])/(h[a+1]-h[a]),v=l.params[a],y=l.params[a+1],"rotation_quaternion"===l.type?(q.slerp(m,v,y,f),v=m):v=(y-v)*f+v),"rotation_quaternion"===l.type?(q.copy(m,v),o&&(m[3]*=-1,m[2]*=-1),q.slerp(t.rotation,t.rotation,m,i)):l.idx>=0?t[l.type][l.idx]=t[l.type][l.idx]*b+v*i:t[l.type]=t[l.type]*b+v*i}q.free(1)},function(t,e){t.vertices[0]=e.vertices[0],t.vertices[1]=e.vertices[1],t.vertices[2]=e.vertices[2],t.environments[0]=e.environments[0],t.environments[1]=e.environments[1],t.environmentRatio=e.environmentRatio,t.material=e.material});function nl(t){return nl="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},nl(t)}function rl(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,ol(r.key),r)}}function ol(t){var e=function(t){if("object"!=nl(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var n=e.call(t,"string");if("object"!=nl(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==nl(e)?e:e+""}Jf.drawStaticFaces=function(t){for(var e=Yf.faces_index,n=Yf.faces,r=0;r<t.length;r++)el(n[e+r],t[r]);Yf.faces_index+=t.length},Jf.setEnvironments=function(t){for(var e,n=z.alloc(),r=0;r<t.objects.length;r++){var o=t.objects[r];if("LIGHT"===o.type){e=Yf.environments[0];var i,a=o.data;(i="SUN"===a.type?e.sun:e.area).power=1,X.copy(i.color,a.color),z.fromLSE(n,o.location,o.scale,o.rotation),J.dotMat43(i.matrix,Yf.worldMatrix,n),z.fromRotVector(n,.5*Math.PI,1,0,0),J.dotMat43(i.matrix,i.matrix,n),Yf.setOrtho(10,10,.1,80);var u=Yf.viewMatrix;J.getInv(u,i.matrix),J.dot(i.viewmatrix,Yf.projectionMatrix,u)}}z.free(1)},window.AudioContext=window.AudioContext||window.webkitAudioContext;var il=new AudioContext,al=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.gain=il.createGain(),this.gain.connect(il.destination),this.gain.gain.value=.5}return function(t,e,n){e&&rl(t.prototype,e),n&&rl(t,n),Object.defineProperty(t,"prototype",{writable:!1})}(t,[{key:"playSound",value:function(t,e){var n=this;if("play"===this.status){if(!e)return;this.stop()}var r=il.createBufferSource();r.loop=t,r.buffer=this.audioBuffer,r.connect(this.gain),r.start(),r.addEventListener("ended",function(){n.status="stop"}),this.node=r,this.status="play"}},{key:"stop",value:function(){this.node&&(this.node.stop(),this.node=null,this.status="stop")}}],[{key:"loadSound",value:function(e){return new Promise(function(n){var r=new t,o=new XMLHttpRequest;o.responseType="arraybuffer",o.onreadystatechange=function(){4===o.readyState&&(0!==o.status&&200!==o.status||il.decodeAudioData(o.response,function(t){r.audioBuffer=t,n(r)}))},o.open("GET",e,!0),o.send("")})}}]),t}();function ul(t){return ul="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},ul(t)}function sl(){var t=vl(),e=t.m(sl),n=(Object.getPrototypeOf?Object.getPrototypeOf(e):e.__proto__).constructor;function r(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===n||"GeneratorFunction"===(e.displayName||e.name))}var o={throw:1,return:2,break:3,continue:3};function i(t){var e,n;return function(r){e||(e={stop:function(){return n(r.a,2)},catch:function(){return r.v},abrupt:function(t,e){return n(r.a,o[t],e)},delegateYield:function(t,o,i){return e.resultName=o,n(r.d,cl(t),i)},finish:function(t){return n(r.f,t)}},n=function(t,n,o){r.p=e.prev,r.n=e.next;try{return t(n,o)}finally{e.next=r.n}}),e.resultName&&(e[e.resultName]=r.v,e.resultName=void 0),e.sent=r.v,e.next=r.n;try{return t.call(this,e)}finally{r.p=e.prev,r.n=e.next}}}return(sl=function(){return{wrap:function(e,n,r,o){return t.w(i(e),n,r,o&&o.reverse())},isGeneratorFunction:r,mark:t.m,awrap:function(t,e){return new ml(t,e)},AsyncIterator:pl,async:function(t,e,n,o,a){return(r(e)?hl:ll)(i(t),e,n,o,a)},keys:fl,values:cl}})()}function cl(t){if(null!=t){var e=t["function"==typeof Symbol&&Symbol.iterator||"@@iterator"],n=0;if(e)return e.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length))return{next:function(){return t&&n>=t.length&&(t=void 0),{value:t&&t[n++],done:!t}}}}throw new TypeError(ul(t)+" is not iterable")}function fl(t){var e=Object(t),n=[];for(var r in e)n.unshift(r);return function t(){for(;n.length;)if((r=n.pop())in e)return t.value=r,t.done=!1,t;return t.done=!0,t}}function ll(t,e,n,r,o){var i=hl(t,e,n,r,o);return i.next().then(function(t){return t.done?t.value:i.next()})}function hl(t,e,n,r,o){return new pl(vl().w(t,e,n,r),o||Promise)}function pl(t,e){function n(r,o,i,a){try{var u=t[r](o),s=u.value;return s instanceof ml?e.resolve(s.v).then(function(t){n("next",t,i,a)},function(t){n("throw",t,i,a)}):e.resolve(s).then(function(t){u.value=t,i(u)},function(t){return n("throw",t,i,a)})}catch(t){a(t)}}var r;this.next||(yl(pl.prototype),yl(pl.prototype,"function"==typeof Symbol&&Symbol.asyncIterator||"@asyncIterator",function(){return this})),yl(this,"_invoke",function(t,o,i){function a(){return new e(function(e,r){n(t,i,e,r)})}return r=r?r.then(a,a):a()},!0)}function vl(){var t,e,n="function"==typeof Symbol?Symbol:{},r=n.iterator||"@@iterator",o=n.toStringTag||"@@toStringTag";function i(n,r,o,i){var s=r&&r.prototype instanceof u?r:u,c=Object.create(s.prototype);return yl(c,"_invoke",function(n,r,o){var i,u,s,c=0,f=o||[],l=!1,h={p:0,n:0,v:t,a:p,f:p.bind(t,4),d:function(e,n){return i=e,u=0,s=t,h.n=n,a}};function p(n,r){for(u=n,s=r,e=0;!l&&c&&!o&&e<f.length;e++){var o,i=f[e],p=h.p,v=i[2];n>3?(o=v===r)&&(s=i[(u=i[4])?5:(u=3,3)],i[4]=i[5]=t):i[0]<=p&&((o=n<2&&p<i[1])?(u=0,h.v=r,h.n=i[1]):p<v&&(o=n<3||i[0]>r||r>v)&&(i[4]=n,i[5]=r,h.n=v,u=0))}if(o||n>1)return a;throw l=!0,r}return function(o,f,v){if(c>1)throw TypeError("Generator is already running");for(l&&1===f&&p(f,v),u=f,s=v;(e=u<2?t:s)||!l;){i||(u?u<3?(u>1&&(h.n=-1),p(u,s)):h.n=s:h.v=s);try{if(c=2,i){if(u||(o="next"),e=i[o]){if(!(e=e.call(i,s)))throw TypeError("iterator result is not an object");if(!e.done)return e;s=e.value,u<2&&(u=0)}else 1===u&&(e=i.return)&&e.call(i),u<2&&(s=TypeError("The iterator does not provide a '"+o+"' method"),u=1);i=t}else if((e=(l=h.n<0)?s:n.call(r,h))!==a)break}catch(e){i=t,u=1,s=e}finally{c=1}}return{value:e,done:l}}}(n,o,i),!0),c}var a={};function u(){}function s(){}function c(){}e=Object.getPrototypeOf;var f=[][r]?e(e([][r]())):(yl(e={},r,function(){return this}),e),l=c.prototype=u.prototype=Object.create(f);function h(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,c):(t.__proto__=c,yl(t,o,"GeneratorFunction")),t.prototype=Object.create(l),t}return s.prototype=c,yl(l,"constructor",c),yl(c,"constructor",s),s.displayName="GeneratorFunction",yl(c,o,"GeneratorFunction"),yl(l),yl(l,o,"Generator"),yl(l,r,function(){return this}),yl(l,"toString",function(){return"[object Generator]"}),(vl=function(){return{w:i,m:h}})()}function yl(t,e,n,r){var o=Object.defineProperty;try{o({},"",{})}catch(t){o=0}yl=function(t,e,n,r){function i(e,n){yl(t,e,function(t){return this._invoke(e,n,t)})}e?o?o(t,e,{value:n,enumerable:!r,configurable:!r,writable:!r}):t[e]=n:(i("next",0),i("throw",1),i("return",2))},yl(t,e,n,r)}function ml(t,e){this.v=t,this.k=e}function bl(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,dl(r.key),r)}}function dl(t){var e=function(t){if("object"!=ul(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var n=e.call(t,"string");if("object"!=ul(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==ul(e)?e:e+""}function gl(t,e,n,r,o,i,a){try{var u=t[i](a),s=u.value}catch(t){return void n(t)}u.done?e(s):Promise.resolve(s).then(r,o)}function wl(t){return function(){var e=this,n=arguments;return new Promise(function(r,o){var i=t.apply(e,n);function a(t){gl(i,r,o,a,u,"next",t)}function u(t){gl(i,r,o,a,u,"throw",t)}a(void 0)})}}function _l(t){return xl.apply(this,arguments)}function xl(){return(xl=wl(sl().mark(function t(e){return sl().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",new Promise(function(t,n){var r=Ut.createXMLHttpRequest();r.open("GET",e,!0),r.onload=function(e){200==r.status||r.status,Ut.loadingCount--,console.log("loadtext end",Ut.loadingCount),t(r.responseText)},r.onerror=function(t){Ut.loadingCount--,console.log("loadtext failed",Ut.loadingCount),n(null)},console.log("loadtext start",e),Ut.loadingCount++,r.send("")}));case 1:case"end":return t.stop()}},t)}))).apply(this,arguments)}var jl=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.img=null,this.chars={}}var e;return function(t,e,n){n&&bl(t,n),Object.defineProperty(t,"prototype",{writable:!1})}(t,0,[{key:"load",value:(e=wl(sl().mark(function e(n){var r,o,i,a,u,s;return sl().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=/.*\//.exec(n),o="./",r&&(o=r[0]),i=new t,e.next=6,_l(n);case 6:return a=e.sent,a=JSON.parse(a),u=a.image.replace(/^\/\//,o),e.next=11,Ll.texture(u);case 11:for(i.img=e.sent,s=0;s<a.chars.length;s++)i.chars[a.chars[s][0]]=a.chars[s];return e.abrupt("return",i);case 14:case"end":return e.stop()}},e)})),function(t){return e.apply(this,arguments)})}]),t}();function Ol(t){return Ol="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Ol(t)}function Sl(){var t=Rl(),e=t.m(Sl),n=(Object.getPrototypeOf?Object.getPrototypeOf(e):e.__proto__).constructor;function r(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===n||"GeneratorFunction"===(e.displayName||e.name))}var o={throw:1,return:2,break:3,continue:3};function i(t){var e,n;return function(r){e||(e={stop:function(){return n(r.a,2)},catch:function(){return r.v},abrupt:function(t,e){return n(r.a,o[t],e)},delegateYield:function(t,o,i){return e.resultName=o,n(r.d,El(t),i)},finish:function(t){return n(r.f,t)}},n=function(t,n,o){r.p=e.prev,r.n=e.next;try{return t(n,o)}finally{e.next=r.n}}),e.resultName&&(e[e.resultName]=r.v,e.resultName=void 0),e.sent=r.v,e.next=r.n;try{return t.call(this,e)}finally{r.p=e.prev,r.n=e.next}}}return(Sl=function(){return{wrap:function(e,n,r,o){return t.w(i(e),n,r,o&&o.reverse())},isGeneratorFunction:r,mark:t.m,awrap:function(t,e){return new Al(t,e)},AsyncIterator:Ml,async:function(t,e,n,o,a){return(r(e)?kl:Tl)(i(t),e,n,o,a)},keys:Pl,values:El}})()}function El(t){if(null!=t){var e=t["function"==typeof Symbol&&Symbol.iterator||"@@iterator"],n=0;if(e)return e.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length))return{next:function(){return t&&n>=t.length&&(t=void 0),{value:t&&t[n++],done:!t}}}}throw new TypeError(Ol(t)+" is not iterable")}function Pl(t){var e=Object(t),n=[];for(var r in e)n.unshift(r);return function t(){for(;n.length;)if((r=n.pop())in e)return t.value=r,t.done=!1,t;return t.done=!0,t}}function Tl(t,e,n,r,o){var i=kl(t,e,n,r,o);return i.next().then(function(t){return t.done?t.value:i.next()})}function kl(t,e,n,r,o){return new Ml(Rl().w(t,e,n,r),o||Promise)}function Ml(t,e){function n(r,o,i,a){try{var u=t[r](o),s=u.value;return s instanceof Al?e.resolve(s.v).then(function(t){n("next",t,i,a)},function(t){n("throw",t,i,a)}):e.resolve(s).then(function(t){u.value=t,i(u)},function(t){return n("throw",t,i,a)})}catch(t){a(t)}}var r;this.next||(Il(Ml.prototype),Il(Ml.prototype,"function"==typeof Symbol&&Symbol.asyncIterator||"@asyncIterator",function(){return this})),Il(this,"_invoke",function(t,o,i){function a(){return new e(function(e,r){n(t,i,e,r)})}return r=r?r.then(a,a):a()},!0)}function Rl(){var t,e,n="function"==typeof Symbol?Symbol:{},r=n.iterator||"@@iterator",o=n.toStringTag||"@@toStringTag";function i(n,r,o,i){var s=r&&r.prototype instanceof u?r:u,c=Object.create(s.prototype);return Il(c,"_invoke",function(n,r,o){var i,u,s,c=0,f=o||[],l=!1,h={p:0,n:0,v:t,a:p,f:p.bind(t,4),d:function(e,n){return i=e,u=0,s=t,h.n=n,a}};function p(n,r){for(u=n,s=r,e=0;!l&&c&&!o&&e<f.length;e++){var o,i=f[e],p=h.p,v=i[2];n>3?(o=v===r)&&(s=i[(u=i[4])?5:(u=3,3)],i[4]=i[5]=t):i[0]<=p&&((o=n<2&&p<i[1])?(u=0,h.v=r,h.n=i[1]):p<v&&(o=n<3||i[0]>r||r>v)&&(i[4]=n,i[5]=r,h.n=v,u=0))}if(o||n>1)return a;throw l=!0,r}return function(o,f,v){if(c>1)throw TypeError("Generator is already running");for(l&&1===f&&p(f,v),u=f,s=v;(e=u<2?t:s)||!l;){i||(u?u<3?(u>1&&(h.n=-1),p(u,s)):h.n=s:h.v=s);try{if(c=2,i){if(u||(o="next"),e=i[o]){if(!(e=e.call(i,s)))throw TypeError("iterator result is not an object");if(!e.done)return e;s=e.value,u<2&&(u=0)}else 1===u&&(e=i.return)&&e.call(i),u<2&&(s=TypeError("The iterator does not provide a '"+o+"' method"),u=1);i=t}else if((e=(l=h.n<0)?s:n.call(r,h))!==a)break}catch(e){i=t,u=1,s=e}finally{c=1}}return{value:e,done:l}}}(n,o,i),!0),c}var a={};function u(){}function s(){}function c(){}e=Object.getPrototypeOf;var f=[][r]?e(e([][r]())):(Il(e={},r,function(){return this}),e),l=c.prototype=u.prototype=Object.create(f);function h(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,c):(t.__proto__=c,Il(t,o,"GeneratorFunction")),t.prototype=Object.create(l),t}return s.prototype=c,Il(l,"constructor",c),Il(c,"constructor",s),s.displayName="GeneratorFunction",Il(c,o,"GeneratorFunction"),Il(l),Il(l,o,"Generator"),Il(l,r,function(){return this}),Il(l,"toString",function(){return"[object Generator]"}),(Rl=function(){return{w:i,m:h}})()}function Il(t,e,n,r){var o=Object.defineProperty;try{o({},"",{})}catch(t){o=0}Il=function(t,e,n,r){function i(e,n){Il(t,e,function(t){return this._invoke(e,n,t)})}e?o?o(t,e,{value:n,enumerable:!r,configurable:!r,writable:!r}):t[e]=n:(i("next",0),i("throw",1),i("return",2))},Il(t,e,n,r)}function Al(t,e){this.v=t,this.k=e}function Cl(t,e,n,r,o,i,a){try{var u=t[i](a),s=u.value}catch(t){return void n(t)}u.done?e(s):Promise.resolve(s).then(r,o)}function Fl(t){return function(){var e=this,n=arguments;return new Promise(function(r,o){var i=t.apply(e,n);function a(t){Cl(i,r,o,a,u,"next",t)}function u(t){Cl(i,r,o,a,u,"throw",t)}a(void 0)})}}function Nl(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,Bl(r.key),r)}}function Bl(t){var e=function(t){if("object"!=Ol(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var n=e.call(t,"string");if("object"!=Ol(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==Ol(e)?e:e+""}var Ul=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.assetList=[]}var e,n,r,o;return function(t,e){e&&Nl(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1})}(t,[{key:"font",value:(o=Fl(Sl().mark(function t(e){var n,r;return Sl().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(n=this.assetList[e]){t.next=10;break}return this.assetList[e]=n={data:null,status:"loading",resolves:[]},t.next=5,jl.load(e);case 5:for(n.data=t.sent,n.status="loaded",r=0;r<n.resolves.length;r++)n.resolves[r]();t.next=13;break;case 10:if("loading"!==n.status){t.next=13;break}return t.next=13,new Promise(function(t){n.resolves.push(t)});case 13:return t.abrupt("return",this.assetList[e].data);case 14:case"end":return t.stop()}},t,this)})),function(t){return o.apply(this,arguments)})},{key:"audio",value:(r=Fl(Sl().mark(function t(e){var n,r;return Sl().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(n=this.assetList[e]){t.next=10;break}return this.assetList[e]=n={data:null,status:"loading",resolves:[]},t.next=5,al.loadSound(e);case 5:for(n.data=t.sent,n.status="loaded",r=0;r<n.resolves.length;r++)n.resolves[r]();t.next=13;break;case 10:if("loading"!==n.status){t.next=13;break}return t.next=13,new Promise(function(t){n.resolves.push(t)});case 13:return t.abrupt("return",this.assetList[e].data);case 14:case"end":return t.stop()}},t,this)})),function(t){return r.apply(this,arguments)})},{key:"texture",value:(n=Fl(Sl().mark(function t(e,n){var r,o;return Sl().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(r=this.assetList[e]){t.next=11;break}return this.assetList[e]=r={data:null,status:"loading",resolves:[]},t.next=5,Be.loadImg(e,n);case 5:for(r.data=t.sent,r.status="loaded",o=0;o<r.resolves.length;o++)r.resolves[o]();n&&n(r.data),t.next=14;break;case 11:if("loading"!==r.status){t.next=14;break}return t.next=14,new Promise(function(t){r.resolves.push(t)});case 14:return t.abrupt("return",this.assetList[e].data);case 15:case"end":return t.stop()}},t,this)})),function(t,e){return n.apply(this,arguments)})},{key:"bumpTexture",value:function(t,e){return this.assetList[t]||(this.assetList[t]=xn.loadBumpTexture(t+"?"+globalParam.version,e)),this.assetList[t]}},{key:"o3o",value:(e=Fl(Sl().mark(function t(e,n){var r,o;return Sl().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(r=this.assetList[e]){t.next=10;break}return this.assetList[e]=r={data:null,status:"loading",resolves:[]},t.next=5,Jf.load(e+"?"+globalParam.version);case 5:for(r.data=t.sent,r.status="loaded",o=0;o<r.resolves.length;o++)r.resolves[o]();t.next=13;break;case 10:if("loading"!==r.status){t.next=13;break}return t.next=13,new Promise(function(t){r.resolves.push(t)});case 13:return t.abrupt("return",this.assetList[e].data);case 14:case"end":return t.stop()}},t,this)})),function(t,n){return e.apply(this,arguments)})},{key:"getStatus",value:function(t){var e=this.assetList[t];return e?e.status:"noload"}}]),t}(),Ll=new Ul;function Vl(t){return Vl="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Vl(t)}function Dl(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,Gl(r.key),r)}}function Gl(t){var e=function(t){if("object"!=Vl(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var n=e.call(t,"string");if("object"!=Vl(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==Vl(e)?e:e+""}var zl=[[-1,-1,-1],[1,-1,-1],[1,1,-1],[-1,1,-1],[-1,-1,1],[1,-1,1],[1,1,1],[-1,1,1]],Xl=[[-1,-1,-1],[-1,1,-1],[1,1,-1],[1,-1,-1],[-1,-1,1],[-1,1,1],[1,1,1],[1,-1,1]],Hl=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.p=new X,this.a=new X,this.aov=.577,this.znear=1,this.zfar=10,this.cameracol=new Yo.ConvexHull,this.cameracol2=new Yo.ConvexHull;for(var e=0;e<8;e++)this.cameracol.poses.push(new X),this.cameracol2.poses.push(new X);this.pvMatrix=new J,this.matrix=new z,this.bounding_planes=[]}return function(t,e){e&&Dl(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1})}(t,[{key:"createBoundingPlanes",value:function(){var t=[],e=new zc;return e.calc(Xl[2],Xl[1],Xl[0]),t.push(e),(e=new zc).calc(Xl[4],Xl[5],Xl[6]),t.push(e),(e=new zc).calc(Xl[0],Xl[4],Xl[7]),t.push(e),(e=new zc).calc(Xl[1],Xl[2],Xl[6]),t.push(e),(e=new zc).calc(Xl[0],Xl[1],Xl[5]),t.push(e),(e=new zc).calc(Xl[3],Xl[7],Xl[6]),t.push(e),t}},{key:"calcBoundingPlanes2",value:function(t,e,n){var r=J.alloc();J.getInv(r,t);for(var o=0;o<8;o++){var i=Xl[o];X.copy(i,zl[o]),i[3]=1,i[1]<0?q.mul(i,i,e):q.mul(i,i,n),J.dotVec4(i,r,i)}return J.free(1),this.createBoundingPlanes()}},{key:"calcBoundingPlanes",value:function(){var t=this.pvMatrix,e=this.znear,n=this.zfar,r=J.alloc();J.getInv(r,t);for(var o=0;o<8;o++){var i=Xl[o];X.copy(i,zl[o]),i[3]=1,i[2]<0?q.mul(i,i,e):q.mul(i,i,n),J.dotVec4(i,r,i)}return J.free(1),this.createBoundingPlanes()}},{key:"calcCollision2",value:function(t,e,n,r){for(var o=q.alloc(),i=0;i<8;i++)X.copy(o,zl[i]),o[3]=1,o[2]<0?q.mul(o,o,n):q.mul(o,o,r),J.dotVec4(o,e,o),X.copy(t.poses[i],o);t.refresh(),q.free(1)}},{key:"calcCollision",value:function(t,e){var n=J.alloc(),r=q.alloc();e?J.getInv(n,e):J.getInv(n,this.pvMatrix);for(var o=0;o<8;o++)X.copy(r,zl[o]),r[3]=1,e||(r[2]<0?q.mul(r,r,this.znear):q.mul(r,r,this.zfar)),J.dotVec4(r,n,r),X.copy(t.poses[o],r);t.refresh(),q.free(1),J.free(1)}}]),t}();function ql(t){return ql="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},ql(t)}function Yl(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,Wl(r.key),r)}}function Wl(t){var e=function(t){if("object"!=ql(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var n=e.call(t,"string");if("object"!=ql(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==ql(e)?e:e+""}Hl.homing=function(t,e,n){var r=e[0]-n[0],o=e[1]-n[1],i=e[2]-n[2];t[0]=Math.atan2(o,Math.sqrt(i*i+r*r)),t[1]=Math.atan2(r,i),t[2]=0};var Ql=[],$l=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.objs=[],this.id=0}return function(t,e){e&&Yl(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1})}(t,[{key:"addObj",value:function(t){this.objs.push(t)}},{key:"rmObj",value:function(t){var e=this.objs.indexOf(t);e>=0&&this.objs.splice(e,1)}},{key:"createObj",value:function(t){t||(t=Engine.defObj);var e=null;if(Ql.length>0&&(e=Ql[Ql.length-1]).stat<0&&(e=null),!e)for(var n=0;n<16;n++)Ql.push(new Obj);return e=Ql.pop(),this.objs.push(e),this.objs.length>1024&&alert("objs>1024!"),Mat43.setInit(e.matrix),e.parent=null,Vec3.set(e.scale,1,1,1),e.angle=0,e.t=0,e.hp=1,e.stat=2,e.pattern=0,e.frame=0,e.pos2=new Vec3,e.func=t,e.id=this.id,this.id++,e.__proto__=t.prototype,e.scene=this.scene,e.init(),e}},{key:"deleteObj",value:function(t){for(var e=0;e<this.objs.length;e++)if(t===this.objs[e]){t.stat=-10,Ql.unshift(objs[e]),objs.splice(e,1);break}}},{key:"update",value:function(){for(var t=this.objs,e=0;e<this.objs.length;e++)2===t[e].stat&&(t[e].stat=1),1===t[e].stat&&t[e].t++;for(e=0;e<Ql.length&&Ql[e].stat<0;e++)Ql[e].stat++}},{key:"move",value:function(){this.update(),this.objs.forEach(function(t){1===t.stat&&t.move()})}},{key:"draw",value:function(){this.objs.forEach(function(t){1===t.stat&&t.draw()})}},{key:"hud",value:function(){this.objs.forEach(function(t){1===t.stat&&t.hud()})}}]),t}();function Jl(t){return Jl="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Jl(t)}function Kl(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,Zl(r.key),r)}}function Zl(t){var e=function(t){if("object"!=Jl(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var n=e.call(t,"string");if("object"!=Jl(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==Jl(e)?e:e+""}$l.STAT_EMPTY=0,$l.STAT_ENABLE=1,$l.STAT_CREATE=2;var th=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.p=new X,this.scale=new X,X.setValue(this.scale,1,1,1),this.rot=new X,this.rotq=new q,this.v=new X,this.a=new X,this.stat=$l.STAT_CREATE,this.type=0,this.hp=1,this.t=0,this.hitareas=[],this.matrix=new z,this.phyObjs=[]}return function(t,e){e&&Kl(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1})}(t,[{key:"init",value:function(){}},{key:"move",value:function(){}},{key:"draw",value:function(){}},{key:"hud",value:function(){}},{key:"drawShadow",value:function(){this.draw()}},{key:"hit",value:function(){}},{key:"delete",value:function(){}}]),t}();function eh(t){return eh="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},eh(t)}function nh(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,rh(r.key),r)}}function rh(t){var e=function(t){if("object"!=eh(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var n=e.call(t,"string");if("object"!=eh(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==eh(e)?e:e+""}var oh=function(){function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.engine=e,this.ono3d=e.ono3d,this.debug_texture=new Be(1024,1024,0)}return function(t,e){e&&nh(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1})}(t,[{key:"createEnv",value:function(t,e,n,r,o){var i=256;t||(t=new Be(i,i,0));var a=this.ono3d.envbufTexture;ke.bindTexture(ke.TEXTURE_2D,t.gl_texture),ke.texParameteri(ke.TEXTURE_2D,ke.TEXTURE_WRAP_S,ke.REPEAT),ke.bindFramebuffer(ke.FRAMEBUFFER,Ye.framebuffer),this.ono3d.setViewport(0,0,i,128),xn.postEffect(a,0,0,1,1,this.ono3d.shaders.cube2polar),xn.copyImage(t,0,0,0,0,i,128);var u=t.width,s=u,c=.5*u;s>>=1,c>>=1;for(var f=[],l=1;l<=3;l++)f.push(l*l*.1);for(f.push(1),l=0;l<f.length;l++){var h=f[l],p=new Be(s,c);ke.bindTexture(ke.TEXTURE_2D,p.gl_texture),ke.texParameteri(ke.TEXTURE_2D,ke.TEXTURE_WRAP_S,ke.REPEAT),this.ono3d.setViewport(0,0,s,c),this.rough(p,h,t,0,0,1,.5),xn.gauss(s,c,10,p,0,0,1,1,s,c),xn.copyImage(p,0,0,0,0,s,c),xn.copyImage(t,0,u-2*c,0,0,s,c),xn.copyImage(t,s,u-2*c,0,0,s,c),xn.copyImage(t,u-s,u-2*c,0,0,s,c),s>>=1,c>>=1,ke.deleteTexture(p.gl_texture)}return ke.bindTexture(ke.TEXTURE_2D,null),ke.bindFramebuffer(ke.FRAMEBUFFER,null),t}},{key:"rough",value:function(t,e,n,r,o,i,a){null==r&&(r=0,o=0,i=1,a=1);var u=this.ono3d.shaders.rough,s=t.width,c=t.height;ke.viewport(0,0,s,c),ke.disable(ke.BLEND),ke.clearColor(0,0,0,0),ke.clear(ke.DEPTH_BUFFER_BIT|ke.COLOR_BUFFER_BIT),ke.enable(ke.DEPTH_TEST),ke.useProgram(u.program),ke.bindBuffer(ke.ARRAY_BUFFER,Ye.fullposbuffer),ke.vertexAttribPointer(u.atts.aPos.location,2,ke.FLOAT,!1,0,0),u.unis;var f=1;0==e&&(f=1),e>=1&&(e=.999),ke.activeTexture(ke.TEXTURE1),ke.uniform1i(u.unis.uDst.location,1),ke.bindTexture(ke.TEXTURE_2D,t.gl_texture),ke.uniform1f(u.unis.uRough.location,1-Math.cos(e*Math.PI*.5));for(var l=0;l<f;l++)ke.uniform1f(u.unis.uSeed.location,15.7*Math.random()),ke.uniform1f(u.unis.uPow.location,1/(l+1)),xn.postEffect(n,r,o,i,a,u),xn.copyImage(t,0,0,0,0,s,c)}},{key:"createCubeMap",value:function(t,e,n,r,o,i){this.ono3d.pvMatrix,J.alloc();var a=J.alloc(),u=engine.camera;engine.camera=new Hl,ke.bindFramebuffer(ke.FRAMEBUFFER,Ye.framebuffer),ke.clearColor(0,0,0,1),ke.clear(ke.COLOR_BUFFER_BIT),engine.camera.aov=1,engine.camera.znear=.01,X.setValue(engine.camera.p,e,n,r),xn.perspectiveMatrix(a,1,1,.01,100);var s=[[0,0,0],[0,.5*-Math.PI,0],[0,-Math.PI,0],[0,1.5*-Math.PI,0],[.5*-Math.PI,0,0],[.5*Math.PI,0,0]],c=[[0,o],[o,o],[2*o,o],[3*o,o],[0,0],[o,0]];this.ono3d.setViewport(0,0,o,o);for(var f=0;f<6;f++)this.ono3d.clear(),ke.clear(ke.DEPTH_BUFFER_BIT),X.copy(engine.camera.a,s[f]),i(0,0,o,o),xn.copyImage(t,c[f][0],c[f][1],0,0,o,o);ke.bindFramebuffer(ke.FRAMEBUFFER,Ye.framebuffer),n=2*o/t.height,e=4*o/t.width,this.ono3d.setViewport(0,0,4*o,2*o),xn.drawCopy(0,0,1,1,t,0,n,e,-n),xn.copyImage(t,0,0,0,0,4*o,2*o),engine.camera=u,J.free(2)}},{key:"shadowGauss",value:function(t,e,n,r,o,i,a,u){for(var s=new Array(5),c=0,f=0;f<s.length;f++){var l=1+2*f,h=Math.exp(l*l*-.5/n);s[f]=h,f>0&&(h*=2),c+=h}for(f=0;f<s.length;f++)s[f]/=c;var p=shadow_gauss_shader,v=p.unis;ke.useProgram(p.program),ke.uniform2f(v.uAxis.location,1/t,0),xn.postEffect(r,o,i,a,u,p),xn.copyImage(r,0,0,0,0,t,e),ke.uniform2f(v.uAxis.location,0,1/e),xn.postEffect(r,0,0,t/r.width,e/r.height,p)}},{key:"toneMapping",value:function(t,e,n,r){var o=ono3d.shaders.decode;ke.useProgram(o.program),ke.uniform1i(o.unis.uSampler2.location,1),ke.activeTexture(ke.TEXTURE1),ke.bindTexture(ke.TEXTURE_2D,r.gl_texture),xn.postEffect(t,0,0,e,n,o)}},{key:"fill",value:function(t,e,n,r,o){var i=ono3d.shaders;ke.enable(ke.BLEND),ke.blendFunc(ke.SRC_ALPHA,ke.ONE_MINUS_SRC_ALPHA),ke.colorMask(!0,!0,!0,!1);var a=this.engine.WIDTH,u=this.engine.HEIGHT;ono3d.setViewport(t*a,(1-(e+r))*u,n*a,(1-r)*u),ke.bindFramebuffer(ke.FRAMEBUFFER,null),ke.useProgram(i.fill.program),ke.uniform4f(i.fill.unis.uColor.location,o[0],o[1],o[2],o[3]),xn.postEffect(null,0,0,0,0,i.fill),ke.colorMask(!0,!0,!0,!0)}},{key:"setExpose",value:function(t,e,n){var r=new H,o=new H,i=ono3d.shaders;ke.bindFramebuffer(ke.FRAMEBUFFER,Ye.framebuffer),ono3d.setViewport(0,511,1,1),ke.useProgram(i.fill.program),ih(r,t),ih(o,e),ke.uniform4f(i.fill.unis.uColor.location,r[0],r[1],o[0],o[1]),xn.postEffect(n,0,0,0,0,i.fill),xn.copyImage(n,0,511,0,511,1,1)}},{key:"calcExpose",value:function(t,e,n,r,o,i){var a=ono3d.shaders;ke.bindFramebuffer(ke.FRAMEBUFFER,Ye.framebuffer),ono3d.setViewport(0,0,256,256),ke.bindTexture(ke.TEXTURE_2D,i.gl_texture),xn.postEffect(t,e,n,r,o,a.average),xn.copyImage(i,0,0,0,0,256,256);for(var u=256,s=0;u>1;s++)ono3d.setViewport(0,0,u/2,u/2),xn.postEffect(i,0,0,u/512,u/512,a.average2),xn.copyImage(i,0,0,0,0,u/2,u/2),u/=2;ono3d.setViewport(0,511,1,1),xn.postEffect(i,0,511/512,1/512,1/512,a.average3),xn.copyImage(i,0,511,0,511,1,1)}}]),t}(),ih=function(t,e){if(0===e)return t[0]=0,void(t[1]=0);var n,r=Math.min(Math.max(Math.floor(Math.log2(e)),-15),16);n=256*((n=r<0?e*(1<<-r):e/(1<<r))-1),t[0]=0|n,t[1]=(8*(n-(0|n))<<5)+(r+15),H.mul(t,t,1/255)},ah=function(t){Qe.qSort(t.materials,t.materials_static_index,t.materials_index-1,function(t,e){return t.blend_method<e.blend_method||t.shader<e.shader?-1:t.blend_method>e.blend_method||t.shader>e.shader?1:0});for(var e=0;e<t.materials_index;e++)t.materials[e].index=e;var n=t.faces,r=t.faces_index;for(e=0;e<r;e++)n[e].material?n[e].materialIndex=(1!==n[e].material.opacity)*(1<<24)+n[e].material.index:n[e].materialIndex=-1;Qe.qSort(n,t.faces_static_index,r-1,function(t,e){return t.materialIndex-e.materialIndex})};function uh(t,e){t.faces,t.faces_index;var n=0,r=t.lines_index,o=t.verticesFloat32Array,i=t.indexBuffer;n=20*t.vertices_index;for(var a=t.lines,u=0;u<r;u++)a[u].materialIndex=a[u].material.index;var s=n;for(u=0;u<r;u++){var c=6*u+s,f=a[u].pos[0];o[c]=f[0],o[c+1]=f[1],o[c+2]=f[2],f=a[u].pos[1],o[c+3]=f[0],o[c+4]=f[1],o[c+5]=f[2]}n+=6*r,ke.bindBuffer(ke.ARRAY_BUFFER,Ye.glbuffer);var l=20*t.vertices_static_index;ke.bufferSubData(ke.ARRAY_BUFFER,4*l,new Float32Array(t.verticesFloat32Array.buffer,4*l,n)),ke.bindBuffer(ke.ELEMENT_ARRAY_BUFFER,Ye.glIdxBuffer),ke.bufferSubData(ke.ELEMENT_ARRAY_BUFFER,0,new Uint16Array(i.buffer,0,e))}var sh=new Float32Array(2);function ch(t){return ch="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},ch(t)}function fh(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,lh(r.key),r)}}function lh(t){var e=function(t){if("object"!=ch(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var n=e.call(t,"string");if("object"!=ch(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==ch(e)?e:e+""}var hh=1024,ph=new Float32Array(2),vh=function(){function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.ono3d=e,console.log(ke.getParameter(ke.MAX_TEXTURE_IMAGE_UNITS)),this.deferred_shader=en.load("./engine/deferred/deferred.shader"),this.lightprobe_shader=en.load("./engine/deferred/lightprobe.shader"),this.main_shader=en.load("./engine/deferred/main.shader"),e.shaders.main=this.main_shader,this.transTexture=new Be(hh,hh);var n=new Ge;n.bind(),this.camerap=[],this.gbuffer={},this.gbuffer.basecol=new Be(hh,hh,Be.FORMAT.UINT8),n.texture(0,this.gbuffer.basecol),this.gbuffer.nrm=new Be(hh,hh,Be.FORMAT.UINT8),n.texture(1,this.gbuffer.nrm),this.gbuffer.pbr=new Be(hh,hh,Be.FORMAT.UINT8),n.texture(2,this.gbuffer.pbr),this.gbuffer.pos=new Be(hh,hh,Be.FORMAT.UINT32),n.texture(3,this.gbuffer.pos),this.gbuffer.depth=new Be(hh,hh,Be.FORMAT.FLOAT16),n.texture(4,this.gbuffer.depth),this.depth_texture=Be.createDepth(hh,hh),n.depthTexture(this.depth_texture),this.framebuffer=n,this.pvMatrix=new J,this.viewMatrix=new J}return function(t,e){e&&fh(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1})}(t,[{key:"calcMatrix",value:function(){var t=new z,e=engine.scene.objects.find(function(t){return"CAMERA"===t.type});if(e){z.fromRotVector(t,.5*-Math.PI,1,0,0),z.dot(t,e.matrix,t),z.getInv(t,t),J.copyMat43(this.viewMatrix,t);var n=Math.tan(.5*e.data.angle),r=n*this.viewh/this.vieww;"PERSP"===e.data.type?xn.perspectiveMatrix(this.pvMatrix,n,r,e.data.clip_start,e.data.clip_end):xn.orthoMatrix(this.pvMatrix,-1.6,1.6*this.viewh/this.vieww,-e.data.clip_start,-e.data.clip_end),J.dotMat43(this.pvMatrix,this.pvMatrix,t),e.pvMatrix=this.pvMatrix}}},{key:"pipeline",value:function(t){var e=this.ono3d,n=engine.scene.objects.find(function(t){return"CAMERA"===t.type});if(ke.clearColor(0,0,0,0),ke.bindFramebuffer(ke.FRAMEBUFFER,null),ke.clear(ke.DEPTH_BUFFER_BIT|ke.COLOR_BUFFER_BIT),n){this.camerap=n.location,this.viewx=e.viewport[0],this.viewy=e.viewport[1],this.vieww=e.viewport[2],this.viewh=e.viewport[3],this.calcMatrix(),t.calcMatrix(),ke.depthMask(!0),ke.enable(ke.DEPTH_TEST),ke.clearColor(0,0,0,0),ke.bindFramebuffer(ke.FRAMEBUFFER,Ye.framebuffer),ke.framebufferTexture2D(ke.FRAMEBUFFER,ke.COLOR_ATTACHMENT0,ke.TEXTURE_2D,this.gbuffer.basecol.gl_texture,0),xn.setDrawBuffers(ke,1),ke.clear(ke.DEPTH_BUFFER_BIT|ke.COLOR_BUFFER_BIT),ke.depthMask(!1),ke.disable(ke.BLEND),t.world&&t.world.envTexture&&(e.drawCelestialSphere(t.world.envTexture,this.pvMatrix,0),ke.bindFramebuffer(ke.FRAMEBUFFER,Ye.framebuffer),ke.framebufferTexture2D(ke.FRAMEBUFFER,ke.COLOR_ATTACHMENT0,ke.TEXTURE_2D,e.texture32.gl_texture,0),e.drawCelestialSphere(t.world.skyTexture,this.pvMatrix,1),ke.clear(ke.DEPTH_BUFFER_BIT)),ke.bindFramebuffer(ke.FRAMEBUFFER,Ye.framebuffer),ke.framebufferTexture2D(ke.FRAMEBUFFER,ke.COLOR_ATTACHMENT0,ke.TEXTURE_2D,Ye.fTexture.gl_texture,0),xn.setDrawBuffers(ke,1);for(var r=0;r<e.materials_index;r++){var o=e.materials[r];o.shader&&""!==o.shader||(o.shader=xn.calcMainShaderName(o))}var i=e.faces,a=e.faces_index,u=e.indexBuffer,s=-1;ah(e);var c=0,f=[];this.materialIndexes=f;for(var l=0;l<a;l++){var h=i[l];s!=h.materialIndex&&(f.push(l),s=h.materialIndex),u[c]=h.vertices[0],u[c+1]=h.vertices[1],u[c+2]=h.vertices[2],c+=3}f.push(a),this.sendgpu(e,c),this.drawShadowMap(),globalParam.stereo=-globalParam.stereoVolume*globalParam.stereomode*.4,ke.depthMask(!0),ke.enable(ke.DEPTH_TEST),ke.enable(ke.CULL_FACE),ke.disable(ke.BLEND),this.framebuffer.bind(),this.framebuffer.drawBuffers(5),ke.clear(ke.DEPTH_BUFFER_BIT),this.framebuffer.clearColor(1,0,0,0,0),this.framebuffer.clearColor(4,1,1,1,1),this.drawOpacity(),this.drawDiffuse(!1),this.createReference(),this.drawNonOpacity(),this.drawDiffuse(!0)}}},{key:"drawDiffuse",value:function(t){var e=this.ono3d,n=this.deferred_shader;n.unis,ke.useProgram(n.program),n.setUniform("uPosMap",this.gbuffer.pos),n.setUniform("uPbrMap",this.gbuffer.pbr);var r=e.environments[0],o=engine.scene.objects.find(function(t){return"LIGHT"===t.type&&"ENVIRONMENT"===t.data.type});o&&(r=o),n.setUniform("uEnvMap",r.envTexture),n.setUniform("uNormalMap",this.gbuffer.nrm),n.setUniform("uTransMap",this.transTexture),n.setUniform("uDepthMap",this.gbuffer.depth),ph[0]=e.viewport[2],ph[1]=e.viewport[3],n.setUniform("uResolution",ph),this.pvMatrix,n.setUniform("projectionMatrix",this.pvMatrix),n.setUniform("anglePos",this.camerap),e.viewport[0],e.viewport[1];var i=e.viewport[2],a=e.viewport[3];ke.bindFramebuffer(ke.FRAMEBUFFER,Ye.framebuffer),ke.framebufferTexture2D(ke.FRAMEBUFFER,ke.COLOR_ATTACHMENT0,ke.TEXTURE_2D,e.texture32.gl_texture,0),ke.disable(ke.DEPTH_TEST);var u=this.gbuffer.pos;t?(ke.disable(ke.BLEND),xn.postEffect(this.gbuffer.basecol,0,0,i/u.width,a/u.height,n)):ke.clearBufferfv(ke.COLOR,0,[0,0,0,0]),ke.blendFunc(ke.ONE,ke.ONE),ke.enable(ke.BLEND);var s=engine.scene.objects.find(function(t){return"LIGHT"===t.type&&"SUN"===t.data.type});s&&this.direction(s),this.lightprobe(),ke.disable(ke.BLEND),ke.disable(ke.BLEND),ke.bindFramebuffer(ke.FRAMEBUFFER,Ye.framebuffer),ke.framebufferTexture2D(ke.FRAMEBUFFER,ke.COLOR_ATTACHMENT0,ke.TEXTURE_2D,Ye.fTexture.gl_texture,0),ke.clearBufferfv(ke.COLOR,0,new Float32Array([0,0,0,0])),xn.postEffect(e.texture32,0,0,i/u.width,a/u.height,e.shaders.u32tof111110)}},{key:"lightprobe",value:function(){var t=this.gbuffer.basecol,e=ono3d.viewport[2],n=ono3d.viewport[3],r=this.lightprobe_shader;ke.useProgram(r.program);var o=r.unis;xn.setUniform(ke,o.anglePos,this.camerap),ono3d.environments[0],xn.setUniform(ke,o.uBaseColMap,t,0),xn.setUniform(ke,o.uNormalMap,this.gbuffer.nrm,1),xn.setUniform(ke,o.uPbrMap,this.gbuffer.pbr,2),xn.setUniform(ke,o.uPosMap,this.gbuffer.pos,4),xn.postEffect(t,0,0,e/t.width,n/t.height,r)}},{key:"direction",value:function(t){var e=this.ono3d,n=this.gbuffer.basecol,r=e.shaders.directional;ke.useProgram(r.program);var o=r.unis;xn.setUniform(ke,o.anglePos,this.camerap),o.uLight&&ke.uniform3f(o.uLight.location,-t.matrix[3],-t.matrix[4],-t.matrix[5]),xn.setUniform(ke,o.lightMat,t.data.viewmatrix);var i=new X;X.mul(i,t.data.color,t.data.energy),xn.setUniform(ke,o.uLightColor,i),xn.setUniform(ke,o.uBaseColMap,n,0),xn.setUniform(ke,o.uNormalMap,this.gbuffer.nrm,1),xn.setUniform(ke,o.uPbrMap,this.gbuffer.pbr,2),xn.setUniform(ke,o.uShadowmap,e.shadowTexture,3),xn.setUniform(ke,o.uPosMap,this.gbuffer.pos,4),xn.postEffect(n,0,0,this.vieww/n.width,this.viewh/n.height,r)}},{key:"drawShadowMap",value:function(){var t=this.ono3d,e=t.faces,n=t.faces_index,r=this.materialIndexes;ke.bindFramebuffer(ke.FRAMEBUFFER,Ye.framebuffer),ke.enable(ke.CULL_FACE),ke.cullFace(ke.BACK);var o=null;if(globalParam.shadow&&(o=engine.scene.objects.find(function(t){return"LIGHT"===t.type&&"SUN"===t.data.type})),o)if(this.calcLightMatrix(o),ke.viewport(0,0,1024,1024),ke.clearColor(1,16/255,1,16/255),ke.clearColor(1,1,1,1),ke.clear(ke.COLOR_BUFFER_BIT|ke.DEPTH_BUFFER_BIT),o.data.use_shadow){var i=t.shaders.shadow;ke.useProgram(i.program),ke.depthMask(!0),ke.enable(ke.DEPTH_TEST),ke.disable(ke.BLEND),xn.setUniform(ke,i.unis.projectionMatrix,o.data.viewmatrix),ke.vertexAttribPointer(i.atts.aPos.location,3,ke.FLOAT,!1,80,0),ke.drawElements(ke.TRIANGLES,3*n,ke.UNSIGNED_SHORT,0);for(var a=0;a<r.length-1;a++){for(var u=a+1;u<r.length-1&&e[r[a]].material.shader==e[r[u]].material.shader&&1===e[r[u]].material.opacity;u++);this.renderShadow(r[a],r[u]-r[a],0,0),a=u-1}xn.copyImage(t.shadowTexture,0,0,0,0,1024,1024),ke.bindFramebuffer(ke.FRAMEBUFFER,Ye.framebuffer)}else xn.copyImage(t.shadowTexture,0,0,0,0,1024,1024)}},{key:"drawOpacity",value:function(){ke.disable(ke.BLEND);var t=this.materialIndexes,e=ono3d.faces;this.opacityIndex=t.length;for(var n=0;n<t.length-1;n++){if(1!==e[t[n]].material.opacity){this.opacityIndex=n;break}for(var r=n+1;r<t.length-1&&e[t[n]].material.shader==e[t[r]].material.shader&&1===e[t[r]].material.opacity;r++);this.renderShader(t[n],t[r]-t[n],this.pvMatrix,0),n=r-1}}},{key:"drawNonOpacity",value:function(){var t=ono3d.faces,e=this.viewx,n=this.viewy,r=this.vieww,o=this.viewh,i=this.materialIndexes;ke.viewport(e,n,r,o),ke.depthMask(!1),ke.enable(ke.DEPTH_TEST),ke.depthMask(!0),ke.blendFunc(ke.SRC_ALPHA,ke.ONE_MINUS_SRC_ALPHA),ke.disable(ke.BLEND),ke.enable(ke.CULL_FACE),ke.bindBuffer(ke.ARRAY_BUFFER,Ye.glbuffer);for(var a=this.opacityIndex;a<i.length-1;a++){for(var u=a+1;u<i.length-1&&t[i[a]].material.shader==t[i[u]].material.shader;u++);this.renderShader(i[a],i[u]-i[a],this.pvMatrix,1),a=u-1}}},{key:"createReference",value:function(){var t=this.viewx,e=this.viewy,n=this.vieww,r=this.viewh;xn.copyImage(this.transTexture,0,0,t,e,n,r),ke.bindFramebuffer(ke.FRAMEBUFFER,Ye.framebuffer),ke.viewport(0,0,1024,512),xn.drawCopy(0,0,1,1,this.transTexture,0,0,1,r/1024),xn.copyImage(this.transTexture,0,0,0,0,1024,512),ke.disable(ke.DEPTH_TEST);var o=hh;ke.disable(ke.BLEND);for(var i=1;i<4;i++)o>>=1,ke.viewport(0,0,o,.5*o),xn.gauss(o,.5*o,100,this.transTexture,0,(hh-2*o)/hh,2*o/hh,o/hh),xn.copyImage(this.transTexture,0,1024-o,0,0,o,.5*o);o>>=1;var a=Math.pow(.5,4);ke.viewport(0,0,hh*a,hh*a*.5),ke.bindFramebuffer(ke.FRAMEBUFFER,this.framebuffer.gl_framebuffer)}},{key:"renderShadow",value:function(t,e,n,r){var o=this.ono3d,i=o.faces,a=i[t].material,u=(a.shader,o.shaders.shadow);if(u.program){var s=u.atts,c=u.unis;ke.useProgram(u.program),xn.setDrawBuffers(ke,1);var f=0;[{name:"aPos",size:3},{name:"aNormal",size:3},{name:"aSvec",size:3},{name:"aTvec",size:3},{name:"aUv",size:2},{name:"aEnvRatio",size:1},{name:"aUv2",size:2},{name:"aLightProbe",size:3}].forEach(function(t){var e=s[t.name];if(e){var n=e.type;ke.vertexAttribPointer(e.location,n.size,n.type,!1,80,4*f)}f+=t.size});for(var l=t;l<t+e;){var h=l,p=(i[l].environments[n],i[l].materialIndex);for(h=l+1;h<t+e&&i[h].materialIndex===p;h++);a=i[l].material,ke.activeTexture(ke.TEXTURE0),ke.uniform1i(c.uBaseColMap.location,0),a.baseColorMap?ke.bindTexture(ke.TEXTURE_2D,a.baseColorMap.gl_texture):ke.bindTexture(ke.TEXTURE_2D,Ye.dummyTexture),ke.drawElements(ke.TRIANGLES,3*(h-l),ke.UNSIGNED_SHORT,3*l*2),l=h}}}},{key:"calcLightMatrix",value:function(t,e){this.HEIGHT,this.WIDTH;var n=engine.camera,r=new X,o=new X,i=new X,a=new J,u=new X;X.setValue(o,-t.matrix[3],-t.matrix[4],-t.matrix[5]),X.setValue(u,n.matrix[6],n.matrix[7],n.matrix[8]),X.cross(r,o,u),X.norm(r),X.cross(i,r,o),X.norm(i);for(var s=new X,c=new An,f=engine.scene.objects,l=new An,h=0;h<f.length;h++)if("MESH"===f[h].type&&f[h].visible_shadow){for(var p=f[h],v=0;v<3;v++)l.min[v]=p.bound_box.min[v]+p.location[v],l.max[v]=p.bound_box.max[v]+p.location[v];An.add(c,c,l)}var y=new Y;Y.setValue(y,r[0],o[0],i[0],r[1],o[1],i[1],r[2],o[2],i[2]);var m=new Y;if(Y.setValue(y,r[0],r[1],r[2],o[0],o[1],o[2],i[0],i[1],i[2]),e){Y.dotVec3(c.min,m,e[0]),Y.dotVec3(c.max,m,e[0]);var b=new X;e.forEach(function(t){Y.dotVec3(b,y,t);for(var e=0;e<3;e++)c.min[e]=Math.min(c.min[e],t[e]),c.max[e]=Math.max(c.max[e],t[e])})}X.mul(s,c.min,.5),X.madd(s,s,c.max,.5),X.madd(s,s,i,1+.5*(c.max[2]-c.min[2]));var d=t.data.viewmatrix;J.setValue(d,r[0],r[1],r[2],0,o[0],o[1],o[2],0,i[0],i[1],i[2],0,s[0],s[1],s[2],1),J.getInv(d,d);var g=c.max[2]-c.min[2]+1;xn.perspectiveMatrix(a,.5*-(c.max[0]-c.min[0]),.5*(c.max[0]-c.min[0]),.5*-(c.max[1]-c.min[1])*1,.5*(c.max[1]-c.min[1])*1,1,g),this.light_near=1,this.light_far=g,J.dot(d,a,d),J.setInit(a),a[5]=0,a[9]=1,a[6]=-1,a[10]=0,J.dot(d,a,d)}}]),t}();function yh(t){return yh="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},yh(t)}function mh(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,dh(r.key),r)}}function bh(t,e,n){return e&&mh(t.prototype,e),n&&mh(t,n),Object.defineProperty(t,"prototype",{writable:!1}),t}function dh(t){var e=function(t){if("object"!=yh(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var n=e.call(t,"string");if("object"!=yh(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==yh(e)?e:e+""}function gh(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}vh.prototype.renderShader=function(t,e,n,r){engine.ono3d.environments[0];var o=this.ono3d,i=o.faces,a=i[t].material;ke.viewport(0,0,o.viewport[2],o.viewport[3]);var u=a.shader,s=o.shaders[u];if(s.program){var c=s.atts,f=s.unis;ke.useProgram(s.program),r?xn.setDrawBuffers(ke,s.outnum):xn.setDrawBuffers(ke,s.outnum-1),xn.setUniform(ke,f.anglePos,this.camerap);var l=0;[{name:"aPos",size:3},{name:"aNormal",size:3},{name:"aSvec",size:3},{name:"aTvec",size:3},{name:"aUv",size:2},{name:"aEnvRatio",size:1},{name:"aUv2",size:2},{name:"aLightProbe",size:3}].forEach(function(t){var e=c[t.name];if(e){var n=e.type;ke.vertexAttribPointer(e.location,n.size,n.type,!1,80,4*l)}l+=t.size}),sh[0]=o.viewport[2],sh[1]=o.viewport[3],xn.setUniform(ke,f.uResolution,sh),globalParam.shadow?xn.setUniform(ke,f.uShadowmap,o.shadowTexture,1):xn.setUniform(ke,f.uShadowmap,Ye.dummyTexture,1);var h=this.transTexture;xn.setUniform(ke,f.uTransMap,h,4),ke.uniformMatrix4fv(f.projectionMatrix.location,!1,n);for(var p=t;p<t+e;){var v=p,y=i[p].materialIndex;for(v=p+1;v<t+e&&i[v].materialIndex===y;v++);a=i[p].material,ke.uniform3f(f.uBaseCol.location,a.baseColor[0],a.baseColor[1],a.baseColor[2]),xn.setUniform(ke,f.uOpacity,a.opacity),xn.setUniform(ke,f.uEmi,a.radiant_energy),xn.setUniform(ke,f.uMetallic,a.metallic),f.uPbr&&ke.uniform4f(f.uPbr.location,a.specular,a.roughness,a.subRoughness,a.ior),ke.activeTexture(ke.TEXTURE0),ke.uniform1i(f.uBaseColMap.location,0),a.baseColorMap?(ke.bindTexture(ke.TEXTURE_2D,a.baseColorMap.gl_texture),ke.uniform3f(f.uBaseCol.location,1,1,1)):ke.bindTexture(ke.TEXTURE_2D,Ye.dummyTexture),xn.setUniform(ke,f.uNormalMap,a.heightMap,2),a.heightMap?(xn.setUniform(ke,f.uNormpow,a.heightMapPower),xn.setUniform(ke,f.uHeightBase,a.heightBase)):(xn.setUniform(ke,f.uNormpow,0),xn.setUniform(ke,f.uHeightBase,.5)),xn.setUniform(ke,f.uPbrMap,a.pbrMap,5),a.pbrMap?xn.setUniform(ke,f.uPbrPow,1):xn.setUniform(ke,f.uPbrPow,0),a.orgMap?xn.setUniform(ke,f.orgMap,a.orgMap,6):xn.setUniform(ke,f.uLightMap,a.lightMap,6),ke.drawElements(ke.TRIANGLES,3*(v-p),ke.UNSIGNED_SHORT,3*p*2),p=v}}},vh.prototype.sendgpu=uh;var wh=bh(function t(){gh(this,t),this.location=new Float32Array(2),this.uv=new Float32Array(4),this.texture=null}),_h=function(){function t(){gh(this,t),this.sprites=[],this.sprite_shader=en.load("./engine/sprites/sprite.shader"),this.sprite2_shader=en.load("./engine/sprites/sprite2.shader"),this.pvMatrix=new J,this.viewMatrix=new J}return bh(t,[{key:"addSprite",value:function(t,e,n,r,o,i,a){var u=new wh;return H.setValues(u.location,e,n),q.setValues(u.uv,r,o,i,a),u.texture=t,this.sprites.push(u),u}},{key:"removeSprite",value:function(t){var e=this.sprites.indexOf(t);if(e<0)return-1;this.sprites.splice(e,1)}},{key:"drawSprites",value:function(){ke.depthMask(!1),ke.disable(ke.DEPTH_TEST);var t=this.sprites,e=new Float32Array(20*t.length),n=new Uint16Array(6*t.length),r=0,o=0;if(0!=t.length){t=t.sort(function(t){return t.texture.id});for(var i=0;i<t.length;i++){var a=t[i],u=a.uv;a.texture,n[o]=4*i+0,n[o+1]=4*i+1,n[o+2]=4*i+2,n[o+3]=4*i+2,n[o+4]=4*i+3,n[o+5]=4*i+0,o+=6,e[r]=a.location[0],e[r+1]=a.location[1],e[r+2]=a.location[2],e[r+3]=u[0],e[r+4]=u[1],e[r+=5]=a.location[0]+a.uv[2],e[r+1]=a.location[1],e[r+2]=a.z,e[r+3]=u[2]+u[0],e[r+4]=u[1],e[r+=5]=a.location[0]+a.uv[2],e[r+1]=a.location[1]+a.uv[3],e[r+2]=a.location[2],e[r+3]=u[2]+u[0],e[r+4]=u[3]+u[1],e[r+=5]=a.location[0],e[r+1]=a.location[1]+a.uv[3],e[r+2]=a.location[2],e[r+3]=u[0],e[r+4]=u[3]+a.uv[1],r+=5}ke.bindBuffer(ke.ARRAY_BUFFER,Ye.glbuffer),ke.bufferSubData(ke.ARRAY_BUFFER,0,e),ke.bindBuffer(ke.ELEMENT_ARRAY_BUFFER,Ye.glIdxBuffer),ke.bufferSubData(ke.ELEMENT_ARRAY_BUFFER,0,n);var s=this.sprite2_shader,c=s.atts;s.unis,t[0].texture,ke.useProgram(s.program);var f=new H,l=0;[{name:"aPos",size:3},{name:"aUv",size:2}].forEach(function(t){var e=c[t.name];if(e){var n=e.type;ke.vertexAttribPointer(e.location,n.size,n.type,!1,20,4*l)}l+=t.size}),s.setUniform("uBaseColor",[1,1,1,1]);var h=t[r=0].texture;for(i=0;i<t.length;i++)h!==t[i].texture&&(s.setUniform("uSampler",h),H.setValues(f,1/h.width,1/h.height),s.setUniform("uvScale",f),ke.drawElements(ke.TRIANGLES,3*(i-r)*2,ke.UNSIGNED_SHORT,3*r*2),h=t[i].texture,r=i);s.setUniform("uSampler",h),H.setValues(f,1/h.width,1/h.height),s.setUniform("uvScale",f),ke.drawElements(ke.TRIANGLES,3*(t.length-r)*2,ke.UNSIGNED_SHORT,3*r*2*2)}}},{key:"calcMatrix",value:function(){var t=new z,e=engine.sprite_scene.objects.find(function(t){return"CAMERA"===t.type});if(e){z.fromRotVector(t,.5*-Math.PI,1,0,0),z.dot(t,e.matrix,t),z.getInv(t,t),J.copyMat43(this.viewMatrix,t);var n=Math.sin(e.data.angle),r=n*this.viewh/this.vieww;"PERSP"===e.data.type?xn.perspectiveMatrix(this.pvMatrix,n,r,e.data.clip_start,e.data.clip_end):xn.orthoMatrix(this.pvMatrix,-1.6,1.6*this.viewh/this.vieww,-e.data.clip_start,-e.data.clip_end),J.dotMat43(this.pvMatrix,this.pvMatrix,t)}}},{key:"pipeline",value:function(t){var e=engine.ono3d;e.clear(),t.calcMatrix(0,!1);for(var n=0;n<t.objects.length;n++)t.objects[n].drawSimple();ke.bindFramebuffer(ke.FRAMEBUFFER,null),ke.viewport(0,0,e.viewport[2],e.viewport[3]),ke.enable(ke.BLEND),ke.blendFunc(ke.SRC_ALPHA,ke.ONE_MINUS_SRC_ALPHA),ke.disable(ke.CULL_FACE),ke.clear(ke.DEPTH_BUFFER_BIT),ke.depthMask(!0),ke.enable(ke.DEPTH_TEST);var r=t.objects.find(function(t){return"CAMERA"===t.type});if(r){this.camerap=r.location,this.viewx=e.viewport[0],this.viewy=e.viewport[1],this.vieww=e.viewport[2],this.viewh=e.viewport[3],this.calcMatrix(),ke.clearColor(0,0,0,0);for(var o=0;o<e.materials_index;o++)e.materials[o].shader=this.sprite_shader;var i=e.faces,a=e.faces_index,u=e.indexBuffer,s=-1;ah(e);var c=0,f=[];for(this.materialIndexes=f,n=0;n<a;n++){var l=i[n];s!=l.materialIndex&&(f.push(n),s=l.materialIndex),u[c]=l.vertices[0],u[c+1]=l.vertices[1],u[c+2]=l.vertices[2],c+=3}for(f.push(a),uh(e,c),f=this.materialIndexes,i=e.faces,this.opacityIndex=f.length,n=0;n<f.length-1;n++)xh(f[n],f[n+1]-f[n],this.pvMatrix);this.drawSprites()}else this.drawSprites()}}]),t}();function xh(t,e,n){var r=engine.ono3d.faces[t].material,o=r.shader,i=o.atts;o.unis,ke.useProgram(o.program),o.setUniform("projectionMatrix",n);var a=0;[{name:"aPos",size:3},{name:"aUv",size:2}].forEach(function(t){var e=i[t.name];if(e){var n=e.type;ke.vertexAttribPointer(e.location,n.size,n.type,!1,20,4*a)}a+=t.size}),r.baseColorMap?(o.setUniform("uSampler",r.baseColorMap),o.setUniform("uBaseCol",[1,1,1,1])):(o.setUniform("uSampler",Ye.dummyTexture),o.setUniform("uBaseCol",[r.baseColor[0],r.baseColor[0],r.baseColor[0],1])),ke.drawElements(ke.TRIANGLES,3*e,ke.UNSIGNED_SHORT,3*t*2)}function jh(t){return jh="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},jh(t)}function Oh(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,Eh(r.key),r)}}function Sh(t,e,n){return(e=Eh(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function Eh(t){var e=function(t){if("object"!=jh(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var n=e.call(t,"string");if("object"!=jh(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==jh(e)?e:e+""}_h.Sprite=wh;var Ph=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.children=[],this.stat=t.STAT_CREATE,this.frame=0,this.sprite_objects=[],this.scene_objects=[],this.sprites=[]}return function(t,e){e&&Oh(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1})}(t,[{key:"addChild",value:function(t){t.parent=this,this.children.push(t)}},{key:"removeChild",value:function(t){var e=this.children.indexOf(t);if(e<0)return-1;this.children.splice(e,1)}},{key:"remove",value:function(){for(var t=0;t<this.sprites.length;t++){var e=this.sprites[t];engine.sprites.removeSprite(e)}for(t=0;t<this.scene_objects.length;t++){var n=this.scene_objects[t];(r=engine.scene.objects.indexOf(n))>=0&&engine.scene.objects.splice(r,1)}for(t=0;t<this.sprite_objects.length;t++){var r,o=this.sprite_objects[t];(r=engine.sprite_scene.objects.indexOf(o))>=0&&engine.sprite_scene.objects.splice(r,1)}for(t=this.children.length;t--;)this.children[t].remove();this.children=[],this.parent.removeChild(this)}},{key:"init",value:function(){}},{key:"move",value:function(){for(var t=0;t<this.children.length;t++)this.children[t].move()}},{key:"draw",value:function(){for(var t=0;t<this.children.length;t++)this.children[t].draw()}},{key:"hud",value:function(){for(var t=0;t<this.children.length;t++)this.children[t].hud()}},{key:"delete",value:function(){}}]),t}();function Th(t){return Th="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Th(t)}function kh(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,Rh(r.key),r)}}function Mh(t,e){if(e.has(t))throw new TypeError("Cannot initialize the same private elements twice on an object")}function Rh(t){var e=function(t){if("object"!=Th(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var n=e.call(t,"string");if("object"!=Th(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==Th(e)?e:e+""}function Ih(t,e,n){return Ch(e,t),n}function Ah(t,e,n){return function(t,e,n){if(e.set)e.set.call(t,n);else{if(!e.writable)throw new TypeError("attempted to set read only private field");e.value=n}}(t,function(t,e){return t.get(Ch(t,e))}(e,t),n),n}function Ch(t,e,n){if("function"==typeof t?t===e:t.has(e))return arguments.length<3?e:n;throw new TypeError("Private element is not present on this object")}Sh(Ph,"STAT_EMPTY",0),Sh(Ph,"STAT_ENABLE",1),Sh(Ph,"STAT_CREATE",2);var Fh=new Jf.Material;X.setValue(Fh.baseColor,.5,.5,.5);var Nh=new WeakMap,Bh=new WeakSet,Uh=function(){function t(){var e=this;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),function(t,e){Mh(t,e),e.add(t)}(this,Bh),function(t,e){Mh(t,e),e.set(t,{writable:!0,value:!1})}(this,Nh),this.scene=new gs,this.sprite_scene=new gs,this.rootTask=new Ph,this.camera=new Hl,this.objMan=new $l,this.stereomode=0,this.fps=60,this.prev_time=0,this.step=1,this.physics=1,this.autoExposure=0,this.exposure_level=.5,this.exposure_upper=1,this.exposure_bloom=0,this.instance_draw_list=[],this.custom_material=null,this.debug={},this.occlusion_list=[],this.font_texture=null,this.process_times={},["mainloop","physics","aabb","collision","impulse","draw","drawGeometry","drawRasterise","fps"].forEach(function(t){e.process_times[t]=0}),this.draw_data={},this.draw_data.draw_object_num=0,this.draw_data.drawed_object_num=0,window.engine=this}return function(t,e,n){e&&kh(t.prototype,e),n&&kh(t,n),Object.defineProperty(t,"prototype",{writable:!1})}(t,[{key:"init",value:function(e,n,r){var o=this;this.WIDTH=n,this.HEIGHT=r;var i=document.createElement("canvas");i.width=n,i.height=r,e.appendChild(i);var a=document.getElementById("maincanvas");a?(a.width=n,a.height=r,this.WIDTH=a.width,this.HEIGHT=a.height,n=this.WIDTH,r=this.HEIGHT):((a=document.createElement("canvas")).width=n,a.height=r,e.appendChild(a)),this.canvasgl=a;var u=i.getContext("2d");ke=a.getContext("webgl2",{antialias:!1}),this.gl=ke;var s=ke.getExtension("EXT_color_buffer_float");s=ke.getExtension("EXT_float_blend"),console.log(s),Ut.enableVirtualPad=!0,Ut.init(i,a,e),this.enableGL=!!ke,globalParam.gl=ke,this.enableGL?(Ye.init(ke),i.style.width="0px",a.style.display="inline"):(a.style.display="none",i.style.display="inline");var c=new xn;this.ono3d=c,c.gl=ke;var f=new oh(this);this.graphics=f,this.screenbuffer_texture=new Be(1024,1024,0),Gh=new Be(1024,1024,0),ke.bindTexture(ke.TEXTURE_2D,Gh.gl_texture),this.bufTexture=Gh,Vh=new Be(512,512,0),Dh=new Be(512,512,0),Pn.init(),Xh=new pu,this.onoPhy=Xh,this.collider=Xh.collider,t.basecolorShader=en.load("./lib/shader/basecolor.shader"),Jf.setOno3d(c),c.init(i,u),this.deferred=new vh(c),this.sprites=new _h(c),c.rendercanvas=i,["mainloop","physics","aabb","collision","impulse","draw","drawGeometry","drawRasterise"].forEach(function(t){o.process_times[t]=0}),Ut.mainfunc=function(){o.mainloop()},function t(){0===Ut.getLoadingCount()?o.start():setTimeout(function(){t()},1e3)}()}},{key:"getSightPos",value:function(t,e){var n=new J,r=e,o=t,i=this.camera,a=this.ono3d;r[0]=Ut.cursorX/this.WIDTH*2-1,r[1]=-(Ut.cursorY/this.HEIGHT*2-1),r[2]=1,J.getInv(n,i.pvMatrix),X.setValue(o,r[0],r[1],-1),J.dotVec3(o,n,o),X.mul(o,o,a.znear),J.dotVec3(r,n,r),X.mul(r,r,a.zfar)}},{key:"calcSHcoefs",value:function(t){var e=[];return t.forEach(function(t){var n=Pn.calcSHcoef(t[0],t[1],t[2]);e.push(n)}),e}},{key:"calcEnvironment",value:function(e,n){var r=new yc;e&&0===e.length&&(e=null);var o=this.graphics,i=(this.ono3d,this);r.envTexture=o.createEnv(null,0,0,0,function(t,e,n,r){i.drawSub(t,e,n,r),ke.bindFramebuffer(ke.FRAMEBUFFER,Ye.framebuffer)});var a=[],u=[];if(e){a=a.concat(e),u=u.concat(n);var s=t.createLightProbe(a,u);r.lightProbe=s}else r.default_shcoef=Pn.calcSHcoef(0,0,0);return r.type="LIGHT",r.data={type:"ENVIRONMENT"},r}},{key:"drawFunc",value:function(){var e=this.HEIGHT,n=this.WIDTH;Ah(this,Nh,!1),Qh++,this.ono3d.setViewport(0,0,n,e),performance.mark("drawStart"),performance.mark("drawGeometryStart"),performance.mark("drawGeometryEnd"),performance.mark("drawRasteriseStart"),this.drawSub(0,0,this.WIDTH,this.HEIGHT);var r=ono3d.environments[0].envTexture;r&&this.debug.show_environmentmap&&(ono3d.setViewport(n/2,0,n/2,e/2),xn.drawCopy(r,0,0,1,1)),this.deferred.transTexture&&this.debug.show_transmap&&(ono3d.setViewport(n/2,0,n/2,e/2),xn.drawCopy(this.deferred.transTexture,0,0,1,1)),ke.bindFramebuffer(ke.FRAMEBUFFER,Ye.framebuffer),xn.copyImage(Gh,0,0,0,0,n,e);var o=this.graphics;this.auto_exposure?o.calcExpose(Gh,(n-512)/2/1024,0,.5,e/1024,Dh):o.setExpose(this.exposure_level,this.exposure_upper,Dh),this.exposure_bloom&&(ono3d.setViewport(0,0,n,e),t.bloom(Gh,this.exposure_bloom),xn.copyImage(Gh,0,0,0,0,n,e)),ke.bindFramebuffer(ke.FRAMEBUFFER,null),ono3d.setViewport(0,0,n,e),o.toneMapping(Gh,n/1024,e/1024,Dh),xn.copyImage(this.screenbuffer_texture,0,0,0,0,n,e),this.sprites.pipeline(this.sprite_scene),performance.mark("drawRasteriseEnd"),performance.mark("drawEnd")}},{key:"calcOcclusion",value:function(){var t=this;this.draw_data.draw_object_num=0,this.draw_data.drawed_object_num=0,this.draw_data.culled_object_num=0,this.draw_data.calc_count=0,this.occlusion_list=[],this.light_occlusion_list=[];var e=this.camera.calcBoundingPlanes();e.forEach(function(e){var n={};n.planes=[e],t.occlusion_list.push(n)});var n=this.ono3d.environments[0].sun;(e=this.camera.calcBoundingPlanes2(n.viewmatrix,this.light_near,this.light_far)).forEach(function(e){var n={};e.distance*=-1,X.mul(e.normal,e.normal,-1),n.planes=[e],t.light_occlusion_list.push(n)}),this.instance_draw_list.forEach(function(t){var e=t.target;if(e.object.occlusion){var n=e.setOcclusion();if(n.length){var r={};r.instance=e,r.planes=n,engine.occlusion_list.push(r)}}});for(var r=this.occlusion_list.length;r--;){var o=this.occlusion_list[r].instance;o&&(o.checkOcclusion(this.occlusion_list)||this.occlusion_list.splice(r,1))}this.scene.objects.forEach(function(t){var e=t;if("MESH"===e.type){engine.draw_data.draw_object_num++;var n=!0;n?(n=2===n?2:0,engine.draw_data.drawed_object_num++,e._draw(n)):engine.draw_data.culled_object_num++}})}},{key:"mainloop",value:function(){var t=this,e=performance.now();if(performance.mark("mainloopStart"),Hh[0]=Ut.padX+(Ut.keyflag[2]||Ut.keyflag[10])-(Ut.keyflag[0]||Ut.keyflag[8]),Hh[1]=Ut.padY+(Ut.keyflag[3]||Ut.keyflag[11])-(Ut.keyflag[1]||Ut.keyflag[9]),H.scalar(Hh)>1&&H.norm(Hh),this.rootTask.move(),this.physics){performance.mark("physicsStart");for(var n=0;n<this.step;n++)Xh.calc(1/this.fps/this.step);this.physics_=1,performance.mark("physicsEnd")}e=performance.now(),performance.mark("mainloopEnd");var r=["mainloop","physics","aabb","collision","impulse","draw","drawGeometry","drawRasterise"];for(n=0;n<r.length;n++){var o=r[n];try{performance.measure(o,o+"Start",o+"End")}catch(t){}}if(performance.now(),e-Wh>1e3){var i=1e3*Qh/(e-Wh);r.forEach(function(e){t.process_times[e]=function(t){try{for(var e=performance.getEntriesByName(t),n=0,r=0;r<e.length;r++)n+=e[r].duration;return n/e.length}catch(t){return-1}}(e)}),this.process_times.fps=i,Qh=0,Wh=e,performance.clearMeasures()}}},{key:"calcMatrix",value:function(t){var e=new z;z.fromRotVector(e,.5*-Math.PI,1,0,0),z.dot(e,t.matrix,e),z.getInv(e,e);var n=t.aov,r=t.aov*this.ono3d.viewport[3]/this.ono3d.viewport[2];xn.perspectiveMatrix(this.ono3d.pvMatrix,n,r,t.znear,t.zfar),J.dotMat43(ono3d.pvMatrix,this.ono3d.pvMatrix,e)}},{key:"drawSub",value:function(t,e,n,r){this.scene.calcMatrix(0,!1),this.calcOcclusion(),this.deferred.pipeline(this.scene)}},{key:"start",value:function(){for(var t=location.search.substring(1,location.search.length).split("&"),e=t.length;e--;){var n=t[e].split("=");n.length>1&&(isNaN(n[1])||""==n[1]||n[1].length>1&&"0"==n[1].indexOf(0)?globalParam[n[0]]=n[1]:globalParam[n[0]]=+n[1])}this.skyTexture=this.loadTexture("./engine/back.exr"),this.userInit&&this.userInit(),this.prev_time=Date.now()-1e3/this.fps,Ah(this,Nh,!0),Ih(this,Bh,Lh).call(this)}},{key:"loadTexture",value:function(t,e){return Ll.texture(t,function(t){})}},{key:"loadEnvTexture",value:function(t){var e=this;return Ll.texture(t,function(t){ke.disable(ke.BLEND),ke.disable(ke.DEPTH_TEST),ke.bindFramebuffer(ke.FRAMEBUFFER,Ye.framebuffer),ke.viewport(0,0,t.width,t.height),xn.postEffect(t,0,0,1,1,e.ono3d.shaders.envset),ke.bindTexture(ke.TEXTURE_2D,t.gl_texture),ke.texParameteri(ke.TEXTURE_2D,ke.TEXTURE_WRAP_S,ke.REPEAT),xn.copyImage(t,0,0,0,0,t.width,t.height),ke.bindTexture(ke.TEXTURE_2D,null),ke.bindFramebuffer(ke.FRAMEBUFFER,null)})}},{key:"bindFrameBuffer",value:function(t){this.gl.bindFramebuffer(ke.FRAMEBUFFER,t)}}],[{key:"bloom",value:function(t,e){var n=ono3d.shaders,r=n.add,o=ono3d.viewport[2],i=ono3d.viewport[3];ke.bindFramebuffer(ke.FRAMEBUFFER,null);var a=.25;ono3d.setViewport(0,0,o*a,i*a),xn.postEffect(t,0,0,o/t.width,i/t.height,n.half),xn.copyImage(Vh,0,0,0,0,o*a,i*a);for(var u=0;u<4;u++)ono3d.setViewport(0,0,o*a,i*a),xn.postEffect(Vh,0,1-4*a,o/512*a*2,i*a*2/512,n.half),xn.copyImage(Vh,0,512*(1-2*a),0,0,o*a,i*a),a*=.5;ono3d.setViewport(0,0,256,512),xn.gauss(256,512,100,Vh,0,0,.5,1),xn.copyImage(Vh,0,0,0,0,256,512),ke.disable(ke.BLEND),ono3d.setViewport(0,0,512,512),xn.postEffect(Vh,0,0,.5,.5,n.multiadd),xn.copyImage(Vh,0,0,0,0,512,512),ke.bindFramebuffer(ke.FRAMEBUFFER,null),ke.useProgram(r.program),ke.uniform1i(r.unis.uSampler2.location,1),ke.activeTexture(ke.TEXTURE1),ke.bindTexture(ke.TEXTURE_2D,Vh.gl_texture),ke.uniform1f(r.unis.v1.location,1-e),ke.uniform1f(r.unis.v2.location,e),ono3d.setViewport(0,0,o,i),xn.postEffect(t,0,0,o/t.width,i/t.height,r)}},{key:"createLightProbe",value:function(t,e){var n=Su.create(t),r=ju.createBspTree(n),o={};return o.bspTree=r,o.points=t,o.shcoefs=e,o}}]),t}();function Lh(){var t=this,e=Date.now(),n=!1,r=1e3/this.fps;for(this.prev_time;e-this.prev_time>.5*r;){Ut.mainloop(),n=!0,this.prev_time+=r;var o=Date.now();if(o-e>.1*r){this.prev_time<o-r&&(this.prev_time=o-r);break}}if(Ah(this,Nh,!0),n){ke.clearColor(0,0,0,0),ke.bindFramebuffer(ke.FRAMEBUFFER,Ye.framebuffer),ke.clear(ke.DEPTH_BUFFER_BIT|ke.COLOR_BUFFER_BIT),this.instance_draw_list=[],this.ono3d.clear(),this.rootTask.draw(),this.drawFunc(),this.ono3d.render(this.camera.p,!0);var i=new J;i[5]=0,i[6]=.98,i[9]=-1*this.WIDTH/this.HEIGHT,i[10]=0,i[13]=0,i[14]=.01,this.ono3d.pvMatrix.set(i),this.ono3d.clear(),this.objMan.hud(),this.rootTask.hud(),this.gl.finish()}window.requestAnimationFrame(function(){Ih(t,Bh,Lh).call(t)})}!function(t,e,n){(e=Rh(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n}(Uh,"Camera",Hl);var Vh,Dh,Gh,zh=Uh,Xh=null;zh.goClass=[],zh.go=[],$l.Obj=th;var Hh=new H;Uh.pad=Hh,Uh.probs=new Yo;var qh,Yh,Wh=0,Qh=0;function $h(t){return $h="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},$h(t)}function Jh(){var t=rp(),e=t.m(Jh),n=(Object.getPrototypeOf?Object.getPrototypeOf(e):e.__proto__).constructor;function r(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===n||"GeneratorFunction"===(e.displayName||e.name))}var o={throw:1,return:2,break:3,continue:3};function i(t){var e,n;return function(r){e||(e={stop:function(){return n(r.a,2)},catch:function(){return r.v},abrupt:function(t,e){return n(r.a,o[t],e)},delegateYield:function(t,o,i){return e.resultName=o,n(r.d,Kh(t),i)},finish:function(t){return n(r.f,t)}},n=function(t,n,o){r.p=e.prev,r.n=e.next;try{return t(n,o)}finally{e.next=r.n}}),e.resultName&&(e[e.resultName]=r.v,e.resultName=void 0),e.sent=r.v,e.next=r.n;try{return t.call(this,e)}finally{r.p=e.prev,r.n=e.next}}}return(Jh=function(){return{wrap:function(e,n,r,o){return t.w(i(e),n,r,o&&o.reverse())},isGeneratorFunction:r,mark:t.m,awrap:function(t,e){return new ip(t,e)},AsyncIterator:np,async:function(t,e,n,o,a){return(r(e)?ep:tp)(i(t),e,n,o,a)},keys:Zh,values:Kh}})()}function Kh(t){if(null!=t){var e=t["function"==typeof Symbol&&Symbol.iterator||"@@iterator"],n=0;if(e)return e.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length))return{next:function(){return t&&n>=t.length&&(t=void 0),{value:t&&t[n++],done:!t}}}}throw new TypeError($h(t)+" is not iterable")}function Zh(t){var e=Object(t),n=[];for(var r in e)n.unshift(r);return function t(){for(;n.length;)if((r=n.pop())in e)return t.value=r,t.done=!1,t;return t.done=!0,t}}function tp(t,e,n,r,o){var i=ep(t,e,n,r,o);return i.next().then(function(t){return t.done?t.value:i.next()})}function ep(t,e,n,r,o){return new np(rp().w(t,e,n,r),o||Promise)}function np(t,e){function n(r,o,i,a){try{var u=t[r](o),s=u.value;return s instanceof ip?e.resolve(s.v).then(function(t){n("next",t,i,a)},function(t){n("throw",t,i,a)}):e.resolve(s).then(function(t){u.value=t,i(u)},function(t){return n("throw",t,i,a)})}catch(t){a(t)}}var r;this.next||(op(np.prototype),op(np.prototype,"function"==typeof Symbol&&Symbol.asyncIterator||"@asyncIterator",function(){return this})),op(this,"_invoke",function(t,o,i){function a(){return new e(function(e,r){n(t,i,e,r)})}return r=r?r.then(a,a):a()},!0)}function rp(){var t,e,n="function"==typeof Symbol?Symbol:{},r=n.iterator||"@@iterator",o=n.toStringTag||"@@toStringTag";function i(n,r,o,i){var s=r&&r.prototype instanceof u?r:u,c=Object.create(s.prototype);return op(c,"_invoke",function(n,r,o){var i,u,s,c=0,f=o||[],l=!1,h={p:0,n:0,v:t,a:p,f:p.bind(t,4),d:function(e,n){return i=e,u=0,s=t,h.n=n,a}};function p(n,r){for(u=n,s=r,e=0;!l&&c&&!o&&e<f.length;e++){var o,i=f[e],p=h.p,v=i[2];n>3?(o=v===r)&&(s=i[(u=i[4])?5:(u=3,3)],i[4]=i[5]=t):i[0]<=p&&((o=n<2&&p<i[1])?(u=0,h.v=r,h.n=i[1]):p<v&&(o=n<3||i[0]>r||r>v)&&(i[4]=n,i[5]=r,h.n=v,u=0))}if(o||n>1)return a;throw l=!0,r}return function(o,f,v){if(c>1)throw TypeError("Generator is already running");for(l&&1===f&&p(f,v),u=f,s=v;(e=u<2?t:s)||!l;){i||(u?u<3?(u>1&&(h.n=-1),p(u,s)):h.n=s:h.v=s);try{if(c=2,i){if(u||(o="next"),e=i[o]){if(!(e=e.call(i,s)))throw TypeError("iterator result is not an object");if(!e.done)return e;s=e.value,u<2&&(u=0)}else 1===u&&(e=i.return)&&e.call(i),u<2&&(s=TypeError("The iterator does not provide a '"+o+"' method"),u=1);i=t}else if((e=(l=h.n<0)?s:n.call(r,h))!==a)break}catch(e){i=t,u=1,s=e}finally{c=1}}return{value:e,done:l}}}(n,o,i),!0),c}var a={};function u(){}function s(){}function c(){}e=Object.getPrototypeOf;var f=[][r]?e(e([][r]())):(op(e={},r,function(){return this}),e),l=c.prototype=u.prototype=Object.create(f);function h(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,c):(t.__proto__=c,op(t,o,"GeneratorFunction")),t.prototype=Object.create(l),t}return s.prototype=c,op(l,"constructor",c),op(c,"constructor",s),s.displayName="GeneratorFunction",op(c,o,"GeneratorFunction"),op(l),op(l,o,"Generator"),op(l,r,function(){return this}),op(l,"toString",function(){return"[object Generator]"}),(rp=function(){return{w:i,m:h}})()}function op(t,e,n,r){var o=Object.defineProperty;try{o({},"",{})}catch(t){o=0}op=function(t,e,n,r){function i(e,n){op(t,e,function(t){return this._invoke(e,n,t)})}e?o?o(t,e,{value:n,enumerable:!r,configurable:!r,writable:!r}):t[e]=n:(i("next",0),i("throw",1),i("return",2))},op(t,e,n,r)}function ip(t,e){this.v=t,this.k=e}function ap(t,e,n,r,o,i,a){try{var u=t[i](a),s=u.value}catch(t){return void n(t)}u.done?e(s):Promise.resolve(s).then(r,o)}function up(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,sp(r.key),r)}}function sp(t){var e=function(t){if("object"!=$h(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var n=e.call(t,"string");if("object"!=$h(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==$h(e)?e:e+""}function cp(t,e){return cp=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},cp(t,e)}function fp(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(t){}return(fp=function(){return!!t})()}function lp(t){return lp=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},lp(t)}globalParam.outline_bold=0,globalParam.outline_color="000000",globalParam.lightColor1="808080",globalParam.lightColor2="808080",globalParam.lightThreshold1=0,globalParam.lightThreshold2=1,globalParam.physics=1,globalParam.physics_=0,globalParam.smoothing=0,globalParam.stereomode=0,globalParam.stereoVolume=1,globalParam.step=1,globalParam.fps=30,globalParam.scene=0,globalParam.shadow=1,globalParam.model="./f1.o3o",globalParam.materialMode=!1,globalParam.baseColor="ffffff",globalParam.metallic=0,globalParam.metalColor="ffffff",globalParam.specular=0,globalParam.roughness=0,globalParam.subRoughness=0,globalParam.frenel=0,globalParam.opacity=1,globalParam.ior=1.1,globalParam.cNormal=1,globalParam.emi=0,globalParam.debugMenu=0,globalParam.source=0,globalParam.target=0,globalParam.reference=0,globalParam.actionAlpha=0,(qh=document.scripts||document.getElementsByTagName("script"))[qh.length-1].parentNode,Uh.AssetManager=Ll;var hp,pp=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&cp(t,e)}(n,t);var e=function(t){var e=fp();return function(){var n,r=lp(t);if(e){var o=lp(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return function(t,e){if(e&&("object"==$h(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(this,n)}}(n);function n(){var t,r;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,n),(t=e.call(this)).frame=0,t.location=new X,X.setValues(t.location,160,0,0),(r=Jh().mark(function t(){return Jh().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,Uh.AssetManager.texture("model/test.png");case 2:Yh=t.sent;case 3:case"end":return t.stop()}},t)}),function(){var t=this,e=arguments;return new Promise(function(n,o){var i=r.apply(t,e);function a(t){ap(i,n,o,a,u,"next",t)}function u(t){ap(i,n,o,a,u,"throw",t)}a(void 0)})})(),t}return function(t,e){e&&up(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1})}(n,[{key:"move",value:function(){if(Yh){if(0===this.frame){this.sprites=[];for(var t=""+this.pt,e=0;e<t.length;e++){var n=t.charCodeAt(e)-"0".charCodeAt(0),r=engine.sprites.addSprite(Yh,0,0,80+8*n,80,8,16);this.sprites.push(r)}r=engine.sprites.addSprite(Yh,0,0,0,96,8,8),this.sprites.push(r)}for(this.frame++,e=0;e<this.sprites.length;e++)r=this.sprites[e],X.copy(r.location,this.location),r.location[0]=this.location[0]+8*e,r.location[1]=this.location[1]-this.frame;this.frame>60&&this.remove()}}}]),n}(Ph);function vp(t){return vp="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},vp(t)}function yp(){var t=_p(),e=t.m(yp),n=(Object.getPrototypeOf?Object.getPrototypeOf(e):e.__proto__).constructor;function r(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===n||"GeneratorFunction"===(e.displayName||e.name))}var o={throw:1,return:2,break:3,continue:3};function i(t){var e,n;return function(r){e||(e={stop:function(){return n(r.a,2)},catch:function(){return r.v},abrupt:function(t,e){return n(r.a,o[t],e)},delegateYield:function(t,o,i){return e.resultName=o,n(r.d,mp(t),i)},finish:function(t){return n(r.f,t)}},n=function(t,n,o){r.p=e.prev,r.n=e.next;try{return t(n,o)}finally{e.next=r.n}}),e.resultName&&(e[e.resultName]=r.v,e.resultName=void 0),e.sent=r.v,e.next=r.n;try{return t.call(this,e)}finally{r.p=e.prev,r.n=e.next}}}return(yp=function(){return{wrap:function(e,n,r,o){return t.w(i(e),n,r,o&&o.reverse())},isGeneratorFunction:r,mark:t.m,awrap:function(t,e){return new jp(t,e)},AsyncIterator:wp,async:function(t,e,n,o,a){return(r(e)?gp:dp)(i(t),e,n,o,a)},keys:bp,values:mp}})()}function mp(t){if(null!=t){var e=t["function"==typeof Symbol&&Symbol.iterator||"@@iterator"],n=0;if(e)return e.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length))return{next:function(){return t&&n>=t.length&&(t=void 0),{value:t&&t[n++],done:!t}}}}throw new TypeError(vp(t)+" is not iterable")}function bp(t){var e=Object(t),n=[];for(var r in e)n.unshift(r);return function t(){for(;n.length;)if((r=n.pop())in e)return t.value=r,t.done=!1,t;return t.done=!0,t}}function dp(t,e,n,r,o){var i=gp(t,e,n,r,o);return i.next().then(function(t){return t.done?t.value:i.next()})}function gp(t,e,n,r,o){return new wp(_p().w(t,e,n,r),o||Promise)}function wp(t,e){function n(r,o,i,a){try{var u=t[r](o),s=u.value;return s instanceof jp?e.resolve(s.v).then(function(t){n("next",t,i,a)},function(t){n("throw",t,i,a)}):e.resolve(s).then(function(t){u.value=t,i(u)},function(t){return n("throw",t,i,a)})}catch(t){a(t)}}var r;this.next||(xp(wp.prototype),xp(wp.prototype,"function"==typeof Symbol&&Symbol.asyncIterator||"@asyncIterator",function(){return this})),xp(this,"_invoke",function(t,o,i){function a(){return new e(function(e,r){n(t,i,e,r)})}return r=r?r.then(a,a):a()},!0)}function _p(){var t,e,n="function"==typeof Symbol?Symbol:{},r=n.iterator||"@@iterator",o=n.toStringTag||"@@toStringTag";function i(n,r,o,i){var s=r&&r.prototype instanceof u?r:u,c=Object.create(s.prototype);return xp(c,"_invoke",function(n,r,o){var i,u,s,c=0,f=o||[],l=!1,h={p:0,n:0,v:t,a:p,f:p.bind(t,4),d:function(e,n){return i=e,u=0,s=t,h.n=n,a}};function p(n,r){for(u=n,s=r,e=0;!l&&c&&!o&&e<f.length;e++){var o,i=f[e],p=h.p,v=i[2];n>3?(o=v===r)&&(s=i[(u=i[4])?5:(u=3,3)],i[4]=i[5]=t):i[0]<=p&&((o=n<2&&p<i[1])?(u=0,h.v=r,h.n=i[1]):p<v&&(o=n<3||i[0]>r||r>v)&&(i[4]=n,i[5]=r,h.n=v,u=0))}if(o||n>1)return a;throw l=!0,r}return function(o,f,v){if(c>1)throw TypeError("Generator is already running");for(l&&1===f&&p(f,v),u=f,s=v;(e=u<2?t:s)||!l;){i||(u?u<3?(u>1&&(h.n=-1),p(u,s)):h.n=s:h.v=s);try{if(c=2,i){if(u||(o="next"),e=i[o]){if(!(e=e.call(i,s)))throw TypeError("iterator result is not an object");if(!e.done)return e;s=e.value,u<2&&(u=0)}else 1===u&&(e=i.return)&&e.call(i),u<2&&(s=TypeError("The iterator does not provide a '"+o+"' method"),u=1);i=t}else if((e=(l=h.n<0)?s:n.call(r,h))!==a)break}catch(e){i=t,u=1,s=e}finally{c=1}}return{value:e,done:l}}}(n,o,i),!0),c}var a={};function u(){}function s(){}function c(){}e=Object.getPrototypeOf;var f=[][r]?e(e([][r]())):(xp(e={},r,function(){return this}),e),l=c.prototype=u.prototype=Object.create(f);function h(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,c):(t.__proto__=c,xp(t,o,"GeneratorFunction")),t.prototype=Object.create(l),t}return s.prototype=c,xp(l,"constructor",c),xp(c,"constructor",s),s.displayName="GeneratorFunction",xp(c,o,"GeneratorFunction"),xp(l),xp(l,o,"Generator"),xp(l,r,function(){return this}),xp(l,"toString",function(){return"[object Generator]"}),(_p=function(){return{w:i,m:h}})()}function xp(t,e,n,r){var o=Object.defineProperty;try{o({},"",{})}catch(t){o=0}xp=function(t,e,n,r){function i(e,n){xp(t,e,function(t){return this._invoke(e,n,t)})}e?o?o(t,e,{value:n,enumerable:!r,configurable:!r,writable:!r}):t[e]=n:(i("next",0),i("throw",1),i("return",2))},xp(t,e,n,r)}function jp(t,e){this.v=t,this.k=e}function Op(t,e,n,r,o,i,a){try{var u=t[i](a),s=u.value}catch(t){return void n(t)}u.done?e(s):Promise.resolve(s).then(r,o)}function Sp(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,Ep(r.key),r)}}function Ep(t){var e=function(t){if("object"!=vp(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var n=e.call(t,"string");if("object"!=vp(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==vp(e)?e:e+""}function Pp(t,e){return Pp=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},Pp(t,e)}function Tp(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(t){}return(Tp=function(){return!!t})()}function kp(t){return kp=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},kp(t)}var Mp,Rp=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&Pp(t,e)}(n,t);var e=function(t){var e=Tp();return function(){var n,r=kp(t);if(e){var o=kp(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return function(t,e){if(e&&("object"==vp(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(this,n)}}(n);function n(){var t,r;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,n),(t=e.call(this)).frame=0,t.location=new X,X.setValues(t.location,160,0,0),(r=yp().mark(function t(){return yp().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,Uh.AssetManager.texture("model/test.png");case 2:hp=t.sent;case 3:case"end":return t.stop()}},t)}),function(){var t=this,e=arguments;return new Promise(function(n,o){var i=r.apply(t,e);function a(t){Op(i,n,o,a,u,"next",t)}function u(t){Op(i,n,o,a,u,"throw",t)}a(void 0)})})(),t}return function(t,e){e&&Sp(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1})}(n,[{key:"move",value:function(){if(hp){if(0===this.frame)if(1===this.pt){var t=engine.sprites.addSprite(hp,0,0,0,104,56,8);this.sprites.push(t)}else t=engine.sprites.addSprite(hp,0,0,0,112,80,8),this.sprites.push(t);this.frame++;for(var e=0;e<this.sprites.length;e++)t=this.sprites[e],X.copy(t.location,this.location),t.location[0]=this.location[0]+8*e,t.location[1]=this.location[1]-this.frame;this.frame>60&&this.remove()}}}]),n}(Ph);function Ip(t){return Ip="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Ip(t)}function Ap(){var t=Lp(),e=t.m(Ap),n=(Object.getPrototypeOf?Object.getPrototypeOf(e):e.__proto__).constructor;function r(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===n||"GeneratorFunction"===(e.displayName||e.name))}var o={throw:1,return:2,break:3,continue:3};function i(t){var e,n;return function(r){e||(e={stop:function(){return n(r.a,2)},catch:function(){return r.v},abrupt:function(t,e){return n(r.a,o[t],e)},delegateYield:function(t,o,i){return e.resultName=o,n(r.d,Cp(t),i)},finish:function(t){return n(r.f,t)}},n=function(t,n,o){r.p=e.prev,r.n=e.next;try{return t(n,o)}finally{e.next=r.n}}),e.resultName&&(e[e.resultName]=r.v,e.resultName=void 0),e.sent=r.v,e.next=r.n;try{return t.call(this,e)}finally{r.p=e.prev,r.n=e.next}}}return(Ap=function(){return{wrap:function(e,n,r,o){return t.w(i(e),n,r,o&&o.reverse())},isGeneratorFunction:r,mark:t.m,awrap:function(t,e){return new Dp(t,e)},AsyncIterator:Up,async:function(t,e,n,o,a){return(r(e)?Bp:Np)(i(t),e,n,o,a)},keys:Fp,values:Cp}})()}function Cp(t){if(null!=t){var e=t["function"==typeof Symbol&&Symbol.iterator||"@@iterator"],n=0;if(e)return e.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length))return{next:function(){return t&&n>=t.length&&(t=void 0),{value:t&&t[n++],done:!t}}}}throw new TypeError(Ip(t)+" is not iterable")}function Fp(t){var e=Object(t),n=[];for(var r in e)n.unshift(r);return function t(){for(;n.length;)if((r=n.pop())in e)return t.value=r,t.done=!1,t;return t.done=!0,t}}function Np(t,e,n,r,o){var i=Bp(t,e,n,r,o);return i.next().then(function(t){return t.done?t.value:i.next()})}function Bp(t,e,n,r,o){return new Up(Lp().w(t,e,n,r),o||Promise)}function Up(t,e){function n(r,o,i,a){try{var u=t[r](o),s=u.value;return s instanceof Dp?e.resolve(s.v).then(function(t){n("next",t,i,a)},function(t){n("throw",t,i,a)}):e.resolve(s).then(function(t){u.value=t,i(u)},function(t){return n("throw",t,i,a)})}catch(t){a(t)}}var r;this.next||(Vp(Up.prototype),Vp(Up.prototype,"function"==typeof Symbol&&Symbol.asyncIterator||"@asyncIterator",function(){return this})),Vp(this,"_invoke",function(t,o,i){function a(){return new e(function(e,r){n(t,i,e,r)})}return r=r?r.then(a,a):a()},!0)}function Lp(){var t,e,n="function"==typeof Symbol?Symbol:{},r=n.iterator||"@@iterator",o=n.toStringTag||"@@toStringTag";function i(n,r,o,i){var s=r&&r.prototype instanceof u?r:u,c=Object.create(s.prototype);return Vp(c,"_invoke",function(n,r,o){var i,u,s,c=0,f=o||[],l=!1,h={p:0,n:0,v:t,a:p,f:p.bind(t,4),d:function(e,n){return i=e,u=0,s=t,h.n=n,a}};function p(n,r){for(u=n,s=r,e=0;!l&&c&&!o&&e<f.length;e++){var o,i=f[e],p=h.p,v=i[2];n>3?(o=v===r)&&(s=i[(u=i[4])?5:(u=3,3)],i[4]=i[5]=t):i[0]<=p&&((o=n<2&&p<i[1])?(u=0,h.v=r,h.n=i[1]):p<v&&(o=n<3||i[0]>r||r>v)&&(i[4]=n,i[5]=r,h.n=v,u=0))}if(o||n>1)return a;throw l=!0,r}return function(o,f,v){if(c>1)throw TypeError("Generator is already running");for(l&&1===f&&p(f,v),u=f,s=v;(e=u<2?t:s)||!l;){i||(u?u<3?(u>1&&(h.n=-1),p(u,s)):h.n=s:h.v=s);try{if(c=2,i){if(u||(o="next"),e=i[o]){if(!(e=e.call(i,s)))throw TypeError("iterator result is not an object");if(!e.done)return e;s=e.value,u<2&&(u=0)}else 1===u&&(e=i.return)&&e.call(i),u<2&&(s=TypeError("The iterator does not provide a '"+o+"' method"),u=1);i=t}else if((e=(l=h.n<0)?s:n.call(r,h))!==a)break}catch(e){i=t,u=1,s=e}finally{c=1}}return{value:e,done:l}}}(n,o,i),!0),c}var a={};function u(){}function s(){}function c(){}e=Object.getPrototypeOf;var f=[][r]?e(e([][r]())):(Vp(e={},r,function(){return this}),e),l=c.prototype=u.prototype=Object.create(f);function h(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,c):(t.__proto__=c,Vp(t,o,"GeneratorFunction")),t.prototype=Object.create(l),t}return s.prototype=c,Vp(l,"constructor",c),Vp(c,"constructor",s),s.displayName="GeneratorFunction",Vp(c,o,"GeneratorFunction"),Vp(l),Vp(l,o,"Generator"),Vp(l,r,function(){return this}),Vp(l,"toString",function(){return"[object Generator]"}),(Lp=function(){return{w:i,m:h}})()}function Vp(t,e,n,r){var o=Object.defineProperty;try{o({},"",{})}catch(t){o=0}Vp=function(t,e,n,r){function i(e,n){Vp(t,e,function(t){return this._invoke(e,n,t)})}e?o?o(t,e,{value:n,enumerable:!r,configurable:!r,writable:!r}):t[e]=n:(i("next",0),i("throw",1),i("return",2))},Vp(t,e,n,r)}function Dp(t,e){this.v=t,this.k=e}function Gp(t,e,n,r,o,i,a){try{var u=t[i](a),s=u.value}catch(t){return void n(t)}u.done?e(s):Promise.resolve(s).then(r,o)}function zp(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,Xp(r.key),r)}}function Xp(t){var e=function(t){if("object"!=Ip(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var n=e.call(t,"string");if("object"!=Ip(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==Ip(e)?e:e+""}function Hp(t,e){return Hp=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},Hp(t,e)}function qp(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(t){}return(qp=function(){return!!t})()}function Yp(t){return Yp=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},Yp(t)}var Wp,Qp,$p=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&Hp(t,e)}(n,t);var e=function(t){var e=qp();return function(){var n,r=Yp(t);if(e){var o=Yp(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return function(t,e){if(e&&("object"==Ip(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(this,n)}}(n);function n(){var t;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,n),(t=e.call(this)).frame=0,t.location=new X,t.v=new X;var r,o,i=2*Math.random()*Math.PI;return t.v[0]=Math.sin(i),t.v[1]=Math.cos(i),X.mul(t.v,t.v,.02*(t.v,Math.random()+1)),(r=Ap().mark(function t(e){return Ap().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,Uh.AssetManager.o3o("model/dis.o3o");case 2:Mp=t.sent;case 3:case"end":return t.stop()}},t)}),o=function(){var t=this,e=arguments;return new Promise(function(n,o){var i=r.apply(t,e);function a(t){Gp(i,n,o,a,u,"next",t)}function u(t){Gp(i,n,o,a,u,"throw",t)}a(void 0)})},function(t){return o.apply(this,arguments)})(),t.mainobj="",t.init=!0,t}return function(t,e){e&&zp(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1})}(n,[{key:"move",value:function(){Mp&&(this.init&&(this.mainobj=Mp.objects_name_hash.hinoko.linkCopy(),engine.scene.objects.push(this.mainobj),this.scene_objects.push(this.mainobj),this.init=!1),this.frame>=24&&this.remove(),X.mad(this.mainobj.location,this.location,this.v,this.frame+10),this.frame++)}}]),n}(Ph);function Jp(t){return Jp="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Jp(t)}function Kp(){var t=ov(),e=t.m(Kp),n=(Object.getPrototypeOf?Object.getPrototypeOf(e):e.__proto__).constructor;function r(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===n||"GeneratorFunction"===(e.displayName||e.name))}var o={throw:1,return:2,break:3,continue:3};function i(t){var e,n;return function(r){e||(e={stop:function(){return n(r.a,2)},catch:function(){return r.v},abrupt:function(t,e){return n(r.a,o[t],e)},delegateYield:function(t,o,i){return e.resultName=o,n(r.d,Zp(t),i)},finish:function(t){return n(r.f,t)}},n=function(t,n,o){r.p=e.prev,r.n=e.next;try{return t(n,o)}finally{e.next=r.n}}),e.resultName&&(e[e.resultName]=r.v,e.resultName=void 0),e.sent=r.v,e.next=r.n;try{return t.call(this,e)}finally{r.p=e.prev,r.n=e.next}}}return(Kp=function(){return{wrap:function(e,n,r,o){return t.w(i(e),n,r,o&&o.reverse())},isGeneratorFunction:r,mark:t.m,awrap:function(t,e){return new av(t,e)},AsyncIterator:rv,async:function(t,e,n,o,a){return(r(e)?nv:ev)(i(t),e,n,o,a)},keys:tv,values:Zp}})()}function Zp(t){if(null!=t){var e=t["function"==typeof Symbol&&Symbol.iterator||"@@iterator"],n=0;if(e)return e.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length))return{next:function(){return t&&n>=t.length&&(t=void 0),{value:t&&t[n++],done:!t}}}}throw new TypeError(Jp(t)+" is not iterable")}function tv(t){var e=Object(t),n=[];for(var r in e)n.unshift(r);return function t(){for(;n.length;)if((r=n.pop())in e)return t.value=r,t.done=!1,t;return t.done=!0,t}}function ev(t,e,n,r,o){var i=nv(t,e,n,r,o);return i.next().then(function(t){return t.done?t.value:i.next()})}function nv(t,e,n,r,o){return new rv(ov().w(t,e,n,r),o||Promise)}function rv(t,e){function n(r,o,i,a){try{var u=t[r](o),s=u.value;return s instanceof av?e.resolve(s.v).then(function(t){n("next",t,i,a)},function(t){n("throw",t,i,a)}):e.resolve(s).then(function(t){u.value=t,i(u)},function(t){return n("throw",t,i,a)})}catch(t){a(t)}}var r;this.next||(iv(rv.prototype),iv(rv.prototype,"function"==typeof Symbol&&Symbol.asyncIterator||"@asyncIterator",function(){return this})),iv(this,"_invoke",function(t,o,i){function a(){return new e(function(e,r){n(t,i,e,r)})}return r=r?r.then(a,a):a()},!0)}function ov(){var t,e,n="function"==typeof Symbol?Symbol:{},r=n.iterator||"@@iterator",o=n.toStringTag||"@@toStringTag";function i(n,r,o,i){var s=r&&r.prototype instanceof u?r:u,c=Object.create(s.prototype);return iv(c,"_invoke",function(n,r,o){var i,u,s,c=0,f=o||[],l=!1,h={p:0,n:0,v:t,a:p,f:p.bind(t,4),d:function(e,n){return i=e,u=0,s=t,h.n=n,a}};function p(n,r){for(u=n,s=r,e=0;!l&&c&&!o&&e<f.length;e++){var o,i=f[e],p=h.p,v=i[2];n>3?(o=v===r)&&(s=i[(u=i[4])?5:(u=3,3)],i[4]=i[5]=t):i[0]<=p&&((o=n<2&&p<i[1])?(u=0,h.v=r,h.n=i[1]):p<v&&(o=n<3||i[0]>r||r>v)&&(i[4]=n,i[5]=r,h.n=v,u=0))}if(o||n>1)return a;throw l=!0,r}return function(o,f,v){if(c>1)throw TypeError("Generator is already running");for(l&&1===f&&p(f,v),u=f,s=v;(e=u<2?t:s)||!l;){i||(u?u<3?(u>1&&(h.n=-1),p(u,s)):h.n=s:h.v=s);try{if(c=2,i){if(u||(o="next"),e=i[o]){if(!(e=e.call(i,s)))throw TypeError("iterator result is not an object");if(!e.done)return e;s=e.value,u<2&&(u=0)}else 1===u&&(e=i.return)&&e.call(i),u<2&&(s=TypeError("The iterator does not provide a '"+o+"' method"),u=1);i=t}else if((e=(l=h.n<0)?s:n.call(r,h))!==a)break}catch(e){i=t,u=1,s=e}finally{c=1}}return{value:e,done:l}}}(n,o,i),!0),c}var a={};function u(){}function s(){}function c(){}e=Object.getPrototypeOf;var f=[][r]?e(e([][r]())):(iv(e={},r,function(){return this}),e),l=c.prototype=u.prototype=Object.create(f);function h(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,c):(t.__proto__=c,iv(t,o,"GeneratorFunction")),t.prototype=Object.create(l),t}return s.prototype=c,iv(l,"constructor",c),iv(c,"constructor",s),s.displayName="GeneratorFunction",iv(c,o,"GeneratorFunction"),iv(l),iv(l,o,"Generator"),iv(l,r,function(){return this}),iv(l,"toString",function(){return"[object Generator]"}),(ov=function(){return{w:i,m:h}})()}function iv(t,e,n,r){var o=Object.defineProperty;try{o({},"",{})}catch(t){o=0}iv=function(t,e,n,r){function i(e,n){iv(t,e,function(t){return this._invoke(e,n,t)})}e?o?o(t,e,{value:n,enumerable:!r,configurable:!r,writable:!r}):t[e]=n:(i("next",0),i("throw",1),i("return",2))},iv(t,e,n,r)}function av(t,e){this.v=t,this.k=e}function uv(t,e,n,r,o,i,a){try{var u=t[i](a),s=u.value}catch(t){return void n(t)}u.done?e(s):Promise.resolve(s).then(r,o)}function sv(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,cv(r.key),r)}}function cv(t){var e=function(t){if("object"!=Jp(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var n=e.call(t,"string");if("object"!=Jp(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==Jp(e)?e:e+""}function fv(){return fv="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(t,e,n){var r=function(t,e){for(;!{}.hasOwnProperty.call(t,e)&&null!==(t=pv(t)););return t}(t,e);if(r){var o=Object.getOwnPropertyDescriptor(r,e);return o.get?o.get.call(arguments.length<3?t:n):o.value}},fv.apply(null,arguments)}function lv(t,e){return lv=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},lv(t,e)}function hv(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(t){}return(hv=function(){return!!t})()}function pv(t){return pv=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},pv(t)}var vv,yv=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&lv(t,e)}(n,t);var e=function(t){var e=hv();return function(){var n,r=pv(t);if(e){var o=pv(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return function(t,e){if(e&&("object"==Jp(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(this,n)}}(n);function n(){var t,r,o;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,n),(t=e.call(this)).frame=0,t.location=new X,t.state=0,t.init=1,t.v=new X,t.ground_flg=0,t.loaded=!1,(r=Kp().mark(function e(n){return Kp().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Uh.AssetManager.o3o("model/sd_cif.o3o");case 2:return Wp=e.sent,e.next=5,Uh.AssetManager.audio("sound/hit.wav");case 5:Qp=e.sent,t.loaded=!0;case 7:case"end":return e.stop()}},e)}),o=function(){var t=this,e=arguments;return new Promise(function(n,o){var i=r.apply(t,e);function a(t){uv(i,n,o,a,u,"next",t)}function u(t){uv(i,n,o,a,u,"throw",t)}a(void 0)})},function(t){return o.apply(this,arguments)})(),t.v[1]=.3,t.mainobj,t}return function(t,e){e&&sv(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1})}(n,[{key:"remove",value:function(){for(var t=0;t<this.scene_objects.length;t++){var e=this.scene_objects[t];this.parent.collider.deleteCollision(e.collision)}fv(pv(n.prototype),"remove",this).call(this)}},{key:"hit",value:function(t,e){if("dis_hit"===e.name||"octahedron_hit"===e.name||"octahedron2_hit"===e.name){var n=new $p;this.parent.addChild(n),X.copy(n.location,this.location),n.location[2]+=.4,Qp.playSound(0,!0),this.remove()}}},{key:"move",value:function(){var t=this;if(this.loaded){if(this.init){for(var e=Wp.getCollectionObjectList(Wp.collections.beam),n=0;n<e.length;n++){var r=e[n].linkCopy();engine.scene.objects.push(r),this.scene_objects.push(r),r.collision&&(this.parent.collider.addCollision(r.collision),r.collision.callbackFunc=function(e,n){t.hit(e,n)}),"beam"===e[n].name&&(this.mainobj=r)}for(n=0;n<this.scene_objects.length;n++)(r=this.scene_objects[n])!==this.mainobj&&(r.parent=this.mainobj);this.init=!1}X.copy(this.mainobj.location,this.location),this.frame>60&&this.remove(),this.frame++,this.location[0]+=this.v[0],this.location[1]+=this.v[1]}}}]),n}(Ph);function mv(t){return mv="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},mv(t)}function bv(){var t=jv(),e=t.m(bv),n=(Object.getPrototypeOf?Object.getPrototypeOf(e):e.__proto__).constructor;function r(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===n||"GeneratorFunction"===(e.displayName||e.name))}var o={throw:1,return:2,break:3,continue:3};function i(t){var e,n;return function(r){e||(e={stop:function(){return n(r.a,2)},catch:function(){return r.v},abrupt:function(t,e){return n(r.a,o[t],e)},delegateYield:function(t,o,i){return e.resultName=o,n(r.d,dv(t),i)},finish:function(t){return n(r.f,t)}},n=function(t,n,o){r.p=e.prev,r.n=e.next;try{return t(n,o)}finally{e.next=r.n}}),e.resultName&&(e[e.resultName]=r.v,e.resultName=void 0),e.sent=r.v,e.next=r.n;try{return t.call(this,e)}finally{r.p=e.prev,r.n=e.next}}}return(bv=function(){return{wrap:function(e,n,r,o){return t.w(i(e),n,r,o&&o.reverse())},isGeneratorFunction:r,mark:t.m,awrap:function(t,e){return new Sv(t,e)},AsyncIterator:xv,async:function(t,e,n,o,a){return(r(e)?_v:wv)(i(t),e,n,o,a)},keys:gv,values:dv}})()}function dv(t){if(null!=t){var e=t["function"==typeof Symbol&&Symbol.iterator||"@@iterator"],n=0;if(e)return e.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length))return{next:function(){return t&&n>=t.length&&(t=void 0),{value:t&&t[n++],done:!t}}}}throw new TypeError(mv(t)+" is not iterable")}function gv(t){var e=Object(t),n=[];for(var r in e)n.unshift(r);return function t(){for(;n.length;)if((r=n.pop())in e)return t.value=r,t.done=!1,t;return t.done=!0,t}}function wv(t,e,n,r,o){var i=_v(t,e,n,r,o);return i.next().then(function(t){return t.done?t.value:i.next()})}function _v(t,e,n,r,o){return new xv(jv().w(t,e,n,r),o||Promise)}function xv(t,e){function n(r,o,i,a){try{var u=t[r](o),s=u.value;return s instanceof Sv?e.resolve(s.v).then(function(t){n("next",t,i,a)},function(t){n("throw",t,i,a)}):e.resolve(s).then(function(t){u.value=t,i(u)},function(t){return n("throw",t,i,a)})}catch(t){a(t)}}var r;this.next||(Ov(xv.prototype),Ov(xv.prototype,"function"==typeof Symbol&&Symbol.asyncIterator||"@asyncIterator",function(){return this})),Ov(this,"_invoke",function(t,o,i){function a(){return new e(function(e,r){n(t,i,e,r)})}return r=r?r.then(a,a):a()},!0)}function jv(){var t,e,n="function"==typeof Symbol?Symbol:{},r=n.iterator||"@@iterator",o=n.toStringTag||"@@toStringTag";function i(n,r,o,i){var s=r&&r.prototype instanceof u?r:u,c=Object.create(s.prototype);return Ov(c,"_invoke",function(n,r,o){var i,u,s,c=0,f=o||[],l=!1,h={p:0,n:0,v:t,a:p,f:p.bind(t,4),d:function(e,n){return i=e,u=0,s=t,h.n=n,a}};function p(n,r){for(u=n,s=r,e=0;!l&&c&&!o&&e<f.length;e++){var o,i=f[e],p=h.p,v=i[2];n>3?(o=v===r)&&(s=i[(u=i[4])?5:(u=3,3)],i[4]=i[5]=t):i[0]<=p&&((o=n<2&&p<i[1])?(u=0,h.v=r,h.n=i[1]):p<v&&(o=n<3||i[0]>r||r>v)&&(i[4]=n,i[5]=r,h.n=v,u=0))}if(o||n>1)return a;throw l=!0,r}return function(o,f,v){if(c>1)throw TypeError("Generator is already running");for(l&&1===f&&p(f,v),u=f,s=v;(e=u<2?t:s)||!l;){i||(u?u<3?(u>1&&(h.n=-1),p(u,s)):h.n=s:h.v=s);try{if(c=2,i){if(u||(o="next"),e=i[o]){if(!(e=e.call(i,s)))throw TypeError("iterator result is not an object");if(!e.done)return e;s=e.value,u<2&&(u=0)}else 1===u&&(e=i.return)&&e.call(i),u<2&&(s=TypeError("The iterator does not provide a '"+o+"' method"),u=1);i=t}else if((e=(l=h.n<0)?s:n.call(r,h))!==a)break}catch(e){i=t,u=1,s=e}finally{c=1}}return{value:e,done:l}}}(n,o,i),!0),c}var a={};function u(){}function s(){}function c(){}e=Object.getPrototypeOf;var f=[][r]?e(e([][r]())):(Ov(e={},r,function(){return this}),e),l=c.prototype=u.prototype=Object.create(f);function h(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,c):(t.__proto__=c,Ov(t,o,"GeneratorFunction")),t.prototype=Object.create(l),t}return s.prototype=c,Ov(l,"constructor",c),Ov(c,"constructor",s),s.displayName="GeneratorFunction",Ov(c,o,"GeneratorFunction"),Ov(l),Ov(l,o,"Generator"),Ov(l,r,function(){return this}),Ov(l,"toString",function(){return"[object Generator]"}),(jv=function(){return{w:i,m:h}})()}function Ov(t,e,n,r){var o=Object.defineProperty;try{o({},"",{})}catch(t){o=0}Ov=function(t,e,n,r){function i(e,n){Ov(t,e,function(t){return this._invoke(e,n,t)})}e?o?o(t,e,{value:n,enumerable:!r,configurable:!r,writable:!r}):t[e]=n:(i("next",0),i("throw",1),i("return",2))},Ov(t,e,n,r)}function Sv(t,e){this.v=t,this.k=e}function Ev(t,e,n,r,o,i,a){try{var u=t[i](a),s=u.value}catch(t){return void n(t)}u.done?e(s):Promise.resolve(s).then(r,o)}function Pv(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,Tv(r.key),r)}}function Tv(t){var e=function(t){if("object"!=mv(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var n=e.call(t,"string");if("object"!=mv(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==mv(e)?e:e+""}function kv(t,e){return kv=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},kv(t,e)}function Mv(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(t){}return(Mv=function(){return!!t})()}function Rv(t){return Rv=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},Rv(t)}var Iv,Av=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&kv(t,e)}(n,t);var e=function(t){var e=Mv();return function(){var n,r=Rv(t);if(e){var o=Rv(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return function(t,e){if(e&&("object"==mv(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(this,n)}}(n);function n(){var t,r,o;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,n),(t=e.call(this)).frame=0,t.location=new X,t.loaded=!1,(r=bv().mark(function e(n){return bv().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Uh.AssetManager.o3o("model/sd_cif.o3o");case 2:vv=e.sent,t.loaded=!0;case 4:case"end":return e.stop()}},e)}),o=function(){var t=this,e=arguments;return new Promise(function(n,o){var i=r.apply(t,e);function a(t){Ev(i,n,o,a,u,"next",t)}function u(t){Ev(i,n,o,a,u,"throw",t)}a(void 0)})},function(t){return o.apply(this,arguments)})(),t.init=!0,t}return function(t,e){e&&Pv(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1})}(n,[{key:"move",value:function(){if(this.loaded){var t=vv.scenes_name_hash.death;if(this.init){for(var e=t.objects,n=0;n<e.length;n++){var r=e[n];engine.scene.objects.push(r),this.scene_objects.push(r),r.parent||X.copy(r.location,this.location)}this.init=!1}t.setFrame(this.frame),this.frame>=t.frame_end&&(this.remove(),this.parent.parent.ending=0,this.parent.parent.next()),this.frame++}}}]),n}(Ph);function Cv(t){return Cv="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Cv(t)}function Fv(){var t=Dv(),e=t.m(Fv),n=(Object.getPrototypeOf?Object.getPrototypeOf(e):e.__proto__).constructor;function r(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===n||"GeneratorFunction"===(e.displayName||e.name))}var o={throw:1,return:2,break:3,continue:3};function i(t){var e,n;return function(r){e||(e={stop:function(){return n(r.a,2)},catch:function(){return r.v},abrupt:function(t,e){return n(r.a,o[t],e)},delegateYield:function(t,o,i){return e.resultName=o,n(r.d,Nv(t),i)},finish:function(t){return n(r.f,t)}},n=function(t,n,o){r.p=e.prev,r.n=e.next;try{return t(n,o)}finally{e.next=r.n}}),e.resultName&&(e[e.resultName]=r.v,e.resultName=void 0),e.sent=r.v,e.next=r.n;try{return t.call(this,e)}finally{r.p=e.prev,r.n=e.next}}}return(Fv=function(){return{wrap:function(e,n,r,o){return t.w(i(e),n,r,o&&o.reverse())},isGeneratorFunction:r,mark:t.m,awrap:function(t,e){return new zv(t,e)},AsyncIterator:Vv,async:function(t,e,n,o,a){return(r(e)?Lv:Uv)(i(t),e,n,o,a)},keys:Bv,values:Nv}})()}function Nv(t){if(null!=t){var e=t["function"==typeof Symbol&&Symbol.iterator||"@@iterator"],n=0;if(e)return e.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length))return{next:function(){return t&&n>=t.length&&(t=void 0),{value:t&&t[n++],done:!t}}}}throw new TypeError(Cv(t)+" is not iterable")}function Bv(t){var e=Object(t),n=[];for(var r in e)n.unshift(r);return function t(){for(;n.length;)if((r=n.pop())in e)return t.value=r,t.done=!1,t;return t.done=!0,t}}function Uv(t,e,n,r,o){var i=Lv(t,e,n,r,o);return i.next().then(function(t){return t.done?t.value:i.next()})}function Lv(t,e,n,r,o){return new Vv(Dv().w(t,e,n,r),o||Promise)}function Vv(t,e){function n(r,o,i,a){try{var u=t[r](o),s=u.value;return s instanceof zv?e.resolve(s.v).then(function(t){n("next",t,i,a)},function(t){n("throw",t,i,a)}):e.resolve(s).then(function(t){u.value=t,i(u)},function(t){return n("throw",t,i,a)})}catch(t){a(t)}}var r;this.next||(Gv(Vv.prototype),Gv(Vv.prototype,"function"==typeof Symbol&&Symbol.asyncIterator||"@asyncIterator",function(){return this})),Gv(this,"_invoke",function(t,o,i){function a(){return new e(function(e,r){n(t,i,e,r)})}return r=r?r.then(a,a):a()},!0)}function Dv(){var t,e,n="function"==typeof Symbol?Symbol:{},r=n.iterator||"@@iterator",o=n.toStringTag||"@@toStringTag";function i(n,r,o,i){var s=r&&r.prototype instanceof u?r:u,c=Object.create(s.prototype);return Gv(c,"_invoke",function(n,r,o){var i,u,s,c=0,f=o||[],l=!1,h={p:0,n:0,v:t,a:p,f:p.bind(t,4),d:function(e,n){return i=e,u=0,s=t,h.n=n,a}};function p(n,r){for(u=n,s=r,e=0;!l&&c&&!o&&e<f.length;e++){var o,i=f[e],p=h.p,v=i[2];n>3?(o=v===r)&&(s=i[(u=i[4])?5:(u=3,3)],i[4]=i[5]=t):i[0]<=p&&((o=n<2&&p<i[1])?(u=0,h.v=r,h.n=i[1]):p<v&&(o=n<3||i[0]>r||r>v)&&(i[4]=n,i[5]=r,h.n=v,u=0))}if(o||n>1)return a;throw l=!0,r}return function(o,f,v){if(c>1)throw TypeError("Generator is already running");for(l&&1===f&&p(f,v),u=f,s=v;(e=u<2?t:s)||!l;){i||(u?u<3?(u>1&&(h.n=-1),p(u,s)):h.n=s:h.v=s);try{if(c=2,i){if(u||(o="next"),e=i[o]){if(!(e=e.call(i,s)))throw TypeError("iterator result is not an object");if(!e.done)return e;s=e.value,u<2&&(u=0)}else 1===u&&(e=i.return)&&e.call(i),u<2&&(s=TypeError("The iterator does not provide a '"+o+"' method"),u=1);i=t}else if((e=(l=h.n<0)?s:n.call(r,h))!==a)break}catch(e){i=t,u=1,s=e}finally{c=1}}return{value:e,done:l}}}(n,o,i),!0),c}var a={};function u(){}function s(){}function c(){}e=Object.getPrototypeOf;var f=[][r]?e(e([][r]())):(Gv(e={},r,function(){return this}),e),l=c.prototype=u.prototype=Object.create(f);function h(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,c):(t.__proto__=c,Gv(t,o,"GeneratorFunction")),t.prototype=Object.create(l),t}return s.prototype=c,Gv(l,"constructor",c),Gv(c,"constructor",s),s.displayName="GeneratorFunction",Gv(c,o,"GeneratorFunction"),Gv(l),Gv(l,o,"Generator"),Gv(l,r,function(){return this}),Gv(l,"toString",function(){return"[object Generator]"}),(Dv=function(){return{w:i,m:h}})()}function Gv(t,e,n,r){var o=Object.defineProperty;try{o({},"",{})}catch(t){o=0}Gv=function(t,e,n,r){function i(e,n){Gv(t,e,function(t){return this._invoke(e,n,t)})}e?o?o(t,e,{value:n,enumerable:!r,configurable:!r,writable:!r}):t[e]=n:(i("next",0),i("throw",1),i("return",2))},Gv(t,e,n,r)}function zv(t,e){this.v=t,this.k=e}function Xv(t,e,n,r,o,i,a){try{var u=t[i](a),s=u.value}catch(t){return void n(t)}u.done?e(s):Promise.resolve(s).then(r,o)}function Hv(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,qv(r.key),r)}}function qv(t){var e=function(t){if("object"!=Cv(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var n=e.call(t,"string");if("object"!=Cv(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==Cv(e)?e:e+""}function Yv(){return Yv="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(t,e,n){var r=function(t,e){for(;!{}.hasOwnProperty.call(t,e)&&null!==(t=$v(t)););return t}(t,e);if(r){var o=Object.getOwnPropertyDescriptor(r,e);return o.get?o.get.call(arguments.length<3?t:n):o.value}},Yv.apply(null,arguments)}function Wv(t,e){return Wv=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},Wv(t,e)}function Qv(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(t){}return(Qv=function(){return!!t})()}function $v(t){return $v=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},$v(t)}var Jv,Kv,Zv,ty,ey,ny,ry,oy,iy=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&Wv(t,e)}(n,t);var e=function(t){var e=Qv();return function(){var n,r=$v(t);if(e){var o=$v(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return function(t,e){if(e&&("object"==Cv(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(this,n)}}(n);function n(){var t,r;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,n),(t=e.call(this)).frame=0,t.loaded=!1,(r=Fv().mark(function e(){return Fv().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Uh.AssetManager.o3o("model/sd_cif.o3o");case 2:Iv=e.sent,t.loaded=!0;case 4:case"end":return e.stop()}},e)}),function(){var t=this,e=arguments;return new Promise(function(n,o){var i=r.apply(t,e);function a(t){Xv(i,n,o,a,u,"next",t)}function u(t){Xv(i,n,o,a,u,"throw",t)}a(void 0)})})(),t}return function(t,e){e&&Hv(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1})}(n,[{key:"move",value:function(){if(this.loaded){var t=Iv.scenes_name_hash.flash;if(this.init){for(var e=0;e<t.objects.length;e++){var r=t.objects[e];this.sprite_objects.push(r),engine.sprite_scene.objects.push(r)}this.init=!1}this.frame>=t.frame_end&&this.remove(),t.setFrame(this.frame),this.frame++,Yv($v(n.prototype),"move",this).call(this)}}}]),n}(Ph);function ay(t){return ay="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},ay(t)}function uy(){var t=py(),e=t.m(uy),n=(Object.getPrototypeOf?Object.getPrototypeOf(e):e.__proto__).constructor;function r(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===n||"GeneratorFunction"===(e.displayName||e.name))}var o={throw:1,return:2,break:3,continue:3};function i(t){var e,n;return function(r){e||(e={stop:function(){return n(r.a,2)},catch:function(){return r.v},abrupt:function(t,e){return n(r.a,o[t],e)},delegateYield:function(t,o,i){return e.resultName=o,n(r.d,sy(t),i)},finish:function(t){return n(r.f,t)}},n=function(t,n,o){r.p=e.prev,r.n=e.next;try{return t(n,o)}finally{e.next=r.n}}),e.resultName&&(e[e.resultName]=r.v,e.resultName=void 0),e.sent=r.v,e.next=r.n;try{return t.call(this,e)}finally{r.p=e.prev,r.n=e.next}}}return(uy=function(){return{wrap:function(e,n,r,o){return t.w(i(e),n,r,o&&o.reverse())},isGeneratorFunction:r,mark:t.m,awrap:function(t,e){return new yy(t,e)},AsyncIterator:hy,async:function(t,e,n,o,a){return(r(e)?ly:fy)(i(t),e,n,o,a)},keys:cy,values:sy}})()}function sy(t){if(null!=t){var e=t["function"==typeof Symbol&&Symbol.iterator||"@@iterator"],n=0;if(e)return e.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length))return{next:function(){return t&&n>=t.length&&(t=void 0),{value:t&&t[n++],done:!t}}}}throw new TypeError(ay(t)+" is not iterable")}function cy(t){var e=Object(t),n=[];for(var r in e)n.unshift(r);return function t(){for(;n.length;)if((r=n.pop())in e)return t.value=r,t.done=!1,t;return t.done=!0,t}}function fy(t,e,n,r,o){var i=ly(t,e,n,r,o);return i.next().then(function(t){return t.done?t.value:i.next()})}function ly(t,e,n,r,o){return new hy(py().w(t,e,n,r),o||Promise)}function hy(t,e){function n(r,o,i,a){try{var u=t[r](o),s=u.value;return s instanceof yy?e.resolve(s.v).then(function(t){n("next",t,i,a)},function(t){n("throw",t,i,a)}):e.resolve(s).then(function(t){u.value=t,i(u)},function(t){return n("throw",t,i,a)})}catch(t){a(t)}}var r;this.next||(vy(hy.prototype),vy(hy.prototype,"function"==typeof Symbol&&Symbol.asyncIterator||"@asyncIterator",function(){return this})),vy(this,"_invoke",function(t,o,i){function a(){return new e(function(e,r){n(t,i,e,r)})}return r=r?r.then(a,a):a()},!0)}function py(){var t,e,n="function"==typeof Symbol?Symbol:{},r=n.iterator||"@@iterator",o=n.toStringTag||"@@toStringTag";function i(n,r,o,i){var s=r&&r.prototype instanceof u?r:u,c=Object.create(s.prototype);return vy(c,"_invoke",function(n,r,o){var i,u,s,c=0,f=o||[],l=!1,h={p:0,n:0,v:t,a:p,f:p.bind(t,4),d:function(e,n){return i=e,u=0,s=t,h.n=n,a}};function p(n,r){for(u=n,s=r,e=0;!l&&c&&!o&&e<f.length;e++){var o,i=f[e],p=h.p,v=i[2];n>3?(o=v===r)&&(s=i[(u=i[4])?5:(u=3,3)],i[4]=i[5]=t):i[0]<=p&&((o=n<2&&p<i[1])?(u=0,h.v=r,h.n=i[1]):p<v&&(o=n<3||i[0]>r||r>v)&&(i[4]=n,i[5]=r,h.n=v,u=0))}if(o||n>1)return a;throw l=!0,r}return function(o,f,v){if(c>1)throw TypeError("Generator is already running");for(l&&1===f&&p(f,v),u=f,s=v;(e=u<2?t:s)||!l;){i||(u?u<3?(u>1&&(h.n=-1),p(u,s)):h.n=s:h.v=s);try{if(c=2,i){if(u||(o="next"),e=i[o]){if(!(e=e.call(i,s)))throw TypeError("iterator result is not an object");if(!e.done)return e;s=e.value,u<2&&(u=0)}else 1===u&&(e=i.return)&&e.call(i),u<2&&(s=TypeError("The iterator does not provide a '"+o+"' method"),u=1);i=t}else if((e=(l=h.n<0)?s:n.call(r,h))!==a)break}catch(e){i=t,u=1,s=e}finally{c=1}}return{value:e,done:l}}}(n,o,i),!0),c}var a={};function u(){}function s(){}function c(){}e=Object.getPrototypeOf;var f=[][r]?e(e([][r]())):(vy(e={},r,function(){return this}),e),l=c.prototype=u.prototype=Object.create(f);function h(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,c):(t.__proto__=c,vy(t,o,"GeneratorFunction")),t.prototype=Object.create(l),t}return s.prototype=c,vy(l,"constructor",c),vy(c,"constructor",s),s.displayName="GeneratorFunction",vy(c,o,"GeneratorFunction"),vy(l),vy(l,o,"Generator"),vy(l,r,function(){return this}),vy(l,"toString",function(){return"[object Generator]"}),(py=function(){return{w:i,m:h}})()}function vy(t,e,n,r){var o=Object.defineProperty;try{o({},"",{})}catch(t){o=0}vy=function(t,e,n,r){function i(e,n){vy(t,e,function(t){return this._invoke(e,n,t)})}e?o?o(t,e,{value:n,enumerable:!r,configurable:!r,writable:!r}):t[e]=n:(i("next",0),i("throw",1),i("return",2))},vy(t,e,n,r)}function yy(t,e){this.v=t,this.k=e}function my(t,e,n,r,o,i,a){try{var u=t[i](a),s=u.value}catch(t){return void n(t)}u.done?e(s):Promise.resolve(s).then(r,o)}function by(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,dy(r.key),r)}}function dy(t){var e=function(t){if("object"!=ay(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var n=e.call(t,"string");if("object"!=ay(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==ay(e)?e:e+""}function gy(t,e){return gy=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},gy(t,e)}function wy(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(t){}return(wy=function(){return!!t})()}function _y(t){return _y=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},_y(t)}var xy,jy=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&gy(t,e)}(n,t);var e=function(t){var e=wy();return function(){var n,r=_y(t);if(e){var o=_y(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return function(t,e){if(e&&("object"==ay(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(this,n)}}(n);function n(){var t,r,o;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,n),(t=e.call(this)).frame=0,t.location=new X,t.state=0,t.init=1,t.v=new H,t.ground_flg=0,t.damaged=0,t.max_hp=10,t.hp=t.max_hp,t.mute=0,t.muteki=0,t.operable=!1,t.enable_sword=!1,(r=uy().mark(function t(e){return uy().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,Uh.AssetManager.audio("sound/walk.wav");case 2:return ty=t.sent,t.next=5,Uh.AssetManager.audio("sound/jump.wav");case 5:return ey=t.sent,t.next=8,Uh.AssetManager.audio("sound/catch.wav");case 8:return ny=t.sent,t.next=11,Uh.AssetManager.audio("sound/jumpcatch.wav");case 11:return oy=t.sent,t.next=14,Uh.AssetManager.o3o("model/sd_cif.o3o");case 14:return Jv=t.sent,t.next=17,Uh.AssetManager.o3o("model/megane.o3o");case 17:return Kv=t.sent,t.next=20,Uh.AssetManager.audio("sound/sword.wav");case 20:ry=t.sent;case 21:case"end":return t.stop()}},t)}),o=function(){var t=this,e=arguments;return new Promise(function(n,o){var i=r.apply(t,e);function a(t){my(i,n,o,a,u,"next",t)}function u(t){my(i,n,o,a,u,"throw",t)}a(void 0)})},function(t){return o.apply(this,arguments)})(),t}return function(t,e){e&&by(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1})}(n,[{key:"hit",value:function(t,e,n,r){if("hit_body"===t.name)if(e.name.indexOf("ground")>=0){var o=Jv.objects_name_hash.mainbone;if(this.ground_flg=1,this.v[1]<0&&(this.v[1]=0,this.location[1]=e.aabb.max[1]-.02,X.copy(o.location,this.location)),this.pt){var i=this.pt,a=Jv.objects_name_hash.hit_head,u=engine.scene.objects.find(function(t){return"CAMERA"===t.type});u&&(t=new q,q.setValues(t,a.matrix[9],a.matrix[10],a.matrix[11],1),J.dotVec4(t,u.pvMatrix,t),X.mul(t,t,1/t[3]),t[0]=160*(t[0]+1)-16,t[1]=120*(1-t[1])-16,X.copy(i.location,t)),this.parent.addChild(i),oy.playSound(0),this.pt=null}}else"octahedron_hit"!==e.name&&"octahedron2_hit"!==e.name&&"dis_hit"!==e.name&&"slash_hit"!==e.name||0!==this.damaged||this.muteki||(this.damaged=60,this.v[1]=.05,this.hp--);else if("hit_head"===t.name&&"megane_hit"==e.name){if(0!==this.state)return;this.parent.parent.ending=2;var s=e.task,c=Jv.objects_name_hash.head;s.mainobj.parent=c;var f=new z;if(this.parent.addChild(new iy),i=new pp,this.parent.addChild(i),u=engine.scene.objects.find(function(t){return"CAMERA"===t.type}),u){var l=new q;q.setValues(l,s.location[0],s.location[1],s.location[2],1),J.dotVec4(l,u.pvMatrix,l),X.mul(l,l,1/l[3]),l[0]=160*(l[0]+1)-16,l[1]=120*(1-l[1])-16,X.copy(i.location,l)}z.getInv(f,s.mainobj.parent.matrix),z.dot(f,f,s.mainobj.matrix),z.toLSE(s.location,s.mainobj.scale,s.mainobj.rotation,f),s.location[1]=.015;var h=this.parent.parent;X.copy(s.mainobj.location,s.location),h.meganes[h.round-1]=s.mainobj.linkCopy(),X.copy(s.mainobj.location,s.location),X.setValues(s.v,0,0,0),s.state=1,this.state=1,i.pt=10-Math.floor(Math.min(10,30*Math.abs(t.matrix[9]-e.matrix[9]))),this.parent.parent.pts[this.parent.parent.round-1]=i.pt,this.ground_flg<1&&(this.pt=new Rp,this.pt.pt=1,Math.abs(this.v[0])>=.09&&(this.pt.pt=2),this.parent.parent.pts[this.parent.parent.round-1]+=this.pt.pt),ny.playSound()}}},{key:"create",value:function(){for(var t=this,e=(Jv.scenes[0],Jv.getCollectionObjectList(Jv.collections.Cif)),n=0;n<e.length;n++){var r=e[n];engine.scene.objects.includes(r)||(engine.scene.objects.push(r),r.collision&&this.parent.collider.addCollision(r.collision),this.scene_objects.push(r))}var o=Jv.objects_name_hash.mainbone;(r=Jv.objects_name_hash.hit_body).collision.callbackFunc=function(e,n,r,o){t.hit(e,n,r,o)},(r=Jv.objects_name_hash.hit_head).collision.callbackFunc=function(e,n,r,o){t.hit(e,n,r,o)},Zv=new ys(o);var i=Kv.objects_name_hash.cif_default;X.copy(this.location,i.location),Jv.objects_name_hash.head.hide_render=!1,Jv.objects_name_hash.head_broken.hide_render=!0}},{key:"move",value:function(){if(Jv){var t,e;this.operable?(t=Ut.keyflag,e=Ut.keyflagOld):(t=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],e=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]),this.init&&(this.create(),this.init=!1);var n=Jv.objects_name_hash.mainbone,r=Jv.actions_name_hash.walk.slots[0],o=Jv.actions_name_hash.stand.slots[0];if(X.copy(n.location,this.location),this.ground_flg>0){var i=.005*(-t[0]+t[2]);i?this.v[0]+=i:this.v[0]*=.85,this.v[0]*this.v[0]<1e-8&&(this.v[0]=0),this.v[0]>.1&&(this.v[0]=.1),this.v[0]<-.1&&(this.v[0]=-.1),this.frame+=30*this.v[0]}else this.v[1]-=.01;if(Math.abs(this.v[0])>.01&&this.ground_flg>0&&ty.playSound(),this.location[0]+=this.v[0],this.location[1]+=this.v[1],this.jump>0&&t[4]&&(this.jump--,this.v[1]+=.03),!e[4]&&t[4]&&this.ground_flg>0&&(this.jump=5,this.v[1]=.02,ey.playSound()),!e[5]&&t[5]&&this.enable_sword){var a=new yv;this.parent.addChild(a),X.copy(a.location,this.location),a.location[0]-=.2,a.location[1]+=1,a=new yv,this.parent.addChild(a),X.copy(a.location,this.location),a.location[0]+=.2,a.location[1]+=1,ry.playSound(0,!0)}if(this.damaged>0?(this.damaged--,this.damaged>>1&1?this.mute=!0:this.mute=!1):this.mute=!1,this.mute)for(var u=0;u<this.scene_objects.length;u++){var s=this.scene_objects[u],c=engine.scene.objects.indexOf(s);c>=0&&engine.scene.objects.splice(c,1)}else for(u=0;u<this.scene_objects.length;u++)s=this.scene_objects[u],-1===engine.scene.objects.indexOf(s)&&engine.scene.objects.push(s);for(u=0;u<n.pose.poseBones.length;u++)n.pose.poseBones[u].rotation.fill(0);if(n.addAction(o,this.frame),this.v[0]<0?Zv.setAction(r,this.frame,1):this.v[0]>0&&Zv.setAction(r,this.frame,0),ys.blend(n.pose,n.pose,Zv,Math.min(Math.abs(10*this.v[0]),1)),this.ground_flg--,this.hp<=0){var f=new Av;X.copy(f.location,this.location),f.location[1]+=1.5,f.location[2]+=1.5,this.parent.parent.ending=0,this.parent.addChild(f),this.remove()}}}}]),n}(Ph);function Oy(t){return Oy="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Oy(t)}function Sy(){var t=Ry(),e=t.m(Sy),n=(Object.getPrototypeOf?Object.getPrototypeOf(e):e.__proto__).constructor;function r(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===n||"GeneratorFunction"===(e.displayName||e.name))}var o={throw:1,return:2,break:3,continue:3};function i(t){var e,n;return function(r){e||(e={stop:function(){return n(r.a,2)},catch:function(){return r.v},abrupt:function(t,e){return n(r.a,o[t],e)},delegateYield:function(t,o,i){return e.resultName=o,n(r.d,Ey(t),i)},finish:function(t){return n(r.f,t)}},n=function(t,n,o){r.p=e.prev,r.n=e.next;try{return t(n,o)}finally{e.next=r.n}}),e.resultName&&(e[e.resultName]=r.v,e.resultName=void 0),e.sent=r.v,e.next=r.n;try{return t.call(this,e)}finally{r.p=e.prev,r.n=e.next}}}return(Sy=function(){return{wrap:function(e,n,r,o){return t.w(i(e),n,r,o&&o.reverse())},isGeneratorFunction:r,mark:t.m,awrap:function(t,e){return new Ay(t,e)},AsyncIterator:My,async:function(t,e,n,o,a){return(r(e)?ky:Ty)(i(t),e,n,o,a)},keys:Py,values:Ey}})()}function Ey(t){if(null!=t){var e=t["function"==typeof Symbol&&Symbol.iterator||"@@iterator"],n=0;if(e)return e.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length))return{next:function(){return t&&n>=t.length&&(t=void 0),{value:t&&t[n++],done:!t}}}}throw new TypeError(Oy(t)+" is not iterable")}function Py(t){var e=Object(t),n=[];for(var r in e)n.unshift(r);return function t(){for(;n.length;)if((r=n.pop())in e)return t.value=r,t.done=!1,t;return t.done=!0,t}}function Ty(t,e,n,r,o){var i=ky(t,e,n,r,o);return i.next().then(function(t){return t.done?t.value:i.next()})}function ky(t,e,n,r,o){return new My(Ry().w(t,e,n,r),o||Promise)}function My(t,e){function n(r,o,i,a){try{var u=t[r](o),s=u.value;return s instanceof Ay?e.resolve(s.v).then(function(t){n("next",t,i,a)},function(t){n("throw",t,i,a)}):e.resolve(s).then(function(t){u.value=t,i(u)},function(t){return n("throw",t,i,a)})}catch(t){a(t)}}var r;this.next||(Iy(My.prototype),Iy(My.prototype,"function"==typeof Symbol&&Symbol.asyncIterator||"@asyncIterator",function(){return this})),Iy(this,"_invoke",function(t,o,i){function a(){return new e(function(e,r){n(t,i,e,r)})}return r=r?r.then(a,a):a()},!0)}function Ry(){var t,e,n="function"==typeof Symbol?Symbol:{},r=n.iterator||"@@iterator",o=n.toStringTag||"@@toStringTag";function i(n,r,o,i){var s=r&&r.prototype instanceof u?r:u,c=Object.create(s.prototype);return Iy(c,"_invoke",function(n,r,o){var i,u,s,c=0,f=o||[],l=!1,h={p:0,n:0,v:t,a:p,f:p.bind(t,4),d:function(e,n){return i=e,u=0,s=t,h.n=n,a}};function p(n,r){for(u=n,s=r,e=0;!l&&c&&!o&&e<f.length;e++){var o,i=f[e],p=h.p,v=i[2];n>3?(o=v===r)&&(s=i[(u=i[4])?5:(u=3,3)],i[4]=i[5]=t):i[0]<=p&&((o=n<2&&p<i[1])?(u=0,h.v=r,h.n=i[1]):p<v&&(o=n<3||i[0]>r||r>v)&&(i[4]=n,i[5]=r,h.n=v,u=0))}if(o||n>1)return a;throw l=!0,r}return function(o,f,v){if(c>1)throw TypeError("Generator is already running");for(l&&1===f&&p(f,v),u=f,s=v;(e=u<2?t:s)||!l;){i||(u?u<3?(u>1&&(h.n=-1),p(u,s)):h.n=s:h.v=s);try{if(c=2,i){if(u||(o="next"),e=i[o]){if(!(e=e.call(i,s)))throw TypeError("iterator result is not an object");if(!e.done)return e;s=e.value,u<2&&(u=0)}else 1===u&&(e=i.return)&&e.call(i),u<2&&(s=TypeError("The iterator does not provide a '"+o+"' method"),u=1);i=t}else if((e=(l=h.n<0)?s:n.call(r,h))!==a)break}catch(e){i=t,u=1,s=e}finally{c=1}}return{value:e,done:l}}}(n,o,i),!0),c}var a={};function u(){}function s(){}function c(){}e=Object.getPrototypeOf;var f=[][r]?e(e([][r]())):(Iy(e={},r,function(){return this}),e),l=c.prototype=u.prototype=Object.create(f);function h(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,c):(t.__proto__=c,Iy(t,o,"GeneratorFunction")),t.prototype=Object.create(l),t}return s.prototype=c,Iy(l,"constructor",c),Iy(c,"constructor",s),s.displayName="GeneratorFunction",Iy(c,o,"GeneratorFunction"),Iy(l),Iy(l,o,"Generator"),Iy(l,r,function(){return this}),Iy(l,"toString",function(){return"[object Generator]"}),(Ry=function(){return{w:i,m:h}})()}function Iy(t,e,n,r){var o=Object.defineProperty;try{o({},"",{})}catch(t){o=0}Iy=function(t,e,n,r){function i(e,n){Iy(t,e,function(t){return this._invoke(e,n,t)})}e?o?o(t,e,{value:n,enumerable:!r,configurable:!r,writable:!r}):t[e]=n:(i("next",0),i("throw",1),i("return",2))},Iy(t,e,n,r)}function Ay(t,e){this.v=t,this.k=e}function Cy(t,e,n,r,o,i,a){try{var u=t[i](a),s=u.value}catch(t){return void n(t)}u.done?e(s):Promise.resolve(s).then(r,o)}function Fy(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,Ny(r.key),r)}}function Ny(t){var e=function(t){if("object"!=Oy(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var n=e.call(t,"string");if("object"!=Oy(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==Oy(e)?e:e+""}function By(t,e){return By=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},By(t,e)}function Uy(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(t){}return(Uy=function(){return!!t})()}function Ly(t){return Ly=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},Ly(t)}var Vy,Dy,Gy,zy=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&By(t,e)}(n,t);var e=function(t){var e=Uy();return function(){var n,r=Ly(t);if(e){var o=Ly(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return function(t,e){if(e&&("object"==Oy(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(this,n)}}(n);function n(){var t,r,o;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,n),(t=e.call(this)).frame=0,t.location=new X,t.state=0,t.frame++,t.v=new X,t.init=1,(r=Sy().mark(function t(e){return Sy().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,Uh.AssetManager.o3o("model/sd_cif.o3o");case 2:xy=t.sent;case 3:case"end":return t.stop()}},t)}),o=function(){var t=this,e=arguments;return new Promise(function(n,o){var i=r.apply(t,e);function a(t){Cy(i,n,o,a,u,"next",t)}function u(t){Cy(i,n,o,a,u,"throw",t)}a(void 0)})},function(t){return o.apply(this,arguments)})(),t}return function(t,e){e&&Fy(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1})}(n,[{key:"create",value:function(){var t=this,e=xy.getCollectionObjectList(xy.collections.megane);this.mainobj=xy.objects_name_hash.megane,X.setValues(this.mainobj.rotation,0,0,0);for(var n=0;n<e.length;n++)engine.scene.objects.push(e[n]),this.scene_objects.push(e[n]),e[n].collision&&(e[n].collision.callbackFunc=function(e,n,r,o){t.hit(e,n,r,o)},e[n].collision.task=this,this.parent.collider.addCollision(e[n].collision));xy.objects_name_hash.megane_broken.hide_render=!0,xy.objects_name_hash.megane.hide_render=!1,this.mainobj.parent=null,this.mainobj.parent_bone=null,xy.scenes[0].setFrame(0),X.copy(this.mainobj.location,this.location),xy.calcMatrix(0,!1)}},{key:"hit",value:function(t,e,n,r){0===this.state&&e.name.indexOf("ground")>=0&&(this.location[1]=r[1]+.1,X.setValues(this.v,0,0,0),xy.objects_name_hash.megane_broken.hide_render=!1,xy.objects_name_hash.megane.hide_render=!0,xy.objects_name_hash.head.hide_render=!0,xy.objects_name_hash.head_broken.hide_render=!1)}},{key:"move",value:function(){xy&&(this.init&&(this.create(),this.init=0),0===this.state&&(X.add(this.location,this.location,this.v),X.copy(this.mainobj.location,this.location),X.copy(xy.objects_name_hash.megane_broken.location,this.location)))}},{key:"draw",value:function(){}}]),n}(Ph);function Xy(t){return Xy="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Xy(t)}function Hy(){var t=Jy(),e=t.m(Hy),n=(Object.getPrototypeOf?Object.getPrototypeOf(e):e.__proto__).constructor;function r(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===n||"GeneratorFunction"===(e.displayName||e.name))}var o={throw:1,return:2,break:3,continue:3};function i(t){var e,n;return function(r){e||(e={stop:function(){return n(r.a,2)},catch:function(){return r.v},abrupt:function(t,e){return n(r.a,o[t],e)},delegateYield:function(t,o,i){return e.resultName=o,n(r.d,qy(t),i)},finish:function(t){return n(r.f,t)}},n=function(t,n,o){r.p=e.prev,r.n=e.next;try{return t(n,o)}finally{e.next=r.n}}),e.resultName&&(e[e.resultName]=r.v,e.resultName=void 0),e.sent=r.v,e.next=r.n;try{return t.call(this,e)}finally{r.p=e.prev,r.n=e.next}}}return(Hy=function(){return{wrap:function(e,n,r,o){return t.w(i(e),n,r,o&&o.reverse())},isGeneratorFunction:r,mark:t.m,awrap:function(t,e){return new Zy(t,e)},AsyncIterator:$y,async:function(t,e,n,o,a){return(r(e)?Qy:Wy)(i(t),e,n,o,a)},keys:Yy,values:qy}})()}function qy(t){if(null!=t){var e=t["function"==typeof Symbol&&Symbol.iterator||"@@iterator"],n=0;if(e)return e.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length))return{next:function(){return t&&n>=t.length&&(t=void 0),{value:t&&t[n++],done:!t}}}}throw new TypeError(Xy(t)+" is not iterable")}function Yy(t){var e=Object(t),n=[];for(var r in e)n.unshift(r);return function t(){for(;n.length;)if((r=n.pop())in e)return t.value=r,t.done=!1,t;return t.done=!0,t}}function Wy(t,e,n,r,o){var i=Qy(t,e,n,r,o);return i.next().then(function(t){return t.done?t.value:i.next()})}function Qy(t,e,n,r,o){return new $y(Jy().w(t,e,n,r),o||Promise)}function $y(t,e){function n(r,o,i,a){try{var u=t[r](o),s=u.value;return s instanceof Zy?e.resolve(s.v).then(function(t){n("next",t,i,a)},function(t){n("throw",t,i,a)}):e.resolve(s).then(function(t){u.value=t,i(u)},function(t){return n("throw",t,i,a)})}catch(t){a(t)}}var r;this.next||(Ky($y.prototype),Ky($y.prototype,"function"==typeof Symbol&&Symbol.asyncIterator||"@asyncIterator",function(){return this})),Ky(this,"_invoke",function(t,o,i){function a(){return new e(function(e,r){n(t,i,e,r)})}return r=r?r.then(a,a):a()},!0)}function Jy(){var t,e,n="function"==typeof Symbol?Symbol:{},r=n.iterator||"@@iterator",o=n.toStringTag||"@@toStringTag";function i(n,r,o,i){var s=r&&r.prototype instanceof u?r:u,c=Object.create(s.prototype);return Ky(c,"_invoke",function(n,r,o){var i,u,s,c=0,f=o||[],l=!1,h={p:0,n:0,v:t,a:p,f:p.bind(t,4),d:function(e,n){return i=e,u=0,s=t,h.n=n,a}};function p(n,r){for(u=n,s=r,e=0;!l&&c&&!o&&e<f.length;e++){var o,i=f[e],p=h.p,v=i[2];n>3?(o=v===r)&&(s=i[(u=i[4])?5:(u=3,3)],i[4]=i[5]=t):i[0]<=p&&((o=n<2&&p<i[1])?(u=0,h.v=r,h.n=i[1]):p<v&&(o=n<3||i[0]>r||r>v)&&(i[4]=n,i[5]=r,h.n=v,u=0))}if(o||n>1)return a;throw l=!0,r}return function(o,f,v){if(c>1)throw TypeError("Generator is already running");for(l&&1===f&&p(f,v),u=f,s=v;(e=u<2?t:s)||!l;){i||(u?u<3?(u>1&&(h.n=-1),p(u,s)):h.n=s:h.v=s);try{if(c=2,i){if(u||(o="next"),e=i[o]){if(!(e=e.call(i,s)))throw TypeError("iterator result is not an object");if(!e.done)return e;s=e.value,u<2&&(u=0)}else 1===u&&(e=i.return)&&e.call(i),u<2&&(s=TypeError("The iterator does not provide a '"+o+"' method"),u=1);i=t}else if((e=(l=h.n<0)?s:n.call(r,h))!==a)break}catch(e){i=t,u=1,s=e}finally{c=1}}return{value:e,done:l}}}(n,o,i),!0),c}var a={};function u(){}function s(){}function c(){}e=Object.getPrototypeOf;var f=[][r]?e(e([][r]())):(Ky(e={},r,function(){return this}),e),l=c.prototype=u.prototype=Object.create(f);function h(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,c):(t.__proto__=c,Ky(t,o,"GeneratorFunction")),t.prototype=Object.create(l),t}return s.prototype=c,Ky(l,"constructor",c),Ky(c,"constructor",s),s.displayName="GeneratorFunction",Ky(c,o,"GeneratorFunction"),Ky(l),Ky(l,o,"Generator"),Ky(l,r,function(){return this}),Ky(l,"toString",function(){return"[object Generator]"}),(Jy=function(){return{w:i,m:h}})()}function Ky(t,e,n,r){var o=Object.defineProperty;try{o({},"",{})}catch(t){o=0}Ky=function(t,e,n,r){function i(e,n){Ky(t,e,function(t){return this._invoke(e,n,t)})}e?o?o(t,e,{value:n,enumerable:!r,configurable:!r,writable:!r}):t[e]=n:(i("next",0),i("throw",1),i("return",2))},Ky(t,e,n,r)}function Zy(t,e){this.v=t,this.k=e}function tm(t,e,n,r,o,i,a){try{var u=t[i](a),s=u.value}catch(t){return void n(t)}u.done?e(s):Promise.resolve(s).then(r,o)}function em(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,nm(r.key),r)}}function nm(t){var e=function(t){if("object"!=Xy(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var n=e.call(t,"string");if("object"!=Xy(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==Xy(e)?e:e+""}function rm(){return rm="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(t,e,n){var r=function(t,e){for(;!{}.hasOwnProperty.call(t,e)&&null!==(t=am(t)););return t}(t,e);if(r){var o=Object.getOwnPropertyDescriptor(r,e);return o.get?o.get.call(arguments.length<3?t:n):o.value}},rm.apply(null,arguments)}function om(t,e){return om=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},om(t,e)}function im(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(t){}return(im=function(){return!!t})()}function am(t){return am=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},am(t)}var um,sm=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&om(t,e)}(n,t);var e=function(t){var e=im();return function(){var n,r=am(t);if(e){var o=am(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return function(t,e){if(e&&("object"==Xy(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(this,n)}}(n);function n(){var t,r,o;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,n),(t=e.call(this)).frame=0,t.loaded=!1,t.collider=new Yo,(r=Hy().mark(function e(n){var r;return Hy().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Uh.AssetManager.audio("sound/count.wav");case 2:return Dy=e.sent,e.next=5,Uh.AssetManager.audio("sound/count2.wav");case 5:return Gy=e.sent,e.next=8,Uh.AssetManager.o3o("model/megane.o3o");case 8:return Vy=e.sent,e.next=11,Uh.AssetManager.audio("sound/walk.wav");case 11:return e.next=13,Uh.AssetManager.audio("sound/jump.wav");case 13:return e.next=15,Uh.AssetManager.audio("sound/catch.wav");case 15:return e.next=17,Uh.AssetManager.audio("sound/jumpcatch.wav");case 17:return e.next=19,Uh.AssetManager.o3o("model/sd_cif.o3o");case 19:return e.next=21,Uh.AssetManager.o3o("model/megane.o3o");case 21:return e.next=23,Uh.AssetManager.audio("sound/sword.wav");case 23:return r=Vy.scenes_name_hash.stage,engine.scene.world=r.world,t.init=!0,e.next=28,Uh.AssetManager.audio("sound/stage.ogg");case 28:e.sent.playSound(1),t.loaded=!0;case 31:case"end":return e.stop()}},e)}),o=function(){var t=this,e=arguments;return new Promise(function(n,o){var i=r.apply(t,e);function a(t){tm(i,n,o,a,u,"next",t)}function u(t){tm(i,n,o,a,u,"throw",t)}a(void 0)})},function(t){return o.apply(this,arguments)})(),t.go=0,t.end=0,t.cloud_offsets=new Array(3),t}return function(t,e){e&&em(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1})}(n,[{key:"remove",value:function(){rm(am(n.prototype),"remove",this).call(this)}},{key:"hit",value:function(t,e){this.end||"hit_body"===e.name&&(this.end=1)}},{key:"move",value:function(){var t=this;if(this.loaded){var e=Vy.scenes_name_hash.stage,r=Vy.scenes_name_hash.stage_hud;if(engine.scene.calcMatrix(),this.collider.All(),this.init){for(var o=0;o<e.objects.length;o++){var i=e.objects[o];this.scene_objects.push(i),engine.scene.objects.push(i),i.collision&&(this.collider.addCollision(i.collision),i.name.indexOf("out")>=0&&(i.collision.callbackFunc=function(e,n){t.hit(e,n)}))}for(this.init=!1,o=0;o<3;o++)Vy.objects_name_hash["sono"+(o+1)].hide_render=this.round!==o+1;for(o=0;o<r.objects.length;o++)i=r.objects[o],engine.sprite_scene.objects.push(i),this.sprite_objects.push(i);this.cif=new jy,this.addChild(this.cif);var a=Vy.objects_name_hash.cloud1.animation_data.action;for(o=0;o<this.cloud_offsets.length;o++)this.cloud_offsets[o]=Math.random()*a.endframe}if(!this.go&&Vy.objects_name_hash.go.location[1]>-2.4){this.go=1,this.cif.operable=!0;var u=new zy;this.addChild(u);var s=Vy.objects_name_hash.megane_point;X.copy(u.location,s.location),u.location[0]+=(2*Math.random()-1)*s.scale[0],u.v[1]=.01*-this.round-.02}if(this.end)this.parent.next();else{for(rm(am(n.prototype),"move",this).call(this),e.setFrame(this.frame),60!==this.frame&&90!==this.frame&&120!==this.frame||Dy.playSound(),150===this.frame&&Gy.playSound(),r.setFrame(this.frame),o=0;o<this.cloud_offsets.length;o++){var c=this.scene_objects.find(function(t){return t.name==="cloud"+(o+1)});c&&c.setFrame(this.cloud_offsets[o]+this.frame)}this.frame++}}}},{key:"draw",value:function(){Vy&&rm(am(n.prototype),"draw",this).call(this)}}]),n}(Ph);function cm(t){return cm="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},cm(t)}function fm(){var t=mm(),e=t.m(fm),n=(Object.getPrototypeOf?Object.getPrototypeOf(e):e.__proto__).constructor;function r(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===n||"GeneratorFunction"===(e.displayName||e.name))}var o={throw:1,return:2,break:3,continue:3};function i(t){var e,n;return function(r){e||(e={stop:function(){return n(r.a,2)},catch:function(){return r.v},abrupt:function(t,e){return n(r.a,o[t],e)},delegateYield:function(t,o,i){return e.resultName=o,n(r.d,lm(t),i)},finish:function(t){return n(r.f,t)}},n=function(t,n,o){r.p=e.prev,r.n=e.next;try{return t(n,o)}finally{e.next=r.n}}),e.resultName&&(e[e.resultName]=r.v,e.resultName=void 0),e.sent=r.v,e.next=r.n;try{return t.call(this,e)}finally{r.p=e.prev,r.n=e.next}}}return(fm=function(){return{wrap:function(e,n,r,o){return t.w(i(e),n,r,o&&o.reverse())},isGeneratorFunction:r,mark:t.m,awrap:function(t,e){return new dm(t,e)},AsyncIterator:ym,async:function(t,e,n,o,a){return(r(e)?vm:pm)(i(t),e,n,o,a)},keys:hm,values:lm}})()}function lm(t){if(null!=t){var e=t["function"==typeof Symbol&&Symbol.iterator||"@@iterator"],n=0;if(e)return e.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length))return{next:function(){return t&&n>=t.length&&(t=void 0),{value:t&&t[n++],done:!t}}}}throw new TypeError(cm(t)+" is not iterable")}function hm(t){var e=Object(t),n=[];for(var r in e)n.unshift(r);return function t(){for(;n.length;)if((r=n.pop())in e)return t.value=r,t.done=!1,t;return t.done=!0,t}}function pm(t,e,n,r,o){var i=vm(t,e,n,r,o);return i.next().then(function(t){return t.done?t.value:i.next()})}function vm(t,e,n,r,o){return new ym(mm().w(t,e,n,r),o||Promise)}function ym(t,e){function n(r,o,i,a){try{var u=t[r](o),s=u.value;return s instanceof dm?e.resolve(s.v).then(function(t){n("next",t,i,a)},function(t){n("throw",t,i,a)}):e.resolve(s).then(function(t){u.value=t,i(u)},function(t){return n("throw",t,i,a)})}catch(t){a(t)}}var r;this.next||(bm(ym.prototype),bm(ym.prototype,"function"==typeof Symbol&&Symbol.asyncIterator||"@asyncIterator",function(){return this})),bm(this,"_invoke",function(t,o,i){function a(){return new e(function(e,r){n(t,i,e,r)})}return r=r?r.then(a,a):a()},!0)}function mm(){var t,e,n="function"==typeof Symbol?Symbol:{},r=n.iterator||"@@iterator",o=n.toStringTag||"@@toStringTag";function i(n,r,o,i){var s=r&&r.prototype instanceof u?r:u,c=Object.create(s.prototype);return bm(c,"_invoke",function(n,r,o){var i,u,s,c=0,f=o||[],l=!1,h={p:0,n:0,v:t,a:p,f:p.bind(t,4),d:function(e,n){return i=e,u=0,s=t,h.n=n,a}};function p(n,r){for(u=n,s=r,e=0;!l&&c&&!o&&e<f.length;e++){var o,i=f[e],p=h.p,v=i[2];n>3?(o=v===r)&&(s=i[(u=i[4])?5:(u=3,3)],i[4]=i[5]=t):i[0]<=p&&((o=n<2&&p<i[1])?(u=0,h.v=r,h.n=i[1]):p<v&&(o=n<3||i[0]>r||r>v)&&(i[4]=n,i[5]=r,h.n=v,u=0))}if(o||n>1)return a;throw l=!0,r}return function(o,f,v){if(c>1)throw TypeError("Generator is already running");for(l&&1===f&&p(f,v),u=f,s=v;(e=u<2?t:s)||!l;){i||(u?u<3?(u>1&&(h.n=-1),p(u,s)):h.n=s:h.v=s);try{if(c=2,i){if(u||(o="next"),e=i[o]){if(!(e=e.call(i,s)))throw TypeError("iterator result is not an object");if(!e.done)return e;s=e.value,u<2&&(u=0)}else 1===u&&(e=i.return)&&e.call(i),u<2&&(s=TypeError("The iterator does not provide a '"+o+"' method"),u=1);i=t}else if((e=(l=h.n<0)?s:n.call(r,h))!==a)break}catch(e){i=t,u=1,s=e}finally{c=1}}return{value:e,done:l}}}(n,o,i),!0),c}var a={};function u(){}function s(){}function c(){}e=Object.getPrototypeOf;var f=[][r]?e(e([][r]())):(bm(e={},r,function(){return this}),e),l=c.prototype=u.prototype=Object.create(f);function h(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,c):(t.__proto__=c,bm(t,o,"GeneratorFunction")),t.prototype=Object.create(l),t}return s.prototype=c,bm(l,"constructor",c),bm(c,"constructor",s),s.displayName="GeneratorFunction",bm(c,o,"GeneratorFunction"),bm(l),bm(l,o,"Generator"),bm(l,r,function(){return this}),bm(l,"toString",function(){return"[object Generator]"}),(mm=function(){return{w:i,m:h}})()}function bm(t,e,n,r){var o=Object.defineProperty;try{o({},"",{})}catch(t){o=0}bm=function(t,e,n,r){function i(e,n){bm(t,e,function(t){return this._invoke(e,n,t)})}e?o?o(t,e,{value:n,enumerable:!r,configurable:!r,writable:!r}):t[e]=n:(i("next",0),i("throw",1),i("return",2))},bm(t,e,n,r)}function dm(t,e){this.v=t,this.k=e}function gm(t,e,n,r,o,i,a){try{var u=t[i](a),s=u.value}catch(t){return void n(t)}u.done?e(s):Promise.resolve(s).then(r,o)}function wm(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,_m(r.key),r)}}function _m(t){var e=function(t){if("object"!=cm(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var n=e.call(t,"string");if("object"!=cm(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==cm(e)?e:e+""}function xm(){return xm="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(t,e,n){var r=function(t,e){for(;!{}.hasOwnProperty.call(t,e)&&null!==(t=Sm(t)););return t}(t,e);if(r){var o=Object.getOwnPropertyDescriptor(r,e);return o.get?o.get.call(arguments.length<3?t:n):o.value}},xm.apply(null,arguments)}function jm(t,e){return jm=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},jm(t,e)}function Om(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(t){}return(Om=function(){return!!t})()}function Sm(t){return Sm=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},Sm(t)}var Em,Pm,Tm,km,Mm,Rm=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&jm(t,e)}(n,t);var e=function(t){var e=Om();return function(){var n,r=Sm(t);if(e){var o=Sm(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return function(t,e){if(e&&("object"==cm(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(this,n)}}(n);function n(){var t,r,o;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,n),(t=e.call(this)).frame=0,t.init=!0,(r=fm().mark(function t(e){return fm().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,Uh.AssetManager.o3o("model/megane.o3o");case 2:um=t.sent;case 3:case"end":return t.stop()}},t)}),o=function(){var t=this,e=arguments;return new Promise(function(n,o){var i=r.apply(t,e);function a(t){gm(i,n,o,a,u,"next",t)}function u(t){gm(i,n,o,a,u,"throw",t)}a(void 0)})},function(t){return o.apply(this,arguments)})(),t}return function(t,e){e&&wm(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1})}(n,[{key:"remove",value:function(){engine.scene.objects=[],xm(Sm(n.prototype),"remove",this).call(this)}},{key:"move",value:function(){if(um){var t=um.scenes_name_hash.intermission;if(this.init){for(var e=0;e<t.objects.length;e++){var r=t.objects[e];engine.sprite_scene.objects.includes(r)||(this.sprite_objects.push(r),engine.sprite_scene.objects.push(r))}this.init=!1}!Ut.keyflagOld[4]&&Ut.keyflag[4]&&this.parent.next(),this.frame++,xm(Sm(n.prototype),"move",this).call(this),t.setFrame(this.frame)}}}]),n}(Ph);function Im(t){return Im="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Im(t)}function Am(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=Array(e);n<e;n++)r[n]=t[n];return r}function Cm(){var t=Vm(),e=t.m(Cm),n=(Object.getPrototypeOf?Object.getPrototypeOf(e):e.__proto__).constructor;function r(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===n||"GeneratorFunction"===(e.displayName||e.name))}var o={throw:1,return:2,break:3,continue:3};function i(t){var e,n;return function(r){e||(e={stop:function(){return n(r.a,2)},catch:function(){return r.v},abrupt:function(t,e){return n(r.a,o[t],e)},delegateYield:function(t,o,i){return e.resultName=o,n(r.d,Fm(t),i)},finish:function(t){return n(r.f,t)}},n=function(t,n,o){r.p=e.prev,r.n=e.next;try{return t(n,o)}finally{e.next=r.n}}),e.resultName&&(e[e.resultName]=r.v,e.resultName=void 0),e.sent=r.v,e.next=r.n;try{return t.call(this,e)}finally{r.p=e.prev,r.n=e.next}}}return(Cm=function(){return{wrap:function(e,n,r,o){return t.w(i(e),n,r,o&&o.reverse())},isGeneratorFunction:r,mark:t.m,awrap:function(t,e){return new Gm(t,e)},AsyncIterator:Lm,async:function(t,e,n,o,a){return(r(e)?Um:Bm)(i(t),e,n,o,a)},keys:Nm,values:Fm}})()}function Fm(t){if(null!=t){var e=t["function"==typeof Symbol&&Symbol.iterator||"@@iterator"],n=0;if(e)return e.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length))return{next:function(){return t&&n>=t.length&&(t=void 0),{value:t&&t[n++],done:!t}}}}throw new TypeError(Im(t)+" is not iterable")}function Nm(t){var e=Object(t),n=[];for(var r in e)n.unshift(r);return function t(){for(;n.length;)if((r=n.pop())in e)return t.value=r,t.done=!1,t;return t.done=!0,t}}function Bm(t,e,n,r,o){var i=Um(t,e,n,r,o);return i.next().then(function(t){return t.done?t.value:i.next()})}function Um(t,e,n,r,o){return new Lm(Vm().w(t,e,n,r),o||Promise)}function Lm(t,e){function n(r,o,i,a){try{var u=t[r](o),s=u.value;return s instanceof Gm?e.resolve(s.v).then(function(t){n("next",t,i,a)},function(t){n("throw",t,i,a)}):e.resolve(s).then(function(t){u.value=t,i(u)},function(t){return n("throw",t,i,a)})}catch(t){a(t)}}var r;this.next||(Dm(Lm.prototype),Dm(Lm.prototype,"function"==typeof Symbol&&Symbol.asyncIterator||"@asyncIterator",function(){return this})),Dm(this,"_invoke",function(t,o,i){function a(){return new e(function(e,r){n(t,i,e,r)})}return r=r?r.then(a,a):a()},!0)}function Vm(){var t,e,n="function"==typeof Symbol?Symbol:{},r=n.iterator||"@@iterator",o=n.toStringTag||"@@toStringTag";function i(n,r,o,i){var s=r&&r.prototype instanceof u?r:u,c=Object.create(s.prototype);return Dm(c,"_invoke",function(n,r,o){var i,u,s,c=0,f=o||[],l=!1,h={p:0,n:0,v:t,a:p,f:p.bind(t,4),d:function(e,n){return i=e,u=0,s=t,h.n=n,a}};function p(n,r){for(u=n,s=r,e=0;!l&&c&&!o&&e<f.length;e++){var o,i=f[e],p=h.p,v=i[2];n>3?(o=v===r)&&(s=i[(u=i[4])?5:(u=3,3)],i[4]=i[5]=t):i[0]<=p&&((o=n<2&&p<i[1])?(u=0,h.v=r,h.n=i[1]):p<v&&(o=n<3||i[0]>r||r>v)&&(i[4]=n,i[5]=r,h.n=v,u=0))}if(o||n>1)return a;throw l=!0,r}return function(o,f,v){if(c>1)throw TypeError("Generator is already running");for(l&&1===f&&p(f,v),u=f,s=v;(e=u<2?t:s)||!l;){i||(u?u<3?(u>1&&(h.n=-1),p(u,s)):h.n=s:h.v=s);try{if(c=2,i){if(u||(o="next"),e=i[o]){if(!(e=e.call(i,s)))throw TypeError("iterator result is not an object");if(!e.done)return e;s=e.value,u<2&&(u=0)}else 1===u&&(e=i.return)&&e.call(i),u<2&&(s=TypeError("The iterator does not provide a '"+o+"' method"),u=1);i=t}else if((e=(l=h.n<0)?s:n.call(r,h))!==a)break}catch(e){i=t,u=1,s=e}finally{c=1}}return{value:e,done:l}}}(n,o,i),!0),c}var a={};function u(){}function s(){}function c(){}e=Object.getPrototypeOf;var f=[][r]?e(e([][r]())):(Dm(e={},r,function(){return this}),e),l=c.prototype=u.prototype=Object.create(f);function h(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,c):(t.__proto__=c,Dm(t,o,"GeneratorFunction")),t.prototype=Object.create(l),t}return s.prototype=c,Dm(l,"constructor",c),Dm(c,"constructor",s),s.displayName="GeneratorFunction",Dm(c,o,"GeneratorFunction"),Dm(l),Dm(l,o,"Generator"),Dm(l,r,function(){return this}),Dm(l,"toString",function(){return"[object Generator]"}),(Vm=function(){return{w:i,m:h}})()}function Dm(t,e,n,r){var o=Object.defineProperty;try{o({},"",{})}catch(t){o=0}Dm=function(t,e,n,r){function i(e,n){Dm(t,e,function(t){return this._invoke(e,n,t)})}e?o?o(t,e,{value:n,enumerable:!r,configurable:!r,writable:!r}):t[e]=n:(i("next",0),i("throw",1),i("return",2))},Dm(t,e,n,r)}function Gm(t,e){this.v=t,this.k=e}function zm(t,e,n,r,o,i,a){try{var u=t[i](a),s=u.value}catch(t){return void n(t)}u.done?e(s):Promise.resolve(s).then(r,o)}function Xm(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,Hm(r.key),r)}}function Hm(t){var e=function(t){if("object"!=Im(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var n=e.call(t,"string");if("object"!=Im(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==Im(e)?e:e+""}function qm(){return qm="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(t,e,n){var r=function(t,e){for(;!{}.hasOwnProperty.call(t,e)&&null!==(t=Qm(t)););return t}(t,e);if(r){var o=Object.getOwnPropertyDescriptor(r,e);return o.get?o.get.call(arguments.length<3?t:n):o.value}},qm.apply(null,arguments)}function Ym(t,e){return Ym=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},Ym(t,e)}function Wm(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(t){}return(Wm=function(){return!!t})()}function Qm(t){return Qm=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},Qm(t)}var $m,Jm=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&Ym(t,e)}(n,t);var e=function(t){var e=Wm();return function(){var n,r=Qm(t);if(e){var o=Qm(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return function(t,e){if(e&&("object"==Im(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(this,n)}}(n);function n(){var t,r,o;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,n),t=e.call(this),(r=Cm().mark(function t(e){return Cm().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,Uh.AssetManager.o3o("model/megane.o3o");case 2:return Em=t.sent,t.next=5,Uh.AssetManager.o3o("model/sd_cif.o3o");case 5:return t.sent,t.next=8,Uh.AssetManager.texture("model/test.png");case 8:return Pm=t.sent,t.next=11,Uh.AssetManager.audio("sound/stage.ogg");case 11:return Tm=t.sent,t.next=14,Uh.AssetManager.audio("sound/result.wav");case 14:return km=t.sent,t.next=17,Uh.AssetManager.font("font/font.txt");case 17:Mm=t.sent,Tm.stop();case 19:case"end":return t.stop()}},t)}),o=function(){var t=this,e=arguments;return new Promise(function(n,o){var i=r.apply(t,e);function a(t){zm(i,n,o,a,u,"next",t)}function u(t){zm(i,n,o,a,u,"throw",t)}a(void 0)})},function(t){return o.apply(this,arguments)})(),t.init=!0,t.pts=[],t.total=0,t}return function(t,e){e&&Xm(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1})}(n,[{key:"remove",value:function(){qm(Qm(n.prototype),"remove",this).call(this)}},{key:"move",value:function(){if(Em){var t=Em.scenes_name_hash.result,e=25===this.parent.total?Em.scenes_name_hash.result_face2:Em.scenes_name_hash.result_face;if(this.init){for(var r=0;r<e.objects.length;r++){var o=e.objects[r];engine.scene.objects.push(o),this.scene_objects.push(o)}engine.scene.world=e.world;var i,a=this.parent;for(r=0;r<3;r++)if(a.meganes[r]){var u=Em.objects_name_hash["head"+(r+1)];a.meganes[r].parent=u,engine.scene.objects.push(a.meganes[r]),this.scene_objects.push(a.meganes[r]),Em.objects_name_hash["head"+(r+1)].hide_render=!1,Em.objects_name_hash["head"+(r+1)+"_broken"].hide_render=!0}else Em.objects_name_hash["head"+(r+1)].hide_render=!0,Em.objects_name_hash["head"+(r+1)+"_broken"].hide_render=!1;for(r=0;r<t.objects.length;r++)o=t.objects[r],this.sprite_objects.push(o),engine.sprite_scene.objects.push(o);for(var s=this.parent.pts,c=0;c<s.length;c++){i=(i=" "+s[c]).slice(-2);var f=[];for(r=0;r<i.length;r++)if((h=i.charCodeAt(r)-"0".charCodeAt(0))>=0&&h<=9){var l=engine.sprites.addSprite(Pm,128+8*r,32*c,0+16*h,32,16,16);this.sprites.push(l),f.push(l)}this.pts.push(f)}for(i=(i=" "+this.parent.total).slice(-2),f=[],r=0;r<i.length;r++){var h;(h=i.charCodeAt(r)-"0".charCodeAt(0))>=0&&h<=9&&(l=engine.sprites.addSprite(Pm,128+8*r,32*c,0+16*h,32,16,16),this.sprites.push(l),f.push(l))}this.pts.push(f),this.init=!1,this.frame=0}if(!Ut.keyflagOld[4]&&Ut.keyflag[4]&&this.frame>120&&this.parent.next(),30!==this.frame&&60!==this.frame&&90!==this.frame||km.playSound(),120===this.frame){var p,v=64,y=function(t,e){var n="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=function(t,e){if(t){if("string"==typeof t)return Am(t,e);var n={}.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Am(t,e):void 0}}(t))||e&&t&&"number"==typeof t.length){n&&(t=n);var r=0,o=function(){};return{s:o,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(t){throw t},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,a=!0,u=!1;return{s:function(){n=n.call(t)},n:function(){var t=n.next();return a=t.done,t},e:function(t){u=!0,i=t},f:function(){try{a||null==n.return||n.return()}finally{if(u)throw i}}}}(["Do you have zero eyes?","...Huh?","You have no motivation at all...","Something is wrong!","Unseemly...","We have no hope and yet we live in longing","What's this score...?","Hold up a minute!","Not not useless!!","Meaoooooooooow!!","Woof woof woooof!","Don't give up!","... ... NEXT.","The story has just begun.","It's acceptable!","Is that all?","don't mind. don't mind.","How about a snack?","Which is important, glasses or me?","Let's try the next one.","good sense","MOE!","Eat vegetables!","LOVE","You're so macho!","I snuck in some of your favourite.","It feels good.","brightness.","Two points left!!","Oh, how frustrating!!","Congratulations!!","Smooch","OH!COOL!!","Thank you for your hard work!","GINYAAAAAAA!!","Would you like to see my underwear?","YOU ARE GOD."][this.parent.total]);try{for(y.s();!(p=y.n()).done;){var m=p.value,b=Mm.chars[m.codePointAt(0)];b&&(l=engine.sprites.addSprite(Mm.img,v,48,b[1],b[2],b[3],b[4]),v+=b[3],this.sprites.push(l))}}catch(t){y.e(t)}finally{y.f()}}for(t.setFrame(this.frame),e.setFrame(this.frame),r=0;r<4;r++){var d=Em.objects_name_hash["result"+(r+1)];for(f=this.pts[r],c=0;c<f.length;c++)f[c].location[1]=-100*d.location[1]}qm(Qm(n.prototype),"move",this).call(this),Em.calcMatrix(0,!1),this.frame++}}}]),n}(Ph);function Km(t){return Km="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Km(t)}function Zm(){var t=ib(),e=t.m(Zm),n=(Object.getPrototypeOf?Object.getPrototypeOf(e):e.__proto__).constructor;function r(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===n||"GeneratorFunction"===(e.displayName||e.name))}var o={throw:1,return:2,break:3,continue:3};function i(t){var e,n;return function(r){e||(e={stop:function(){return n(r.a,2)},catch:function(){return r.v},abrupt:function(t,e){return n(r.a,o[t],e)},delegateYield:function(t,o,i){return e.resultName=o,n(r.d,tb(t),i)},finish:function(t){return n(r.f,t)}},n=function(t,n,o){r.p=e.prev,r.n=e.next;try{return t(n,o)}finally{e.next=r.n}}),e.resultName&&(e[e.resultName]=r.v,e.resultName=void 0),e.sent=r.v,e.next=r.n;try{return t.call(this,e)}finally{r.p=e.prev,r.n=e.next}}}return(Zm=function(){return{wrap:function(e,n,r,o){return t.w(i(e),n,r,o&&o.reverse())},isGeneratorFunction:r,mark:t.m,awrap:function(t,e){return new ub(t,e)},AsyncIterator:ob,async:function(t,e,n,o,a){return(r(e)?rb:nb)(i(t),e,n,o,a)},keys:eb,values:tb}})()}function tb(t){if(null!=t){var e=t["function"==typeof Symbol&&Symbol.iterator||"@@iterator"],n=0;if(e)return e.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length))return{next:function(){return t&&n>=t.length&&(t=void 0),{value:t&&t[n++],done:!t}}}}throw new TypeError(Km(t)+" is not iterable")}function eb(t){var e=Object(t),n=[];for(var r in e)n.unshift(r);return function t(){for(;n.length;)if((r=n.pop())in e)return t.value=r,t.done=!1,t;return t.done=!0,t}}function nb(t,e,n,r,o){var i=rb(t,e,n,r,o);return i.next().then(function(t){return t.done?t.value:i.next()})}function rb(t,e,n,r,o){return new ob(ib().w(t,e,n,r),o||Promise)}function ob(t,e){function n(r,o,i,a){try{var u=t[r](o),s=u.value;return s instanceof ub?e.resolve(s.v).then(function(t){n("next",t,i,a)},function(t){n("throw",t,i,a)}):e.resolve(s).then(function(t){u.value=t,i(u)},function(t){return n("throw",t,i,a)})}catch(t){a(t)}}var r;this.next||(ab(ob.prototype),ab(ob.prototype,"function"==typeof Symbol&&Symbol.asyncIterator||"@asyncIterator",function(){return this})),ab(this,"_invoke",function(t,o,i){function a(){return new e(function(e,r){n(t,i,e,r)})}return r=r?r.then(a,a):a()},!0)}function ib(){var t,e,n="function"==typeof Symbol?Symbol:{},r=n.iterator||"@@iterator",o=n.toStringTag||"@@toStringTag";function i(n,r,o,i){var s=r&&r.prototype instanceof u?r:u,c=Object.create(s.prototype);return ab(c,"_invoke",function(n,r,o){var i,u,s,c=0,f=o||[],l=!1,h={p:0,n:0,v:t,a:p,f:p.bind(t,4),d:function(e,n){return i=e,u=0,s=t,h.n=n,a}};function p(n,r){for(u=n,s=r,e=0;!l&&c&&!o&&e<f.length;e++){var o,i=f[e],p=h.p,v=i[2];n>3?(o=v===r)&&(s=i[(u=i[4])?5:(u=3,3)],i[4]=i[5]=t):i[0]<=p&&((o=n<2&&p<i[1])?(u=0,h.v=r,h.n=i[1]):p<v&&(o=n<3||i[0]>r||r>v)&&(i[4]=n,i[5]=r,h.n=v,u=0))}if(o||n>1)return a;throw l=!0,r}return function(o,f,v){if(c>1)throw TypeError("Generator is already running");for(l&&1===f&&p(f,v),u=f,s=v;(e=u<2?t:s)||!l;){i||(u?u<3?(u>1&&(h.n=-1),p(u,s)):h.n=s:h.v=s);try{if(c=2,i){if(u||(o="next"),e=i[o]){if(!(e=e.call(i,s)))throw TypeError("iterator result is not an object");if(!e.done)return e;s=e.value,u<2&&(u=0)}else 1===u&&(e=i.return)&&e.call(i),u<2&&(s=TypeError("The iterator does not provide a '"+o+"' method"),u=1);i=t}else if((e=(l=h.n<0)?s:n.call(r,h))!==a)break}catch(e){i=t,u=1,s=e}finally{c=1}}return{value:e,done:l}}}(n,o,i),!0),c}var a={};function u(){}function s(){}function c(){}e=Object.getPrototypeOf;var f=[][r]?e(e([][r]())):(ab(e={},r,function(){return this}),e),l=c.prototype=u.prototype=Object.create(f);function h(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,c):(t.__proto__=c,ab(t,o,"GeneratorFunction")),t.prototype=Object.create(l),t}return s.prototype=c,ab(l,"constructor",c),ab(c,"constructor",s),s.displayName="GeneratorFunction",ab(c,o,"GeneratorFunction"),ab(l),ab(l,o,"Generator"),ab(l,r,function(){return this}),ab(l,"toString",function(){return"[object Generator]"}),(ib=function(){return{w:i,m:h}})()}function ab(t,e,n,r){var o=Object.defineProperty;try{o({},"",{})}catch(t){o=0}ab=function(t,e,n,r){function i(e,n){ab(t,e,function(t){return this._invoke(e,n,t)})}e?o?o(t,e,{value:n,enumerable:!r,configurable:!r,writable:!r}):t[e]=n:(i("next",0),i("throw",1),i("return",2))},ab(t,e,n,r)}function ub(t,e){this.v=t,this.k=e}function sb(t,e,n,r,o,i,a){try{var u=t[i](a),s=u.value}catch(t){return void n(t)}u.done?e(s):Promise.resolve(s).then(r,o)}function cb(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,fb(r.key),r)}}function fb(t){var e=function(t){if("object"!=Km(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var n=e.call(t,"string");if("object"!=Km(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==Km(e)?e:e+""}function lb(){return lb="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(t,e,n){var r=function(t,e){for(;!{}.hasOwnProperty.call(t,e)&&null!==(t=vb(t)););return t}(t,e);if(r){var o=Object.getOwnPropertyDescriptor(r,e);return o.get?o.get.call(arguments.length<3?t:n):o.value}},lb.apply(null,arguments)}function hb(t,e){return hb=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},hb(t,e)}function pb(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(t){}return(pb=function(){return!!t})()}function vb(t){return vb=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},vb(t)}var yb,mb=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&hb(t,e)}(n,t);var e=function(t){var e=pb();return function(){var n,r=vb(t);if(e){var o=vb(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return function(t,e){if(e&&("object"==Km(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(this,n)}}(n);function n(){var t,r,o;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,n),(t=e.call(this)).loaded=!1,(r=Zm().mark(function e(n){return Zm().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Uh.AssetManager.o3o("model/megane.o3o");case 2:$m=e.sent,t.loaded=!0;case 4:case"end":return e.stop()}},e)}),o=function(){var t=this,e=arguments;return new Promise(function(n,o){var i=r.apply(t,e);function a(t){sb(i,n,o,a,u,"next",t)}function u(t){sb(i,n,o,a,u,"throw",t)}a(void 0)})},function(t){return o.apply(this,arguments)})(),t.init=!0,t}return function(t,e){e&&cb(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1})}(n,[{key:"move",value:function(){if(this.loaded){var t=$m.scenes_name_hash.escape;if(this.init){for(var e=0;e<t.objects.length;e++){var r=t.objects[e];this.sprite_objects.push(r),engine.sprite_scene.objects.push(r)}this.init=!1,this.frame=0}if(this.frame>=t.frame_end){this.remove();var o=new cj;this.parent.addChild(o)}t.setFrame(this.frame),this.frame++,lb(vb(n.prototype),"move",this).call(this)}}}]),n}(Ph);function bb(t){return bb="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},bb(t)}function db(){var t=Ob(),e=t.m(db),n=(Object.getPrototypeOf?Object.getPrototypeOf(e):e.__proto__).constructor;function r(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===n||"GeneratorFunction"===(e.displayName||e.name))}var o={throw:1,return:2,break:3,continue:3};function i(t){var e,n;return function(r){e||(e={stop:function(){return n(r.a,2)},catch:function(){return r.v},abrupt:function(t,e){return n(r.a,o[t],e)},delegateYield:function(t,o,i){return e.resultName=o,n(r.d,gb(t),i)},finish:function(t){return n(r.f,t)}},n=function(t,n,o){r.p=e.prev,r.n=e.next;try{return t(n,o)}finally{e.next=r.n}}),e.resultName&&(e[e.resultName]=r.v,e.resultName=void 0),e.sent=r.v,e.next=r.n;try{return t.call(this,e)}finally{r.p=e.prev,r.n=e.next}}}return(db=function(){return{wrap:function(e,n,r,o){return t.w(i(e),n,r,o&&o.reverse())},isGeneratorFunction:r,mark:t.m,awrap:function(t,e){return new Eb(t,e)},AsyncIterator:jb,async:function(t,e,n,o,a){return(r(e)?xb:_b)(i(t),e,n,o,a)},keys:wb,values:gb}})()}function gb(t){if(null!=t){var e=t["function"==typeof Symbol&&Symbol.iterator||"@@iterator"],n=0;if(e)return e.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length))return{next:function(){return t&&n>=t.length&&(t=void 0),{value:t&&t[n++],done:!t}}}}throw new TypeError(bb(t)+" is not iterable")}function wb(t){var e=Object(t),n=[];for(var r in e)n.unshift(r);return function t(){for(;n.length;)if((r=n.pop())in e)return t.value=r,t.done=!1,t;return t.done=!0,t}}function _b(t,e,n,r,o){var i=xb(t,e,n,r,o);return i.next().then(function(t){return t.done?t.value:i.next()})}function xb(t,e,n,r,o){return new jb(Ob().w(t,e,n,r),o||Promise)}function jb(t,e){function n(r,o,i,a){try{var u=t[r](o),s=u.value;return s instanceof Eb?e.resolve(s.v).then(function(t){n("next",t,i,a)},function(t){n("throw",t,i,a)}):e.resolve(s).then(function(t){u.value=t,i(u)},function(t){return n("throw",t,i,a)})}catch(t){a(t)}}var r;this.next||(Sb(jb.prototype),Sb(jb.prototype,"function"==typeof Symbol&&Symbol.asyncIterator||"@asyncIterator",function(){return this})),Sb(this,"_invoke",function(t,o,i){function a(){return new e(function(e,r){n(t,i,e,r)})}return r=r?r.then(a,a):a()},!0)}function Ob(){var t,e,n="function"==typeof Symbol?Symbol:{},r=n.iterator||"@@iterator",o=n.toStringTag||"@@toStringTag";function i(n,r,o,i){var s=r&&r.prototype instanceof u?r:u,c=Object.create(s.prototype);return Sb(c,"_invoke",function(n,r,o){var i,u,s,c=0,f=o||[],l=!1,h={p:0,n:0,v:t,a:p,f:p.bind(t,4),d:function(e,n){return i=e,u=0,s=t,h.n=n,a}};function p(n,r){for(u=n,s=r,e=0;!l&&c&&!o&&e<f.length;e++){var o,i=f[e],p=h.p,v=i[2];n>3?(o=v===r)&&(s=i[(u=i[4])?5:(u=3,3)],i[4]=i[5]=t):i[0]<=p&&((o=n<2&&p<i[1])?(u=0,h.v=r,h.n=i[1]):p<v&&(o=n<3||i[0]>r||r>v)&&(i[4]=n,i[5]=r,h.n=v,u=0))}if(o||n>1)return a;throw l=!0,r}return function(o,f,v){if(c>1)throw TypeError("Generator is already running");for(l&&1===f&&p(f,v),u=f,s=v;(e=u<2?t:s)||!l;){i||(u?u<3?(u>1&&(h.n=-1),p(u,s)):h.n=s:h.v=s);try{if(c=2,i){if(u||(o="next"),e=i[o]){if(!(e=e.call(i,s)))throw TypeError("iterator result is not an object");if(!e.done)return e;s=e.value,u<2&&(u=0)}else 1===u&&(e=i.return)&&e.call(i),u<2&&(s=TypeError("The iterator does not provide a '"+o+"' method"),u=1);i=t}else if((e=(l=h.n<0)?s:n.call(r,h))!==a)break}catch(e){i=t,u=1,s=e}finally{c=1}}return{value:e,done:l}}}(n,o,i),!0),c}var a={};function u(){}function s(){}function c(){}e=Object.getPrototypeOf;var f=[][r]?e(e([][r]())):(Sb(e={},r,function(){return this}),e),l=c.prototype=u.prototype=Object.create(f);function h(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,c):(t.__proto__=c,Sb(t,o,"GeneratorFunction")),t.prototype=Object.create(l),t}return s.prototype=c,Sb(l,"constructor",c),Sb(c,"constructor",s),s.displayName="GeneratorFunction",Sb(c,o,"GeneratorFunction"),Sb(l),Sb(l,o,"Generator"),Sb(l,r,function(){return this}),Sb(l,"toString",function(){return"[object Generator]"}),(Ob=function(){return{w:i,m:h}})()}function Sb(t,e,n,r){var o=Object.defineProperty;try{o({},"",{})}catch(t){o=0}Sb=function(t,e,n,r){function i(e,n){Sb(t,e,function(t){return this._invoke(e,n,t)})}e?o?o(t,e,{value:n,enumerable:!r,configurable:!r,writable:!r}):t[e]=n:(i("next",0),i("throw",1),i("return",2))},Sb(t,e,n,r)}function Eb(t,e){this.v=t,this.k=e}function Pb(t,e,n,r,o,i,a){try{var u=t[i](a),s=u.value}catch(t){return void n(t)}u.done?e(s):Promise.resolve(s).then(r,o)}function Tb(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,kb(r.key),r)}}function kb(t){var e=function(t){if("object"!=bb(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var n=e.call(t,"string");if("object"!=bb(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==bb(e)?e:e+""}function Mb(){return Mb="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(t,e,n){var r=function(t,e){for(;!{}.hasOwnProperty.call(t,e)&&null!==(t=Ab(t)););return t}(t,e);if(r){var o=Object.getOwnPropertyDescriptor(r,e);return o.get?o.get.call(arguments.length<3?t:n):o.value}},Mb.apply(null,arguments)}function Rb(t,e){return Rb=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},Rb(t,e)}function Ib(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(t){}return(Ib=function(){return!!t})()}function Ab(t){return Ab=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},Ab(t)}var Cb,Fb=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&Rb(t,e)}(n,t);var e=function(t){var e=Ib();return function(){var n,r=Ab(t);if(e){var o=Ab(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return function(t,e){if(e&&("object"==bb(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(this,n)}}(n);function n(){var t,r,o;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,n),t=e.call(this),(r=db().mark(function t(e){return db().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,Uh.AssetManager.o3o("model/megane.o3o");case 2:yb=t.sent;case 3:case"end":return t.stop()}},t)}),o=function(){var t=this,e=arguments;return new Promise(function(n,o){var i=r.apply(t,e);function a(t){Pb(i,n,o,a,u,"next",t)}function u(t){Pb(i,n,o,a,u,"throw",t)}a(void 0)})},function(t){return o.apply(this,arguments)})(),t.init=!0,t}return function(t,e){e&&Tb(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1})}(n,[{key:"move",value:function(){if(yb){var t=yb.scenes_name_hash.gameover;if(this.init){for(var e=0;e<t.objects.length;e++){var r=t.objects[e];this.sprite_objects.push(r),engine.sprite_scene.objects.push(r)}this.init=!1}!Util.keyflagOld[4]&&Util.keyflag[4]&&this.frame>120&&this.parent.next(),this.frame++,t.setFrame(this.frame),Mb(Ab(n.prototype),"move",this).call(this)}}}]),n}(Ph);function Nb(t){return Nb="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Nb(t)}function Bb(){var t=zb(),e=t.m(Bb),n=(Object.getPrototypeOf?Object.getPrototypeOf(e):e.__proto__).constructor;function r(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===n||"GeneratorFunction"===(e.displayName||e.name))}var o={throw:1,return:2,break:3,continue:3};function i(t){var e,n;return function(r){e||(e={stop:function(){return n(r.a,2)},catch:function(){return r.v},abrupt:function(t,e){return n(r.a,o[t],e)},delegateYield:function(t,o,i){return e.resultName=o,n(r.d,Ub(t),i)},finish:function(t){return n(r.f,t)}},n=function(t,n,o){r.p=e.prev,r.n=e.next;try{return t(n,o)}finally{e.next=r.n}}),e.resultName&&(e[e.resultName]=r.v,e.resultName=void 0),e.sent=r.v,e.next=r.n;try{return t.call(this,e)}finally{r.p=e.prev,r.n=e.next}}}return(Bb=function(){return{wrap:function(e,n,r,o){return t.w(i(e),n,r,o&&o.reverse())},isGeneratorFunction:r,mark:t.m,awrap:function(t,e){return new Hb(t,e)},AsyncIterator:Gb,async:function(t,e,n,o,a){return(r(e)?Db:Vb)(i(t),e,n,o,a)},keys:Lb,values:Ub}})()}function Ub(t){if(null!=t){var e=t["function"==typeof Symbol&&Symbol.iterator||"@@iterator"],n=0;if(e)return e.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length))return{next:function(){return t&&n>=t.length&&(t=void 0),{value:t&&t[n++],done:!t}}}}throw new TypeError(Nb(t)+" is not iterable")}function Lb(t){var e=Object(t),n=[];for(var r in e)n.unshift(r);return function t(){for(;n.length;)if((r=n.pop())in e)return t.value=r,t.done=!1,t;return t.done=!0,t}}function Vb(t,e,n,r,o){var i=Db(t,e,n,r,o);return i.next().then(function(t){return t.done?t.value:i.next()})}function Db(t,e,n,r,o){return new Gb(zb().w(t,e,n,r),o||Promise)}function Gb(t,e){function n(r,o,i,a){try{var u=t[r](o),s=u.value;return s instanceof Hb?e.resolve(s.v).then(function(t){n("next",t,i,a)},function(t){n("throw",t,i,a)}):e.resolve(s).then(function(t){u.value=t,i(u)},function(t){return n("throw",t,i,a)})}catch(t){a(t)}}var r;this.next||(Xb(Gb.prototype),Xb(Gb.prototype,"function"==typeof Symbol&&Symbol.asyncIterator||"@asyncIterator",function(){return this})),Xb(this,"_invoke",function(t,o,i){function a(){return new e(function(e,r){n(t,i,e,r)})}return r=r?r.then(a,a):a()},!0)}function zb(){var t,e,n="function"==typeof Symbol?Symbol:{},r=n.iterator||"@@iterator",o=n.toStringTag||"@@toStringTag";function i(n,r,o,i){var s=r&&r.prototype instanceof u?r:u,c=Object.create(s.prototype);return Xb(c,"_invoke",function(n,r,o){var i,u,s,c=0,f=o||[],l=!1,h={p:0,n:0,v:t,a:p,f:p.bind(t,4),d:function(e,n){return i=e,u=0,s=t,h.n=n,a}};function p(n,r){for(u=n,s=r,e=0;!l&&c&&!o&&e<f.length;e++){var o,i=f[e],p=h.p,v=i[2];n>3?(o=v===r)&&(s=i[(u=i[4])?5:(u=3,3)],i[4]=i[5]=t):i[0]<=p&&((o=n<2&&p<i[1])?(u=0,h.v=r,h.n=i[1]):p<v&&(o=n<3||i[0]>r||r>v)&&(i[4]=n,i[5]=r,h.n=v,u=0))}if(o||n>1)return a;throw l=!0,r}return function(o,f,v){if(c>1)throw TypeError("Generator is already running");for(l&&1===f&&p(f,v),u=f,s=v;(e=u<2?t:s)||!l;){i||(u?u<3?(u>1&&(h.n=-1),p(u,s)):h.n=s:h.v=s);try{if(c=2,i){if(u||(o="next"),e=i[o]){if(!(e=e.call(i,s)))throw TypeError("iterator result is not an object");if(!e.done)return e;s=e.value,u<2&&(u=0)}else 1===u&&(e=i.return)&&e.call(i),u<2&&(s=TypeError("The iterator does not provide a '"+o+"' method"),u=1);i=t}else if((e=(l=h.n<0)?s:n.call(r,h))!==a)break}catch(e){i=t,u=1,s=e}finally{c=1}}return{value:e,done:l}}}(n,o,i),!0),c}var a={};function u(){}function s(){}function c(){}e=Object.getPrototypeOf;var f=[][r]?e(e([][r]())):(Xb(e={},r,function(){return this}),e),l=c.prototype=u.prototype=Object.create(f);function h(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,c):(t.__proto__=c,Xb(t,o,"GeneratorFunction")),t.prototype=Object.create(l),t}return s.prototype=c,Xb(l,"constructor",c),Xb(c,"constructor",s),s.displayName="GeneratorFunction",Xb(c,o,"GeneratorFunction"),Xb(l),Xb(l,o,"Generator"),Xb(l,r,function(){return this}),Xb(l,"toString",function(){return"[object Generator]"}),(zb=function(){return{w:i,m:h}})()}function Xb(t,e,n,r){var o=Object.defineProperty;try{o({},"",{})}catch(t){o=0}Xb=function(t,e,n,r){function i(e,n){Xb(t,e,function(t){return this._invoke(e,n,t)})}e?o?o(t,e,{value:n,enumerable:!r,configurable:!r,writable:!r}):t[e]=n:(i("next",0),i("throw",1),i("return",2))},Xb(t,e,n,r)}function Hb(t,e){this.v=t,this.k=e}function qb(t,e,n,r,o,i,a){try{var u=t[i](a),s=u.value}catch(t){return void n(t)}u.done?e(s):Promise.resolve(s).then(r,o)}function Yb(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,Wb(r.key),r)}}function Wb(t){var e=function(t){if("object"!=Nb(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var n=e.call(t,"string");if("object"!=Nb(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==Nb(e)?e:e+""}function Qb(){return Qb="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(t,e,n){var r=function(t,e){for(;!{}.hasOwnProperty.call(t,e)&&null!==(t=Kb(t)););return t}(t,e);if(r){var o=Object.getOwnPropertyDescriptor(r,e);return o.get?o.get.call(arguments.length<3?t:n):o.value}},Qb.apply(null,arguments)}function $b(t,e){return $b=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},$b(t,e)}function Jb(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(t){}return(Jb=function(){return!!t})()}function Kb(t){return Kb=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},Kb(t)}var Zb,td,ed,nd=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&$b(t,e)}(n,t);var e=function(t){var e=Jb();return function(){var n,r=Kb(t);if(e){var o=Kb(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return function(t,e){if(e&&("object"==Nb(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(this,n)}}(n);function n(){var t,r,o;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,n),t=e.call(this),(r=Bb().mark(function t(e){return Bb().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,Uh.AssetManager.o3o("model/megane.o3o");case 2:Cb=t.sent;case 3:case"end":return t.stop()}},t)}),o=function(){var t=this,e=arguments;return new Promise(function(n,o){var i=r.apply(t,e);function a(t){qb(i,n,o,a,u,"next",t)}function u(t){qb(i,n,o,a,u,"throw",t)}a(void 0)})},function(t){return o.apply(this,arguments)})(),t.init=!0,t}return function(t,e){e&&Yb(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1})}(n,[{key:"move",value:function(){if(Cb){var t=Cb.scenes_name_hash.omake;if(this.init){for(var e=0;e<t.objects.length;e++){var r=t.objects[e];this.sprite_objects.push(r),engine.sprite_scene.objects.push(r)}this.init=!1}this.frame>120&&this.parent.next(),this.frame++,t.setFrame(this.frame),Qb(Kb(n.prototype),"move",this).call(this)}}}]),n}(Ph);function rd(t){return rd="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},rd(t)}function od(){var t=fd(),e=t.m(od),n=(Object.getPrototypeOf?Object.getPrototypeOf(e):e.__proto__).constructor;function r(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===n||"GeneratorFunction"===(e.displayName||e.name))}var o={throw:1,return:2,break:3,continue:3};function i(t){var e,n;return function(r){e||(e={stop:function(){return n(r.a,2)},catch:function(){return r.v},abrupt:function(t,e){return n(r.a,o[t],e)},delegateYield:function(t,o,i){return e.resultName=o,n(r.d,id(t),i)},finish:function(t){return n(r.f,t)}},n=function(t,n,o){r.p=e.prev,r.n=e.next;try{return t(n,o)}finally{e.next=r.n}}),e.resultName&&(e[e.resultName]=r.v,e.resultName=void 0),e.sent=r.v,e.next=r.n;try{return t.call(this,e)}finally{r.p=e.prev,r.n=e.next}}}return(od=function(){return{wrap:function(e,n,r,o){return t.w(i(e),n,r,o&&o.reverse())},isGeneratorFunction:r,mark:t.m,awrap:function(t,e){return new hd(t,e)},AsyncIterator:cd,async:function(t,e,n,o,a){return(r(e)?sd:ud)(i(t),e,n,o,a)},keys:ad,values:id}})()}function id(t){if(null!=t){var e=t["function"==typeof Symbol&&Symbol.iterator||"@@iterator"],n=0;if(e)return e.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length))return{next:function(){return t&&n>=t.length&&(t=void 0),{value:t&&t[n++],done:!t}}}}throw new TypeError(rd(t)+" is not iterable")}function ad(t){var e=Object(t),n=[];for(var r in e)n.unshift(r);return function t(){for(;n.length;)if((r=n.pop())in e)return t.value=r,t.done=!1,t;return t.done=!0,t}}function ud(t,e,n,r,o){var i=sd(t,e,n,r,o);return i.next().then(function(t){return t.done?t.value:i.next()})}function sd(t,e,n,r,o){return new cd(fd().w(t,e,n,r),o||Promise)}function cd(t,e){function n(r,o,i,a){try{var u=t[r](o),s=u.value;return s instanceof hd?e.resolve(s.v).then(function(t){n("next",t,i,a)},function(t){n("throw",t,i,a)}):e.resolve(s).then(function(t){u.value=t,i(u)},function(t){return n("throw",t,i,a)})}catch(t){a(t)}}var r;this.next||(ld(cd.prototype),ld(cd.prototype,"function"==typeof Symbol&&Symbol.asyncIterator||"@asyncIterator",function(){return this})),ld(this,"_invoke",function(t,o,i){function a(){return new e(function(e,r){n(t,i,e,r)})}return r=r?r.then(a,a):a()},!0)}function fd(){var t,e,n="function"==typeof Symbol?Symbol:{},r=n.iterator||"@@iterator",o=n.toStringTag||"@@toStringTag";function i(n,r,o,i){var s=r&&r.prototype instanceof u?r:u,c=Object.create(s.prototype);return ld(c,"_invoke",function(n,r,o){var i,u,s,c=0,f=o||[],l=!1,h={p:0,n:0,v:t,a:p,f:p.bind(t,4),d:function(e,n){return i=e,u=0,s=t,h.n=n,a}};function p(n,r){for(u=n,s=r,e=0;!l&&c&&!o&&e<f.length;e++){var o,i=f[e],p=h.p,v=i[2];n>3?(o=v===r)&&(s=i[(u=i[4])?5:(u=3,3)],i[4]=i[5]=t):i[0]<=p&&((o=n<2&&p<i[1])?(u=0,h.v=r,h.n=i[1]):p<v&&(o=n<3||i[0]>r||r>v)&&(i[4]=n,i[5]=r,h.n=v,u=0))}if(o||n>1)return a;throw l=!0,r}return function(o,f,v){if(c>1)throw TypeError("Generator is already running");for(l&&1===f&&p(f,v),u=f,s=v;(e=u<2?t:s)||!l;){i||(u?u<3?(u>1&&(h.n=-1),p(u,s)):h.n=s:h.v=s);try{if(c=2,i){if(u||(o="next"),e=i[o]){if(!(e=e.call(i,s)))throw TypeError("iterator result is not an object");if(!e.done)return e;s=e.value,u<2&&(u=0)}else 1===u&&(e=i.return)&&e.call(i),u<2&&(s=TypeError("The iterator does not provide a '"+o+"' method"),u=1);i=t}else if((e=(l=h.n<0)?s:n.call(r,h))!==a)break}catch(e){i=t,u=1,s=e}finally{c=1}}return{value:e,done:l}}}(n,o,i),!0),c}var a={};function u(){}function s(){}function c(){}e=Object.getPrototypeOf;var f=[][r]?e(e([][r]())):(ld(e={},r,function(){return this}),e),l=c.prototype=u.prototype=Object.create(f);function h(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,c):(t.__proto__=c,ld(t,o,"GeneratorFunction")),t.prototype=Object.create(l),t}return s.prototype=c,ld(l,"constructor",c),ld(c,"constructor",s),s.displayName="GeneratorFunction",ld(c,o,"GeneratorFunction"),ld(l),ld(l,o,"Generator"),ld(l,r,function(){return this}),ld(l,"toString",function(){return"[object Generator]"}),(fd=function(){return{w:i,m:h}})()}function ld(t,e,n,r){var o=Object.defineProperty;try{o({},"",{})}catch(t){o=0}ld=function(t,e,n,r){function i(e,n){ld(t,e,function(t){return this._invoke(e,n,t)})}e?o?o(t,e,{value:n,enumerable:!r,configurable:!r,writable:!r}):t[e]=n:(i("next",0),i("throw",1),i("return",2))},ld(t,e,n,r)}function hd(t,e){this.v=t,this.k=e}function pd(t,e,n,r,o,i,a){try{var u=t[i](a),s=u.value}catch(t){return void n(t)}u.done?e(s):Promise.resolve(s).then(r,o)}function vd(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,yd(r.key),r)}}function yd(t){var e=function(t){if("object"!=rd(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var n=e.call(t,"string");if("object"!=rd(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==rd(e)?e:e+""}function md(){return md="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(t,e,n){var r=function(t,e){for(;!{}.hasOwnProperty.call(t,e)&&null!==(t=gd(t)););return t}(t,e);if(r){var o=Object.getOwnPropertyDescriptor(r,e);return o.get?o.get.call(arguments.length<3?t:n):o.value}},md.apply(null,arguments)}function bd(t,e){return bd=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},bd(t,e)}function dd(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(t){}return(dd=function(){return!!t})()}function gd(t){return gd=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},gd(t)}var wd,_d=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&bd(t,e)}(n,t);var e=function(t){var e=dd();return function(){var n,r=gd(t);if(e){var o=gd(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return function(t,e){if(e&&("object"==rd(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(this,n)}}(n);function n(){var t,r,o;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,n),(t=e.call(this)).loaded=!1,(r=od().mark(function e(n){return od().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Uh.AssetManager.o3o("model/megane.o3o");case 2:return Zb=e.sent,e.next=5,Uh.AssetManager.audio("sound/ufo.wav");case 5:return td=e.sent,e.next=8,Uh.AssetManager.audio("sound/wip.wav");case 8:ed=e.sent,t.loaded=!0;case 10:case"end":return e.stop()}},e)}),o=function(){var t=this,e=arguments;return new Promise(function(n,o){var i=r.apply(t,e);function a(t){pd(i,n,o,a,u,"next",t)}function u(t){pd(i,n,o,a,u,"throw",t)}a(void 0)})},function(t){return o.apply(this,arguments)})(),t.init=!0,t}return function(t,e){e&&vd(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1})}(n,[{key:"move",value:function(){if(this.loaded){var t=Zb.scenes_name_hash.demo,e=Zb.scenes_name_hash.demo_sprite;if(this.init){for(var r=0;r<t.objects.length;r++){var o=t.objects[r];this.scene_objects.push(o),engine.scene.objects.push(o)}for(r=0;r<e.objects.length;r++)o=e.objects[r],this.sprite_objects.push(o),engine.sprite_scene.objects.push(o);engine.scene.world=t.world,this.init=!1,this.frame=0,td.playSound(!0)}300===this.frame&&(td.stop(),ed.playSound()),this.frame>=t.frame_end&&this.parent.next(),t.setFrame(this.frame),e.setFrame(this.frame),this.frame++,md(gd(n.prototype),"move",this).call(this)}}}]),n}(Ph);function xd(t){return xd="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},xd(t)}function jd(){var t=kd(),e=t.m(jd),n=(Object.getPrototypeOf?Object.getPrototypeOf(e):e.__proto__).constructor;function r(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===n||"GeneratorFunction"===(e.displayName||e.name))}var o={throw:1,return:2,break:3,continue:3};function i(t){var e,n;return function(r){e||(e={stop:function(){return n(r.a,2)},catch:function(){return r.v},abrupt:function(t,e){return n(r.a,o[t],e)},delegateYield:function(t,o,i){return e.resultName=o,n(r.d,Od(t),i)},finish:function(t){return n(r.f,t)}},n=function(t,n,o){r.p=e.prev,r.n=e.next;try{return t(n,o)}finally{e.next=r.n}}),e.resultName&&(e[e.resultName]=r.v,e.resultName=void 0),e.sent=r.v,e.next=r.n;try{return t.call(this,e)}finally{r.p=e.prev,r.n=e.next}}}return(jd=function(){return{wrap:function(e,n,r,o){return t.w(i(e),n,r,o&&o.reverse())},isGeneratorFunction:r,mark:t.m,awrap:function(t,e){return new Rd(t,e)},AsyncIterator:Td,async:function(t,e,n,o,a){return(r(e)?Pd:Ed)(i(t),e,n,o,a)},keys:Sd,values:Od}})()}function Od(t){if(null!=t){var e=t["function"==typeof Symbol&&Symbol.iterator||"@@iterator"],n=0;if(e)return e.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length))return{next:function(){return t&&n>=t.length&&(t=void 0),{value:t&&t[n++],done:!t}}}}throw new TypeError(xd(t)+" is not iterable")}function Sd(t){var e=Object(t),n=[];for(var r in e)n.unshift(r);return function t(){for(;n.length;)if((r=n.pop())in e)return t.value=r,t.done=!1,t;return t.done=!0,t}}function Ed(t,e,n,r,o){var i=Pd(t,e,n,r,o);return i.next().then(function(t){return t.done?t.value:i.next()})}function Pd(t,e,n,r,o){return new Td(kd().w(t,e,n,r),o||Promise)}function Td(t,e){function n(r,o,i,a){try{var u=t[r](o),s=u.value;return s instanceof Rd?e.resolve(s.v).then(function(t){n("next",t,i,a)},function(t){n("throw",t,i,a)}):e.resolve(s).then(function(t){u.value=t,i(u)},function(t){return n("throw",t,i,a)})}catch(t){a(t)}}var r;this.next||(Md(Td.prototype),Md(Td.prototype,"function"==typeof Symbol&&Symbol.asyncIterator||"@asyncIterator",function(){return this})),Md(this,"_invoke",function(t,o,i){function a(){return new e(function(e,r){n(t,i,e,r)})}return r=r?r.then(a,a):a()},!0)}function kd(){var t,e,n="function"==typeof Symbol?Symbol:{},r=n.iterator||"@@iterator",o=n.toStringTag||"@@toStringTag";function i(n,r,o,i){var s=r&&r.prototype instanceof u?r:u,c=Object.create(s.prototype);return Md(c,"_invoke",function(n,r,o){var i,u,s,c=0,f=o||[],l=!1,h={p:0,n:0,v:t,a:p,f:p.bind(t,4),d:function(e,n){return i=e,u=0,s=t,h.n=n,a}};function p(n,r){for(u=n,s=r,e=0;!l&&c&&!o&&e<f.length;e++){var o,i=f[e],p=h.p,v=i[2];n>3?(o=v===r)&&(s=i[(u=i[4])?5:(u=3,3)],i[4]=i[5]=t):i[0]<=p&&((o=n<2&&p<i[1])?(u=0,h.v=r,h.n=i[1]):p<v&&(o=n<3||i[0]>r||r>v)&&(i[4]=n,i[5]=r,h.n=v,u=0))}if(o||n>1)return a;throw l=!0,r}return function(o,f,v){if(c>1)throw TypeError("Generator is already running");for(l&&1===f&&p(f,v),u=f,s=v;(e=u<2?t:s)||!l;){i||(u?u<3?(u>1&&(h.n=-1),p(u,s)):h.n=s:h.v=s);try{if(c=2,i){if(u||(o="next"),e=i[o]){if(!(e=e.call(i,s)))throw TypeError("iterator result is not an object");if(!e.done)return e;s=e.value,u<2&&(u=0)}else 1===u&&(e=i.return)&&e.call(i),u<2&&(s=TypeError("The iterator does not provide a '"+o+"' method"),u=1);i=t}else if((e=(l=h.n<0)?s:n.call(r,h))!==a)break}catch(e){i=t,u=1,s=e}finally{c=1}}return{value:e,done:l}}}(n,o,i),!0),c}var a={};function u(){}function s(){}function c(){}e=Object.getPrototypeOf;var f=[][r]?e(e([][r]())):(Md(e={},r,function(){return this}),e),l=c.prototype=u.prototype=Object.create(f);function h(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,c):(t.__proto__=c,Md(t,o,"GeneratorFunction")),t.prototype=Object.create(l),t}return s.prototype=c,Md(l,"constructor",c),Md(c,"constructor",s),s.displayName="GeneratorFunction",Md(c,o,"GeneratorFunction"),Md(l),Md(l,o,"Generator"),Md(l,r,function(){return this}),Md(l,"toString",function(){return"[object Generator]"}),(kd=function(){return{w:i,m:h}})()}function Md(t,e,n,r){var o=Object.defineProperty;try{o({},"",{})}catch(t){o=0}Md=function(t,e,n,r){function i(e,n){Md(t,e,function(t){return this._invoke(e,n,t)})}e?o?o(t,e,{value:n,enumerable:!r,configurable:!r,writable:!r}):t[e]=n:(i("next",0),i("throw",1),i("return",2))},Md(t,e,n,r)}function Rd(t,e){this.v=t,this.k=e}function Id(t,e,n,r,o,i,a){try{var u=t[i](a),s=u.value}catch(t){return void n(t)}u.done?e(s):Promise.resolve(s).then(r,o)}function Ad(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,Cd(r.key),r)}}function Cd(t){var e=function(t){if("object"!=xd(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var n=e.call(t,"string");if("object"!=xd(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==xd(e)?e:e+""}function Fd(){return Fd="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(t,e,n){var r=function(t,e){for(;!{}.hasOwnProperty.call(t,e)&&null!==(t=Ud(t)););return t}(t,e);if(r){var o=Object.getOwnPropertyDescriptor(r,e);return o.get?o.get.call(arguments.length<3?t:n):o.value}},Fd.apply(null,arguments)}function Nd(t,e){return Nd=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},Nd(t,e)}function Bd(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(t){}return(Bd=function(){return!!t})()}function Ud(t){return Ud=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},Ud(t)}var Ld,Vd,Dd=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&Nd(t,e)}(n,t);var e=function(t){var e=Bd();return function(){var n,r=Ud(t);if(e){var o=Ud(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return function(t,e){if(e&&("object"==xd(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(this,n)}}(n);function n(){var t,r,o;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,n),(t=e.call(this)).loaded=!1,(r=jd().mark(function e(n){return jd().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Uh.AssetManager.o3o("model/megane.o3o");case 2:wd=e.sent,t.loaded=!0;case 4:case"end":return e.stop()}},e)}),o=function(){var t=this,e=arguments;return new Promise(function(n,o){var i=r.apply(t,e);function a(t){Id(i,n,o,a,u,"next",t)}function u(t){Id(i,n,o,a,u,"throw",t)}a(void 0)})},function(t){return o.apply(this,arguments)})(),t.init=!0,t}return function(t,e){e&&Ad(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1})}(n,[{key:"move",value:function(){if(this.loaded){var t=wd.scenes_name_hash.burp,e=wd.scenes_name_hash.burp_sprite;if(this.init){engine.scene.world=t.world;for(var r=0;r<t.objects.length;r++){var o=t.objects[r];this.scene_objects.push(o),engine.scene.objects.push(o)}for(r=0;r<e.objects.length;r++)o=e.objects[r],this.sprite_objects.push(o),engine.sprite_scene.objects.push(o);this.init=!1,this.frame=0,document.querySelector('span.vpad[code="5"]').style.display="inline-block"}this.frame>=t.frame_end&&this.parent.next(),t.setFrame(this.frame),e.setFrame(this.frame),this.frame++,Fd(Ud(n.prototype),"move",this).call(this)}}}]),n}(Ph);function Gd(t){return Gd="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Gd(t)}function zd(){var t=Qd(),e=t.m(zd),n=(Object.getPrototypeOf?Object.getPrototypeOf(e):e.__proto__).constructor;function r(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===n||"GeneratorFunction"===(e.displayName||e.name))}var o={throw:1,return:2,break:3,continue:3};function i(t){var e,n;return function(r){e||(e={stop:function(){return n(r.a,2)},catch:function(){return r.v},abrupt:function(t,e){return n(r.a,o[t],e)},delegateYield:function(t,o,i){return e.resultName=o,n(r.d,Xd(t),i)},finish:function(t){return n(r.f,t)}},n=function(t,n,o){r.p=e.prev,r.n=e.next;try{return t(n,o)}finally{e.next=r.n}}),e.resultName&&(e[e.resultName]=r.v,e.resultName=void 0),e.sent=r.v,e.next=r.n;try{return t.call(this,e)}finally{r.p=e.prev,r.n=e.next}}}return(zd=function(){return{wrap:function(e,n,r,o){return t.w(i(e),n,r,o&&o.reverse())},isGeneratorFunction:r,mark:t.m,awrap:function(t,e){return new Jd(t,e)},AsyncIterator:Wd,async:function(t,e,n,o,a){return(r(e)?Yd:qd)(i(t),e,n,o,a)},keys:Hd,values:Xd}})()}function Xd(t){if(null!=t){var e=t["function"==typeof Symbol&&Symbol.iterator||"@@iterator"],n=0;if(e)return e.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length))return{next:function(){return t&&n>=t.length&&(t=void 0),{value:t&&t[n++],done:!t}}}}throw new TypeError(Gd(t)+" is not iterable")}function Hd(t){var e=Object(t),n=[];for(var r in e)n.unshift(r);return function t(){for(;n.length;)if((r=n.pop())in e)return t.value=r,t.done=!1,t;return t.done=!0,t}}function qd(t,e,n,r,o){var i=Yd(t,e,n,r,o);return i.next().then(function(t){return t.done?t.value:i.next()})}function Yd(t,e,n,r,o){return new Wd(Qd().w(t,e,n,r),o||Promise)}function Wd(t,e){function n(r,o,i,a){try{var u=t[r](o),s=u.value;return s instanceof Jd?e.resolve(s.v).then(function(t){n("next",t,i,a)},function(t){n("throw",t,i,a)}):e.resolve(s).then(function(t){u.value=t,i(u)},function(t){return n("throw",t,i,a)})}catch(t){a(t)}}var r;this.next||($d(Wd.prototype),$d(Wd.prototype,"function"==typeof Symbol&&Symbol.asyncIterator||"@asyncIterator",function(){return this})),$d(this,"_invoke",function(t,o,i){function a(){return new e(function(e,r){n(t,i,e,r)})}return r=r?r.then(a,a):a()},!0)}function Qd(){var t,e,n="function"==typeof Symbol?Symbol:{},r=n.iterator||"@@iterator",o=n.toStringTag||"@@toStringTag";function i(n,r,o,i){var s=r&&r.prototype instanceof u?r:u,c=Object.create(s.prototype);return $d(c,"_invoke",function(n,r,o){var i,u,s,c=0,f=o||[],l=!1,h={p:0,n:0,v:t,a:p,f:p.bind(t,4),d:function(e,n){return i=e,u=0,s=t,h.n=n,a}};function p(n,r){for(u=n,s=r,e=0;!l&&c&&!o&&e<f.length;e++){var o,i=f[e],p=h.p,v=i[2];n>3?(o=v===r)&&(s=i[(u=i[4])?5:(u=3,3)],i[4]=i[5]=t):i[0]<=p&&((o=n<2&&p<i[1])?(u=0,h.v=r,h.n=i[1]):p<v&&(o=n<3||i[0]>r||r>v)&&(i[4]=n,i[5]=r,h.n=v,u=0))}if(o||n>1)return a;throw l=!0,r}return function(o,f,v){if(c>1)throw TypeError("Generator is already running");for(l&&1===f&&p(f,v),u=f,s=v;(e=u<2?t:s)||!l;){i||(u?u<3?(u>1&&(h.n=-1),p(u,s)):h.n=s:h.v=s);try{if(c=2,i){if(u||(o="next"),e=i[o]){if(!(e=e.call(i,s)))throw TypeError("iterator result is not an object");if(!e.done)return e;s=e.value,u<2&&(u=0)}else 1===u&&(e=i.return)&&e.call(i),u<2&&(s=TypeError("The iterator does not provide a '"+o+"' method"),u=1);i=t}else if((e=(l=h.n<0)?s:n.call(r,h))!==a)break}catch(e){i=t,u=1,s=e}finally{c=1}}return{value:e,done:l}}}(n,o,i),!0),c}var a={};function u(){}function s(){}function c(){}e=Object.getPrototypeOf;var f=[][r]?e(e([][r]())):($d(e={},r,function(){return this}),e),l=c.prototype=u.prototype=Object.create(f);function h(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,c):(t.__proto__=c,$d(t,o,"GeneratorFunction")),t.prototype=Object.create(l),t}return s.prototype=c,$d(l,"constructor",c),$d(c,"constructor",s),s.displayName="GeneratorFunction",$d(c,o,"GeneratorFunction"),$d(l),$d(l,o,"Generator"),$d(l,r,function(){return this}),$d(l,"toString",function(){return"[object Generator]"}),(Qd=function(){return{w:i,m:h}})()}function $d(t,e,n,r){var o=Object.defineProperty;try{o({},"",{})}catch(t){o=0}$d=function(t,e,n,r){function i(e,n){$d(t,e,function(t){return this._invoke(e,n,t)})}e?o?o(t,e,{value:n,enumerable:!r,configurable:!r,writable:!r}):t[e]=n:(i("next",0),i("throw",1),i("return",2))},$d(t,e,n,r)}function Jd(t,e){this.v=t,this.k=e}function Kd(t,e,n,r,o,i,a){try{var u=t[i](a),s=u.value}catch(t){return void n(t)}u.done?e(s):Promise.resolve(s).then(r,o)}function Zd(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,tg(r.key),r)}}function tg(t){var e=function(t){if("object"!=Gd(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var n=e.call(t,"string");if("object"!=Gd(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==Gd(e)?e:e+""}function eg(t,e){return eg=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},eg(t,e)}function ng(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(t){}return(ng=function(){return!!t})()}function rg(t){return rg=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},rg(t)}var og,ig=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&eg(t,e)}(n,t);var e=function(t){var e=ng();return function(){var n,r=rg(t);if(e){var o=rg(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return function(t,e){if(e&&("object"==Gd(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(this,n)}}(n);function n(){var t,r,o;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,n),(t=e.call(this)).frame=0,t.location=new X,t.v=new X,t.state=0,(r=zd().mark(function e(n){return zd().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Uh.AssetManager.o3o("model/dis.o3o");case 2:return Ld=e.sent,e.next=5,Uh.AssetManager.audio("sound/explosion.wav");case 5:Vd=e.sent,t.state=1;case 7:case"end":return e.stop()}},e)}),o=function(){var t=this,e=arguments;return new Promise(function(n,o){var i=r.apply(t,e);function a(t){Kd(i,n,o,a,u,"next",t)}function u(t){Kd(i,n,o,a,u,"throw",t)}a(void 0)})},function(t){return o.apply(this,arguments)})(),t.mainobj="",t.init=!0,t}return function(t,e){e&&Zd(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1})}(n,[{key:"move",value:function(){if(0!==this.state){if(this.init){this.mainobj=Ld.objects_name_hash.shobaku.linkCopy(),engine.scene.objects.push(this.mainobj),this.scene_objects.push(this.mainobj);for(var t=0;t<5;t++){var e=new $p;this.parent.addChild(e),X.copy(e.location,this.location)}this.init=!1,Vd.playSound(!1,!0)}this.frame>this.mainobj.animation_data.action.endframe&&this.remove(),this.mainobj.setFrame(this.frame),X.mad(this.mainobj.location,this.location,this.v,this.frame),this.frame++}}}]),n}(Ph);function ag(t){return ag="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},ag(t)}function ug(){var t=pg(),e=t.m(ug),n=(Object.getPrototypeOf?Object.getPrototypeOf(e):e.__proto__).constructor;function r(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===n||"GeneratorFunction"===(e.displayName||e.name))}var o={throw:1,return:2,break:3,continue:3};function i(t){var e,n;return function(r){e||(e={stop:function(){return n(r.a,2)},catch:function(){return r.v},abrupt:function(t,e){return n(r.a,o[t],e)},delegateYield:function(t,o,i){return e.resultName=o,n(r.d,sg(t),i)},finish:function(t){return n(r.f,t)}},n=function(t,n,o){r.p=e.prev,r.n=e.next;try{return t(n,o)}finally{e.next=r.n}}),e.resultName&&(e[e.resultName]=r.v,e.resultName=void 0),e.sent=r.v,e.next=r.n;try{return t.call(this,e)}finally{r.p=e.prev,r.n=e.next}}}return(ug=function(){return{wrap:function(e,n,r,o){return t.w(i(e),n,r,o&&o.reverse())},isGeneratorFunction:r,mark:t.m,awrap:function(t,e){return new yg(t,e)},AsyncIterator:hg,async:function(t,e,n,o,a){return(r(e)?lg:fg)(i(t),e,n,o,a)},keys:cg,values:sg}})()}function sg(t){if(null!=t){var e=t["function"==typeof Symbol&&Symbol.iterator||"@@iterator"],n=0;if(e)return e.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length))return{next:function(){return t&&n>=t.length&&(t=void 0),{value:t&&t[n++],done:!t}}}}throw new TypeError(ag(t)+" is not iterable")}function cg(t){var e=Object(t),n=[];for(var r in e)n.unshift(r);return function t(){for(;n.length;)if((r=n.pop())in e)return t.value=r,t.done=!1,t;return t.done=!0,t}}function fg(t,e,n,r,o){var i=lg(t,e,n,r,o);return i.next().then(function(t){return t.done?t.value:i.next()})}function lg(t,e,n,r,o){return new hg(pg().w(t,e,n,r),o||Promise)}function hg(t,e){function n(r,o,i,a){try{var u=t[r](o),s=u.value;return s instanceof yg?e.resolve(s.v).then(function(t){n("next",t,i,a)},function(t){n("throw",t,i,a)}):e.resolve(s).then(function(t){u.value=t,i(u)},function(t){return n("throw",t,i,a)})}catch(t){a(t)}}var r;this.next||(vg(hg.prototype),vg(hg.prototype,"function"==typeof Symbol&&Symbol.asyncIterator||"@asyncIterator",function(){return this})),vg(this,"_invoke",function(t,o,i){function a(){return new e(function(e,r){n(t,i,e,r)})}return r=r?r.then(a,a):a()},!0)}function pg(){var t,e,n="function"==typeof Symbol?Symbol:{},r=n.iterator||"@@iterator",o=n.toStringTag||"@@toStringTag";function i(n,r,o,i){var s=r&&r.prototype instanceof u?r:u,c=Object.create(s.prototype);return vg(c,"_invoke",function(n,r,o){var i,u,s,c=0,f=o||[],l=!1,h={p:0,n:0,v:t,a:p,f:p.bind(t,4),d:function(e,n){return i=e,u=0,s=t,h.n=n,a}};function p(n,r){for(u=n,s=r,e=0;!l&&c&&!o&&e<f.length;e++){var o,i=f[e],p=h.p,v=i[2];n>3?(o=v===r)&&(s=i[(u=i[4])?5:(u=3,3)],i[4]=i[5]=t):i[0]<=p&&((o=n<2&&p<i[1])?(u=0,h.v=r,h.n=i[1]):p<v&&(o=n<3||i[0]>r||r>v)&&(i[4]=n,i[5]=r,h.n=v,u=0))}if(o||n>1)return a;throw l=!0,r}return function(o,f,v){if(c>1)throw TypeError("Generator is already running");for(l&&1===f&&p(f,v),u=f,s=v;(e=u<2?t:s)||!l;){i||(u?u<3?(u>1&&(h.n=-1),p(u,s)):h.n=s:h.v=s);try{if(c=2,i){if(u||(o="next"),e=i[o]){if(!(e=e.call(i,s)))throw TypeError("iterator result is not an object");if(!e.done)return e;s=e.value,u<2&&(u=0)}else 1===u&&(e=i.return)&&e.call(i),u<2&&(s=TypeError("The iterator does not provide a '"+o+"' method"),u=1);i=t}else if((e=(l=h.n<0)?s:n.call(r,h))!==a)break}catch(e){i=t,u=1,s=e}finally{c=1}}return{value:e,done:l}}}(n,o,i),!0),c}var a={};function u(){}function s(){}function c(){}e=Object.getPrototypeOf;var f=[][r]?e(e([][r]())):(vg(e={},r,function(){return this}),e),l=c.prototype=u.prototype=Object.create(f);function h(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,c):(t.__proto__=c,vg(t,o,"GeneratorFunction")),t.prototype=Object.create(l),t}return s.prototype=c,vg(l,"constructor",c),vg(c,"constructor",s),s.displayName="GeneratorFunction",vg(c,o,"GeneratorFunction"),vg(l),vg(l,o,"Generator"),vg(l,r,function(){return this}),vg(l,"toString",function(){return"[object Generator]"}),(pg=function(){return{w:i,m:h}})()}function vg(t,e,n,r){var o=Object.defineProperty;try{o({},"",{})}catch(t){o=0}vg=function(t,e,n,r){function i(e,n){vg(t,e,function(t){return this._invoke(e,n,t)})}e?o?o(t,e,{value:n,enumerable:!r,configurable:!r,writable:!r}):t[e]=n:(i("next",0),i("throw",1),i("return",2))},vg(t,e,n,r)}function yg(t,e){this.v=t,this.k=e}function mg(t,e,n,r,o,i,a){try{var u=t[i](a),s=u.value}catch(t){return void n(t)}u.done?e(s):Promise.resolve(s).then(r,o)}function bg(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,dg(r.key),r)}}function dg(t){var e=function(t){if("object"!=ag(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var n=e.call(t,"string");if("object"!=ag(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==ag(e)?e:e+""}function gg(){return gg="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(t,e,n){var r=function(t,e){for(;!{}.hasOwnProperty.call(t,e)&&null!==(t=xg(t)););return t}(t,e);if(r){var o=Object.getOwnPropertyDescriptor(r,e);return o.get?o.get.call(arguments.length<3?t:n):o.value}},gg.apply(null,arguments)}function wg(t,e){return wg=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},wg(t,e)}function _g(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(t){}return(_g=function(){return!!t})()}function xg(t){return xg=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},xg(t)}var jg,Og=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&wg(t,e)}(n,t);var e=function(t){var e=_g();return function(){var n,r=xg(t);if(e){var o=xg(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return function(t,e){if(e&&("object"==ag(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(this,n)}}(n);function n(){var t;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,n),(t=e.call(this)).frame=0,t.total_frame=180+120*Math.random(),t.next_frame=0,t.pattern_frame=0,t.location=new X,t.v=new X,t.target=new X,t.state=0,t.init=1,t.v=new X;var r,o,i=2*Math.random()*Math.PI;return t.v[0]=Math.sin(i),t.v[1]=Math.cos(i),X.mul(t.v,t.v,.01),t.ground_flg=0,(r=ug().mark(function t(e){return ug().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,Uh.AssetManager.o3o("model/dis.o3o");case 2:og=t.sent;case 3:case"end":return t.stop()}},t)}),o=function(){var t=this,e=arguments;return new Promise(function(n,o){var i=r.apply(t,e);function a(t){mg(i,n,o,a,u,"next",t)}function u(t){mg(i,n,o,a,u,"throw",t)}a(void 0)})},function(t){return o.apply(this,arguments)})(),t.mainobj="",t.hp=3,t.motion="octahedron",t}return function(t,e){e&&bg(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1})}(n,[{key:"hit",value:function(t,e){if("ground"==e.name)return this.v[1]<0&&(this.v[1]*=-.5),this.pattern_frame=-1,void(this.pattern=0);"beam_hit"===e.name&&(this.hp--,this.frame=0,this.hp<0&&this.bakuhatsu())}},{key:"remove",value:function(){for(var t=0;t<this.scene_objects.length;t++){var e=this.scene_objects[t];this.parent.collider.deleteCollision(e.collision)}gg(xg(n.prototype),"remove",this).call(this)}},{key:"bakuhatsu",value:function(){var t=new ig;this.parent.addChild(t),X.copy(t.location,this.location),t.location[2]+=.4,this.remove()}},{key:"move",value:function(){var t=this;if(og){if(this.init){for(var e=og.getCollectionObjectList(og.collections.octahedron),n=0;n<e.length;n++){var r=e[n].linkCopy();engine.scene.objects.push(r),this.scene_objects.push(r),r.collision&&(this.parent.collider.addCollision(r.collision),r.collision.callbackFunc=function(e,n){t.hit(e,n)}),e[n].parent||(this.mainobj=r)}for(n=0;n<this.scene_objects.length;n++)(r=this.scene_objects[n])!==this.mainobj&&(r.parent=this.mainobj);this.mainobj.action=null,this.init=!1,this.pattern=0}switch(this.pattern){case 0:0===this.pattern_frame&&(this.target[0]=2*(2*Math.random()-1),this.target[1]=2*Math.random()+3,this.next_frame=180*Math.random()+120),this.next_frame<=this.pattern_frame&&this.parent.go&&(this.pattern_frame=-1,this.pattern=1);break;case 1:0===this.pattern_frame&&X.copy(this.target,this.parent.cif.location)}for(this.mainobj.action&&"damage"===this.mainobj.action.name&&this.frame>=this.mainobj.action.endframe&&(this.mainobj.action=null),n=0;n<this.scene_objects.length;n++)(r=this.scene_objects[n]).setFrame(this.frame);var o=new X;X.sub(o,this.target,this.location),X.nrm(o),X.mul(this.v,this.v,.99),X.mad(this.v,this.v,o,.001),X.add(this.location,this.location,this.v),X.copy(this.mainobj.location,this.location),this.pattern_frame++,this.frame++}}}]),n}(Ph);function Sg(t){return Sg="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Sg(t)}function Eg(){var t=Ig(),e=t.m(Eg),n=(Object.getPrototypeOf?Object.getPrototypeOf(e):e.__proto__).constructor;function r(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===n||"GeneratorFunction"===(e.displayName||e.name))}var o={throw:1,return:2,break:3,continue:3};function i(t){var e,n;return function(r){e||(e={stop:function(){return n(r.a,2)},catch:function(){return r.v},abrupt:function(t,e){return n(r.a,o[t],e)},delegateYield:function(t,o,i){return e.resultName=o,n(r.d,Pg(t),i)},finish:function(t){return n(r.f,t)}},n=function(t,n,o){r.p=e.prev,r.n=e.next;try{return t(n,o)}finally{e.next=r.n}}),e.resultName&&(e[e.resultName]=r.v,e.resultName=void 0),e.sent=r.v,e.next=r.n;try{return t.call(this,e)}finally{r.p=e.prev,r.n=e.next}}}return(Eg=function(){return{wrap:function(e,n,r,o){return t.w(i(e),n,r,o&&o.reverse())},isGeneratorFunction:r,mark:t.m,awrap:function(t,e){return new Cg(t,e)},AsyncIterator:Rg,async:function(t,e,n,o,a){return(r(e)?Mg:kg)(i(t),e,n,o,a)},keys:Tg,values:Pg}})()}function Pg(t){if(null!=t){var e=t["function"==typeof Symbol&&Symbol.iterator||"@@iterator"],n=0;if(e)return e.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length))return{next:function(){return t&&n>=t.length&&(t=void 0),{value:t&&t[n++],done:!t}}}}throw new TypeError(Sg(t)+" is not iterable")}function Tg(t){var e=Object(t),n=[];for(var r in e)n.unshift(r);return function t(){for(;n.length;)if((r=n.pop())in e)return t.value=r,t.done=!1,t;return t.done=!0,t}}function kg(t,e,n,r,o){var i=Mg(t,e,n,r,o);return i.next().then(function(t){return t.done?t.value:i.next()})}function Mg(t,e,n,r,o){return new Rg(Ig().w(t,e,n,r),o||Promise)}function Rg(t,e){function n(r,o,i,a){try{var u=t[r](o),s=u.value;return s instanceof Cg?e.resolve(s.v).then(function(t){n("next",t,i,a)},function(t){n("throw",t,i,a)}):e.resolve(s).then(function(t){u.value=t,i(u)},function(t){return n("throw",t,i,a)})}catch(t){a(t)}}var r;this.next||(Ag(Rg.prototype),Ag(Rg.prototype,"function"==typeof Symbol&&Symbol.asyncIterator||"@asyncIterator",function(){return this})),Ag(this,"_invoke",function(t,o,i){function a(){return new e(function(e,r){n(t,i,e,r)})}return r=r?r.then(a,a):a()},!0)}function Ig(){var t,e,n="function"==typeof Symbol?Symbol:{},r=n.iterator||"@@iterator",o=n.toStringTag||"@@toStringTag";function i(n,r,o,i){var s=r&&r.prototype instanceof u?r:u,c=Object.create(s.prototype);return Ag(c,"_invoke",function(n,r,o){var i,u,s,c=0,f=o||[],l=!1,h={p:0,n:0,v:t,a:p,f:p.bind(t,4),d:function(e,n){return i=e,u=0,s=t,h.n=n,a}};function p(n,r){for(u=n,s=r,e=0;!l&&c&&!o&&e<f.length;e++){var o,i=f[e],p=h.p,v=i[2];n>3?(o=v===r)&&(s=i[(u=i[4])?5:(u=3,3)],i[4]=i[5]=t):i[0]<=p&&((o=n<2&&p<i[1])?(u=0,h.v=r,h.n=i[1]):p<v&&(o=n<3||i[0]>r||r>v)&&(i[4]=n,i[5]=r,h.n=v,u=0))}if(o||n>1)return a;throw l=!0,r}return function(o,f,v){if(c>1)throw TypeError("Generator is already running");for(l&&1===f&&p(f,v),u=f,s=v;(e=u<2?t:s)||!l;){i||(u?u<3?(u>1&&(h.n=-1),p(u,s)):h.n=s:h.v=s);try{if(c=2,i){if(u||(o="next"),e=i[o]){if(!(e=e.call(i,s)))throw TypeError("iterator result is not an object");if(!e.done)return e;s=e.value,u<2&&(u=0)}else 1===u&&(e=i.return)&&e.call(i),u<2&&(s=TypeError("The iterator does not provide a '"+o+"' method"),u=1);i=t}else if((e=(l=h.n<0)?s:n.call(r,h))!==a)break}catch(e){i=t,u=1,s=e}finally{c=1}}return{value:e,done:l}}}(n,o,i),!0),c}var a={};function u(){}function s(){}function c(){}e=Object.getPrototypeOf;var f=[][r]?e(e([][r]())):(Ag(e={},r,function(){return this}),e),l=c.prototype=u.prototype=Object.create(f);function h(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,c):(t.__proto__=c,Ag(t,o,"GeneratorFunction")),t.prototype=Object.create(l),t}return s.prototype=c,Ag(l,"constructor",c),Ag(c,"constructor",s),s.displayName="GeneratorFunction",Ag(c,o,"GeneratorFunction"),Ag(l),Ag(l,o,"Generator"),Ag(l,r,function(){return this}),Ag(l,"toString",function(){return"[object Generator]"}),(Ig=function(){return{w:i,m:h}})()}function Ag(t,e,n,r){var o=Object.defineProperty;try{o({},"",{})}catch(t){o=0}Ag=function(t,e,n,r){function i(e,n){Ag(t,e,function(t){return this._invoke(e,n,t)})}e?o?o(t,e,{value:n,enumerable:!r,configurable:!r,writable:!r}):t[e]=n:(i("next",0),i("throw",1),i("return",2))},Ag(t,e,n,r)}function Cg(t,e){this.v=t,this.k=e}function Fg(t,e,n,r,o,i,a){try{var u=t[i](a),s=u.value}catch(t){return void n(t)}u.done?e(s):Promise.resolve(s).then(r,o)}function Ng(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,Bg(r.key),r)}}function Bg(t){var e=function(t){if("object"!=Sg(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var n=e.call(t,"string");if("object"!=Sg(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==Sg(e)?e:e+""}function Ug(){return Ug="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(t,e,n){var r=function(t,e){for(;!{}.hasOwnProperty.call(t,e)&&null!==(t=Dg(t)););return t}(t,e);if(r){var o=Object.getOwnPropertyDescriptor(r,e);return o.get?o.get.call(arguments.length<3?t:n):o.value}},Ug.apply(null,arguments)}function Lg(t,e){return Lg=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},Lg(t,e)}function Vg(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(t){}return(Vg=function(){return!!t})()}function Dg(t){return Dg=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},Dg(t)}var Gg,zg=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&Lg(t,e)}(n,t);var e=function(t){var e=Vg();return function(){var n,r=Dg(t);if(e){var o=Dg(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return function(t,e){if(e&&("object"==Sg(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(this,n)}}(n);function n(){var t,r,o;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,n),(t=e.call(this)).frame=0,t.location=new X,t.v=new X,t.state=0,t.init=1,t.v=new X,t.ground_flg=0,(r=Eg().mark(function t(e){return Eg().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,Uh.AssetManager.o3o("model/dis.o3o");case 2:jg=t.sent;case 3:case"end":return t.stop()}},t)}),o=function(){var t=this,e=arguments;return new Promise(function(n,o){var i=r.apply(t,e);function a(t){Fg(i,n,o,a,u,"next",t)}function u(t){Fg(i,n,o,a,u,"throw",t)}a(void 0)})},function(t){return o.apply(this,arguments)})(),t.mainobj="",t.hp=2,t.motion="octahedron",t}return function(t,e){e&&Ng(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1})}(n,[{key:"hit",value:function(t,e){"ground"==e.name&&this.v[1]<0&&(this.v[1]>-.001&&(this.hp=0),this.v[1]*=-.4),"beam_hit"===e.name&&this.hp--,this.hp<=0&&this.bakuhatsu()}},{key:"remove",value:function(){for(var t=0;t<this.scene_objects.length;t++){var e=this.scene_objects[t];this.parent.collider.deleteCollision(e.collision)}Ug(Dg(n.prototype),"remove",this).call(this)}},{key:"bakuhatsu",value:function(){var t=new ig;this.parent.addChild(t),X.copy(t.location,this.location),t.location[2]+=.4,this.remove()}},{key:"move",value:function(){var t=this;if(jg){if(this.init){for(var e=jg.getCollectionObjectList(jg.collections.octahedron2),n=0;n<e.length;n++){var r=e[n].linkCopy();engine.scene.objects.push(r),this.scene_objects.push(r),r.collision&&(this.parent.collider.addCollision(r.collision),r.collision.callbackFunc=function(e,n){t.hit(e,n)}),e[n].parent||(this.mainobj=r)}for(n=0;n<this.scene_objects.length;n++)(r=this.scene_objects[n])!==this.mainobj&&(r.parent=this.mainobj);this.mainobj.action=null,this.init=!1}for(this.v[1]-=.001,n=0;n<this.scene_objects.length;n++)(r=this.scene_objects[n]).setFrame(this.frame);X.add(this.location,this.location,this.v),X.copy(this.mainobj.location,this.location),this.frame++}}}]),n}(Ph);function Xg(t){return Xg="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Xg(t)}function Hg(){var t=Jg(),e=t.m(Hg),n=(Object.getPrototypeOf?Object.getPrototypeOf(e):e.__proto__).constructor;function r(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===n||"GeneratorFunction"===(e.displayName||e.name))}var o={throw:1,return:2,break:3,continue:3};function i(t){var e,n;return function(r){e||(e={stop:function(){return n(r.a,2)},catch:function(){return r.v},abrupt:function(t,e){return n(r.a,o[t],e)},delegateYield:function(t,o,i){return e.resultName=o,n(r.d,qg(t),i)},finish:function(t){return n(r.f,t)}},n=function(t,n,o){r.p=e.prev,r.n=e.next;try{return t(n,o)}finally{e.next=r.n}}),e.resultName&&(e[e.resultName]=r.v,e.resultName=void 0),e.sent=r.v,e.next=r.n;try{return t.call(this,e)}finally{r.p=e.prev,r.n=e.next}}}return(Hg=function(){return{wrap:function(e,n,r,o){return t.w(i(e),n,r,o&&o.reverse())},isGeneratorFunction:r,mark:t.m,awrap:function(t,e){return new Zg(t,e)},AsyncIterator:$g,async:function(t,e,n,o,a){return(r(e)?Qg:Wg)(i(t),e,n,o,a)},keys:Yg,values:qg}})()}function qg(t){if(null!=t){var e=t["function"==typeof Symbol&&Symbol.iterator||"@@iterator"],n=0;if(e)return e.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length))return{next:function(){return t&&n>=t.length&&(t=void 0),{value:t&&t[n++],done:!t}}}}throw new TypeError(Xg(t)+" is not iterable")}function Yg(t){var e=Object(t),n=[];for(var r in e)n.unshift(r);return function t(){for(;n.length;)if((r=n.pop())in e)return t.value=r,t.done=!1,t;return t.done=!0,t}}function Wg(t,e,n,r,o){var i=Qg(t,e,n,r,o);return i.next().then(function(t){return t.done?t.value:i.next()})}function Qg(t,e,n,r,o){return new $g(Jg().w(t,e,n,r),o||Promise)}function $g(t,e){function n(r,o,i,a){try{var u=t[r](o),s=u.value;return s instanceof Zg?e.resolve(s.v).then(function(t){n("next",t,i,a)},function(t){n("throw",t,i,a)}):e.resolve(s).then(function(t){u.value=t,i(u)},function(t){return n("throw",t,i,a)})}catch(t){a(t)}}var r;this.next||(Kg($g.prototype),Kg($g.prototype,"function"==typeof Symbol&&Symbol.asyncIterator||"@asyncIterator",function(){return this})),Kg(this,"_invoke",function(t,o,i){function a(){return new e(function(e,r){n(t,i,e,r)})}return r=r?r.then(a,a):a()},!0)}function Jg(){var t,e,n="function"==typeof Symbol?Symbol:{},r=n.iterator||"@@iterator",o=n.toStringTag||"@@toStringTag";function i(n,r,o,i){var s=r&&r.prototype instanceof u?r:u,c=Object.create(s.prototype);return Kg(c,"_invoke",function(n,r,o){var i,u,s,c=0,f=o||[],l=!1,h={p:0,n:0,v:t,a:p,f:p.bind(t,4),d:function(e,n){return i=e,u=0,s=t,h.n=n,a}};function p(n,r){for(u=n,s=r,e=0;!l&&c&&!o&&e<f.length;e++){var o,i=f[e],p=h.p,v=i[2];n>3?(o=v===r)&&(s=i[(u=i[4])?5:(u=3,3)],i[4]=i[5]=t):i[0]<=p&&((o=n<2&&p<i[1])?(u=0,h.v=r,h.n=i[1]):p<v&&(o=n<3||i[0]>r||r>v)&&(i[4]=n,i[5]=r,h.n=v,u=0))}if(o||n>1)return a;throw l=!0,r}return function(o,f,v){if(c>1)throw TypeError("Generator is already running");for(l&&1===f&&p(f,v),u=f,s=v;(e=u<2?t:s)||!l;){i||(u?u<3?(u>1&&(h.n=-1),p(u,s)):h.n=s:h.v=s);try{if(c=2,i){if(u||(o="next"),e=i[o]){if(!(e=e.call(i,s)))throw TypeError("iterator result is not an object");if(!e.done)return e;s=e.value,u<2&&(u=0)}else 1===u&&(e=i.return)&&e.call(i),u<2&&(s=TypeError("The iterator does not provide a '"+o+"' method"),u=1);i=t}else if((e=(l=h.n<0)?s:n.call(r,h))!==a)break}catch(e){i=t,u=1,s=e}finally{c=1}}return{value:e,done:l}}}(n,o,i),!0),c}var a={};function u(){}function s(){}function c(){}e=Object.getPrototypeOf;var f=[][r]?e(e([][r]())):(Kg(e={},r,function(){return this}),e),l=c.prototype=u.prototype=Object.create(f);function h(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,c):(t.__proto__=c,Kg(t,o,"GeneratorFunction")),t.prototype=Object.create(l),t}return s.prototype=c,Kg(l,"constructor",c),Kg(c,"constructor",s),s.displayName="GeneratorFunction",Kg(c,o,"GeneratorFunction"),Kg(l),Kg(l,o,"Generator"),Kg(l,r,function(){return this}),Kg(l,"toString",function(){return"[object Generator]"}),(Jg=function(){return{w:i,m:h}})()}function Kg(t,e,n,r){var o=Object.defineProperty;try{o({},"",{})}catch(t){o=0}Kg=function(t,e,n,r){function i(e,n){Kg(t,e,function(t){return this._invoke(e,n,t)})}e?o?o(t,e,{value:n,enumerable:!r,configurable:!r,writable:!r}):t[e]=n:(i("next",0),i("throw",1),i("return",2))},Kg(t,e,n,r)}function Zg(t,e){this.v=t,this.k=e}function tw(t,e,n,r,o,i,a){try{var u=t[i](a),s=u.value}catch(t){return void n(t)}u.done?e(s):Promise.resolve(s).then(r,o)}function ew(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,nw(r.key),r)}}function nw(t){var e=function(t){if("object"!=Xg(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var n=e.call(t,"string");if("object"!=Xg(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==Xg(e)?e:e+""}function rw(t,e){return rw=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},rw(t,e)}function ow(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(t){}return(ow=function(){return!!t})()}function iw(t){return iw=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},iw(t)}var aw,uw,sw,cw=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&rw(t,e)}(n,t);var e=function(t){var e=ow();return function(){var n,r=iw(t);if(e){var o=iw(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return function(t,e){if(e&&("object"==Xg(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(this,n)}}(n);function n(){var t,r,o;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,n),(t=e.call(this)).frame=0,t.location=new X,t.loaded=!1,(r=Hg().mark(function e(n){return Hg().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Uh.AssetManager.o3o("model/sd_cif.o3o");case 2:Gg=e.sent,t.loaded=!0;case 4:case"end":return e.stop()}},e)}),o=function(){var t=this,e=arguments;return new Promise(function(n,o){var i=r.apply(t,e);function a(t){tw(i,n,o,a,u,"next",t)}function u(t){tw(i,n,o,a,u,"throw",t)}a(void 0)})},function(t){return o.apply(this,arguments)})(),t.init=!0,t}return function(t,e){e&&ew(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1})}(n,[{key:"move",value:function(){if(this.loaded){var t=Gg.scenes_name_hash.death_bee;if(this.init){for(var e=t.objects,n=0;n<e.length;n++){var r=e[n];engine.scene.objects.push(r),this.scene_objects.push(r),r.parent||X.copy(r.location,this.location)}this.init=!1}t.setFrame(this.frame),this.frame>=t.frame_end&&this.remove(),this.frame++}}}]),n}(Ph);function fw(t){return fw="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},fw(t)}function lw(){var t=bw(),e=t.m(lw),n=(Object.getPrototypeOf?Object.getPrototypeOf(e):e.__proto__).constructor;function r(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===n||"GeneratorFunction"===(e.displayName||e.name))}var o={throw:1,return:2,break:3,continue:3};function i(t){var e,n;return function(r){e||(e={stop:function(){return n(r.a,2)},catch:function(){return r.v},abrupt:function(t,e){return n(r.a,o[t],e)},delegateYield:function(t,o,i){return e.resultName=o,n(r.d,hw(t),i)},finish:function(t){return n(r.f,t)}},n=function(t,n,o){r.p=e.prev,r.n=e.next;try{return t(n,o)}finally{e.next=r.n}}),e.resultName&&(e[e.resultName]=r.v,e.resultName=void 0),e.sent=r.v,e.next=r.n;try{return t.call(this,e)}finally{r.p=e.prev,r.n=e.next}}}return(lw=function(){return{wrap:function(e,n,r,o){return t.w(i(e),n,r,o&&o.reverse())},isGeneratorFunction:r,mark:t.m,awrap:function(t,e){return new gw(t,e)},AsyncIterator:mw,async:function(t,e,n,o,a){return(r(e)?yw:vw)(i(t),e,n,o,a)},keys:pw,values:hw}})()}function hw(t){if(null!=t){var e=t["function"==typeof Symbol&&Symbol.iterator||"@@iterator"],n=0;if(e)return e.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length))return{next:function(){return t&&n>=t.length&&(t=void 0),{value:t&&t[n++],done:!t}}}}throw new TypeError(fw(t)+" is not iterable")}function pw(t){var e=Object(t),n=[];for(var r in e)n.unshift(r);return function t(){for(;n.length;)if((r=n.pop())in e)return t.value=r,t.done=!1,t;return t.done=!0,t}}function vw(t,e,n,r,o){var i=yw(t,e,n,r,o);return i.next().then(function(t){return t.done?t.value:i.next()})}function yw(t,e,n,r,o){return new mw(bw().w(t,e,n,r),o||Promise)}function mw(t,e){function n(r,o,i,a){try{var u=t[r](o),s=u.value;return s instanceof gw?e.resolve(s.v).then(function(t){n("next",t,i,a)},function(t){n("throw",t,i,a)}):e.resolve(s).then(function(t){u.value=t,i(u)},function(t){return n("throw",t,i,a)})}catch(t){a(t)}}var r;this.next||(dw(mw.prototype),dw(mw.prototype,"function"==typeof Symbol&&Symbol.asyncIterator||"@asyncIterator",function(){return this})),dw(this,"_invoke",function(t,o,i){function a(){return new e(function(e,r){n(t,i,e,r)})}return r=r?r.then(a,a):a()},!0)}function bw(){var t,e,n="function"==typeof Symbol?Symbol:{},r=n.iterator||"@@iterator",o=n.toStringTag||"@@toStringTag";function i(n,r,o,i){var s=r&&r.prototype instanceof u?r:u,c=Object.create(s.prototype);return dw(c,"_invoke",function(n,r,o){var i,u,s,c=0,f=o||[],l=!1,h={p:0,n:0,v:t,a:p,f:p.bind(t,4),d:function(e,n){return i=e,u=0,s=t,h.n=n,a}};function p(n,r){for(u=n,s=r,e=0;!l&&c&&!o&&e<f.length;e++){var o,i=f[e],p=h.p,v=i[2];n>3?(o=v===r)&&(s=i[(u=i[4])?5:(u=3,3)],i[4]=i[5]=t):i[0]<=p&&((o=n<2&&p<i[1])?(u=0,h.v=r,h.n=i[1]):p<v&&(o=n<3||i[0]>r||r>v)&&(i[4]=n,i[5]=r,h.n=v,u=0))}if(o||n>1)return a;throw l=!0,r}return function(o,f,v){if(c>1)throw TypeError("Generator is already running");for(l&&1===f&&p(f,v),u=f,s=v;(e=u<2?t:s)||!l;){i||(u?u<3?(u>1&&(h.n=-1),p(u,s)):h.n=s:h.v=s);try{if(c=2,i){if(u||(o="next"),e=i[o]){if(!(e=e.call(i,s)))throw TypeError("iterator result is not an object");if(!e.done)return e;s=e.value,u<2&&(u=0)}else 1===u&&(e=i.return)&&e.call(i),u<2&&(s=TypeError("The iterator does not provide a '"+o+"' method"),u=1);i=t}else if((e=(l=h.n<0)?s:n.call(r,h))!==a)break}catch(e){i=t,u=1,s=e}finally{c=1}}return{value:e,done:l}}}(n,o,i),!0),c}var a={};function u(){}function s(){}function c(){}e=Object.getPrototypeOf;var f=[][r]?e(e([][r]())):(dw(e={},r,function(){return this}),e),l=c.prototype=u.prototype=Object.create(f);function h(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,c):(t.__proto__=c,dw(t,o,"GeneratorFunction")),t.prototype=Object.create(l),t}return s.prototype=c,dw(l,"constructor",c),dw(c,"constructor",s),s.displayName="GeneratorFunction",dw(c,o,"GeneratorFunction"),dw(l),dw(l,o,"Generator"),dw(l,r,function(){return this}),dw(l,"toString",function(){return"[object Generator]"}),(bw=function(){return{w:i,m:h}})()}function dw(t,e,n,r){var o=Object.defineProperty;try{o({},"",{})}catch(t){o=0}dw=function(t,e,n,r){function i(e,n){dw(t,e,function(t){return this._invoke(e,n,t)})}e?o?o(t,e,{value:n,enumerable:!r,configurable:!r,writable:!r}):t[e]=n:(i("next",0),i("throw",1),i("return",2))},dw(t,e,n,r)}function gw(t,e){this.v=t,this.k=e}function ww(t,e,n,r,o,i,a){try{var u=t[i](a),s=u.value}catch(t){return void n(t)}u.done?e(s):Promise.resolve(s).then(r,o)}function _w(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,xw(r.key),r)}}function xw(t){var e=function(t){if("object"!=fw(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var n=e.call(t,"string");if("object"!=fw(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==fw(e)?e:e+""}function jw(){return jw="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(t,e,n){var r=function(t,e){for(;!{}.hasOwnProperty.call(t,e)&&null!==(t=Ew(t)););return t}(t,e);if(r){var o=Object.getOwnPropertyDescriptor(r,e);return o.get?o.get.call(arguments.length<3?t:n):o.value}},jw.apply(null,arguments)}function Ow(t,e){return Ow=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},Ow(t,e)}function Sw(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(t){}return(Sw=function(){return!!t})()}function Ew(t){return Ew=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},Ew(t)}var Pw,Tw,kw,Mw=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&Ow(t,e)}(n,t);var e=function(t){var e=Sw();return function(){var n,r=Ew(t);if(e){var o=Ew(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return function(t,e){if(e&&("object"==fw(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(this,n)}}(n);function n(){var t,r,o;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,n),(t=e.call(this)).frame=0,t.location=new X,t.state=0,t.frame++,t.v=new X,t.v[1]=-.02,t.loaded=!1,t.init=1,(r=lw().mark(function e(n){return lw().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Uh.AssetManager.o3o("model/sd_bee.o3o");case 2:return aw=e.sent,e.next=5,Uh.AssetManager.o3o("model/sd_cif.o3o");case 5:return uw=e.sent,e.next=8,Uh.AssetManager.audio("sound/catch.wav");case 8:sw=e.sent,t.loaded=!0;case 10:case"end":return e.stop()}},e)}),o=function(){var t=this,e=arguments;return new Promise(function(n,o){var i=r.apply(t,e);function a(t){ww(i,n,o,a,u,"next",t)}function u(t){ww(i,n,o,a,u,"throw",t)}a(void 0)})},function(t){return o.apply(this,arguments)})(),t}return function(t,e){e&&_w(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1})}(n,[{key:"remove",value:function(){for(var t=0;t<this.scene_objects.length;t++){var e=this.scene_objects[t];this.parent.collider.deleteCollision(e.collision)}jw(Ew(n.prototype),"remove",this).call(this)}},{key:"hit",value:function(t,e,n,r){if(0===this.state){if("beam_hit"===e.name){var o=new cw;return X.copy(o.location,this.location),o.location[2]+=1.5,this.parent.addChild(o),void this.remove()}if(e.name.indexOf("ground")>=0){this.location[1]=r[1],X.setValues(this.v,0,0,0);for(var i=0;i<this.scene_objects.length;i++)this.scene_objects[i].animation_data&&(this.scene_objects[i].animation_data.action=aw.actions_name_hash.crash);this.state=1}if("hit_body"==e.name){e.task;var a=uw.objects_name_hash.head;this.mainobj.parent=a;var u=this.mainobj;this.parent.cif.state=1;var s=new z;for(z.getInv(s,this.mainobj.parent.matrix),z.dot(s,s,this.mainobj.matrix),z.toLSE(u.location,u.scale,u.rotation,s),i=0;i<this.scene_objects.length;i++)this.scene_objects[i].animation_data&&(this.scene_objects[i].animation_data.action=aw.actions_name_hash.dakko);this.state=1,this.parent.parent.ending=3,sw.playSound()}}}},{key:"move",value:function(){var t=this;if(this.loaded){if(this.init){for(var e=aw.getCollectionObjectList(aw.collections.Bee),n=0;n<e.length;n++){var r=e[n].linkCopy();engine.scene.objects.push(r),this.scene_objects.push(r),r.collision&&(r.collision.task=this,this.parent.collider.addCollision(r.collision),r.collision.callbackFunc=function(e,n,r,o){t.hit(e,n,r,o)}),e[n].parent||(this.mainobj=r)}for(n=0;n<this.scene_objects.length;n++){(r=this.scene_objects[n]).parent&&(r.parent=this.scene_objects.find(function(t){return t.name_full===r.parent}));for(var o=0;o<r.modifiers.length;o++){var i=r.modifiers[o];i.object&&(i.object=this.scene_objects.find(function(t){return t.name_full===i.object+"_copy"}))}}for(n=0;n<this.scene_objects.length;n++)this.scene_objects[n].animation_data&&(this.scene_objects[n].animation_data.action=aw.actions_name_hash.fall);this.init=!1}for(n=0;n<this.scene_objects.length;n++)this.scene_objects[n].setFrame(this.frame);0===this.state&&(X.add(this.location,this.location,this.v),X.copy(this.mainobj.location,this.location)),this.frame++}}},{key:"draw",value:function(){}}]),n}(Ph);function Rw(t){return Rw="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Rw(t)}function Iw(){var t=Uw(),e=t.m(Iw),n=(Object.getPrototypeOf?Object.getPrototypeOf(e):e.__proto__).constructor;function r(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===n||"GeneratorFunction"===(e.displayName||e.name))}var o={throw:1,return:2,break:3,continue:3};function i(t){var e,n;return function(r){e||(e={stop:function(){return n(r.a,2)},catch:function(){return r.v},abrupt:function(t,e){return n(r.a,o[t],e)},delegateYield:function(t,o,i){return e.resultName=o,n(r.d,Aw(t),i)},finish:function(t){return n(r.f,t)}},n=function(t,n,o){r.p=e.prev,r.n=e.next;try{return t(n,o)}finally{e.next=r.n}}),e.resultName&&(e[e.resultName]=r.v,e.resultName=void 0),e.sent=r.v,e.next=r.n;try{return t.call(this,e)}finally{r.p=e.prev,r.n=e.next}}}return(Iw=function(){return{wrap:function(e,n,r,o){return t.w(i(e),n,r,o&&o.reverse())},isGeneratorFunction:r,mark:t.m,awrap:function(t,e){return new Vw(t,e)},AsyncIterator:Bw,async:function(t,e,n,o,a){return(r(e)?Nw:Fw)(i(t),e,n,o,a)},keys:Cw,values:Aw}})()}function Aw(t){if(null!=t){var e=t["function"==typeof Symbol&&Symbol.iterator||"@@iterator"],n=0;if(e)return e.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length))return{next:function(){return t&&n>=t.length&&(t=void 0),{value:t&&t[n++],done:!t}}}}throw new TypeError(Rw(t)+" is not iterable")}function Cw(t){var e=Object(t),n=[];for(var r in e)n.unshift(r);return function t(){for(;n.length;)if((r=n.pop())in e)return t.value=r,t.done=!1,t;return t.done=!0,t}}function Fw(t,e,n,r,o){var i=Nw(t,e,n,r,o);return i.next().then(function(t){return t.done?t.value:i.next()})}function Nw(t,e,n,r,o){return new Bw(Uw().w(t,e,n,r),o||Promise)}function Bw(t,e){function n(r,o,i,a){try{var u=t[r](o),s=u.value;return s instanceof Vw?e.resolve(s.v).then(function(t){n("next",t,i,a)},function(t){n("throw",t,i,a)}):e.resolve(s).then(function(t){u.value=t,i(u)},function(t){return n("throw",t,i,a)})}catch(t){a(t)}}var r;this.next||(Lw(Bw.prototype),Lw(Bw.prototype,"function"==typeof Symbol&&Symbol.asyncIterator||"@asyncIterator",function(){return this})),Lw(this,"_invoke",function(t,o,i){function a(){return new e(function(e,r){n(t,i,e,r)})}return r=r?r.then(a,a):a()},!0)}function Uw(){var t,e,n="function"==typeof Symbol?Symbol:{},r=n.iterator||"@@iterator",o=n.toStringTag||"@@toStringTag";function i(n,r,o,i){var s=r&&r.prototype instanceof u?r:u,c=Object.create(s.prototype);return Lw(c,"_invoke",function(n,r,o){var i,u,s,c=0,f=o||[],l=!1,h={p:0,n:0,v:t,a:p,f:p.bind(t,4),d:function(e,n){return i=e,u=0,s=t,h.n=n,a}};function p(n,r){for(u=n,s=r,e=0;!l&&c&&!o&&e<f.length;e++){var o,i=f[e],p=h.p,v=i[2];n>3?(o=v===r)&&(s=i[(u=i[4])?5:(u=3,3)],i[4]=i[5]=t):i[0]<=p&&((o=n<2&&p<i[1])?(u=0,h.v=r,h.n=i[1]):p<v&&(o=n<3||i[0]>r||r>v)&&(i[4]=n,i[5]=r,h.n=v,u=0))}if(o||n>1)return a;throw l=!0,r}return function(o,f,v){if(c>1)throw TypeError("Generator is already running");for(l&&1===f&&p(f,v),u=f,s=v;(e=u<2?t:s)||!l;){i||(u?u<3?(u>1&&(h.n=-1),p(u,s)):h.n=s:h.v=s);try{if(c=2,i){if(u||(o="next"),e=i[o]){if(!(e=e.call(i,s)))throw TypeError("iterator result is not an object");if(!e.done)return e;s=e.value,u<2&&(u=0)}else 1===u&&(e=i.return)&&e.call(i),u<2&&(s=TypeError("The iterator does not provide a '"+o+"' method"),u=1);i=t}else if((e=(l=h.n<0)?s:n.call(r,h))!==a)break}catch(e){i=t,u=1,s=e}finally{c=1}}return{value:e,done:l}}}(n,o,i),!0),c}var a={};function u(){}function s(){}function c(){}e=Object.getPrototypeOf;var f=[][r]?e(e([][r]())):(Lw(e={},r,function(){return this}),e),l=c.prototype=u.prototype=Object.create(f);function h(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,c):(t.__proto__=c,Lw(t,o,"GeneratorFunction")),t.prototype=Object.create(l),t}return s.prototype=c,Lw(l,"constructor",c),Lw(c,"constructor",s),s.displayName="GeneratorFunction",Lw(c,o,"GeneratorFunction"),Lw(l),Lw(l,o,"Generator"),Lw(l,r,function(){return this}),Lw(l,"toString",function(){return"[object Generator]"}),(Uw=function(){return{w:i,m:h}})()}function Lw(t,e,n,r){var o=Object.defineProperty;try{o({},"",{})}catch(t){o=0}Lw=function(t,e,n,r){function i(e,n){Lw(t,e,function(t){return this._invoke(e,n,t)})}e?o?o(t,e,{value:n,enumerable:!r,configurable:!r,writable:!r}):t[e]=n:(i("next",0),i("throw",1),i("return",2))},Lw(t,e,n,r)}function Vw(t,e){this.v=t,this.k=e}function Dw(t,e,n,r,o,i,a){try{var u=t[i](a),s=u.value}catch(t){return void n(t)}u.done?e(s):Promise.resolve(s).then(r,o)}function Gw(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,zw(r.key),r)}}function zw(t){var e=function(t){if("object"!=Rw(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var n=e.call(t,"string");if("object"!=Rw(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==Rw(e)?e:e+""}function Xw(t,e){return Xw=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},Xw(t,e)}function Hw(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(t){}return(Hw=function(){return!!t})()}function qw(t){return qw=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},qw(t)}var Yw,Ww=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&Xw(t,e)}(n,t);var e=function(t){var e=Hw();return function(){var n,r=qw(t);if(e){var o=qw(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return function(t,e){if(e&&("object"==Rw(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(this,n)}}(n);function n(){var t,r,o;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,n),(t=e.call(this)).frame=0,t.location=new X,t.state=0,t.init=1,t.v=new X,t.ground_flg=0,(r=Iw().mark(function e(n){return Iw().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Uh.AssetManager.o3o("model/megane.o3o");case 2:return Tw=e.sent,e.next=5,Uh.AssetManager.o3o("model/dis.o3o");case 5:return Pw=e.sent,e.next=8,Uh.AssetManager.audio("sound/bakuhatsu.wav");case 8:return kw=e.sent,e.next=11,Uh.AssetManager.audio("sound/broken.wav");case 11:e.sent,t.state=1;case 13:case"end":return e.stop()}},e)}),o=function(){var t=this,e=arguments;return new Promise(function(n,o){var i=r.apply(t,e);function a(t){Dw(i,n,o,a,u,"next",t)}function u(t){Dw(i,n,o,a,u,"throw",t)}a(void 0)})},function(t){return o.apply(this,arguments)})(),t.v[1]=.4,t.mainobj="",t}return function(t,e){e&&Gw(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1})}(n,[{key:"move",value:function(){var t=this;if(0!==this.state){if(this.init){for(var e=Pw.getCollectionObjectList(Pw.collections.bakuhatsu),n=0;n<e.length;n++){var r=e[n];engine.scene.objects.push(r),this.scene_objects.push(r),r.collision&&(this.parent.collider.addCollision(r.collision),r.collision.callbackFunc=function(e,n){t.hit(e,n)}),e[n].parent||(this.mainobj=r)}this.init=!1,kw.playSound()}if(80===this.frame){var o=this.parent.children;for(n=o.length;n--;)(o[n]instanceof Og||o[n]instanceof zg)&&o[n].bakuhatsu()}if(this.frame>this.mainobj.animation_data.action.endframe){this.parent.parent.ending=1,this.remove();var i=new zy;this.parent.addChild(i);var a=Tw.objects_name_hash.last_megane_point;X.copy(i.location,a.location),i.v[1]=-.02,i=new Mw,this.parent.addChild(i),a=Tw.objects_name_hash.last_bee_point,X.copy(i.location,a.location)}for(n=0;n<this.scene_objects.length;n++)this.scene_objects[n].setFrame(this.frame);X.copy(this.mainobj.location,this.location),this.frame++}}}]),n}(Ph);function Qw(t){return Qw="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Qw(t)}function $w(){var t=n_(),e=t.m($w),n=(Object.getPrototypeOf?Object.getPrototypeOf(e):e.__proto__).constructor;function r(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===n||"GeneratorFunction"===(e.displayName||e.name))}var o={throw:1,return:2,break:3,continue:3};function i(t){var e,n;return function(r){e||(e={stop:function(){return n(r.a,2)},catch:function(){return r.v},abrupt:function(t,e){return n(r.a,o[t],e)},delegateYield:function(t,o,i){return e.resultName=o,n(r.d,Jw(t),i)},finish:function(t){return n(r.f,t)}},n=function(t,n,o){r.p=e.prev,r.n=e.next;try{return t(n,o)}finally{e.next=r.n}}),e.resultName&&(e[e.resultName]=r.v,e.resultName=void 0),e.sent=r.v,e.next=r.n;try{return t.call(this,e)}finally{r.p=e.prev,r.n=e.next}}}return($w=function(){return{wrap:function(e,n,r,o){return t.w(i(e),n,r,o&&o.reverse())},isGeneratorFunction:r,mark:t.m,awrap:function(t,e){return new o_(t,e)},AsyncIterator:e_,async:function(t,e,n,o,a){return(r(e)?t_:Zw)(i(t),e,n,o,a)},keys:Kw,values:Jw}})()}function Jw(t){if(null!=t){var e=t["function"==typeof Symbol&&Symbol.iterator||"@@iterator"],n=0;if(e)return e.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length))return{next:function(){return t&&n>=t.length&&(t=void 0),{value:t&&t[n++],done:!t}}}}throw new TypeError(Qw(t)+" is not iterable")}function Kw(t){var e=Object(t),n=[];for(var r in e)n.unshift(r);return function t(){for(;n.length;)if((r=n.pop())in e)return t.value=r,t.done=!1,t;return t.done=!0,t}}function Zw(t,e,n,r,o){var i=t_(t,e,n,r,o);return i.next().then(function(t){return t.done?t.value:i.next()})}function t_(t,e,n,r,o){return new e_(n_().w(t,e,n,r),o||Promise)}function e_(t,e){function n(r,o,i,a){try{var u=t[r](o),s=u.value;return s instanceof o_?e.resolve(s.v).then(function(t){n("next",t,i,a)},function(t){n("throw",t,i,a)}):e.resolve(s).then(function(t){u.value=t,i(u)},function(t){return n("throw",t,i,a)})}catch(t){a(t)}}var r;this.next||(r_(e_.prototype),r_(e_.prototype,"function"==typeof Symbol&&Symbol.asyncIterator||"@asyncIterator",function(){return this})),r_(this,"_invoke",function(t,o,i){function a(){return new e(function(e,r){n(t,i,e,r)})}return r=r?r.then(a,a):a()},!0)}function n_(){var t,e,n="function"==typeof Symbol?Symbol:{},r=n.iterator||"@@iterator",o=n.toStringTag||"@@toStringTag";function i(n,r,o,i){var s=r&&r.prototype instanceof u?r:u,c=Object.create(s.prototype);return r_(c,"_invoke",function(n,r,o){var i,u,s,c=0,f=o||[],l=!1,h={p:0,n:0,v:t,a:p,f:p.bind(t,4),d:function(e,n){return i=e,u=0,s=t,h.n=n,a}};function p(n,r){for(u=n,s=r,e=0;!l&&c&&!o&&e<f.length;e++){var o,i=f[e],p=h.p,v=i[2];n>3?(o=v===r)&&(s=i[(u=i[4])?5:(u=3,3)],i[4]=i[5]=t):i[0]<=p&&((o=n<2&&p<i[1])?(u=0,h.v=r,h.n=i[1]):p<v&&(o=n<3||i[0]>r||r>v)&&(i[4]=n,i[5]=r,h.n=v,u=0))}if(o||n>1)return a;throw l=!0,r}return function(o,f,v){if(c>1)throw TypeError("Generator is already running");for(l&&1===f&&p(f,v),u=f,s=v;(e=u<2?t:s)||!l;){i||(u?u<3?(u>1&&(h.n=-1),p(u,s)):h.n=s:h.v=s);try{if(c=2,i){if(u||(o="next"),e=i[o]){if(!(e=e.call(i,s)))throw TypeError("iterator result is not an object");if(!e.done)return e;s=e.value,u<2&&(u=0)}else 1===u&&(e=i.return)&&e.call(i),u<2&&(s=TypeError("The iterator does not provide a '"+o+"' method"),u=1);i=t}else if((e=(l=h.n<0)?s:n.call(r,h))!==a)break}catch(e){i=t,u=1,s=e}finally{c=1}}return{value:e,done:l}}}(n,o,i),!0),c}var a={};function u(){}function s(){}function c(){}e=Object.getPrototypeOf;var f=[][r]?e(e([][r]())):(r_(e={},r,function(){return this}),e),l=c.prototype=u.prototype=Object.create(f);function h(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,c):(t.__proto__=c,r_(t,o,"GeneratorFunction")),t.prototype=Object.create(l),t}return s.prototype=c,r_(l,"constructor",c),r_(c,"constructor",s),s.displayName="GeneratorFunction",r_(c,o,"GeneratorFunction"),r_(l),r_(l,o,"Generator"),r_(l,r,function(){return this}),r_(l,"toString",function(){return"[object Generator]"}),(n_=function(){return{w:i,m:h}})()}function r_(t,e,n,r){var o=Object.defineProperty;try{o({},"",{})}catch(t){o=0}r_=function(t,e,n,r){function i(e,n){r_(t,e,function(t){return this._invoke(e,n,t)})}e?o?o(t,e,{value:n,enumerable:!r,configurable:!r,writable:!r}):t[e]=n:(i("next",0),i("throw",1),i("return",2))},r_(t,e,n,r)}function o_(t,e){this.v=t,this.k=e}function i_(t,e,n,r,o,i,a){try{var u=t[i](a),s=u.value}catch(t){return void n(t)}u.done?e(s):Promise.resolve(s).then(r,o)}function a_(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,u_(r.key),r)}}function u_(t){var e=function(t){if("object"!=Qw(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var n=e.call(t,"string");if("object"!=Qw(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==Qw(e)?e:e+""}function s_(){return s_="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(t,e,n){var r=function(t,e){for(;!{}.hasOwnProperty.call(t,e)&&null!==(t=l_(t)););return t}(t,e);if(r){var o=Object.getOwnPropertyDescriptor(r,e);return o.get?o.get.call(arguments.length<3?t:n):o.value}},s_.apply(null,arguments)}function c_(t,e){return c_=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},c_(t,e)}function f_(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(t){}return(f_=function(){return!!t})()}function l_(t){return l_=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},l_(t)}var h_,p_,v_,y_=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&c_(t,e)}(n,t);var e=function(t){var e=f_();return function(){var n,r=l_(t);if(e){var o=l_(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return function(t,e){if(e&&("object"==Qw(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(this,n)}}(n);function n(){var t,r,o;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,n),(t=e.call(this)).frame=0,t.location=new X,t.v=new X,t.mainobj=null,t.init=!0,t.loaded=!1,(r=$w().mark(function e(n){return $w().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Uh.AssetManager.o3o("model/dis.o3o");case 2:Yw=e.sent,t.loaded=!0;case 4:case"end":return e.stop()}},e)}),o=function(){var t=this,e=arguments;return new Promise(function(n,o){var i=r.apply(t,e);function a(t){i_(i,n,o,a,u,"next",t)}function u(t){i_(i,n,o,a,u,"throw",t)}a(void 0)})},function(t){return o.apply(this,arguments)})(),t}return function(t,e){e&&a_(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1})}(n,[{key:"remove",value:function(){for(var t=0;t<this.scene_objects.length;t++){var e=this.scene_objects[t];this.parent.collider.deleteCollision(e.collision)}s_(l_(n.prototype),"remove",this).call(this)}},{key:"move",value:function(){if(this.loaded){if(this.init){for(var t=Yw.getCollectionObjectList(Yw.collections.slash),e=0;e<t.length;e++){var n=t[e].linkCopy();engine.scene.objects.push(n),this.scene_objects.push(n),n.collision&&this.parent.collider.addCollision(n.collision),t[e].parent||(this.mainobj=n)}for(e=0;e<this.scene_objects.length;e++)(n=this.scene_objects[e])!==this.mainobj&&(n.parent=this.mainobj);this.init=!1}this.frame>this.mainobj.animation_data.action.endframe&&this.remove(),this.mainobj.setFrame(this.frame),X.copy(this.mainobj.location,this.location),this.frame++}}}]),n}(Ph);function m_(t){return m_="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},m_(t)}function b_(){var t=j_(),e=t.m(b_),n=(Object.getPrototypeOf?Object.getPrototypeOf(e):e.__proto__).constructor;function r(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===n||"GeneratorFunction"===(e.displayName||e.name))}var o={throw:1,return:2,break:3,continue:3};function i(t){var e,n;return function(r){e||(e={stop:function(){return n(r.a,2)},catch:function(){return r.v},abrupt:function(t,e){return n(r.a,o[t],e)},delegateYield:function(t,o,i){return e.resultName=o,n(r.d,d_(t),i)},finish:function(t){return n(r.f,t)}},n=function(t,n,o){r.p=e.prev,r.n=e.next;try{return t(n,o)}finally{e.next=r.n}}),e.resultName&&(e[e.resultName]=r.v,e.resultName=void 0),e.sent=r.v,e.next=r.n;try{return t.call(this,e)}finally{r.p=e.prev,r.n=e.next}}}return(b_=function(){return{wrap:function(e,n,r,o){return t.w(i(e),n,r,o&&o.reverse())},isGeneratorFunction:r,mark:t.m,awrap:function(t,e){return new S_(t,e)},AsyncIterator:x_,async:function(t,e,n,o,a){return(r(e)?__:w_)(i(t),e,n,o,a)},keys:g_,values:d_}})()}function d_(t){if(null!=t){var e=t["function"==typeof Symbol&&Symbol.iterator||"@@iterator"],n=0;if(e)return e.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length))return{next:function(){return t&&n>=t.length&&(t=void 0),{value:t&&t[n++],done:!t}}}}throw new TypeError(m_(t)+" is not iterable")}function g_(t){var e=Object(t),n=[];for(var r in e)n.unshift(r);return function t(){for(;n.length;)if((r=n.pop())in e)return t.value=r,t.done=!1,t;return t.done=!0,t}}function w_(t,e,n,r,o){var i=__(t,e,n,r,o);return i.next().then(function(t){return t.done?t.value:i.next()})}function __(t,e,n,r,o){return new x_(j_().w(t,e,n,r),o||Promise)}function x_(t,e){function n(r,o,i,a){try{var u=t[r](o),s=u.value;return s instanceof S_?e.resolve(s.v).then(function(t){n("next",t,i,a)},function(t){n("throw",t,i,a)}):e.resolve(s).then(function(t){u.value=t,i(u)},function(t){return n("throw",t,i,a)})}catch(t){a(t)}}var r;this.next||(O_(x_.prototype),O_(x_.prototype,"function"==typeof Symbol&&Symbol.asyncIterator||"@asyncIterator",function(){return this})),O_(this,"_invoke",function(t,o,i){function a(){return new e(function(e,r){n(t,i,e,r)})}return r=r?r.then(a,a):a()},!0)}function j_(){var t,e,n="function"==typeof Symbol?Symbol:{},r=n.iterator||"@@iterator",o=n.toStringTag||"@@toStringTag";function i(n,r,o,i){var s=r&&r.prototype instanceof u?r:u,c=Object.create(s.prototype);return O_(c,"_invoke",function(n,r,o){var i,u,s,c=0,f=o||[],l=!1,h={p:0,n:0,v:t,a:p,f:p.bind(t,4),d:function(e,n){return i=e,u=0,s=t,h.n=n,a}};function p(n,r){for(u=n,s=r,e=0;!l&&c&&!o&&e<f.length;e++){var o,i=f[e],p=h.p,v=i[2];n>3?(o=v===r)&&(s=i[(u=i[4])?5:(u=3,3)],i[4]=i[5]=t):i[0]<=p&&((o=n<2&&p<i[1])?(u=0,h.v=r,h.n=i[1]):p<v&&(o=n<3||i[0]>r||r>v)&&(i[4]=n,i[5]=r,h.n=v,u=0))}if(o||n>1)return a;throw l=!0,r}return function(o,f,v){if(c>1)throw TypeError("Generator is already running");for(l&&1===f&&p(f,v),u=f,s=v;(e=u<2?t:s)||!l;){i||(u?u<3?(u>1&&(h.n=-1),p(u,s)):h.n=s:h.v=s);try{if(c=2,i){if(u||(o="next"),e=i[o]){if(!(e=e.call(i,s)))throw TypeError("iterator result is not an object");if(!e.done)return e;s=e.value,u<2&&(u=0)}else 1===u&&(e=i.return)&&e.call(i),u<2&&(s=TypeError("The iterator does not provide a '"+o+"' method"),u=1);i=t}else if((e=(l=h.n<0)?s:n.call(r,h))!==a)break}catch(e){i=t,u=1,s=e}finally{c=1}}return{value:e,done:l}}}(n,o,i),!0),c}var a={};function u(){}function s(){}function c(){}e=Object.getPrototypeOf;var f=[][r]?e(e([][r]())):(O_(e={},r,function(){return this}),e),l=c.prototype=u.prototype=Object.create(f);function h(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,c):(t.__proto__=c,O_(t,o,"GeneratorFunction")),t.prototype=Object.create(l),t}return s.prototype=c,O_(l,"constructor",c),O_(c,"constructor",s),s.displayName="GeneratorFunction",O_(c,o,"GeneratorFunction"),O_(l),O_(l,o,"Generator"),O_(l,r,function(){return this}),O_(l,"toString",function(){return"[object Generator]"}),(j_=function(){return{w:i,m:h}})()}function O_(t,e,n,r){var o=Object.defineProperty;try{o({},"",{})}catch(t){o=0}O_=function(t,e,n,r){function i(e,n){O_(t,e,function(t){return this._invoke(e,n,t)})}e?o?o(t,e,{value:n,enumerable:!r,configurable:!r,writable:!r}):t[e]=n:(i("next",0),i("throw",1),i("return",2))},O_(t,e,n,r)}function S_(t,e){this.v=t,this.k=e}function E_(t,e,n,r,o,i,a){try{var u=t[i](a),s=u.value}catch(t){return void n(t)}u.done?e(s):Promise.resolve(s).then(r,o)}function P_(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,T_(r.key),r)}}function T_(t){var e=function(t){if("object"!=m_(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var n=e.call(t,"string");if("object"!=m_(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==m_(e)?e:e+""}function k_(){return k_="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(t,e,n){var r=function(t,e){for(;!{}.hasOwnProperty.call(t,e)&&null!==(t=I_(t)););return t}(t,e);if(r){var o=Object.getOwnPropertyDescriptor(r,e);return o.get?o.get.call(arguments.length<3?t:n):o.value}},k_.apply(null,arguments)}function M_(t,e){return M_=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},M_(t,e)}function R_(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(t){}return(R_=function(){return!!t})()}function I_(t){return I_=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},I_(t)}var A_,C_,F_,N_,B_=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&M_(t,e)}(n,t);var e=function(t){var e=R_();return function(){var n,r=I_(t);if(e){var o=I_(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return function(t,e){if(e&&("object"==m_(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(this,n)}}(n);function n(){var t,r,o;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,n),(t=e.call(this)).frame=0,t.location=new X,t.state=0,t.init=1,t.v=new X,t.ground_flg=0,t.target=new X,(r=b_().mark(function e(n){return b_().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Uh.AssetManager.o3o("model/dis.o3o");case 2:return h_=e.sent,e.next=5,Uh.AssetManager.audio("sound/broken.wav");case 5:return p_=e.sent,e.next=8,Uh.AssetManager.audio("sound/slash.wav");case 8:v_=e.sent,t.state=1;case 10:case"end":return e.stop()}},e)}),o=function(){var t=this,e=arguments;return new Promise(function(n,o){var i=r.apply(t,e);function a(t){E_(i,n,o,a,u,"next",t)}function u(t){E_(i,n,o,a,u,"throw",t)}a(void 0)})},function(t){return o.apply(this,arguments)})(),t.mainobj="",t.max_hp=180,t.hp=t.max_hp,t.location[1]=4,t.total_frame=0,t.motion="uneune",t.pattern=0,t.pattern_frame=0,t}return function(t,e){e&&P_(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1})}(n,[{key:"hit",value:function(t,e){if("ground"===e.name&&this.v[1]<0&&(this.ground=1),!(this.hp<=0)&&1!=this.pattern&&"beam_hit"===e.name){if(this.hp--,this.hp<=0)for(var n=0;n<this.scene_objects.length;n++)this.pattern=100,this.pattern_frame=0;else for(n=0;n<this.scene_objects.length;n++)this.scene_objects[n].animation_data&&(this.scene_objects[n].animation_data.action=h_.actions_name_hash.damage);this.frame=0}}},{key:"remove",value:function(){for(var t=0;t<this.scene_objects.length;t++){var e=this.scene_objects[t];this.parent.collider.deleteCollision(e.collision)}k_(I_(n.prototype),"remove",this).call(this)}},{key:"move",value:function(){var t=this;if(0!==this.state){if(this.init){for(var e=h_.getCollectionObjectList(h_.collections.dis),n=0;n<e.length;n++){var r=e[n];engine.scene.objects.push(r),this.scene_objects.push(r),r.collision&&(this.parent.collider.addCollision(r.collision),r.collision.callbackFunc=function(e,n){t.hit(e,n)}),e[n].parent||(this.mainobj=r)}for(n=0;n<this.scene_objects.length;n++)this.scene_objects[n].animation_data&&(this.scene_objects[n].animation_data.action=h_.actions_name_hash.uneune);this.init=!1}switch(this.hp,this.pattern){case 0:this.location[1]=(4-6.6)*(this.pattern_frame/180)+6.6,this.pattern_frame>120&&(this.pattern_frame=-1,this.pattern=1,this.base_pattern=2),this.total_frame++,this.pattern_frame%120==0&&this.createOctahedron(4);break;case 1:var o=h_.actions_name_hash.warp;0===this.pattern_frame&&this.setAction("warp"),this.pattern_frame===o.endframe>>1?(this.location[1]=3*Math.random()+3,this.location[0]=8*(Math.random()-.5)):this.pattern_frame>o.endframe&&(this.pattern_frame=-1,this.pattern=this.base_pattern);break;case 2:0===this.pattern_frame&&(this.setAction("uneune"),this.offset=Math.asin(this.location[0]/4),this.offsety=this.location[1],this.next_frame=120*Math.random()+60,this.target[1]=1*Math.sin(.01*this.pattern_frame)+4),this.target[0]=this.parent.cif.location[0]+2*Math.sin(.1*this.pattern_frame);var i=new X;X.sub(i,this.target,this.location),X.normalize(i,i),X.mul(this.v,this.v,.97),X.mad(this.v,this.v,i,.003),X.add(this.location,this.location,this.v),this.pattern_frame>=this.next_frame&&(this.pattern_frame=-1,this.base_pattern=this.pattern,Math.random()>.5?this.pattern=1:this.pattern=3),this.hp<this.max_hp*(2/3)&&(this.pattern=6,this.pattern_frame=2),this.pattern_frame%120==0&&this.createOctahedron(4);break;case 3:var a=h_.actions_name_hash.slash;this.pattern_frame,this.setAction("slash"),50===this.pattern_frame&&(v_.playSound(!1),a=new y_,this.parent.addChild(a),X.copy(a.location,this.location),X.copy(a.location,this.location)),this.pattern_frame===a.endframe&&(this.pattern=this.base_pattern,this.pattern_frame=-1,this.ground=!1);break;case 4:0===this.pattern_frame&&this.setAction("uneune"),this.v[1]-=.005,this.ground&&(this.v[1]=0,this.pattern=5,this.pattern_frame=-1),X.add(this.location,this.location,this.v);break;case 5:this.pattern_frame>=90&&(this.pattern=6,this.pattern_frame=-1);break;case 6:if(0===this.pattern_frame&&(this.v[1]=.24,this.v[0]=.01*(this.parent.cif.location[0]-this.location[0]),this.ground=!1),this.v[1]-=.005,this.ground){for(this.v[1]=0,this.pattern=5,this.pattern_frame=-1,n=0;n<3;n++){var u=new zg;this.parent.addChild(u),X.copy(u.location,this.location),u.v[0]+=.03*(2*Math.random()-1),u.v[1]+=.03*Math.random()+.07}this.parent.camera_bure=!0,this.parent.camera_frame=0}this.ground=!1,X.add(this.location,this.location,this.v),this.hp<this.max_hp/3&&(this.pattern=7,this.pattern_frame=-1);break;case 7:this.setAction("hakkyo"),0===this.pattern_frame&&(this.next_frame=60*Math.random()+30);var s=new X;if(s[1]=1*Math.sin(.01*this.pattern_frame)+4,s[0]=this.parent.cif.location[0],X.sub(s,s,this.location),X.normalize(s,s),X.mul(this.v,this.v,.98),X.mad(this.v,this.v,s,.003),X.add(this.location,this.location,this.v),this.pattern_frame>=this.next_frame&&(X.mul(this.v,this.v,0),this.pattern_frame=-1,this.base_pattern=this.pattern,Math.random()>.5?this.pattern=1:this.pattern=3),this.pattern_frame%200==0&&this.createOctahedron(8),this.pattern_frame%250==50)for(n=0;n<3;n++)u=new zg,this.parent.addChild(u),X.copy(u.location,this.location),u.v[0]+=.03*(2*Math.random()-1),u.v[1]+=.03*Math.random()+.07;break;case 100:for(n=0;n<this.scene_objects.length;n++)this.scene_objects[n].animation_data&&(this.scene_objects[n].animation_data.action=h_.actions_name_hash.yarare);if(0===this.pattern_frame&&p_.playSound(),this.pattern_frame%4==0){var c=new $p;this.parent.addChild(c),X.copy(c.location,this.location),c.location[2]+=.4}if(this.location[1]-=.005,this.pattern_frame>120){var f=new Ww;this.parent.addChild(f),X.copy(f.location,this.location),f.location[2]-=.5,this.remove()}}if("damage"===this.mainobj.animation_data.action.name&&this.frame>=this.mainobj.animation_data.action.endframe)for(n=0;n<this.scene_objects.length;n++)this.scene_objects[n].animation_data&&(this.scene_objects[n].animation_data.action=h_.actions_name_hash.uneune);for(this.pattern_frame++,n=0;n<this.scene_objects.length;n++)this.scene_objects[n].setFrame(this.pattern_frame);X.copy(this.mainobj.location,this.location),this.frame++}}},{key:"setAction",value:function(t){var e=h_.actions_name_hash[t];if(e)for(var n=0;n<this.scene_objects.length;n++)this.scene_objects[n].animation_data&&(this.scene_objects[n].animation_data.action=e)}},{key:"createOctahedron",value:function(t){for(var e=this.parent.children,n=0,r=0;r<e.length;r++)e[r]instanceof Og&&n++;if(n<t){var o=new Og;this.parent.addChild(o),X.copy(o.location,this.location),X.copy(o.target,this.location),o.target[0]+=2*(2*Math.random()-1),o.target[1]+=2*(2*Math.random()-1)}}}]),n}(Ph);function U_(t){return U_="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},U_(t)}function L_(){var t=H_(),e=t.m(L_),n=(Object.getPrototypeOf?Object.getPrototypeOf(e):e.__proto__).constructor;function r(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===n||"GeneratorFunction"===(e.displayName||e.name))}var o={throw:1,return:2,break:3,continue:3};function i(t){var e,n;return function(r){e||(e={stop:function(){return n(r.a,2)},catch:function(){return r.v},abrupt:function(t,e){return n(r.a,o[t],e)},delegateYield:function(t,o,i){return e.resultName=o,n(r.d,V_(t),i)},finish:function(t){return n(r.f,t)}},n=function(t,n,o){r.p=e.prev,r.n=e.next;try{return t(n,o)}finally{e.next=r.n}}),e.resultName&&(e[e.resultName]=r.v,e.resultName=void 0),e.sent=r.v,e.next=r.n;try{return t.call(this,e)}finally{r.p=e.prev,r.n=e.next}}}return(L_=function(){return{wrap:function(e,n,r,o){return t.w(i(e),n,r,o&&o.reverse())},isGeneratorFunction:r,mark:t.m,awrap:function(t,e){return new Y_(t,e)},AsyncIterator:X_,async:function(t,e,n,o,a){return(r(e)?z_:G_)(i(t),e,n,o,a)},keys:D_,values:V_}})()}function V_(t){if(null!=t){var e=t["function"==typeof Symbol&&Symbol.iterator||"@@iterator"],n=0;if(e)return e.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length))return{next:function(){return t&&n>=t.length&&(t=void 0),{value:t&&t[n++],done:!t}}}}throw new TypeError(U_(t)+" is not iterable")}function D_(t){var e=Object(t),n=[];for(var r in e)n.unshift(r);return function t(){for(;n.length;)if((r=n.pop())in e)return t.value=r,t.done=!1,t;return t.done=!0,t}}function G_(t,e,n,r,o){var i=z_(t,e,n,r,o);return i.next().then(function(t){return t.done?t.value:i.next()})}function z_(t,e,n,r,o){return new X_(H_().w(t,e,n,r),o||Promise)}function X_(t,e){function n(r,o,i,a){try{var u=t[r](o),s=u.value;return s instanceof Y_?e.resolve(s.v).then(function(t){n("next",t,i,a)},function(t){n("throw",t,i,a)}):e.resolve(s).then(function(t){u.value=t,i(u)},function(t){return n("throw",t,i,a)})}catch(t){a(t)}}var r;this.next||(q_(X_.prototype),q_(X_.prototype,"function"==typeof Symbol&&Symbol.asyncIterator||"@asyncIterator",function(){return this})),q_(this,"_invoke",function(t,o,i){function a(){return new e(function(e,r){n(t,i,e,r)})}return r=r?r.then(a,a):a()},!0)}function H_(){var t,e,n="function"==typeof Symbol?Symbol:{},r=n.iterator||"@@iterator",o=n.toStringTag||"@@toStringTag";function i(n,r,o,i){var s=r&&r.prototype instanceof u?r:u,c=Object.create(s.prototype);return q_(c,"_invoke",function(n,r,o){var i,u,s,c=0,f=o||[],l=!1,h={p:0,n:0,v:t,a:p,f:p.bind(t,4),d:function(e,n){return i=e,u=0,s=t,h.n=n,a}};function p(n,r){for(u=n,s=r,e=0;!l&&c&&!o&&e<f.length;e++){var o,i=f[e],p=h.p,v=i[2];n>3?(o=v===r)&&(s=i[(u=i[4])?5:(u=3,3)],i[4]=i[5]=t):i[0]<=p&&((o=n<2&&p<i[1])?(u=0,h.v=r,h.n=i[1]):p<v&&(o=n<3||i[0]>r||r>v)&&(i[4]=n,i[5]=r,h.n=v,u=0))}if(o||n>1)return a;throw l=!0,r}return function(o,f,v){if(c>1)throw TypeError("Generator is already running");for(l&&1===f&&p(f,v),u=f,s=v;(e=u<2?t:s)||!l;){i||(u?u<3?(u>1&&(h.n=-1),p(u,s)):h.n=s:h.v=s);try{if(c=2,i){if(u||(o="next"),e=i[o]){if(!(e=e.call(i,s)))throw TypeError("iterator result is not an object");if(!e.done)return e;s=e.value,u<2&&(u=0)}else 1===u&&(e=i.return)&&e.call(i),u<2&&(s=TypeError("The iterator does not provide a '"+o+"' method"),u=1);i=t}else if((e=(l=h.n<0)?s:n.call(r,h))!==a)break}catch(e){i=t,u=1,s=e}finally{c=1}}return{value:e,done:l}}}(n,o,i),!0),c}var a={};function u(){}function s(){}function c(){}e=Object.getPrototypeOf;var f=[][r]?e(e([][r]())):(q_(e={},r,function(){return this}),e),l=c.prototype=u.prototype=Object.create(f);function h(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,c):(t.__proto__=c,q_(t,o,"GeneratorFunction")),t.prototype=Object.create(l),t}return s.prototype=c,q_(l,"constructor",c),q_(c,"constructor",s),s.displayName="GeneratorFunction",q_(c,o,"GeneratorFunction"),q_(l),q_(l,o,"Generator"),q_(l,r,function(){return this}),q_(l,"toString",function(){return"[object Generator]"}),(H_=function(){return{w:i,m:h}})()}function q_(t,e,n,r){var o=Object.defineProperty;try{o({},"",{})}catch(t){o=0}q_=function(t,e,n,r){function i(e,n){q_(t,e,function(t){return this._invoke(e,n,t)})}e?o?o(t,e,{value:n,enumerable:!r,configurable:!r,writable:!r}):t[e]=n:(i("next",0),i("throw",1),i("return",2))},q_(t,e,n,r)}function Y_(t,e){this.v=t,this.k=e}function W_(t,e,n,r,o,i,a){try{var u=t[i](a),s=u.value}catch(t){return void n(t)}u.done?e(s):Promise.resolve(s).then(r,o)}function Q_(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,$_(r.key),r)}}function $_(t){var e=function(t){if("object"!=U_(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var n=e.call(t,"string");if("object"!=U_(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==U_(e)?e:e+""}function J_(){return J_="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(t,e,n){var r=function(t,e){for(;!{}.hasOwnProperty.call(t,e)&&null!==(t=tx(t)););return t}(t,e);if(r){var o=Object.getOwnPropertyDescriptor(r,e);return o.get?o.get.call(arguments.length<3?t:n):o.value}},J_.apply(null,arguments)}function K_(t,e){return K_=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},K_(t,e)}function Z_(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(t){}return(Z_=function(){return!!t})()}function tx(t){return tx=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},tx(t)}var ex,nx,rx=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&K_(t,e)}(n,t);var e=function(t){var e=Z_();return function(){var n,r=tx(t);if(e){var o=tx(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return function(t,e){if(e&&("object"==U_(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(this,n)}}(n);function n(){var t,r,o;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,n),(t=e.call(this)).frame=0,t.collider=new Yo,t.state=0,(r=L_().mark(function e(n){return L_().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Uh.AssetManager.o3o("model/megane.o3o");case 2:return A_=e.sent,e.next=5,Uh.AssetManager.audio("sound/boss.ogg");case 5:return C_=e.sent,e.next=8,Uh.AssetManager.audio("sound/count.wav");case 8:return F_=e.sent,e.next=11,Uh.AssetManager.audio("sound/count2.wav");case 11:return N_=e.sent,e.next=14,Uh.AssetManager.o3o("model/sd_cif.o3o");case 14:return e.next=16,Uh.AssetManager.audio("sound/hit.wav");case 16:t.state=1;case 17:case"end":return e.stop()}},e)}),o=function(){var t=this,e=arguments;return new Promise(function(n,o){var i=r.apply(t,e);function a(t){W_(i,n,o,a,u,"next",t)}function u(t){W_(i,n,o,a,u,"throw",t)}a(void 0)})},function(t){return o.apply(this,arguments)})(),t.init=!0,t.go=0,t.dis=null,t.cif=null,t.cloud_offsets=new Array(3),t}return function(t,e){e&&Q_(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1})}(n,[{key:"remove",value:function(){engine.scene.objects=[],C_.stop(),J_(tx(n.prototype),"remove",this).call(this)}},{key:"hit",value:function(t,e){"hit_body"===e.name&&this.parent.next()}},{key:"move",value:function(){var t=this;if(0!==this.state){engine.scene.calcMatrix(),this.collider.All();var e=A_.scenes_name_hash.deathmatch,r=A_.scenes_name_hash.deathmatch_hud;if(this.init){this.parent.ending=-1,engine.scene.world=e.world;for(var o=0;o<e.objects.length;o++){var i=e.objects[o];engine.scene.objects.push(i),this.scene_objects.push(i),i.collision&&(this.collider.addCollision(i.collision),i.name.indexOf("out")>=0&&(i.collision.callbackFunc=function(e,n){t.hit(e,n)}))}for(this.init=!1,o=0;o<r.objects.length;o++)i=r.objects[o],this.sprite_objects.push(i),engine.sprite_scene.objects.push(i);this.addChild(this.dis=new B_),this.addChild(this.cif=new jy),this.cif.enable_sword=!0;var a=A_.objects_name_hash.cloud1.animation_data.action;for(o=0;o<this.cloud_offsets.length;o++)this.cloud_offsets[o]=Math.random()*a.endframe}if(this.go||A_.objects_name_hash.go.location[1]>-2.4&&(C_.playSound(!0),this.go=1,this.cif.operable=!0),this.dis.hp<=0&&(this.cif.muteki=1,C_.stop()),this.camera_bure){var u=this.scene_objects.find(function(t){return"Camera"===t.name}),s=A_.actions_name_hash.camera_bure;u.addAction(s.slots[0],this.camera_frame),this.camera_frame++,s.endframe<this.camera_frame&&(this.camera_bure=!1)}for(o=0;o<this.cloud_offsets.length;o++){var c=this.scene_objects.find(function(t){return t.name==="cloud"+(o+1)});c&&c.setFrame(this.cloud_offsets[o]+this.frame)}r.setFrame(this.frame),60!==this.frame&&90!==this.frame&&120!==this.frame||F_.playSound(),150===this.frame&&N_.playSound();var f=A_.objects_name_hash.dis_hp;f.setFrame(this.dis.hp/this.dis.max_hp*f.animation_data.action.endframe);var l=A_.objects_name_hash.cif_hp;l.setFrame(this.cif.hp/this.cif.max_hp*l.animation_data.action.endframe),J_(tx(n.prototype),"move",this).call(this),e.setFrame(this.frame),this.frame++}}},{key:"draw",value:function(){A_&&J_(tx(n.prototype),"draw",this).call(this)}}]),n}(Ph);function ox(t){return ox="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},ox(t)}function ix(){var t=lx(),e=t.m(ix),n=(Object.getPrototypeOf?Object.getPrototypeOf(e):e.__proto__).constructor;function r(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===n||"GeneratorFunction"===(e.displayName||e.name))}var o={throw:1,return:2,break:3,continue:3};function i(t){var e,n;return function(r){e||(e={stop:function(){return n(r.a,2)},catch:function(){return r.v},abrupt:function(t,e){return n(r.a,o[t],e)},delegateYield:function(t,o,i){return e.resultName=o,n(r.d,ax(t),i)},finish:function(t){return n(r.f,t)}},n=function(t,n,o){r.p=e.prev,r.n=e.next;try{return t(n,o)}finally{e.next=r.n}}),e.resultName&&(e[e.resultName]=r.v,e.resultName=void 0),e.sent=r.v,e.next=r.n;try{return t.call(this,e)}finally{r.p=e.prev,r.n=e.next}}}return(ix=function(){return{wrap:function(e,n,r,o){return t.w(i(e),n,r,o&&o.reverse())},isGeneratorFunction:r,mark:t.m,awrap:function(t,e){return new px(t,e)},AsyncIterator:fx,async:function(t,e,n,o,a){return(r(e)?cx:sx)(i(t),e,n,o,a)},keys:ux,values:ax}})()}function ax(t){if(null!=t){var e=t["function"==typeof Symbol&&Symbol.iterator||"@@iterator"],n=0;if(e)return e.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length))return{next:function(){return t&&n>=t.length&&(t=void 0),{value:t&&t[n++],done:!t}}}}throw new TypeError(ox(t)+" is not iterable")}function ux(t){var e=Object(t),n=[];for(var r in e)n.unshift(r);return function t(){for(;n.length;)if((r=n.pop())in e)return t.value=r,t.done=!1,t;return t.done=!0,t}}function sx(t,e,n,r,o){var i=cx(t,e,n,r,o);return i.next().then(function(t){return t.done?t.value:i.next()})}function cx(t,e,n,r,o){return new fx(lx().w(t,e,n,r),o||Promise)}function fx(t,e){function n(r,o,i,a){try{var u=t[r](o),s=u.value;return s instanceof px?e.resolve(s.v).then(function(t){n("next",t,i,a)},function(t){n("throw",t,i,a)}):e.resolve(s).then(function(t){u.value=t,i(u)},function(t){return n("throw",t,i,a)})}catch(t){a(t)}}var r;this.next||(hx(fx.prototype),hx(fx.prototype,"function"==typeof Symbol&&Symbol.asyncIterator||"@asyncIterator",function(){return this})),hx(this,"_invoke",function(t,o,i){function a(){return new e(function(e,r){n(t,i,e,r)})}return r=r?r.then(a,a):a()},!0)}function lx(){var t,e,n="function"==typeof Symbol?Symbol:{},r=n.iterator||"@@iterator",o=n.toStringTag||"@@toStringTag";function i(n,r,o,i){var s=r&&r.prototype instanceof u?r:u,c=Object.create(s.prototype);return hx(c,"_invoke",function(n,r,o){var i,u,s,c=0,f=o||[],l=!1,h={p:0,n:0,v:t,a:p,f:p.bind(t,4),d:function(e,n){return i=e,u=0,s=t,h.n=n,a}};function p(n,r){for(u=n,s=r,e=0;!l&&c&&!o&&e<f.length;e++){var o,i=f[e],p=h.p,v=i[2];n>3?(o=v===r)&&(s=i[(u=i[4])?5:(u=3,3)],i[4]=i[5]=t):i[0]<=p&&((o=n<2&&p<i[1])?(u=0,h.v=r,h.n=i[1]):p<v&&(o=n<3||i[0]>r||r>v)&&(i[4]=n,i[5]=r,h.n=v,u=0))}if(o||n>1)return a;throw l=!0,r}return function(o,f,v){if(c>1)throw TypeError("Generator is already running");for(l&&1===f&&p(f,v),u=f,s=v;(e=u<2?t:s)||!l;){i||(u?u<3?(u>1&&(h.n=-1),p(u,s)):h.n=s:h.v=s);try{if(c=2,i){if(u||(o="next"),e=i[o]){if(!(e=e.call(i,s)))throw TypeError("iterator result is not an object");if(!e.done)return e;s=e.value,u<2&&(u=0)}else 1===u&&(e=i.return)&&e.call(i),u<2&&(s=TypeError("The iterator does not provide a '"+o+"' method"),u=1);i=t}else if((e=(l=h.n<0)?s:n.call(r,h))!==a)break}catch(e){i=t,u=1,s=e}finally{c=1}}return{value:e,done:l}}}(n,o,i),!0),c}var a={};function u(){}function s(){}function c(){}e=Object.getPrototypeOf;var f=[][r]?e(e([][r]())):(hx(e={},r,function(){return this}),e),l=c.prototype=u.prototype=Object.create(f);function h(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,c):(t.__proto__=c,hx(t,o,"GeneratorFunction")),t.prototype=Object.create(l),t}return s.prototype=c,hx(l,"constructor",c),hx(c,"constructor",s),s.displayName="GeneratorFunction",hx(c,o,"GeneratorFunction"),hx(l),hx(l,o,"Generator"),hx(l,r,function(){return this}),hx(l,"toString",function(){return"[object Generator]"}),(lx=function(){return{w:i,m:h}})()}function hx(t,e,n,r){var o=Object.defineProperty;try{o({},"",{})}catch(t){o=0}hx=function(t,e,n,r){function i(e,n){hx(t,e,function(t){return this._invoke(e,n,t)})}e?o?o(t,e,{value:n,enumerable:!r,configurable:!r,writable:!r}):t[e]=n:(i("next",0),i("throw",1),i("return",2))},hx(t,e,n,r)}function px(t,e){this.v=t,this.k=e}function vx(t,e,n,r,o,i,a){try{var u=t[i](a),s=u.value}catch(t){return void n(t)}u.done?e(s):Promise.resolve(s).then(r,o)}function yx(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,mx(r.key),r)}}function mx(t){var e=function(t){if("object"!=ox(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var n=e.call(t,"string");if("object"!=ox(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==ox(e)?e:e+""}function bx(){return bx="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(t,e,n){var r=function(t,e){for(;!{}.hasOwnProperty.call(t,e)&&null!==(t=_x(t)););return t}(t,e);if(r){var o=Object.getOwnPropertyDescriptor(r,e);return o.get?o.get.call(arguments.length<3?t:n):o.value}},bx.apply(null,arguments)}function gx(t,e){return gx=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},gx(t,e)}function wx(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(t){}return(wx=function(){return!!t})()}function _x(t){return _x=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},_x(t)}var xx,jx,Ox=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&gx(t,e)}(n,t);var e=function(t){var e=wx();return function(){var n,r=_x(t);if(e){var o=_x(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return function(t,e){if(e&&("object"==ox(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(this,n)}}(n);function n(){var t,r,o;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,n),(t=e.call(this)).loaded=!1,(r=ix().mark(function e(n){return ix().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Uh.AssetManager.o3o("model/ending.o3o");case 2:if(ex=e.sent,0!=t.parent.ending){e.next=9;break}return e.next=6,Uh.AssetManager.audio("sound/badend.ogg");case 6:nx=e.sent,e.next=12;break;case 9:return e.next=11,Uh.AssetManager.audio("sound/ending.ogg");case 11:nx=e.sent;case 12:t.loaded=!0;case 13:case"end":return e.stop()}},e)}),o=function(){var t=this,e=arguments;return new Promise(function(n,o){var i=r.apply(t,e);function a(t){vx(i,n,o,a,u,"next",t)}function u(t){vx(i,n,o,a,u,"throw",t)}a(void 0)})},function(t){return o.apply(this,arguments)})(),t.init=!0,t}return function(t,e){e&&yx(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1})}(n,[{key:"move",value:function(){if(this.loaded){var t=ex.scenes_name_hash["ending"+this.parent.ending],e=ex.scenes_name_hash.ending_hud;if(this.init){var r=ex.materials.find(function(t){return t.screenbuffer});r&&(r.baseColorMap=engine.screenbuffer_texture);for(var o=0;o<t.objects.length;o++){var i=t.objects[o];this.scene_objects.push(i),engine.scene.objects.push(i)}for(o=0;o<e.objects.length;o++)i=e.objects[o],/^ed.+/.test(i.name)&&i.name!=="ed"+this.parent.ending||(this.sprite_objects.push(i),engine.sprite_scene.objects.push(i));engine.scene.world=t.world,this.init=!1,this.frame=0,nx.playSound(!0)}this.frame>=t.frame_end&&this.parent.next(),t.setFrame(this.frame),e.setFrame(this.frame),this.frame++,bx(_x(n.prototype),"move",this).call(this)}}}]),n}(Ph);function Sx(t){return Sx="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Sx(t)}function Ex(){var t=Ix(),e=t.m(Ex),n=(Object.getPrototypeOf?Object.getPrototypeOf(e):e.__proto__).constructor;function r(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===n||"GeneratorFunction"===(e.displayName||e.name))}var o={throw:1,return:2,break:3,continue:3};function i(t){var e,n;return function(r){e||(e={stop:function(){return n(r.a,2)},catch:function(){return r.v},abrupt:function(t,e){return n(r.a,o[t],e)},delegateYield:function(t,o,i){return e.resultName=o,n(r.d,Px(t),i)},finish:function(t){return n(r.f,t)}},n=function(t,n,o){r.p=e.prev,r.n=e.next;try{return t(n,o)}finally{e.next=r.n}}),e.resultName&&(e[e.resultName]=r.v,e.resultName=void 0),e.sent=r.v,e.next=r.n;try{return t.call(this,e)}finally{r.p=e.prev,r.n=e.next}}}return(Ex=function(){return{wrap:function(e,n,r,o){return t.w(i(e),n,r,o&&o.reverse())},isGeneratorFunction:r,mark:t.m,awrap:function(t,e){return new Cx(t,e)},AsyncIterator:Rx,async:function(t,e,n,o,a){return(r(e)?Mx:kx)(i(t),e,n,o,a)},keys:Tx,values:Px}})()}function Px(t){if(null!=t){var e=t["function"==typeof Symbol&&Symbol.iterator||"@@iterator"],n=0;if(e)return e.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length))return{next:function(){return t&&n>=t.length&&(t=void 0),{value:t&&t[n++],done:!t}}}}throw new TypeError(Sx(t)+" is not iterable")}function Tx(t){var e=Object(t),n=[];for(var r in e)n.unshift(r);return function t(){for(;n.length;)if((r=n.pop())in e)return t.value=r,t.done=!1,t;return t.done=!0,t}}function kx(t,e,n,r,o){var i=Mx(t,e,n,r,o);return i.next().then(function(t){return t.done?t.value:i.next()})}function Mx(t,e,n,r,o){return new Rx(Ix().w(t,e,n,r),o||Promise)}function Rx(t,e){function n(r,o,i,a){try{var u=t[r](o),s=u.value;return s instanceof Cx?e.resolve(s.v).then(function(t){n("next",t,i,a)},function(t){n("throw",t,i,a)}):e.resolve(s).then(function(t){u.value=t,i(u)},function(t){return n("throw",t,i,a)})}catch(t){a(t)}}var r;this.next||(Ax(Rx.prototype),Ax(Rx.prototype,"function"==typeof Symbol&&Symbol.asyncIterator||"@asyncIterator",function(){return this})),Ax(this,"_invoke",function(t,o,i){function a(){return new e(function(e,r){n(t,i,e,r)})}return r=r?r.then(a,a):a()},!0)}function Ix(){var t,e,n="function"==typeof Symbol?Symbol:{},r=n.iterator||"@@iterator",o=n.toStringTag||"@@toStringTag";function i(n,r,o,i){var s=r&&r.prototype instanceof u?r:u,c=Object.create(s.prototype);return Ax(c,"_invoke",function(n,r,o){var i,u,s,c=0,f=o||[],l=!1,h={p:0,n:0,v:t,a:p,f:p.bind(t,4),d:function(e,n){return i=e,u=0,s=t,h.n=n,a}};function p(n,r){for(u=n,s=r,e=0;!l&&c&&!o&&e<f.length;e++){var o,i=f[e],p=h.p,v=i[2];n>3?(o=v===r)&&(s=i[(u=i[4])?5:(u=3,3)],i[4]=i[5]=t):i[0]<=p&&((o=n<2&&p<i[1])?(u=0,h.v=r,h.n=i[1]):p<v&&(o=n<3||i[0]>r||r>v)&&(i[4]=n,i[5]=r,h.n=v,u=0))}if(o||n>1)return a;throw l=!0,r}return function(o,f,v){if(c>1)throw TypeError("Generator is already running");for(l&&1===f&&p(f,v),u=f,s=v;(e=u<2?t:s)||!l;){i||(u?u<3?(u>1&&(h.n=-1),p(u,s)):h.n=s:h.v=s);try{if(c=2,i){if(u||(o="next"),e=i[o]){if(!(e=e.call(i,s)))throw TypeError("iterator result is not an object");if(!e.done)return e;s=e.value,u<2&&(u=0)}else 1===u&&(e=i.return)&&e.call(i),u<2&&(s=TypeError("The iterator does not provide a '"+o+"' method"),u=1);i=t}else if((e=(l=h.n<0)?s:n.call(r,h))!==a)break}catch(e){i=t,u=1,s=e}finally{c=1}}return{value:e,done:l}}}(n,o,i),!0),c}var a={};function u(){}function s(){}function c(){}e=Object.getPrototypeOf;var f=[][r]?e(e([][r]())):(Ax(e={},r,function(){return this}),e),l=c.prototype=u.prototype=Object.create(f);function h(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,c):(t.__proto__=c,Ax(t,o,"GeneratorFunction")),t.prototype=Object.create(l),t}return s.prototype=c,Ax(l,"constructor",c),Ax(c,"constructor",s),s.displayName="GeneratorFunction",Ax(c,o,"GeneratorFunction"),Ax(l),Ax(l,o,"Generator"),Ax(l,r,function(){return this}),Ax(l,"toString",function(){return"[object Generator]"}),(Ix=function(){return{w:i,m:h}})()}function Ax(t,e,n,r){var o=Object.defineProperty;try{o({},"",{})}catch(t){o=0}Ax=function(t,e,n,r){function i(e,n){Ax(t,e,function(t){return this._invoke(e,n,t)})}e?o?o(t,e,{value:n,enumerable:!r,configurable:!r,writable:!r}):t[e]=n:(i("next",0),i("throw",1),i("return",2))},Ax(t,e,n,r)}function Cx(t,e){this.v=t,this.k=e}function Fx(t,e,n,r,o,i,a){try{var u=t[i](a),s=u.value}catch(t){return void n(t)}u.done?e(s):Promise.resolve(s).then(r,o)}function Nx(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,Bx(r.key),r)}}function Bx(t){var e=function(t){if("object"!=Sx(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var n=e.call(t,"string");if("object"!=Sx(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==Sx(e)?e:e+""}function Ux(){return Ux="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(t,e,n){var r=function(t,e){for(;!{}.hasOwnProperty.call(t,e)&&null!==(t=Dx(t)););return t}(t,e);if(r){var o=Object.getOwnPropertyDescriptor(r,e);return o.get?o.get.call(arguments.length<3?t:n):o.value}},Ux.apply(null,arguments)}function Lx(t,e){return Lx=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},Lx(t,e)}function Vx(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(t){}return(Vx=function(){return!!t})()}function Dx(t){return Dx=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},Dx(t)}var Gx,zx=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&Lx(t,e)}(n,t);var e=function(t){var e=Vx();return function(){var n,r=Dx(t);if(e){var o=Dx(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return function(t,e){if(e&&("object"==Sx(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(this,n)}}(n);function n(){var t,r,o;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,n),(t=e.call(this)).frame=0,t.total=0,(r=Ex().mark(function t(e){return Ex().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,Uh.AssetManager.o3o("model/megane.o3o");case 2:return xx=t.sent,t.next=5,Uh.AssetManager.texture("model/test.png");case 5:jx=t.sent;case 6:case"end":return t.stop()}},t)}),o=function(){var t=this,e=arguments;return new Promise(function(n,o){var i=r.apply(t,e);function a(t){Fx(i,n,o,a,u,"next",t)}function u(t){Fx(i,n,o,a,u,"throw",t)}a(void 0)})},function(t){return o.apply(this,arguments)})(),t.round=0,t.stat=-1,t.init=1,t.pts=[0,0,0],t.meganes=new Array(3),t.ending=0,t}return function(t,e){e&&Nx(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1})}(n,[{key:"next",value:function(){var t=xx.scenes_name_hash.score;switch(this.stat){case 0:case 2:this.frame++,t.setFrame(this.frame),xx.calcMatrix(0,!1),this.children[0].remove();var e=" "+this.pts[this.round-1];e=e.slice(-2);for(var n=0;n<e.length;n++){var r=e.charCodeAt(n)-"0".charCodeAt(0);if(r>=0&&r<=9){var o=engine.sprites.addSprite(jx,32+6*n,10*(this.round-1)+2,0+8*r,88,8,8);this.sprites.push(o)}}this.addChild(new Rm),this.stat++;break;case-1:case 1:case 3:this.children.length&&this.children[0].remove(),this.round++;var i=new sm;i.round=this.round,this.addChild(i),this.stat++;break;case 4:for(n=0;n<this.sprites.length;n++)o=this.sprites[n],engine.sprites.removeSprite(o);for(n=0;n<this.sprite_objects.length;n++){var a=this.sprite_objects[n],u=engine.sprite_scene.objects.indexOf(a);u>=0&&engine.sprite_scene.objects.splice(u,1)}this.children[0].remove();var s=this.pts;for(this.total=0,n=0;n<s.length;n++)this.total+=s[n];var c=new Jm;this.addChild(c),this.stat++;break;case 5:if(this.children[0].remove(),this.total>=30)this.addChild(new nd),this.stat+=2;else{var f=new Fb;this.addChild(f),this.stat++}break;case 6:this.remove(),this.parent.addChild(new cj);break;case 7:this.children[0].remove(),this.addChild(new _d),this.stat++;break;case 8:this.children[0].remove(),this.addChild(new Dd),this.stat++;break;case 9:this.children.length&&this.children[0].remove(),this.addChild(new rx),this.stat++;break;case 10:this.children[0].remove(),-1===this.ending?(this.remove(),this.parent.addChild(new mb)):(this.addChild(new Ox),this.stat++)}}},{key:"move",value:function(){if(xx){var t=xx.scenes_name_hash.score;if(this.init){for(var e=0;e<t.objects.length;e++){var r=t.objects[e];engine.sprite_scene.objects.push(r),this.sprite_objects.push(r)}this.init=0,this.next(),t.setFrame(0)}Ux(Dx(n.prototype),"move",this).call(this)}}}]),n}(Ph);function Xx(t){return Xx="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Xx(t)}function Hx(){var t=Jx(),e=t.m(Hx),n=(Object.getPrototypeOf?Object.getPrototypeOf(e):e.__proto__).constructor;function r(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===n||"GeneratorFunction"===(e.displayName||e.name))}var o={throw:1,return:2,break:3,continue:3};function i(t){var e,n;return function(r){e||(e={stop:function(){return n(r.a,2)},catch:function(){return r.v},abrupt:function(t,e){return n(r.a,o[t],e)},delegateYield:function(t,o,i){return e.resultName=o,n(r.d,qx(t),i)},finish:function(t){return n(r.f,t)}},n=function(t,n,o){r.p=e.prev,r.n=e.next;try{return t(n,o)}finally{e.next=r.n}}),e.resultName&&(e[e.resultName]=r.v,e.resultName=void 0),e.sent=r.v,e.next=r.n;try{return t.call(this,e)}finally{r.p=e.prev,r.n=e.next}}}return(Hx=function(){return{wrap:function(e,n,r,o){return t.w(i(e),n,r,o&&o.reverse())},isGeneratorFunction:r,mark:t.m,awrap:function(t,e){return new Zx(t,e)},AsyncIterator:$x,async:function(t,e,n,o,a){return(r(e)?Qx:Wx)(i(t),e,n,o,a)},keys:Yx,values:qx}})()}function qx(t){if(null!=t){var e=t["function"==typeof Symbol&&Symbol.iterator||"@@iterator"],n=0;if(e)return e.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length))return{next:function(){return t&&n>=t.length&&(t=void 0),{value:t&&t[n++],done:!t}}}}throw new TypeError(Xx(t)+" is not iterable")}function Yx(t){var e=Object(t),n=[];for(var r in e)n.unshift(r);return function t(){for(;n.length;)if((r=n.pop())in e)return t.value=r,t.done=!1,t;return t.done=!0,t}}function Wx(t,e,n,r,o){var i=Qx(t,e,n,r,o);return i.next().then(function(t){return t.done?t.value:i.next()})}function Qx(t,e,n,r,o){return new $x(Jx().w(t,e,n,r),o||Promise)}function $x(t,e){function n(r,o,i,a){try{var u=t[r](o),s=u.value;return s instanceof Zx?e.resolve(s.v).then(function(t){n("next",t,i,a)},function(t){n("throw",t,i,a)}):e.resolve(s).then(function(t){u.value=t,i(u)},function(t){return n("throw",t,i,a)})}catch(t){a(t)}}var r;this.next||(Kx($x.prototype),Kx($x.prototype,"function"==typeof Symbol&&Symbol.asyncIterator||"@asyncIterator",function(){return this})),Kx(this,"_invoke",function(t,o,i){function a(){return new e(function(e,r){n(t,i,e,r)})}return r=r?r.then(a,a):a()},!0)}function Jx(){var t,e,n="function"==typeof Symbol?Symbol:{},r=n.iterator||"@@iterator",o=n.toStringTag||"@@toStringTag";function i(n,r,o,i){var s=r&&r.prototype instanceof u?r:u,c=Object.create(s.prototype);return Kx(c,"_invoke",function(n,r,o){var i,u,s,c=0,f=o||[],l=!1,h={p:0,n:0,v:t,a:p,f:p.bind(t,4),d:function(e,n){return i=e,u=0,s=t,h.n=n,a}};function p(n,r){for(u=n,s=r,e=0;!l&&c&&!o&&e<f.length;e++){var o,i=f[e],p=h.p,v=i[2];n>3?(o=v===r)&&(s=i[(u=i[4])?5:(u=3,3)],i[4]=i[5]=t):i[0]<=p&&((o=n<2&&p<i[1])?(u=0,h.v=r,h.n=i[1]):p<v&&(o=n<3||i[0]>r||r>v)&&(i[4]=n,i[5]=r,h.n=v,u=0))}if(o||n>1)return a;throw l=!0,r}return function(o,f,v){if(c>1)throw TypeError("Generator is already running");for(l&&1===f&&p(f,v),u=f,s=v;(e=u<2?t:s)||!l;){i||(u?u<3?(u>1&&(h.n=-1),p(u,s)):h.n=s:h.v=s);try{if(c=2,i){if(u||(o="next"),e=i[o]){if(!(e=e.call(i,s)))throw TypeError("iterator result is not an object");if(!e.done)return e;s=e.value,u<2&&(u=0)}else 1===u&&(e=i.return)&&e.call(i),u<2&&(s=TypeError("The iterator does not provide a '"+o+"' method"),u=1);i=t}else if((e=(l=h.n<0)?s:n.call(r,h))!==a)break}catch(e){i=t,u=1,s=e}finally{c=1}}return{value:e,done:l}}}(n,o,i),!0),c}var a={};function u(){}function s(){}function c(){}e=Object.getPrototypeOf;var f=[][r]?e(e([][r]())):(Kx(e={},r,function(){return this}),e),l=c.prototype=u.prototype=Object.create(f);function h(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,c):(t.__proto__=c,Kx(t,o,"GeneratorFunction")),t.prototype=Object.create(l),t}return s.prototype=c,Kx(l,"constructor",c),Kx(c,"constructor",s),s.displayName="GeneratorFunction",Kx(c,o,"GeneratorFunction"),Kx(l),Kx(l,o,"Generator"),Kx(l,r,function(){return this}),Kx(l,"toString",function(){return"[object Generator]"}),(Jx=function(){return{w:i,m:h}})()}function Kx(t,e,n,r){var o=Object.defineProperty;try{o({},"",{})}catch(t){o=0}Kx=function(t,e,n,r){function i(e,n){Kx(t,e,function(t){return this._invoke(e,n,t)})}e?o?o(t,e,{value:n,enumerable:!r,configurable:!r,writable:!r}):t[e]=n:(i("next",0),i("throw",1),i("return",2))},Kx(t,e,n,r)}function Zx(t,e){this.v=t,this.k=e}function tj(t,e,n,r,o,i,a){try{var u=t[i](a),s=u.value}catch(t){return void n(t)}u.done?e(s):Promise.resolve(s).then(r,o)}function ej(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,nj(r.key),r)}}function nj(t){var e=function(t){if("object"!=Xx(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var n=e.call(t,"string");if("object"!=Xx(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==Xx(e)?e:e+""}function rj(){return rj="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(t,e,n){var r=function(t,e){for(;!{}.hasOwnProperty.call(t,e)&&null!==(t=aj(t)););return t}(t,e);if(r){var o=Object.getOwnPropertyDescriptor(r,e);return o.get?o.get.call(arguments.length<3?t:n):o.value}},rj.apply(null,arguments)}function oj(t,e){return oj=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},oj(t,e)}function ij(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(t){}return(ij=function(){return!!t})()}function aj(t){return aj=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},aj(t)}var uj,sj,cj=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&oj(t,e)}(n,t);var e=function(t){var e=ij();return function(){var n,r=aj(t);if(e){var o=aj(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return function(t,e){if(e&&("object"==Xx(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(this,n)}}(n);function n(){var t,r,o;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,n),(t=e.call(this)).frame=0,t.select=-1,(r=Hx().mark(function e(n){var r,o,i;return Hx().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Uh.AssetManager.o3o("model/megane.o3o");case 2:for(Gx=e.sent,r=Gx.scenes_name_hash.title,o=Gx.scenes_name_hash.titlebg,r.setFrame(t.frame),Gx.calcMatrix(),engine.scene.world=o.world,Gx.calcMatrix(0,!1),i=0;i<r.objects.length;i++)engine.sprite_scene.objects.push(r.objects[i]);t.init=!0;case 11:case"end":return e.stop()}},e)}),o=function(){var t=this,e=arguments;return new Promise(function(n,o){var i=r.apply(t,e);function a(t){tj(i,n,o,a,u,"next",t)}function u(t){tj(i,n,o,a,u,"throw",t)}a(void 0)})},function(t){return o.apply(this,arguments)})(),t.cloud_offsets=new Array(3),t}return function(t,e){e&&ej(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1})}(n,[{key:"move",value:function(){if(Gx){var t=Gx.scenes_name_hash.titlebg,e=Gx.scenes_name_hash.title;if(this.init&&t.world.envTexture.data){for(var r=0;r<t.objects.length;r++){var o=t.objects[r];this.scene_objects.push(o),engine.scene.objects.includes(t.objects[r])||engine.scene.objects.push(t.objects[r])}this.init=!1;var i=Gx.objects_name_hash.cloud1.animation_data.action;for(r=0;r<this.cloud_offsets.length;r++)this.cloud_offsets[r]=Math.random()*i.endframe}for(t.setFrame(this.frame),e.setFrame(this.frame),r=0;r<this.cloud_offsets.length;r++){var a=this.scene_objects.find(function(t){return t.name==="cloud"+(r+1)});a&&a.setFrame(this.cloud_offsets[r]+this.frame)}if(!Ut.keyflagOld[4]&&Ut.keyflag[4]){this.remove(),engine.sprite_scene.objects=[],engine.scene.objects=[];var u=new zx;this.parent.addChild(u),u.stat=this.select}this.frame++,z.setInit(ono3d.worldMatrix),rj(aj(n.prototype),"move",this).call(this)}}},{key:"draw",value:function(){}}]),n}(Ph);function fj(t){return fj="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},fj(t)}function lj(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=Array(e);n<e;n++)r[n]=t[n];return r}function hj(){var t=dj(),e=t.m(hj),n=(Object.getPrototypeOf?Object.getPrototypeOf(e):e.__proto__).constructor;function r(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===n||"GeneratorFunction"===(e.displayName||e.name))}var o={throw:1,return:2,break:3,continue:3};function i(t){var e,n;return function(r){e||(e={stop:function(){return n(r.a,2)},catch:function(){return r.v},abrupt:function(t,e){return n(r.a,o[t],e)},delegateYield:function(t,o,i){return e.resultName=o,n(r.d,pj(t),i)},finish:function(t){return n(r.f,t)}},n=function(t,n,o){r.p=e.prev,r.n=e.next;try{return t(n,o)}finally{e.next=r.n}}),e.resultName&&(e[e.resultName]=r.v,e.resultName=void 0),e.sent=r.v,e.next=r.n;try{return t.call(this,e)}finally{r.p=e.prev,r.n=e.next}}}return(hj=function(){return{wrap:function(e,n,r,o){return t.w(i(e),n,r,o&&o.reverse())},isGeneratorFunction:r,mark:t.m,awrap:function(t,e){return new wj(t,e)},AsyncIterator:bj,async:function(t,e,n,o,a){return(r(e)?mj:yj)(i(t),e,n,o,a)},keys:vj,values:pj}})()}function pj(t){if(null!=t){var e=t["function"==typeof Symbol&&Symbol.iterator||"@@iterator"],n=0;if(e)return e.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length))return{next:function(){return t&&n>=t.length&&(t=void 0),{value:t&&t[n++],done:!t}}}}throw new TypeError(fj(t)+" is not iterable")}function vj(t){var e=Object(t),n=[];for(var r in e)n.unshift(r);return function t(){for(;n.length;)if((r=n.pop())in e)return t.value=r,t.done=!1,t;return t.done=!0,t}}function yj(t,e,n,r,o){var i=mj(t,e,n,r,o);return i.next().then(function(t){return t.done?t.value:i.next()})}function mj(t,e,n,r,o){return new bj(dj().w(t,e,n,r),o||Promise)}function bj(t,e){function n(r,o,i,a){try{var u=t[r](o),s=u.value;return s instanceof wj?e.resolve(s.v).then(function(t){n("next",t,i,a)},function(t){n("throw",t,i,a)}):e.resolve(s).then(function(t){u.value=t,i(u)},function(t){return n("throw",t,i,a)})}catch(t){a(t)}}var r;this.next||(gj(bj.prototype),gj(bj.prototype,"function"==typeof Symbol&&Symbol.asyncIterator||"@asyncIterator",function(){return this})),gj(this,"_invoke",function(t,o,i){function a(){return new e(function(e,r){n(t,i,e,r)})}return r=r?r.then(a,a):a()},!0)}function dj(){var t,e,n="function"==typeof Symbol?Symbol:{},r=n.iterator||"@@iterator",o=n.toStringTag||"@@toStringTag";function i(n,r,o,i){var s=r&&r.prototype instanceof u?r:u,c=Object.create(s.prototype);return gj(c,"_invoke",function(n,r,o){var i,u,s,c=0,f=o||[],l=!1,h={p:0,n:0,v:t,a:p,f:p.bind(t,4),d:function(e,n){return i=e,u=0,s=t,h.n=n,a}};function p(n,r){for(u=n,s=r,e=0;!l&&c&&!o&&e<f.length;e++){var o,i=f[e],p=h.p,v=i[2];n>3?(o=v===r)&&(s=i[(u=i[4])?5:(u=3,3)],i[4]=i[5]=t):i[0]<=p&&((o=n<2&&p<i[1])?(u=0,h.v=r,h.n=i[1]):p<v&&(o=n<3||i[0]>r||r>v)&&(i[4]=n,i[5]=r,h.n=v,u=0))}if(o||n>1)return a;throw l=!0,r}return function(o,f,v){if(c>1)throw TypeError("Generator is already running");for(l&&1===f&&p(f,v),u=f,s=v;(e=u<2?t:s)||!l;){i||(u?u<3?(u>1&&(h.n=-1),p(u,s)):h.n=s:h.v=s);try{if(c=2,i){if(u||(o="next"),e=i[o]){if(!(e=e.call(i,s)))throw TypeError("iterator result is not an object");if(!e.done)return e;s=e.value,u<2&&(u=0)}else 1===u&&(e=i.return)&&e.call(i),u<2&&(s=TypeError("The iterator does not provide a '"+o+"' method"),u=1);i=t}else if((e=(l=h.n<0)?s:n.call(r,h))!==a)break}catch(e){i=t,u=1,s=e}finally{c=1}}return{value:e,done:l}}}(n,o,i),!0),c}var a={};function u(){}function s(){}function c(){}e=Object.getPrototypeOf;var f=[][r]?e(e([][r]())):(gj(e={},r,function(){return this}),e),l=c.prototype=u.prototype=Object.create(f);function h(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,c):(t.__proto__=c,gj(t,o,"GeneratorFunction")),t.prototype=Object.create(l),t}return s.prototype=c,gj(l,"constructor",c),gj(c,"constructor",s),s.displayName="GeneratorFunction",gj(c,o,"GeneratorFunction"),gj(l),gj(l,o,"Generator"),gj(l,r,function(){return this}),gj(l,"toString",function(){return"[object Generator]"}),(dj=function(){return{w:i,m:h}})()}function gj(t,e,n,r){var o=Object.defineProperty;try{o({},"",{})}catch(t){o=0}gj=function(t,e,n,r){function i(e,n){gj(t,e,function(t){return this._invoke(e,n,t)})}e?o?o(t,e,{value:n,enumerable:!r,configurable:!r,writable:!r}):t[e]=n:(i("next",0),i("throw",1),i("return",2))},gj(t,e,n,r)}function wj(t,e){this.v=t,this.k=e}function _j(t,e,n,r,o,i,a){try{var u=t[i](a),s=u.value}catch(t){return void n(t)}u.done?e(s):Promise.resolve(s).then(r,o)}function xj(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,jj(r.key),r)}}function jj(t){var e=function(t){if("object"!=fj(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var n=e.call(t,"string");if("object"!=fj(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==fj(e)?e:e+""}function Oj(){return Oj="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(t,e,n){var r=function(t,e){for(;!{}.hasOwnProperty.call(t,e)&&null!==(t=Pj(t)););return t}(t,e);if(r){var o=Object.getOwnPropertyDescriptor(r,e);return o.get?o.get.call(arguments.length<3?t:n):o.value}},Oj.apply(null,arguments)}function Sj(t,e){return Sj=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},Sj(t,e)}function Ej(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(t){}return(Ej=function(){return!!t})()}function Pj(t){return Pj=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},Pj(t)}var Tj=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&Sj(t,e)}(n,t);var e=function(t){var e=Ej();return function(){var n,r=Pj(t);if(e){var o=Pj(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return function(t,e){if(e&&("object"==fj(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(this,n)}}(n);function n(){var t,r,o;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,n),(t=e.call(this)).loaded=!1,(r=hj().mark(function e(n){return hj().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Uh.AssetManager.o3o("model/opening.o3o");case 2:return uj=e.sent,e.next=5,Uh.AssetManager.font("font/font.txt");case 5:sj=e.sent,t.loaded=!0;case 7:case"end":return e.stop()}},e)}),o=function(){var t=this,e=arguments;return new Promise(function(n,o){var i=r.apply(t,e);function a(t){_j(i,n,o,a,u,"next",t)}function u(t){_j(i,n,o,a,u,"throw",t)}a(void 0)})},function(t){return o.apply(this,arguments)})(),t.init=!0,t}return function(t,e){e&&xj(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1})}(n,[{key:"move",value:function(){if(this.loaded){var t=uj.scenes_name_hash.opening;if(this.init){for(var e=0;e<t.objects.length;e++){var r=t.objects[e];this.sprite_objects.push(r),engine.sprite_scene.objects.push(r)}this.init=!1,this.frame=0;var o,i=32,a=32,u=function(t,e){var n="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=function(t,e){if(t){if("string"==typeof t)return lj(t,e);var n={}.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?lj(t,e):void 0}}(t))||e&&t&&"number"==typeof t.length){n&&(t=n);var r=0,o=function(){};return{s:o,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(t){throw t},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,a=!0,u=!1;return{s:function(){n=n.call(t)},n:function(){var t=n.next();return a=t.done,t},e:function(t){u=!0,i=t},f:function(){try{a||null==n.return||n.return()}finally{if(u)throw i}}}}("This is an wicked imitation video game.\nContains many lies and spoilers.");try{for(u.s();!(o=u.n()).done;){var s=o.value;if(s.codePointAt(0)!=="\n".codePointAt(0)){var c=sj.chars[s.codePointAt(0)];if(c){var f=engine.sprites.addSprite(sj.img,i,a,c[1],c[2],c[3],c[4]);i+=c[3],this.sprites.push(f)}}else a+=sj.chars[65][4],i=32}}catch(t){u.e(t)}finally{u.f()}}if(this.frame>=t.frame_end){this.remove();var l=new cj;this.parent.addChild(l)}t.setFrame(this.frame),this.frame++,Oj(Pj(n.prototype),"move",this).call(this)}}}]),n}(Ph);function kj(t){return kj="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},kj(t)}function Mj(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,Rj(r.key),r)}}function Rj(t){var e=function(t){if("object"!=kj(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var n=e.call(t,"string");if("object"!=kj(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==kj(e)?e:e+""}var Ij=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t)}return function(t,e){e&&Mj(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1})}(t,[{key:"init",value:function(t,e){var n=this,r=document.createElement("link");r.rel="stylesheet",r.href="css/vpad.css",document.head.appendChild(r);var o=function(e){t[e.target.code]=!0},i=function(e){t[e.target.code]=1&e.buttons},a=function(e){t[e.target.code]=!1},u=document.createElement("div");u.className="vpad";for(var s=0;s<e.length;s++){var c=e[s],f=document.createElement("span");f.className="vpad",f.setAttribute("code",c.code),f.code=c.code,f.textContent=c.label,f.addEventListener("pointerdown",o),f.addEventListener("pointerup",a),f.addEventListener("pointerout",a),f.addEventListener("pointerenter",i),u.appendChild(f)}this.div=u,u.style.display="none",document.body.appendChild(u);var l=document.getElementById("vpad_visible");l.addEventListener("change",function(t){n.show(t.currentTarget.checked)}),this.checkbox=l,navigator.userAgent.match(/iPhone|Android.+Mobile/)&&this.show(!0)}},{key:"show",value:function(t){this.div.style.display=t?"inline-block":"none",this.checkbox.checked=t}}]),t}();function Aj(t){return Aj="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Aj(t)}function Cj(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,Nj(r.key),r)}}function Fj(t,e,n){return e&&Cj(t.prototype,e),n&&Cj(t,n),Object.defineProperty(t,"prototype",{writable:!1}),t}function Nj(t){var e=function(t){if("object"!=Aj(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var n=e.call(t,"string");if("object"!=Aj(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==Aj(e)?e:e+""}new(Fj(function t(){var e=this;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.engine=new Uh,window.engine=this.engine,this.engine.userInit=function(){window.engine=e.engine,window.ono3d=e.engine.ono3d,window.Util=Ut;var t=new Tj;e.engine.rootTask.addChild(t)},this.engine.init(document.getElementById("aaa"),640,480),(new Ij).init(Ut.keyflag,[{code:0,label:"left"},{code:2,label:"right"},{code:4,label:"z"},{code:5,label:"x"}])}))}();